!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.PUBNUB=t():e.PUBNUB=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){var t,n,r=0,i=0,a=!0,o=e.timeout||f.DEF_TIMEOUT,s=e.data||{},u=e.fail||function(){},c=e.success||function(){},l=function(e,i){r||(r=1,clearTimeout(n),t&&(t.onerror=t.onload=null,t.abort&&t.abort(),t=null),e&&u(i))},h=function(){if(!i){var e;i=1,clearTimeout(n);try{e=JSON.parse(t.responseText)}catch(r){return l(1)}c(e)}};n=f.timeout(function(){l(1)},o);try{t="undefined"!=typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest,t.onerror=t.onabort=function(){l(1,t.responseText||{error:"Network Connection Error"})},t.onload=t.onloadend=h,s.pnsdk=d;var p=f.build_url(e.url,s);t.open("GET",p,a),a&&(t.timeout=o),t.send()}catch(y){l(1,{error:"XHR Failed",stacktrace:y})}return l}function i(e,t){var n=h.HmacSHA256(e,t);return n.toString(h.enc.Base64)}function a(){if(!("onLine"in navigator))return 1;try{return navigator.onLine}catch(e){return!0}}function o(e){return"sendBeacon"in navigator?navigator.sendBeacon(e):!1}function s(e){console.error(e)}function u(e){e.db=p,e.xdr=r,e.error=e.error||s,e.hmac_SHA256=i,e.crypto_obj=l(),e._is_online=a,e.sendBeacon=o,e.params={pnsdk:d};var t=function(e){return u(e)},n=f.PN_API(e);for(var c in n)n.hasOwnProperty(c)&&(t[c]=n[c]);return t.init=t,t.crypto_obj=l(),t.PNmessage=f.PNmessage,window.addEventListener("beforeunload",function(){return t["each-channel"](function(e){t.LEAVE(e.name,0)}),!0}),t.ready(),window.addEventListener("offline",t.offline),t}var c=n(1),f=n(2),l=n(40),h=n(41),d="PubNub-JS-consumer/"+c.version,p=function(){var e="undefined"!=typeof localStorage&&localStorage;return{get:function(t){try{return e?e.getItem(t):-1===document.cookie.indexOf(t)?null:((document.cookie||"").match(RegExp(t+"=([^;]+)"))||[])[1]||null}catch(n){return}},set:function(t,n){try{if(e)return e.setItem(t,n)&&0;document.cookie=t+"="+n+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(r){return}}}}();u.PNmessage=f.PNmessage,e.exports=u},function(e,t){e.exports={name:"pubnub",preferGlobal:!1,version:"4.0.0-beta1",author:"PubNub <support@pubnub.com>",description:"Publish & Subscribe Real-time Messaging with PubNub",contributors:[{name:"Stephen Blum",email:"stephen@pubnub.com"}],bin:{},scripts:{test:"grunt test --force"},main:"./node.js/pubnub.js",browser:"./modern/dist/pubnub.js",repository:{type:"git",url:"git://github.com/pubnub/javascript.git"},keywords:["cloud","publish","subscribe","websockets","comet","bosh","xmpp","real-time","messaging"],dependencies:{agentkeepalive:"~0.2",bunyan:"^1.5.1",lodash:"^4.1.0",loglevel:"^1.4.0",uuid:"^2.0.1"},noAnalyze:!1,devDependencies:{"babel-core":"^6.6.5","babel-eslint":"5.0.0","babel-plugin-transform-class-properties":"^6.6.0","babel-plugin-transform-flow-strip-types":"^6.6.5","babel-preset-es2015":"^6.6.0","babel-register":"^6.6.5",chai:"3.5.0",eslint:"2.2.0","eslint-config-airbnb":"6.0.2","eslint-plugin-flowtype":"2.1.0","eslint-plugin-mocha":"2.0.0","eslint-plugin-react":"4.1.0","flow-bin":"^0.22.1",gulp:"^3.9.1","gulp-babel":"^6.1.2","gulp-clean":"^0.3.2","gulp-exec":"^2.1.2","gulp-flowtype":"^0.4.9","gulp-mocha":"^2.2.0","gulp-rename":"^1.2.2","gulp-webpack":"^1.5.0","imports-loader":"0.6.5",isparta:"4.0.0","json-loader":"0.5.4",karma:"0.13.21","karma-chai":"0.1.0","karma-mocha":"^0.2.2","karma-phantomjs-launcher":"1.0.0","karma-spec-reporter":"0.0.24","load-grunt-tasks":"^3.4.1",mocha:"2.4.5","node-uuid":"1.4.7","phantomjs-prebuilt":"2.1.4",proxyquire:"1.7.4","run-sequence":"^1.1.5",sinon:"^1.17.3","uglify-js":"^2.6.2",underscore:"1.7.0",webpack:"^1.12.14","webpack-dev-server":"1.14.1"},bundleDependencies:[],license:"MIT",engine:{node:">=0.8"}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(){return"x"+ ++G+ +new Date}function a(){L||(L=1,F.each(z,function(e){e()}))}function o(e){var t=e||{apns:{}};return t.getPubnubMessage=function(){var e={};if(Object.keys(t.apns).length){e.pn_apns={aps:{alert:t.apns.alert,badge:t.apns.badge}};for(var n in t.apns)e.pn_apns[n]=t.apns[n];var r=["badge","alert"];for(var n in r)delete e.pn_apns[r[n]]}t.gcm&&(e.pn_gcm={data:t.gcm});for(var n in t)e[n]=t[n];var i=["apns","gcm","publish","channel","callback","error"];for(var n in i)delete e[i[n]];return e},t.publish=function(){var e=t.getPubnubMessage();t.pubnub&&t.channel&&t.pubnub.publish({message:e,channel:t.channel,callback:t.callback,error:t.error})},t}function s(e){function t(e,t){return O.encrypt(e,t||M.getCipherKey())||e}function n(e,t){return O.decrypt(e,t||M.getCipherKey())||O.decrypt(e,M.getCipherKey())||e}function r(e){var t=0;return F.each(A.generate_channel_group_list(),function(n){var r=A.getChannelGroup(n);r&&(t++,(e||function(){})(r))}),t}function o(e){var t=0;return F.each(A.generate_channel_list(),function(n){var r=A.getChannel(n);r&&(t++,(e||function(){})(r))}),t}function s(){ye()||l(1,{error:"Offline. Please check your network settings."}),_e&&clearTimeout(_e),_e=F.timeout(s,R.SECOND)}function c(){oe&&be.time(function(e){y(function(){},e),e||l(1,{error:"Heartbeat failed to connect to Pubnub Servers.Please check your network settings."}),ve&&clearTimeout(ve),ve=F.timeout(c,ae)})}function l(e,t){le&&le(e,t),le=null,clearTimeout(_e),clearTimeout(ve)}function d(e){var t=F.rnow()-ue;return t-e/1e4}function y(e,t){function n(t){if(t){var n=t/1e4,i=(F.rnow()-r)/2;ue=F.rnow()-(n+i),e&&e(ue)}}var r=F.rnow();t&&n(t)||be.time(n)}var _="undefined"!=typeof e.use_send_beacon?e.use_send_beacon:!0,b=_?e.sendBeacon:null,m=e.xdr,w=e.db||{get:function(){},set:function(){}},C=e.error||function(){},I=e.hmac_SHA256,O=e.crypto_obj||{encrypt:function(e){return e},decrypt:function(e){return e}},M=(new p["default"]).setInstanceId(f["default"].v4()).setAuthKey(e.auth_key||"").setSecretKey(e.secret_key||"").setSubscribeKey(e.subscribe_key).setPublishKey(e.publish_key).setCipherKey(e.cipher_key);M.setUUID(e.uuid||!e.unique_uuid&&w.get(M.getSubscribeKey()+"uuid")||f["default"].v4()),w.set(M.getSubscribeKey()+"uuid",M.getUUID());var B=(new g["default"]).setRequestIdConfig(e.use_request_id||!1).setPresenceTimeout(F.validateHeartbeat(e.heartbeat||e.pnexpires||0,C)).setSupressLeaveEvents(e.noleave||0).setInstanceIdConfig(e.instance_id||!1);B.setHeartbeatInterval(e.heartbeat_interval||B.getPresenceTimeout()/2-1);var A=new v["default"],T=new h["default"](e.xdr,M,e.ssl,e.origin).addBeaconDispatcher(b).setCoreParams(e.params||{}),N=new k["default"]({networking:T}),G=new P["default"]({keychain:M,config:B,networking:T}),Q=new K["default"]({keychain:M,config:B,networking:T,error:C}),V=new x["default"]({keychain:M,config:B,networking:T,error:C,state:A}),$=new E["default"]({keychain:M,networking:T,error:C,decrypt:n}),Y=new U["default"]({keychain:M,config:B,networking:T,error:C,hmac_SHA256:I}),Z=new D["default"]({keychain:M,networking:T,error:C}),ee=new j["default"]({keychain:M,networking:T,config:B,error:C}),te=new H["default"]({keychain:M,networking:T,presenceEndpoints:V,error:C,config:B,publishQueue:N,state:A}),ne=new k["default"](B,A,V,C),re=+e.windowing||q,ie=(+e.timeout||X)*R.SECOND,ae=(+e.keepalive||J)*R.SECOND,oe=e.timecheck||0,se=function(){},ue=0,ce=0,fe=0,le=0,he=e.restore||0,de=0,pe=!1,ye=(e.no_wait_for_pending,e._is_online||function(){return 1}),ge=e.shutdown,_e=void 0,ve=void 0;2===B.getPresenceTimeout()&&B.setHeartbeatInterval(1);var be={history:function(e,t){$.fetchHistory(e,t)},time:function(e){G.fetchTime(e)},here_now:function(e,t){V.hereNow(e,t)},where_now:function(e,t){V.whereNow(e,t)},presence_heartbeat:function(e){V.heartbeat(e)},state:function(e,t){V.performState(e,t)},grant:function(e,t){Y.performGrant(e,t)},audit:function(e,t){Y.performAudit(e,t)},mobile_gw_provision:function(e){Q.provisionDevice(e)},replay:function(e,t){Z.performReplay(e,t)},channel_group:function(e,t){ee.channelGroup(e,t)},channel_group_list_groups:function(e,t){ee.listGroups(e,t)},channel_group_remove_group:function(e,t){ee.removeGroup(e,t)},channel_group_list_channels:function(e,t){ee.listChannels(e,t)},channel_group_add_channel:function(e,t){ee.addChannel(e,t)},channel_group_remove_channel:function(e,t){ee.removeChannel(e,t)},set_resumed:function(e){pe=e},get_cipher_key:function(){return M.getCipherKey()},set_cipher_key:function(e){M.setCipherKey(e)},raw_encrypt:function(e,n){return t(e,n)},raw_decrypt:function(e,t){return n(e,t)},get_heartbeat:function(){return B.getPresenceTimeout()},set_heartbeat:function(e,t){B.setPresenceTimeout(F.validateHeartbeat(e,B.getPresenceTimeout(),C)),B.setHeartbeatInterval(t||B.getPresenceTimeout()/2-1),2===B.getPresenceTimeout()&&B.setHeartbeatInterval(1),se(),ne.start()},get_heartbeat_interval:function(){return B.getHeartbeatInterval()},set_heartbeat_interval:function(e){B.setHeartbeatInterval(e),ne.start()},get_version:function(){return W},getGcmMessageObject:function(e){return{data:e}},getApnsMessageObject:function(e){var t={aps:{badge:1,alert:""}};for(var n in e)n[t]=e[n];return t},_add_param:function(e,t){T.addCoreParam(e,t)},auth:function(e){M.setAuthKey(e),se()},publish:function(e,t){te.performPublish(e,t)},unsubscribe:function(e,t){de=0,he=1,te.performUnsubscribe(e,t),se()},subscribe:function(e,t){function i(e){e?F.timeout(se,P):(T.shiftStandardOrigin(!0),T.shiftSubscribeOrigin(!0),F.timeout(function(){be.time(i)},R.SECOND)),o(function(t){return e&&t.disconnected?(t.disconnected=0,t.reconnect(t.name)):void(e||t.disconnected||(t.disconnected=1,t.disconnect(t.name)))}),r(function(t){return e&&t.disconnected?(t.disconnected=0,t.reconnect(t.name)):void(e||t.disconnected||(t.disconnected=1,t.disconnect(t.name)))})}function a(){var e=A.generate_channel_list().join(","),t=A.generate_channel_group_list().join(",");if(e||t){e||(e=","),l();var s=T.prepareParams({uuid:M.getUUID(),auth:M.getAuthKey()});t&&(s["channel-group"]=t);var c=JSON.stringify(A.getPresenceState());c.length>2&&(s.state=JSON.stringify(A.getPresenceState())),B.getPresenceTimeout()&&(s.heartbeat=B.getPresenceTimeout()),B.isInstanceIdEnabled()&&(s.instanceid=M.getInstanceId()),ne.start(),le=m({timeout:k,fail:function(e){e&&e.error&&e.service?(S["default"].error(e,y),i(!1)):be.time(function(t){!t&&S["default"].error(e,y),i(t)})},data:T.prepareParams(s),url:[T.getSubscribeOrigin(),"subscribe",M.getSubscribeKey(),F.encode(e),0,de],success:function(e){if(!e||"object"==("undefined"==typeof e?"undefined":u(e))&&"error"in e&&e.error)return y(e),F.timeout(se,R.SECOND);if(g(e[1]),de=!de&&he&&w.get(M.getSubscribeKey())||e[1],o(function(e){e.connected||(e.connected=1,e.connect(e.name))}),r(function(e){e.connected||(e.connected=1,e.connect(e.name))}),pe&&!he)return de=0,pe=!1,w.set(M.getSubscribeKey(),0),void F.timeout(a,P);v&&(de=1e4,v=0),w.set(M.getSubscribeKey(),e[1]);var t=function(){var t="",n="";e.length>3?(t=e[3],n=e[2]):t=e.length>2?e[2]:F.map(A.generate_channel_list(),function(t){return F.map(Array(e[0].length).join(",").split(","),function(){return t})}).join(",");var r=t.split(","),i=n?n.split(","):[];return function(){var e=r.shift()||fe,t=i.shift(),n={};t?(e&&e.indexOf("-pnpres")>=0&&t.indexOf("-pnpres")<0&&(t+="-pnpres"),n=A.getChannelGroup(t)||A.getChannel(t)||{callback:function(){}}):n=A.getChannel(e);var a=[n.callback||ce,e.split(R.PRESENCE_SUFFIX)[0]];return t&&a.push(t.split(R.PRESENCE_SUFFIX)[0]),a}}(),i=d(+e[1]);F.each(e[0],function(r){var a=t(),o=n(r,A.getChannel(a[1])?A.getChannel(a[1]).cipher_key:null);a[0]&&a[0](o,e,a[2]||a[1],i,a[1])}),F.timeout(a,P)}})}}var s=e.channel,c=e.channel_group,t=t||e.callback,t=t||e.message,f=e.connect||function(){},h=e.reconnect||function(){},p=e.disconnect||function(){},y=e.error||y||function(){},g=e.idle||function(){},_=e.presence||0,v=e.backfill||0,b=e.timetoken||0,k=e.timeout||ie,P=e.windowing||re,x=e.state,I=e.heartbeat||e.pnexpires,E=e.heartbeat_interval,O=e.restore||he;return M.setAuthKey(e.auth_key||M.getAuthKey()),he=O,de=b,s||c?t?M.getSubscribeKey()?((I||0===I||E||0===E)&&be.set_heartbeat(I,E),s&&F.each((s.join?s.join(","):""+s).split(","),function(n){var r=A.getChannel(n)||{};A.addChannel(fe=n,{name:n,connected:r.connected,disconnected:r.disconnected,subscribed:1,callback:ce=t,cipher_key:e.cipher_key,connect:f,disconnect:p,reconnect:h}),x&&(n in x?A.addToPresenceState(n,x[n]):A.addToPresenceState(n,x)),_&&(be.subscribe({channel:n+R.PRESENCE_SUFFIX,callback:_,restore:O}),r.subscribed)}),c&&F.each((c.join?c.join(","):""+c).split(","),function(n){var r=A.getChannelGroup(n)||{};A.addChannelGroup(n,{name:n,connected:r.connected,disconnected:r.disconnected,subscribed:1,callback:ce=t,cipher_key:e.cipher_key,connect:f,disconnect:p,reconnect:h}),_&&(be.subscribe({channel_group:n+R.PRESENCE_SUFFIX,callback:_,restore:O,auth_key:M.getAuthKey()}),r.subscribed)}),se=function(){l(),F.timeout(a,P)},L?void se():z.push(se)):C("Missing Subscribe Key"):C("Missing Callback"):C("Missing Channel")},revoke:function(e,t){e.read=!1,e.write=!1,be.grant(e,t)},set_uuid:function(e){M.setUUID(e),se()},get_uuid:function(){return M.getUUID()},isArray:function(e){return F.isArray(e)},get_subscribed_channels:function(){return A.generate_channel_list(!0)},stop_timers:function(){clearTimeout(_e),clearTimeout(ve),ne.stop()},shutdown:function(){be.stop_timers(),ge&&ge()},xdr:m,ready:a,db:w,uuid:F.generateUUID,map:F.map,each:F.each,"each-channel":o,grep:F.grep,offline:function(){l(1,{message:"Offline. Please check your network settings."})},supplant:F.supplant,now:F.rnow,unique:i,updater:F.updater};return _e=F.timeout(s,R.SECOND),ve=F.timeout(c,ae),PRESENCE_HB_TIMEOUT=F.timeout(start_presence_heartbeat,(B.getHeartbeatInterval()-3)*R.SECOND),y(),be}var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},c=n(3),f=r(c),l=n(5),h=r(l),d=n(6),p=r(d),y=n(9),g=r(y),_=n(10),v=r(_),b=n(11),k=r(b),m=n(12),S=r(m),w=n(32),P=r(w),C=n(33),x=r(C),I=n(34),E=r(I),O=n(35),K=r(O),M=n(36),U=r(M),B=n(37),D=r(B),A=n(38),j=r(A),T=n(39),H=r(T),N=n(1),R=n(8),F=n(7),G=1,L=!1,z=[],q=10,Q=15e3,X=310,J=60,W=N.version;e.exports={PN_API:s,unique:i,PNmessage:o,DEF_TIMEOUT:Q,timeout:F.timeout,build_url:F.buildURL,each:F.each,uuid:F.generateUUID,URLBIT:R.URLBIT,grep:F.grep,supplant:F.supplant,now:F.rnow,updater:F.updater,map:F.map}},function(e,t,n){function r(e,t,n){var r=t&&n||0,i=0;for(t=t||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){16>i&&(t[r+i++]=c[e])});16>i;)t[r+i++]=0;return t}function i(e,t){var n=t||0,r=u;return r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]}function a(e,t,n){var r=t&&n||0,a=t||[];e=e||{};var o=void 0!==e.clockseq?e.clockseq:d,s=void 0!==e.msecs?e.msecs:(new Date).getTime(),u=void 0!==e.nsecs?e.nsecs:y+1,c=s-p+(u-y)/1e4;if(0>c&&void 0===e.clockseq&&(o=o+1&16383),(0>c||s>p)&&void 0===e.nsecs&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");p=s,y=u,d=o,s+=122192928e5;var f=(1e4*(268435455&s)+u)%4294967296;a[r++]=f>>>24&255,a[r++]=f>>>16&255,a[r++]=f>>>8&255,a[r++]=255&f;var l=s/4294967296*1e4&268435455;a[r++]=l>>>8&255,a[r++]=255&l,a[r++]=l>>>24&15|16,a[r++]=l>>>16&255,a[r++]=o>>>8|128,a[r++]=255&o;for(var g=e.node||h,_=0;6>_;_++)a[r+_]=g[_];return t?t:i(a)}function o(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"==e?new Array(16):null,e=null),e=e||{};var a=e.random||(e.rng||s)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var o=0;16>o;o++)t[r+o]=a[o];return t||i(a)}for(var s=n(4),u=[],c={},f=0;256>f;f++)u[f]=(f+256).toString(16).substr(1),c[u[f]]=f;var l=s(),h=[1|l[0],l[1],l[2],l[3],l[4],l[5]],d=16383&(l[6]<<8|l[7]),p=0,y=0,g=o;g.v1=a,g.v4=o,g.parse=r,g.unparse=i,e.exports=g},function(e,t){(function(t){var n;if(t.crypto&&crypto.getRandomValues){var r=new Uint8Array(16);n=function(){return crypto.getRandomValues(r),r}}if(!n){var i=new Array(16);n=function(){for(var e,t=0;16>t;t++)0===(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}e.exports=n}).call(t,function(){return this}())},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(6),s=(r(o),n(7)),u=function(){function e(t,n){var r=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],a=arguments.length<=3||void 0===arguments[3]?"pubsub.pubnub.com":arguments[3];i(this,e),this._xdr=t,this._keychain=n,this._maxSubDomain=20,this._currentSubDomain=Math.floor(Math.random()*this._maxSubDomain),this._providedFQDN=(r?"https://":"http://")+a,this._coreParams={},this.shiftStandardOrigin(!1),this.shiftSubscribeOrigin(!1)}return a(e,[{key:"setCoreParams",value:function(e){return this._coreParams=e,this}},{key:"addCoreParam",value:function(e,t){this._coreParams[e]=t}},{key:"addBeaconDispatcher",value:function(e){return this._sendBeacon=e,this}},{key:"prepareParams",value:function(e){return e||(e={}),s.each(this._coreParams,function(t,n){t in e||(e[t]=n)}),e}},{key:"nextOrigin",value:function(e){if(-1===this._providedFQDN.indexOf("pubsub."))return this._providedFQDN;var t=void 0;return e?t=s.generateUUID().split("-")[0]:(this._currentSubDomain=this._currentSubDomain+1,this._currentSubDomain>=this._maxSubDomain&&(this._currentSubDomain=1),t=this._currentSubDomain.toString()),this._providedFQDN.replace("pubsub","ps"+t)}},{key:"shiftStandardOrigin",value:function(){var e=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];return this._standardOrigin=this.nextOrigin(e),this._standardOrigin}},{key:"shiftSubscribeOrigin",value:function(){var e=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];return this._subscribeOrigin=this.nextOrigin(e),this._subscribeOrigin}},{key:"fetchHistory",value:function(e,t){var n=t.data,r=t.success,i=t.fail,a=[this.getStandardOrigin(),"v2","history","sub-key",this._keychain.getSubscribeKey(),"channel",s.encode(e)];this._xdr({data:n,success:r,fail:i,url:a})}},{key:"performChannelGroupOperation",value:function(e,t,n){var r=n.data,i=n.success,a=n.fail,o=[this.getStandardOrigin(),"v1","channel-registration","sub-key",this._keychain.getSubscribeKey(),"channel-group"];e&&"*"!==e&&o.push(e),"remove"===t&&o.push("remove"),this._xdr({data:r,success:i,fail:a,url:o})}},{key:"provisionDeviceForPush",value:function(e,t){var n=t.data,r=t.success,i=t.fail,a=[this.getStandardOrigin(),"v1","push","sub-key",this._keychain.getSubscribeKey(),"devices",e];this._xdr({data:n,success:r,fail:i,url:a})}},{key:"performGrant",value:function(e){var t=e.data,n=e.success,r=e.fail,i=[this.getStandardOrigin(),"v1","auth","grant","sub-key",this._keychain.getSubscribeKey()];this._xdr({data:t,success:n,fail:r,url:i})}},{key:"performHeartbeat",value:function(e,t){var n=t.data,r=t.success,i=t.fail,a=[this.getStandardOrigin(),"v2","presence","sub-key",this._keychain.getSubscribeKey(),"channel",e,"heartbeat"];this._xdr({data:n,success:r,fail:i,url:a})}},{key:"performState",value:function(e,t,n,r){var i=r.data,a=r.success,o=r.fail,u=[this.getStandardOrigin(),"v2","presence","sub-key",this._keychain.getSubscribeKey(),"channel",t];e?u.push("uuid",n,"data"):u.push("uuid",s.encode(n)),this._xdr({data:i,success:a,fail:o,url:u})}},{key:"performAudit",value:function(e){var t=e.data,n=e.success,r=e.fail,i=[this.getStandardOrigin(),"v1","auth","audit","sub-key",this._keychain.getSubscribeKey()];this._xdr({data:t,success:n,fail:r,url:i})}},{key:"performChannelLeave",value:function(e,t){var n=t.data,r=t.success,i=t.fail,a=this.nextOrigin(!1),o=[a,"v2","presence","sub_key",this._keychain.getSubscribeKey(),"channel",s.encode(e),"leave"];this._sendBeacon?this._sendBeacon(s.buildURL(o,n))&&r({status:200,action:"leave",message:"OK",service:"Presence"}):this._xdr({data:n,success:r,fail:i,url:o})}},{key:"performChannelGroupLeave",value:function(e){var t=e.data,n=e.success,r=e.fail,i=this.nextOrigin(!1),a=[i,"v2","presence","sub_key",this._keychain.getSubscribeKey(),"channel",s.encode(","),"leave"];"undefined"!=typeof this._sendBeacon?this._sendBeacon(s.buildURL(a,t))&&n({status:200,action:"leave",message:"OK",service:"Presence"}):this._xdr({data:t,success:n,fail:r,url:a})}},{key:"fetchReplay",value:function(e,t,n){var r=n.data,i=n.success,a=n.fail,o=[this.getStandardOrigin(),"v1","replay",this._keychain.getPublishKey(),this._keychain.getSubscribeKey(),e,t];this._xdr({data:r,success:i,fail:a,url:o})}},{key:"fetchTime",value:function(e){var t=e.data,n=e.success,r=e.fail,i=[this.getStandardOrigin(),"time",0];this._xdr({data:t,success:n,fail:r,url:i})}},{key:"fetchWhereNow",value:function(e,t){var n=t.data,r=t.success,i=t.fail,a=[this.getStandardOrigin(),"v2","presence","sub_key",this._keychain.getSubscribeKey(),"uuid",s.encode(e)];this._xdr({data:n,success:r,fail:i,url:a})}},{key:"fetchHereNow",value:function(e,t,n){var r=n.data,i=n.success,a=n.fail,o=[this.getStandardOrigin(),"v2","presence","sub_key",this._keychain.getSubscribeKey()];e&&(o.push("channel"),o.push(s.encode(e))),t&&!e&&(o.push("channel"),o.push(",")),this._xdr({data:r,success:i,fail:a,url:o})}},{key:"performPublish",value:function(e,t,n){var r=n.data,i=n.callback,a=n.success,o=n.fail,u=n.mode,c=[this.getStandardOrigin(),"publish",this._keychain.getPublishKey(),this._keychain.getSubscribeKey(),0,s.encode(e),0,s.encode(t)];this._xdr({data:r,callback:i,success:a,fail:o,url:c,mode:u})}},{key:"getOrigin",value:function(){return this._providedFQDN}},{key:"getStandardOrigin",value:function(){return this._standardOrigin}},{key:"getSubscribeOrigin",value:function(){return this._subscribeOrigin}}]),e}();t["default"]=u},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(){n(this,e)}return r(e,[{key:"setUUID",value:function(e){return this._UUID=e,this}},{key:"setCipherKey",value:function(e){return this._cipherKey=e,this}},{key:"setSubscribeKey",value:function(e){return this._subscribeKey=e,this}},{key:"setPublishKey",value:function(e){return this._publishKey=e,this}},{key:"setAuthKey",value:function(e){return this._authKey=e,this}},{key:"setInstanceId",value:function(e){return this._instanceId=e,this}},{key:"setSecretKey",value:function(e){return this._secretKey=e,this}},{key:"getCipherKey",value:function(){return this._cipherKey}},{key:"getSubscribeKey",value:function(){return this._subscribeKey}},{key:"getPublishKey",value:function(){return this._publishKey}},{key:"getAuthKey",value:function(){return this._authKey}},{key:"getInstanceId",value:function(){return this._instanceId}},{key:"getSecretKey",value:function(){return this._secretKey}},{key:"getUUID",value:function(){return this._UUID}}]),e}();t["default"]=i},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(){return+new Date}function a(e){return!!e&&"string"!=typeof e&&(Array.isArray&&Array.isArray(e)||"number"==typeof e.length)}function o(e,t){if(e&&t)if(a(e))for(var n=0,r=e.length;r>n;)t.call(e[n],e[n],n++);else for(var n in e)e.hasOwnProperty&&e.hasOwnProperty(n)&&t.call(e[n],n,e[n])}function s(e){return encodeURIComponent(e)}function u(e,t){var n=e.join(w.URLBIT),r=[];return t?(o(t,function(e,t){var n="object"===("undefined"==typeof t?"undefined":k(t))?JSON.stringify(t):t;"undefined"!=typeof t&&null!==t&&s(n).length>0&&r.push(e+"="+s(n))}),n+="?"+r.join(w.PARAMSBIT)):n}function c(e,t){var n,r=0,a=function o(){r+t>i()?(clearTimeout(n),n=setTimeout(o,t)):(r=i(),e())};return a}function f(e,t){var n=[];return o(e||[],function(e){t(e)&&n.push(e)}),n}function l(e,t){return e.replace(P,function(e,n){return t[n]||e})}function h(e,t){return"undefined"!=typeof setTimeout?setTimeout(e,t):void 0}function d(e){var t=S["default"].v4();return e&&e(t),t}function p(e,t){var n=[];return o(e||[],function(e,r){n.push(t(e,r))}),n}function y(e){return encodeURIComponent(e).replace(/[!'()*~]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}function g(e){var t=[];return o(e,function(e){t.push(e)}),t}function _(e){return g(e).sort()}function v(e){var t=_(e);return p(t,function(t){return t+"="+y(e[t])}).join("&")}function b(e,t,n){var r=!1;if("undefined"==typeof e)return t;if("number"==typeof e)r=!(e>w._minimumHeartbeatInterval||0===e);else{if("boolean"==typeof e)return e?w._defaultHeartbeatInterval:0;r=!0}if(r){if(n){var i="Presence Heartbeat value invalid. Valid range ( x >";i+=w._minimumHeartbeatInterval+" or x = 0). Current Value : ",i+=t||w._minimumHeartbeatInterval,n(i)}return t||w._minimumHeartbeatInterval}return e}var k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},m=n(3),S=r(m),w=n(8),P=/{([\w\-]+)}/g;e.exports={buildURL:u,encode:s,each:o,updater:c,rnow:i,isArray:a,map:p,pamEncode:y,generateUUID:d,timeout:h,supplant:l,grep:f,_get_pam_sign_input_from_params:v,_object_to_key_list_sorted:_,_object_to_key_list:g,validateHeartbeat:b}},function(e,t){e.exports={PARAMSBIT:"&",URLBIT:"/",defaultHeartbeatInterval:30,minimumHeartbeatInterval:5,PRESENCE_SUFFIX:"-pnpres",SECOND:1e3}},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(){n(this,e),this._instanceId=!1,this._requestId=!1}return r(e,[{key:"setInstanceIdConfig",value:function(e){return this._instanceId=e,this}},{key:"setRequestIdConfig",value:function(e){return this._requestId=e,this}},{key:"setHeartbeatInterval",value:function(e){return this._heartbeatInterval=e,this}},{key:"setPresenceTimeout",value:function(e){return this._presenceTimeout=e,this}},{key:"setSupressLeaveEvents",value:function(e){return this._suppressLeaveEvents=e,this}},{key:"isInstanceIdEnabled",value:function(){return this._instanceId}},{key:"isRequestIdEnabled",value:function(){return this._requestId}},{key:"isSuppressingLeaveEvents",value:function(){return this._suppressLeaveEvents}},{key:"getHeartbeatInterval",value:function(){return this._heartbeatInterval}},{key:"getPresenceTimeout",value:function(){return this._presenceTimeout}}]),e}();t["default"]=i},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(7),s=r(o),u=function(){function e(){i(this,e),this._channelStorage={},this._channelGroupStorage={},this._presenceState={}}return a(e,[{key:"containsChannel",value:function(e){return e in this._channelStorage}},{key:"containsChannelGroup",value:function(e){return e in this._channelGroupStorage}},{key:"getChannel",value:function(e){return this._channelStorage[e]}},{key:"getChannelGroup",value:function(e){return this._channelGroupStorage[e]}},{key:"addChannel",value:function(e,t){this._channelStorage[e]=t}},{key:"addChannelGroup",value:function(e,t){this._channelGroupStorage[e]=t}},{key:"addToPresenceState",value:function(e,t){this._presenceState[e]=t}},{key:"isInPresenceState",value:function(e){return e in this._presenceState}},{key:"removeFromPresenceState",value:function(e){delete this._presenceState[e]}},{key:"getPresenceState",value:function(){return this._presenceState}},{key:"setIsReady",value:function(e){this._ready=e}},{key:"getIsReady",value:function(){return this._ready}},{key:"getChannels",value:function(e){var t=[];return s["default"].each(this._channelStorage,function(n,r){e?n.search("-pnpres")<0&&r.subscribed&&t.push(n):r.subscribed&&t.push(n)}),t.sort()}},{key:"getChannelGroups",value:function(e){var t=[];return s["default"].each(this._channelGroupStorage,function(n,r){e?n.search("-pnpres")<0&&r.subscribed&&t.push(n):r.subscribed&&t.push(n)}),t.sort()}}]),e}();t["default"]=u},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(5),s=(r(o),function c(){i(this,c)}),u=function(){function e(t){var n=t.networking;i(this,e),this._publishQueue=[],this._networking=n}return a(e,[{key:"createQueueable",value:function(){return new s}},{key:"queuePublishItem",value:function(e){this._publishQueue.push(e)}},{key:"sendOneMessage",value:function(){var e=this._publishQueue.shift();this._networking.performPublish(e.channel,e.payload,{mode:e.httpMethod,success:e.onSuccess,fail:e.onFail,data:this._networking.prepareParams(e.params)})}},{key:"getQueueLength",value:function(){return this._publishQueue.length}},{key:"setIsSending",value:function(e){return this._isSending=e,this}},{key:"isSending",value:function(){return this._isSending}}]),e}();t["default"]=u},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(13),u=r(s),c=function(){function e(){i(this,e)}return o(e,null,[{key:"callback",value:function(e,t,n){if("object"===("undefined"==typeof e?"undefined":a(e))){if(e.error){var r=(0,u["default"])(e,["message","payload"]);return void(n&&n(r))}if(e.payload)return void(e.next_page?t&&t(e.payload,e.next_page):t&&t(e.payload))}t&&t(e)}},{key:"error",value:function(e,t){if("object"===("undefined"==typeof e?"undefined":a(e))&&e.error){var n=(0,u["default"])(e,["message","payload"]);if(t)return t(n)}else if(t)return t(e)}}]),e}();t["default"]=c},function(e,t,n){var r=n(14),i=n(26),a=n(28),o=a(function(e,t){return null==e?{}:i(e,r(t,1))});e.exports=o},function(e,t,n){function r(e,t,n,u){u||(u=[]);for(var c=-1,f=e.length;++c<f;){var l=e[c];t>0&&s(l)&&(n||o(l)||a(l))?t>1?r(l,t-1,n,u):i(u,l):n||(u[u.length]=l)}return u;
}var i=n(15),a=n(16),o=n(25),s=n(17);e.exports=r},function(e,t){function n(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}e.exports=n},function(e,t,n){function r(e){return i(e)&&s.call(e,"callee")&&(!c.call(e,"callee")||u.call(e)==a)}var i=n(17),a="[object Arguments]",o=Object.prototype,s=o.hasOwnProperty,u=o.toString,c=o.propertyIsEnumerable;e.exports=r},function(e,t,n){function r(e){return a(e)&&i(e)}var i=n(18),a=n(24);e.exports=r},function(e,t,n){function r(e){return null!=e&&o(i(e))&&!a(e)}var i=n(19),a=n(21),o=n(23);e.exports=r},function(e,t,n){var r=n(20),i=r("length");e.exports=i},function(e,t){function n(e){return function(t){return null==t?void 0:t[e]}}e.exports=n},function(e,t,n){function r(e){var t=i(e)?u.call(e):"";return t==a||t==o}var i=n(22),a="[object Function]",o="[object GeneratorFunction]",s=Object.prototype,u=s.toString;e.exports=r},function(e,t){function n(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}e.exports=n},function(e,t){function n(e){return"number"==typeof e&&e>-1&&e%1==0&&r>=e}var r=9007199254740991;e.exports=n},function(e,t){function n(e){return!!e&&"object"==typeof e}e.exports=n},function(e,t){var n=Array.isArray;e.exports=n},function(e,t,n){function r(e,t){return e=Object(e),i(t,function(t,n){return n in e&&(t[n]=e[n]),t},{})}var i=n(27);e.exports=r},function(e,t){function n(e,t,n,r){var i=-1,a=e.length;for(r&&a&&(n=e[++i]);++i<a;)n=t(n,e[i],i,e);return n}e.exports=n},function(e,t,n){function r(e,t){if("function"!=typeof e)throw new TypeError(o);return t=s(void 0===t?e.length-1:a(t),0),function(){for(var n=arguments,r=-1,a=s(n.length-t,0),o=Array(a);++r<a;)o[r]=n[t+r];switch(t){case 0:return e.call(this,o);case 1:return e.call(this,n[0],o);case 2:return e.call(this,n[0],n[1],o)}var u=Array(t+1);for(r=-1;++r<t;)u[r]=n[r];return u[t]=o,i(e,this,u)}}var i=n(29),a=n(30),o="Expected a function",s=Math.max;e.exports=r},function(e,t){function n(e,t,n){var r=n.length;switch(r){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}e.exports=n},function(e,t,n){function r(e){if(!e)return 0===e?e:0;if(e=i(e),e===a||e===-a){var t=0>e?-1:1;return t*o}var n=e%1;return e===e?n?e-n:e:0}var i=n(31),a=1/0,o=1.7976931348623157e308;e.exports=r},function(e,t,n){function r(e){if(a(e)){var t=i(e.valueOf)?e.valueOf():e;e=a(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(s,"");var n=c.test(e);return n||f.test(e)?l(e.slice(2),n?2:8):u.test(e)?o:+e}var i=n(21),a=n(22),o=NaN,s=/^\s+|\s+$/g,u=/^[-+]0x[0-9a-f]+$/i,c=/^0b[01]+$/i,f=/^0o[0-7]+$/i,l=parseInt;e.exports=r},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(5),s=(r(o),n(9)),u=(r(s),n(6)),c=(r(u),function(){function e(t){var n=t.networking,r=t.config,a=t.keychain;i(this,e),this._networking=n,this._config=r,this._keychain=a}return a(e,[{key:"fetchTime",value:function(e){var t={uuid:this._keychain.getUUID(),auth:this._keychain.getAuthKey()};this._config.isInstanceIdEnabled()&&(t.instanceid=this._keychain.getInstanceId());var n=function(t){e(t[0])},r=function(){e(0)};this._networking.fetchTime({data:this._networking.prepareParams(t),success:n,fail:r})}}]),e}());t["default"]=c},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(5),s=(r(o),n(9)),u=(r(s),n(6)),c=(r(u),n(10)),f=(r(c),n(12)),l=r(f),h=n(7),d=r(h),p=n(8),y=r(p),g=function(){function e(t){var n=t.networking,r=t.config,a=t.keychain,o=t.state,s=t.error;i(this,e),this._networking=n,this._config=r,this._keychain=a,this._state=o,this._error=s}return a(e,[{key:"hereNow",value:function(e,t){var n=e.callback||t,r=e.error||function(){},i=e.auth_key||this._keychain.getAuthKey(),a=e.channel,o=e.channel_group,s="uuids"in e?e.uuids:!0,u=e.state,c={uuid:this._keychain.getUUID(),auth:i};return s||(c.disable_uuids=1),u&&(c.state=1),n?this._keychain.getSubscribeKey()?(o&&(c["channel-group"]=o),this._config.isInstanceIdEnabled()&&(c.instanceid=this._keychain.getInstanceId()),void this._networking.fetchHereNow(a,o,{data:this._networking.prepareParams(c),success:function(e){l["default"].callback(e,n,r)},fail:function(e){l["default"].error(e,r)}})):this._error("Missing Subscribe Key"):this._error("Missing Callback")}},{key:"whereNow",value:function(e,t){var n=e.callback||t,r=e.error||function(){},i=e.auth_key||this._keychain.getAuthKey(),a=e.uuid||this._keychain.getUUID(),o={auth:i};return n?this._keychain.getSubscribeKey()?(this._config.isInstanceIdEnabled()&&(o.instanceid=this._keychain.getInstanceId()),void this._networking.fetchWhereNow(a,{data:this._networking.prepareParams(o),success:function(e){l["default"].callback(e,n,r)},fail:function(e){l["default"].error(e,r)}})):this._error("Missing Subscribe Key"):this._error("Missing Callback")}},{key:"heartbeat",value:function(e){var t=e.callback||function(){},n=e.error||function(){},r={uuid:this._keychain.getUUID(),auth:this._keychain.getAuthKey()},i=JSON.stringify(this._state.getPresenceState());i.length>2&&(r.state=JSON.stringify(this._state.getPresenceState())),this._config.getPresenceTimeout()>0&&this._config.getPresenceTimeout()<320&&(r.heartbeat=this._config.getPresenceTimeout());var a=d["default"].encode(this._state.generate_channel_list(!0).join(",")),o=this._state.generate_channel_group_list(!0).join(",");a||(a=","),o&&(r["channel-group"]=o),this._config.isInstanceIdEnabled()&&(r.instanceid=this._keychain.getInstanceId()),this._config.isRequestIdEnabled()&&(r.requestid=d["default"].generateUUID()),this._networking.performHeartbeat(a,{data:this._networking.prepareParams(r),success:function(e){l["default"].callback(e,t,n)},fail:function(e){l["default"].error(e,n)}})}},{key:"performState",value:function(e,t){var n=e.callback||t||function(){},r=e.error||function(){},i=e.auth_key||this._keychain.getAuthKey(),a=e.state,o=e.uuid||this._keychain.getUUID(),s=e.channel,u=e.channel_group,c=this._networking.prepareParams({auth:i});return this._keychain.getSubscribeKey()?o?s||u?("undefined"!=typeof s&&this._state.getChannel(s)&&this._state.getChannel(s).subscribed&&a&&this._state.addToPresenceState(s,a),"undefined"!=typeof u&&this._state.getChannelGroup(u)&&this._state.getChannelGroup(u).subscribed&&(a&&this._state.addToPresenceState(u,a),c["channel-group"]=u,s||(s=",")),c.state=JSON.stringify(a),this._config.isInstanceIdEnabled()&&(c.instanceid=this._keychain.getInstanceId()),void this._networking.performState(a,s,o,{data:this._networking.prepareParams(c),success:function(e){l["default"].callback(e,n,r)},fail:function(e){l["default"].error(e,r)}})):this._error("Missing Channel"):this._error("Missing UUID"):this._error("Missing Subscribe Key")}},{key:"announceChannelLeave",value:function(e,t,n,r){var i={uuid:this._keychain.getUUID(),auth:t||this._keychain.getAuthKey()},a=n||function(){},o=r||function(){};return e.indexOf(y["default"].PRESENCE_SUFFIX)>0?!0:this._config.isSuppressingLeaveEvents()?!1:(this._config.isInstanceIdEnabled()&&(i.instanceid=this._keychain.getInstanceId()),void this._networking.performChannelLeave(e,{data:this._networking.prepareParams(i),success:function(e){l["default"].callback(e,a,o)},fail:function(e){l["default"].error(e,o)}}))}},{key:"announceChannelGroupLeave",value:function(e,t,n,r){var i={uuid:this._keychain.getUUID(),auth:t||this._keychain.getAuthKey()},a=n||function(){},o=r||function(){};return e.indexOf(y["default"].PRESENCE_SUFFIX)>0?!0:this._config.isSuppressingLeaveEvents()?!1:(e&&e.length>0&&(i["channel-group"]=e),this._config.isInstanceIdEnabled()&&(i.instanceid=this._keychain.getInstanceId()),void this._networking.performChannelGroupLeave({data:this._networking.prepareParams(i),success:function(e){l["default"].callback(e,a,o)},fail:function(e){l["default"].error(e,o)}}))}}]),e}();t["default"]=g},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(5),u=(r(s),n(6)),c=(r(u),n(12)),f=r(c),l=function(){function e(t){var n=t.networking,r=t.keychain,a=t.error,o=t.decrypt;i(this,e),this._networking=n,this._keychain=r,this._error=a,this._decrypt=o}return o(e,[{key:"fetchHistory",value:function(e,t){var n=this,r=e.callback||t,i=e.count||e.limit||100,a=e.reverse||"false",o=e.error||function(){},s=e.auth_key||this._keychain.getAuthKey(),u=e.cipher_key,c=e.channel,l=e.channel_group,h=e.start,d=e.end,p=e.include_token,y=e.string_message_token||!1;if(!c&&!l)return this._error("Missing Channel");if(!r)return this._error("Missing Callback");if(!this._keychain.getSubscribeKey())return this._error("Missing Subscribe Key");var g={stringtoken:"true",count:i,reverse:a,auth:s};l&&(g["channel-group"]=l,c||(c=",")),h&&(g.start=h),d&&(g.end=d),p&&(g.include_token="true"),y&&(g.string_message_token="true"),this._networking.fetchHistory(c,{data:this._networking.prepareParams(g),success:function(e){n._handleHistoryResponse(e,o,r,p,u)},fail:function(e){f["default"].error(e,o)}})}},{key:"_handleHistoryResponse",value:function(e,t,n,r,i){if("object"===("undefined"==typeof e?"undefined":a(e))&&e.error)return void t({message:e.message,payload:e.payload});for(var o=e[0],s=[],u=0;u<o.length;u++)if(r){var c=this._decrypt(o[u].message,i),f=o[u].timetoken;try{s.push({message:JSON.parse(c),timetoken:f})}catch(l){s.push({message:c,timetoken:f})}}else{var h=this._decrypt(o[u],i);try{s.push(JSON.parse(h))}catch(l){s.push(h)}}n([s,e[1],e[2]])}}]),e}();t["default"]=l},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(5),s=(r(o),n(6)),u=(r(s),n(9)),c=(r(u),n(12)),f=r(c),l=function(){function e(t){var n=t.networking,r=t.keychain,a=t.error,o=t.config;i(this,e),this._networking=n,this._keychain=r,this._error=a,this._config=o}return a(e,[{key:"provisionDevice",value:function(e){var t=e.op,n=e.gw_type,r=e.device_id,i=e.channel,a=e.callback||function(){},o=e.auth_key||this._keychain.getAuthKey(),s=e.error||function(){};if(!r)return this._error("Missing Device ID (device_id)");if(!n)return this._error("Missing GW Type (gw_type: gcm or apns)");if(!t)return this._error("Missing GW Operation (op: add or remove)");if(!i)return this._error("Missing gw destination Channel (channel)");if(!this._keychain.getPublishKey())return this._error("Missing Publish Key");if(!this._keychain.getSubscribeKey())return this._error("Missing Subscribe Key");var u={uuid:this._keychain.getUUID(),auth:o,type:n};"add"===t?u.add=i:"remove"===t&&(u.remove=i),this._config.isInstanceIdEnabled()&&(u.instanceid=this._keychain.getInstanceId()),this._networking.provisionDeviceForPush(r,{data:u,success:function(e){f["default"].callback(e,a,s)},fail:function(e){f["default"].error(e,s)}})}}]),e}();t["default"]=l},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(5),s=(r(o),n(9)),u=(r(s),n(6)),c=(r(u),n(12)),f=r(c),l=n(7),h=r(l),d=function(){function e(t){var n=t.networking,r=t.config,a=t.keychain,o=t.error,s=t.hmac_SHA256;i(this,e),this._networking=n,this._keychain=a,this._config=r,this._error=o,this._hmac_SHA256=s}return a(e,[{key:"performGrant",value:function(e,t){var n=e.callback||t,r=e.error||function(){},i=e.channel||e.channels,a=e.channel_group,o=e.ttl,s=e.read?"1":"0",u=e.write?"1":"0",c=e.manage?"1":"0",l=e.auth_key||e.auth_keys;if(!n)return this._error("Missing Callback");if(!this._keychain.getSubscribeKey())return this._error("Missing Subscribe Key");if(!this._keychain.getPublishKey())return this._error("Missing Publish Key");if(!this._keychain.getSecretKey())return this._error("Missing Secret Key");var d=Math.floor((new Date).getTime()/1e3),p=this._keychain.getSubscribeKey()+"\n"+this._keychain.getPublishKey()+"\ngrant\n",y={w:u,r:s,timestamp:d};e.manage&&(y.m=c),h["default"].isArray(i)&&(i=i.join(",")),h["default"].isArray(l)&&(l=l.join(",")),"undefined"!=typeof i&&null!==i&&i.length>0&&(y.channel=i),"undefined"!=typeof a&&null!==a&&a.length>0&&(y["channel-group"]=a),(o||0===o)&&(y.ttl=o),l&&(y.auth=l),y=this._networking.prepareParams(y),l||delete y.auth,p+=h["default"]._get_pam_sign_input_from_params(y);var g=this._hmac_SHA256(p,this._keychain.getSecretKey());g=g.replace(/\+/g,"-"),g=g.replace(/\//g,"_"),y.signature=g,this._networking.performGrant({data:y,success:function(e){f["default"].callback(e,n,r)},fail:function(e){f["default"].error(e,r)}})}},{key:"performAudit",value:function(e,t){var n=e.callback||t,r=e.error||function(){},i=e.channel,a=e.channel_group,o=e.auth_key;if(!n)return this._error("Missing Callback");if(!this._keychain.getSubscribeKey())return this._error("Missing Subscribe Key");if(!this._keychain.getPublishKey())return this._error("Missing Publish Key");if(!this._keychain.getSecretKey())return this._error("Missing Secret Key");var s=Math.floor((new Date).getTime()/1e3),u=this._keychain.getSubscribeKey()+"\n"+this._keychain.getPublishKey()+"\naudit\n",c={timestamp:s};"undefined"!=typeof i&&null!==i&&i.length>0&&(c.channel=i),"undefined"!=typeof a&&null!==a&&a.length>0&&(c["channel-group"]=a),o&&(c.auth=o),c=this._networking.prepareParams(c),o||delete c.auth,u+=h["default"]._get_pam_sign_input_from_params(c);var l=this._hmac_SHA256(u,this._keychain.getSecretKey());l=l.replace(/\+/g,"-"),l=l.replace(/\//g,"_"),c.signature=l,this._networking.performAudit({data:c,success:function(e){f["default"].callback(e,n,r)},fail:function(e){f["default"].error(e,r)}})}}]),e}();t["default"]=d},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(5),s=(r(o),n(6)),u=(r(s),n(12)),c=r(u),f=function(){function e(t){var n=t.networking,r=t.keychain,a=t.error;i(this,e),this._networking=n,this._keychain=r,this._error=a}return a(e,[{key:"performReplay",value:function(e,t){var n=e.stop,r=e.start,i=e.end,a=e.reverse,o=e.limit,s=e.source,u=t||e.callback||function(){},f=e.auth_key||this._keychain.getAuthKey(),l=e.destination,h=e.error||function(){},d={};return s?l?this._keychain.getPublishKey()?this._keychain.getSubscribeKey()?(n&&(d.stop="all"),a&&(d.reverse="true"),r&&(d.start=r),i&&(d.end=i),o&&(d.count=o),d.auth=f,void this._networking.fetchReplay(s,l,{success:function(e){c["default"].callback(e,u,h)},fail:function(){u([0,"Disconnected"])},data:this._networking.prepareParams(d)})):this._error("Missing Subscribe Key"):this._error("Missing Publish Key"):this._error("Missing Destination Channel"):this._error("Missing Source Channel")}}]),e}();t["default"]=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(5),s=(r(o),n(6)),u=(r(s),n(9)),c=(r(u),n(12)),f=r(c),l=n(7),h=r(l),d=function(){function e(t){var n=t.networking,r=t.keychain,a=t.config,o=t.error;i(this,e),this._networking=n,this._keychain=r,this._config=a,this._error=o}return a(e,[{key:"channelGroup",value:function(e,t){var n=e.channel_group,r=e.callback||t,i=e.channels||e.channel,a="",o={},s=e.mode||"add",u=e.error||this._error;if(n){var c=n.split(":");a=c.length>1?c[1]:c[0]}i&&(h["default"].isArray(i)&&(i=i.join(",")),o[s]=i),o.auth||(o.auth=e.auth_key||this._keychain.getAuthKey()),this._networking.performChannelGroupOperation(a,s,{data:this._networking.prepareParams(o),success:function(e){f["default"].callback(e,r,u)},fail:function(e){f["default"].error(e,u)}})}},{key:"listChannels",value:function(e,t){return e.channel_group?void this.channelGroup(e,t):this._error("Missing Channel Group")}},{key:"removeGroup",value:function(e,t){var n="Use channel_group_remove_channel if you want to remove a channel from a group.";return e.channel_group?e.channel?this._error(n):(e.mode="remove",void this.channelGroup(e,t)):this._error("Missing Channel Group")}},{key:"listGroups",value:function(e,t){this.channelGroup(e,t)}},{key:"addChannel",value:function(e,t){return e.channel_group?e.channel||e.channels?void this.channelGroup(e,t):this._error("Missing Channel"):this._error("Missing Channel Group")}},{key:"removeChannel",value:function(e,t){return e.channel_group?e.channel||e.channels?(e.mode="remove",void this.channelGroup(e,t)):this._error("Missing Channel"):this._error("Missing Channel Group")}}]),e}();t["default"]=d},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(5),s=(r(o),n(9)),u=(r(s),n(6)),c=(r(u),n(10)),f=(r(c),n(11)),l=(r(f),n(33)),h=(r(l),n(!function(){var e=new Error('Cannot find module "./presenters/responders"');throw e.code="MODULE_NOT_FOUND",e}())),d=r(h),p=n(7),y=r(p),g=n(8),_=r(g),v=function(){function e(t){var n=t.networking,r=t.config,a=t.keychain,o=t.presenceEndpoints,s=t.publishQueue,u=t.state,c=t.error;i(this,e),this._networking=n,this._config=r,this._keychain=a,this._state=u,this._error=c,this._presence=o,this._publishQueue=s}return a(e,[{key:"__publish",value:function(e){if(NO_WAIT_FOR_PENDING){if(!PUB_QUEUE.length)return}else{if(e&&(PUB_QUEUE.sending=0),PUB_QUEUE.sending||!PUB_QUEUE.length)return;PUB_QUEUE.sending=1}xdr(PUB_QUEUE.shift())}},{key:"performPublish",value:function(e,t){var n=this,r=e.message;if(!r)return this._error("Missing Message");var i=t||e.callback||function(){},a=e.channel,o=e.auth_key||this._keychain.getAuthKey(),s=e.cipher_key,u=e.error||function(){},c=e.post||!1,f=e.store_in_history||!0,l={uuid:this._keychain.getUUID(),auth:o};if(!a)return this._error("Missing Channel");if(!this._keychain.getPublishKey())return this._error("Missing Publish Key");if(!this._keychain.getSubscribeKey())return this._error("Missing Subscribe Key");r.getPubnubMessage&&(r=r.getPubnubMessage()),r=JSON.stringify(encrypt(r,s)),f||(l.store="0"),this._config.isInstanceIdEnabled()&&(l.instanceid=this._keychain.getInstanceId());var h=this._publishQueue.createQueueable();h.channel=a,h.params=l,h.httpMethod=c?"POST":"GET",h.onFail=function(e){d["default"].error(e,u),n.__publish(!0)},h.onSuccess=function(e){d["default"].callback(e,i,u),n.__publish(!0)},this._publishQueue.queuePublishItem(h),this.__publish(!1)}},{key:"performUnsubscribe",value:function(e,t){var n=e.channel,r=e.channel_group,i=e.auth_key||this._keychain.getAuthKey(),a=t||e.callback||function(){},o=e.error||function(){};if(!n&&!r)return this._error("Missing Channel or Channel Group");if(!this._keychain.getSubscribeKey())return this._error("Missing Subscribe Key");if(n){var s=y["default"].isArray(n)?n:(""+n).split(","),u=[],c=[];if(y["default"].each(s,function(e){this._state.getChannel(e)&&u.push(e)}),0===u.length)return void a({action:"leave"});y["default"].each(u,function(e){c.push(e+_["default"].PRESENCE_SUFFIX)}),y["default"].each(u.concat(c),function(e){this._state.containsChannel(e)&&this._state.removeChannel(e),this._state.isInPresenceState(e)&&this._state.removeFromPresenceState(e)}),this._presence.performChannelLeave(u.join(","),i,a,o)}if(r){var f=y["default"].isArray(r)?r:(""+r).split(","),l=[],h=[];if(y["default"].each(f,function(e){this._state.getChannelGroup(e)&&l.push(e)}),0===l.length)return void a({action:"leave"});y["default"].each(l,function(e){h.push(e+_["default"].PRESENCE_SUFFIX)}),y["default"].each(l.concat(h),function(e){this._state.containsChannelGroup(e)&&this._state.removeChannelGroup(e),this._state.isInPresenceState(e)&&this._state.removeFromPresenceState(e)}),this._presence.performChannelGroupLeave(l.join(","),i,a,o)}}}]),e}();t["default"]=v},function(e,t,n){function r(){function e(e){return i.SHA256(e).toString(i.enc.Hex)}function t(e){return e=e||{},e.hasOwnProperty("encryptKey")||(e.encryptKey=l.encryptKey),e.hasOwnProperty("keyEncoding")||(e.keyEncoding=l.keyEncoding),e.hasOwnProperty("keyLength")||(e.keyLength=l.keyLength),e.hasOwnProperty("mode")||(e.mode=l.mode),-1==u.indexOf(e.keyEncoding.toLowerCase())&&(e.keyEncoding=l.keyEncoding),-1==c.indexOf(parseInt(e.keyLength,10))&&(e.keyLength=l.keyLength),-1==f.indexOf(e.mode.toLowerCase())&&(e.mode=l.mode),e}function n(e,t){return"base64"===t.keyEncoding?i.enc.Base64.parse(e):"hex"===t.keyEncoding?i.enc.Hex.parse(e):e}function r(t,r){return t=n(t,r),r.encryptKey?i.enc.Utf8.parse(e(t).slice(0,32)):t}function a(e){return"ecb"===e.mode?i.mode.ECB:i.mode.CBC}function o(e){return"cbc"===e.mode?i.enc.Utf8.parse(s):null}var s="0123456789012345",u=["hex","utf8","base64","binary"],c=[128,256],f=["ecb","cbc"],l={encryptKey:!0,keyEncoding:"utf8",keyLength:256,mode:"cbc"};return{encrypt:function(e,n,s){if(!n)return e;s=t(s);var u=o(s),c=a(s),f=r(n,s),l=JSON.stringify(e),h=i.AES.encrypt(l,f,{iv:u,mode:c}).ciphertext,d=h.toString(i.enc.Base64);return d||e},decrypt:function(e,n,s){if(!n)return e;s=t(s);var u=o(s),c=a(s),f=r(n,s);try{var l=i.enc.Base64.parse(e),h=i.AES.decrypt({ciphertext:l},f,{iv:u,mode:c}).toString(i.enc.Utf8),d=JSON.parse(h);return d}catch(p){return}}}}var i=n(41);e.exports=r},function(e,t){var n=n||function(e,t){var n={},r=n.lib={},i=function(){},a=r.Base={extend:function(e){i.prototype=this;var t=new i;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=r.WordArray=a.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=n!=t?n:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes;if(e=e.sigBytes,this.clamp(),r%4)for(var i=0;e>i;i++)t[r+i>>>2]|=(n[i>>>2]>>>24-8*(i%4)&255)<<24-8*((r+i)%4);else if(65535<n.length)for(i=0;e>i;i+=4)t[r+i>>>2]=n[i>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-8*(n%4),t.length=e.ceil(n/4)},clone:function(){var e=a.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],r=0;t>r;r+=4)n.push(4294967296*e.random()|0);return new o.init(n,t)}}),s=n.enc={},u=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;e>r;r++){var i=t[r>>>2]>>>24-8*(r%4)&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;t>r;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-4*(r%8);return new o.init(n,t/2)}},c=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;e>r;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-8*(r%4)&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;t>r;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-8*(r%4);return new o.init(n,t)}},f=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},l=r.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=f.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,a=this.blockSize,s=i/(4*a),s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0);if(t=s*a,i=e.min(4*t,i),t){for(var u=0;t>u;u+=a)this._doProcessBlock(r,u);u=r.splice(0,t),n.sigBytes-=i}return new o.init(u,i)},clone:function(){var e=a.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});r.Hasher=l.extend({cfg:a.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new h.HMAC.init(e,n).finalize(t)}}});var h=n.algo={};return n}(Math);!function(e){for(var t=n,r=t.lib,i=r.WordArray,a=r.Hasher,r=t.algo,o=[],s=[],u=function(e){return 4294967296*(e-(0|e))|0},c=2,f=0;64>f;){var l;e:{l=c;for(var h=e.sqrt(l),d=2;h>=d;d++)if(!(l%d)){l=!1;break e}l=!0}l&&(8>f&&(o[f]=u(e.pow(c,.5))),s[f]=u(e.pow(c,1/3)),f++),c++}var p=[],r=r.SHA256=a.extend({_doReset:function(){this._hash=new i.init(o.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],a=n[2],o=n[3],u=n[4],c=n[5],f=n[6],l=n[7],h=0;64>h;h++){if(16>h)p[h]=0|e[t+h];else{var d=p[h-15],y=p[h-2];p[h]=((d<<25|d>>>7)^(d<<14|d>>>18)^d>>>3)+p[h-7]+((y<<15|y>>>17)^(y<<13|y>>>19)^y>>>10)+p[h-16]}d=l+((u<<26|u>>>6)^(u<<21|u>>>11)^(u<<7|u>>>25))+(u&c^~u&f)+s[h]+p[h],y=((r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22))+(r&i^r&a^i&a),l=f,f=c,c=u,u=o+d|0,o=a,a=i,i=r,r=d+y|0}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+a|0,n[3]=n[3]+o|0,n[4]=n[4]+u|0,n[5]=n[5]+c|0,n[6]=n[6]+f|0,n[7]=n[7]+l|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;return n[i>>>5]|=128<<24-i%32,n[(i+64>>>9<<4)+14]=e.floor(r/4294967296),n[(i+64>>>9<<4)+15]=r,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=a._createHelper(r),t.HmacSHA256=a._createHmacHelper(r)}(Math),function(){var e=n,t=e.enc.Utf8;e.algo.HMAC=e.lib.Base.extend({init:function(e,n){e=this._hasher=new e.init,"string"==typeof n&&(n=t.parse(n));var r=e.blockSize,i=4*r;n.sigBytes>i&&(n=e.finalize(n)),n.clamp();for(var a=this._oKey=n.clone(),o=this._iKey=n.clone(),s=a.words,u=o.words,c=0;r>c;c++)s[c]^=1549556828,u[c]^=909522486;a.sigBytes=o.sigBytes=i,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;return e=t.finalize(e),t.reset(),t.finalize(this._oKey.clone().concat(e))}})}(),function(){var e=n,t=e.lib.WordArray;e.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp(),e=[];for(var i=0;n>i;i+=3)for(var a=(t[i>>>2]>>>24-8*(i%4)&255)<<16|(t[i+1>>>2]>>>24-8*((i+1)%4)&255)<<8|t[i+2>>>2]>>>24-8*((i+2)%4)&255,o=0;4>o&&n>i+.75*o;o++)e.push(r.charAt(a>>>6*(3-o)&63));if(t=r.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var n=e.length,r=this._map,i=r.charAt(64);i&&(i=e.indexOf(i),-1!=i&&(n=i));for(var i=[],a=0,o=0;n>o;o++)if(o%4){var s=r.indexOf(e.charAt(o-1))<<2*(o%4),u=r.indexOf(e.charAt(o))>>>6-2*(o%4);i[a>>>2]|=(s|u)<<24-8*(a%4),a++}return t.create(i,a)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(e){function t(e,t,n,r,i,a,o){return e=e+(t&n|~t&r)+i+o,(e<<a|e>>>32-a)+t}function r(e,t,n,r,i,a,o){return e=e+(t&r|n&~r)+i+o,(e<<a|e>>>32-a)+t}function i(e,t,n,r,i,a,o){return e=e+(t^n^r)+i+o,(e<<a|e>>>32-a)+t}function a(e,t,n,r,i,a,o){return e=e+(n^(t|~r))+i+o,(e<<a|e>>>32-a)+t}for(var o=n,s=o.lib,u=s.WordArray,c=s.Hasher,s=o.algo,f=[],l=0;64>l;l++)f[l]=4294967296*e.abs(e.sin(l+1))|0;s=s.MD5=c.extend({_doReset:function(){this._hash=new u.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,n){for(var o=0;16>o;o++){var s=n+o,u=e[s];e[s]=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8)}var o=this._hash.words,s=e[n+0],u=e[n+1],c=e[n+2],l=e[n+3],h=e[n+4],d=e[n+5],p=e[n+6],y=e[n+7],g=e[n+8],_=e[n+9],v=e[n+10],b=e[n+11],k=e[n+12],m=e[n+13],S=e[n+14],w=e[n+15],P=o[0],C=o[1],x=o[2],I=o[3],P=t(P,C,x,I,s,7,f[0]),I=t(I,P,C,x,u,12,f[1]),x=t(x,I,P,C,c,17,f[2]),C=t(C,x,I,P,l,22,f[3]),P=t(P,C,x,I,h,7,f[4]),I=t(I,P,C,x,d,12,f[5]),x=t(x,I,P,C,p,17,f[6]),C=t(C,x,I,P,y,22,f[7]),P=t(P,C,x,I,g,7,f[8]),I=t(I,P,C,x,_,12,f[9]),x=t(x,I,P,C,v,17,f[10]),C=t(C,x,I,P,b,22,f[11]),P=t(P,C,x,I,k,7,f[12]),I=t(I,P,C,x,m,12,f[13]),x=t(x,I,P,C,S,17,f[14]),C=t(C,x,I,P,w,22,f[15]),P=r(P,C,x,I,u,5,f[16]),I=r(I,P,C,x,p,9,f[17]),x=r(x,I,P,C,b,14,f[18]),C=r(C,x,I,P,s,20,f[19]),P=r(P,C,x,I,d,5,f[20]),I=r(I,P,C,x,v,9,f[21]),x=r(x,I,P,C,w,14,f[22]),C=r(C,x,I,P,h,20,f[23]),P=r(P,C,x,I,_,5,f[24]),I=r(I,P,C,x,S,9,f[25]),x=r(x,I,P,C,l,14,f[26]),C=r(C,x,I,P,g,20,f[27]),P=r(P,C,x,I,m,5,f[28]),I=r(I,P,C,x,c,9,f[29]),x=r(x,I,P,C,y,14,f[30]),C=r(C,x,I,P,k,20,f[31]),P=i(P,C,x,I,d,4,f[32]),I=i(I,P,C,x,g,11,f[33]),x=i(x,I,P,C,b,16,f[34]),C=i(C,x,I,P,S,23,f[35]),P=i(P,C,x,I,u,4,f[36]),I=i(I,P,C,x,h,11,f[37]),x=i(x,I,P,C,y,16,f[38]),C=i(C,x,I,P,v,23,f[39]),P=i(P,C,x,I,m,4,f[40]),I=i(I,P,C,x,s,11,f[41]),x=i(x,I,P,C,l,16,f[42]),C=i(C,x,I,P,p,23,f[43]),P=i(P,C,x,I,_,4,f[44]),I=i(I,P,C,x,k,11,f[45]),x=i(x,I,P,C,w,16,f[46]),C=i(C,x,I,P,c,23,f[47]),P=a(P,C,x,I,s,6,f[48]),I=a(I,P,C,x,y,10,f[49]),x=a(x,I,P,C,S,15,f[50]),C=a(C,x,I,P,d,21,f[51]),P=a(P,C,x,I,k,6,f[52]),I=a(I,P,C,x,l,10,f[53]),x=a(x,I,P,C,v,15,f[54]),C=a(C,x,I,P,u,21,f[55]),P=a(P,C,x,I,g,6,f[56]),I=a(I,P,C,x,w,10,f[57]),x=a(x,I,P,C,p,15,f[58]),C=a(C,x,I,P,m,21,f[59]),P=a(P,C,x,I,h,6,f[60]),I=a(I,P,C,x,b,10,f[61]),x=a(x,I,P,C,c,15,f[62]),C=a(C,x,I,P,_,21,f[63]);
o[0]=o[0]+P|0,o[1]=o[1]+C|0,o[2]=o[2]+x|0,o[3]=o[3]+I|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;n[i>>>5]|=128<<24-i%32;var a=e.floor(r/4294967296);for(n[(i+64>>>9<<4)+15]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),n[(i+64>>>9<<4)+14]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),t.sigBytes=4*(n.length+1),this._process(),t=this._hash,n=t.words,r=0;4>r;r++)i=n[r],n[r]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8);return t},clone:function(){var e=c.clone.call(this);return e._hash=this._hash.clone(),e}}),o.MD5=c._createHelper(s),o.HmacMD5=c._createHmacHelper(s)}(Math),function(){var e=n,t=e.lib,r=t.Base,i=t.WordArray,t=e.algo,a=t.EvpKDF=r.extend({cfg:r.extend({keySize:4,hasher:t.MD5,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=this.cfg,r=n.hasher.create(),a=i.create(),o=a.words,s=n.keySize,n=n.iterations;o.length<s;){u&&r.update(u);var u=r.update(e).finalize(t);r.reset();for(var c=1;n>c;c++)u=r.finalize(u),r.reset();a.concat(u)}return a.sigBytes=4*s,a}});e.EvpKDF=function(e,t,n){return a.create(n).compute(e,t)}}(),n.lib.Cipher||function(e){var t=n,r=t.lib,i=r.Base,a=r.WordArray,o=r.BufferedBlockAlgorithm,s=t.enc.Base64,u=t.algo.EvpKDF,c=r.Cipher=o.extend({cfg:i.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){o.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(t,n,r){return("string"==typeof n?y:p).encrypt(e,t,n,r)},decrypt:function(t,n,r){return("string"==typeof n?y:p).decrypt(e,t,n,r)}}}});r.StreamCipher=c.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var f=t.mode={},l=function(t,n,r){var i=this._iv;i?this._iv=e:i=this._prevBlock;for(var a=0;r>a;a++)t[n+a]^=i[a]},h=(r.BlockCipherMode=i.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}})).extend();h.Encryptor=h.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize;l.call(this,e,t,r),n.encryptBlock(e,t),this._prevBlock=e.slice(t,t+r)}}),h.Decryptor=h.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize,i=e.slice(t,t+r);n.decryptBlock(e,t),l.call(this,e,t,r),this._prevBlock=i}}),f=f.CBC=h,h=(t.pad={}).Pkcs7={pad:function(e,t){for(var n=4*t,n=n-e.sigBytes%n,r=n<<24|n<<16|n<<8|n,i=[],o=0;n>o;o+=4)i.push(r);n=a.create(i,n),e.concat(n)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},r.BlockCipher=c.extend({cfg:c.cfg.extend({mode:f,padding:h}),reset:function(){c.reset.call(this);var e=this.cfg,t=e.iv,e=e.mode;if(this._xformMode==this._ENC_XFORM_MODE)var n=e.createEncryptor;else n=e.createDecryptor,this._minBufferSize=1;this._mode=n.call(e,this,t&&t.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else t=this._process(!0),e.unpad(t);return t},blockSize:4});var d=r.CipherParams=i.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),f=(t.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return e=e.salt,(e?a.create([1398893684,1701076831]).concat(e).concat(t):t).toString(s)},parse:function(e){e=s.parse(e);var t=e.words;if(1398893684==t[0]&&1701076831==t[1]){var n=a.create(t.slice(2,4));t.splice(0,4),e.sigBytes-=16}return d.create({ciphertext:e,salt:n})}},p=r.SerializableCipher=i.extend({cfg:i.extend({format:f}),encrypt:function(e,t,n,r){r=this.cfg.extend(r);var i=e.createEncryptor(n,r);return t=i.finalize(t),i=i.cfg,d.create({ciphertext:t,key:n,iv:i.iv,algorithm:e,mode:i.mode,padding:i.padding,blockSize:e.blockSize,formatter:r.format})},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),e.createDecryptor(n,r).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),t=(t.kdf={}).OpenSSL={execute:function(e,t,n,r){return r||(r=a.random(8)),e=u.create({keySize:t+n}).compute(e,r),n=a.create(e.words.slice(t),4*n),e.sigBytes=4*t,d.create({key:e,iv:n,salt:r})}},y=r.PasswordBasedCipher=p.extend({cfg:p.cfg.extend({kdf:t}),encrypt:function(e,t,n,r){return r=this.cfg.extend(r),n=r.kdf.execute(n,e.keySize,e.ivSize),r.iv=n.iv,e=p.encrypt.call(this,e,t,n.key,r),e.mixIn(n),e},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),n=r.kdf.execute(n,e.keySize,e.ivSize,t.salt),r.iv=n.iv,p.decrypt.call(this,e,t,n.key,r)}})}(),function(){for(var e=n,t=e.lib.BlockCipher,r=e.algo,i=[],a=[],o=[],s=[],u=[],c=[],f=[],l=[],h=[],d=[],p=[],y=0;256>y;y++)p[y]=128>y?y<<1:y<<1^283;for(var g=0,_=0,y=0;256>y;y++){var v=_^_<<1^_<<2^_<<3^_<<4,v=v>>>8^255&v^99;i[g]=v,a[v]=g;var b=p[g],k=p[b],m=p[k],S=257*p[v]^16843008*v;o[g]=S<<24|S>>>8,s[g]=S<<16|S>>>16,u[g]=S<<8|S>>>24,c[g]=S,S=16843009*m^65537*k^257*b^16843008*g,f[v]=S<<24|S>>>8,l[v]=S<<16|S>>>16,h[v]=S<<8|S>>>24,d[v]=S,g?(g=b^p[p[p[m^b]]],_^=p[p[_]]):g=_=1}var w=[0,1,2,4,8,16,32,64,128,27,54],r=r.AES=t.extend({_doReset:function(){for(var e=this._key,t=e.words,n=e.sigBytes/4,e=4*((this._nRounds=n+6)+1),r=this._keySchedule=[],a=0;e>a;a++)if(n>a)r[a]=t[a];else{var o=r[a-1];a%n?n>6&&4==a%n&&(o=i[o>>>24]<<24|i[o>>>16&255]<<16|i[o>>>8&255]<<8|i[255&o]):(o=o<<8|o>>>24,o=i[o>>>24]<<24|i[o>>>16&255]<<16|i[o>>>8&255]<<8|i[255&o],o^=w[a/n|0]<<24),r[a]=r[a-n]^o}for(t=this._invKeySchedule=[],n=0;e>n;n++)a=e-n,o=n%4?r[a]:r[a-4],t[n]=4>n||4>=a?o:f[i[o>>>24]]^l[i[o>>>16&255]]^h[i[o>>>8&255]]^d[i[255&o]]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,o,s,u,c,i)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,f,l,h,d,a),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,r,i,a,o,s){for(var u=this._nRounds,c=e[t]^n[0],f=e[t+1]^n[1],l=e[t+2]^n[2],h=e[t+3]^n[3],d=4,p=1;u>p;p++)var y=r[c>>>24]^i[f>>>16&255]^a[l>>>8&255]^o[255&h]^n[d++],g=r[f>>>24]^i[l>>>16&255]^a[h>>>8&255]^o[255&c]^n[d++],_=r[l>>>24]^i[h>>>16&255]^a[c>>>8&255]^o[255&f]^n[d++],h=r[h>>>24]^i[c>>>16&255]^a[f>>>8&255]^o[255&l]^n[d++],c=y,f=g,l=_;y=(s[c>>>24]<<24|s[f>>>16&255]<<16|s[l>>>8&255]<<8|s[255&h])^n[d++],g=(s[f>>>24]<<24|s[l>>>16&255]<<16|s[h>>>8&255]<<8|s[255&c])^n[d++],_=(s[l>>>24]<<24|s[h>>>16&255]<<16|s[c>>>8&255]<<8|s[255&f])^n[d++],h=(s[h>>>24]<<24|s[c>>>16&255]<<16|s[f>>>8&255]<<8|s[255&l])^n[d++],e[t]=y,e[t+1]=g,e[t+2]=_,e[t+3]=h},keySize:8});e.AES=t._createHelper(r)}(),n.mode.ECB=function(){var e=n.lib.BlockCipherMode.extend();return e.Encryptor=e.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),e.Decryptor=e.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),e}(),e.exports=n}])});