{"version":3,"sources":["core/endpoints/presence/here_now.js"],"names":[],"mappings":"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","file":"core/endpoints/presence/here_now.js","sourcesContent":["/* @flow */\n\nimport { HereNowArguments } from '../../flow_interfaces';\n\nexport function getOperation(): string {\n  return 'PNHereNowOperation';\n}\n\nexport function validateParams(modules) {\n  let { config } = modules;\n\n  if (!config.subscribeKey) return 'Missing Subscribe Key';\n}\n\nexport function getURL(modules, incomingParams: HereNowArguments): string {\n  let { config } = modules;\n  let { channels = [], channelGroups = [] } = incomingParams;\n  let baseURL = '/v2/presence/sub-key/' + config.subscribeKey;\n\n  if (channels.length > 0 || channelGroups.length > 0) {\n    let stringifiedChannels = channels.length > 0 ? channels.join(',') : ',';\n    baseURL += '/channel/' + encodeURIComponent(stringifiedChannels);\n  }\n\n  return baseURL;\n}\n\nexport function prepareParams(modules, incomingParams: HereNowArguments): Object {\n  let { channelGroups = [], includeUUIDs = true, includeState = false } = incomingParams;\n  const params = {};\n\n  if (!includeUUIDs) params.disable_uuids = 1;\n  if (includeState) params.state = 1;\n\n  if (channelGroups.length > 0) {\n    params['channel-group'] = encodeURIComponent(channelGroups.join(','));\n  }\n\n  return params;\n}\n\nexport function handleResponse(modules, serverResponse: Object, incomingParams: HereNowArguments): Object {\n  let { channels = [], channelGroups = [], includeUUIDs = true, includeState = false } = incomingParams;\n\n  let prepareSingularChannel = () => {\n    let response = {};\n    let occupantsList = [];\n    response.totalChannels = 1;\n    response.totalOccupancy = serverResponse.occupancy;\n    response.channels = {};\n    response.channels[channels[0]] = {\n      occupants: occupantsList,\n      name: channels[0],\n      occupancy: serverResponse.occupancy\n    };\n\n    if (includeUUIDs) {\n      serverResponse.uuids.forEach((uuidEntry) => {\n        if (includeState) {\n          occupantsList.push({ state: uuidEntry.state, uuid: uuidEntry.uuid });\n        } else {\n          occupantsList.push({ state: null, uuid: uuidEntry });\n        }\n      });\n    }\n\n    return response;\n  };\n\n  let prepareMultipleChannel = () => {\n    let response = {};\n    response.totalChannels = serverResponse.payload.total_channels;\n    response.totalOccupancy = serverResponse.payload.total_occupancy;\n    response.channels = {};\n\n    Object.keys(serverResponse.payload.channels).forEach((channelName) => {\n      let channelEntry = serverResponse.payload.channels[channelName];\n      let occupantsList = [];\n      response.channels[channelName] = {\n        occupants: occupantsList,\n        name: channelName,\n        occupancy: channelEntry.occupancy\n      };\n\n      if (includeUUIDs) {\n        channelEntry.uuids.forEach((uuidEntry) => {\n          if (includeState) {\n            occupantsList.push({ state: uuidEntry.state, uuid: uuidEntry.uuid });\n          } else {\n            occupantsList.push({ state: null, uuid: uuidEntry });\n          }\n        });\n      }\n\n      return response;\n    });\n\n    return response;\n  };\n\n  let response;\n  if (channels.length > 1 || channelGroups.length > 0) {\n    response = prepareMultipleChannel();\n  } else {\n    response = prepareSingularChannel();\n  }\n\n  return response;\n}\n"],"sourceRoot":"/source/"}