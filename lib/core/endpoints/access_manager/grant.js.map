{"version":3,"sources":["core/endpoints/access_manager/grant.js"],"names":["getOperation","operationConstants","PNAccessManagerGrant","validateParams","modules","incomingParams","config","subscribeKey","publishKey","secretKey","uuids","authKeys","channels","channelGroups","getURL","getRequestTimeout","getTransactionTimeout","isAuthSupported","prepareParams","ttl","read","write","manage","get","join","update","deleteParam","params","r","w","m","d","g","j","u","length","channel","auth","handleResponse"],"mappings":"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","sourcesContent":["/* @flow */\n\nimport { GrantArguments, ModulesInject } from '../../flow_interfaces';\nimport operationConstants from '../../constants/operations';\n\nexport function getOperation(): string {\n  return operationConstants.PNAccessManagerGrant;\n}\n\nexport function validateParams(modules: ModulesInject, incomingParams: GrantArguments) {\n  let { config } = modules;\n\n  if (!config.subscribeKey) return 'Missing Subscribe Key';\n  if (!config.publishKey) return 'Missing Publish Key';\n  if (!config.secretKey) return 'Missing Secret Key';\n  if (incomingParams.uuids != null && !incomingParams.authKeys) { return 'authKeys are required for grant request on uuids'; }\n  if (incomingParams.uuids != null && (incomingParams.channels != null || incomingParams.channelGroups != null)) { return 'Both channel/channelgroup and uuid cannot be used in the same request'; }\n}\n\nexport function getURL(modules: ModulesInject): string {\n  let { config } = modules;\n  return `/v2/auth/grant/sub-key/${config.subscribeKey}`;\n}\n\nexport function getRequestTimeout({ config }: ModulesInject): number {\n  return config.getTransactionTimeout();\n}\n\nexport function isAuthSupported(): boolean {\n  return false;\n}\n\nexport function prepareParams(modules: ModulesInject, incomingParams: GrantArguments): Object {\n  const { channels = [],\n    channelGroups = [],\n    uuids = [],\n    ttl,\n    read = false,\n    write = false,\n    manage = false,\n    get = false,\n    join = false,\n    update = false,\n    authKeys = [] } = incomingParams;\n  const deleteParam = incomingParams.delete;\n  const params = {};\n\n  params.r = (read) ? '1' : '0';\n  params.w = (write) ? '1' : '0';\n  params.m = (manage) ? '1' : '0';\n  params.d = (deleteParam) ? '1' : '0';\n  params.g = (get) ? '1'  : '0';\n  params.j = (join) ? '1' : '0';\n  params.u = (update) ? '1' : '0';\n\n  if (channels.length > 0) {\n    params.channel = channels.join(',');\n  }\n\n  if (channelGroups.length > 0) {\n    params['channel-group'] = channelGroups.join(',');\n  }\n\n  if (authKeys.length > 0) {\n    params.auth = authKeys.join(',');\n  }\n\n  if (uuids.length > 0) {\n    params['target-uuid'] = uuids.join(',');\n  }\n\n  if (ttl || ttl === 0) {\n    params.ttl = ttl;\n  }\n  return params;\n}\n\nexport function handleResponse(): Object {\n  return {};\n}\n"],"file":"grant.js"}