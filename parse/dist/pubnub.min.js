!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b(require("crypto"),require("buffer")):"function"==typeof define&&define.amd?define(["crypto","buffer"],b):"object"==typeof exports?exports.PUBNUB=b(require("crypto"),require("buffer")):a.PUBNUB=b(a.crypto,a.buffer)}(this,function(a,b){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){function d(a,b){return h.createHmac("sha256",new i(b,"utf8")).update(a).digest("base64")}function e(a){console.error(a)}function f(a){function b(a,b){g({message:a,payload:b})}var c,d,e,f=a.success||function(){},g=a.fail||function(){},h=a.mode||"GET",i=a.data||{},j={};i.pnsdk=l,"POST"===h&&(c=decodeURIComponent(a.url.pop())),e=k.build_url(a.url,i),e="/"+e.split("/").slice(3).join("/"),d=a.url[0].split("//")[1],j.url="http://"+d+e,j.method=h,j.body=c,Parse.Cloud.httpRequest(j).then(function(a){var c;try{c=JSON.parse(a.text)}catch(d){return void b("Bad JSON response",a.text)}f(c)},function(a){var c;try{c=JSON.parse(a.text),"object"==typeof c&&"error"in c&&c.error===!0?g(c):b("Network error",a.text)}catch(d){b("Network error",a.text)}})}function g(){function a(a){return h.createHash("sha256").update(a).digest("hex").slice(0,32)}var b="0123456789012345";return{encrypt:function(c,d){if(!d)return c;var e=JSON.stringify(c),f=h.createCipheriv("aes-256-cbc",a(d),b),g=f.update(e,"utf8","base64")+f["final"]("base64");return g||c},decrypt:function(c,d){var e;if(!d)return c;var f=h.createDecipheriv("aes-256-cbc",a(d),b);try{e=f.update(c,"base64","utf8")+f["final"]("utf8")}catch(g){return null}return JSON.parse(e)}}}var h=c(1),i=c(2).Buffer,j=c(3),k=c(4),l="PubNub-JS-Parse/"+j.version,m=function(){var a={};return{get:function(b){return a[b]},set:function(b,c){a[b]=c}}}(),n=function(a){a.xdr=f,a.db=m,a.error=a.error||e,a.hmac_SHA256=d,a.crypto_obj=g(),a.params={pnsdk:l};var b=function(a){return n(a)},c=k.PN_API(a);for(var h in c)c.hasOwnProperty(h)&&(b[h]=c[h]);return b.init=b,b.secure=b,b.subscribe=function(){throw Error("#subscribe() method is disabled in Parse.com environment")},b.ready(),b};n.init=n,n.unique=k.unique,n.secure=n,a.exports=n,a.exports.PNmessage=k.PNmessage},function(b,c){b.exports=a},function(a,c){a.exports=b},function(a,b){a.exports={name:"pubnub",preferGlobal:!1,version:"3.14.1",author:"PubNub <support@pubnub.com>",description:"Publish & Subscribe Real-time Messaging with PubNub",contributors:[{name:"Stephen Blum",email:"stephen@pubnub.com"}],bin:{},scripts:{test:"grunt test --force"},main:"./node.js/pubnub.js",browser:"./modern/dist/pubnub.js",repository:{type:"git",url:"git://github.com/pubnub/javascript.git"},keywords:["cloud","publish","subscribe","websockets","comet","bosh","xmpp","real-time","messaging"],dependencies:{agentkeepalive:"~0.2",lodash:"^4.1.0",uuid:"^2.0.1"},noAnalyze:!1,devDependencies:{"babel-core":"^6.6.5","babel-eslint":"5.0.0","babel-plugin-transform-class-properties":"^6.6.0","babel-plugin-transform-flow-strip-types":"^6.6.5","babel-preset-es2015":"^6.6.0",chai:"3.5.0",eslint:"2.2.0","eslint-config-airbnb":"6.0.2","eslint-plugin-flowtype":"2.1.0","eslint-plugin-mocha":"2.0.0","eslint-plugin-react":"4.1.0","flow-bin":"^0.22.1",grunt:"0.4.5","grunt-babel":"6.0.0","grunt-contrib-clean":"1.0.0","grunt-contrib-copy":"^1.0.0","grunt-contrib-uglify":"^1.0.0","grunt-env":"0.4.4","grunt-eslint":"18.0.0","grunt-flow":"1.0.3","grunt-karma":"0.12.1","grunt-mocha-istanbul":"3.0.1","grunt-text-replace":"0.4.0","grunt-webpack":"1.0.11","imports-loader":"0.6.5",isparta:"4.0.0","json-loader":"0.5.4",karma:"0.13.21","karma-chai":"0.1.0","karma-mocha":"^0.2.2","karma-phantomjs-launcher":"1.0.0","karma-spec-reporter":"0.0.24","load-grunt-tasks":"^3.4.1",mocha:"2.4.5",nock:"1.1.0","node-uuid":"1.4.7",nodeunit:"0.9.0","phantomjs-prebuilt":"2.1.4",proxyquire:"1.7.4",sinon:"^1.17.3","uglify-js":"^2.6.2",underscore:"1.7.0",webpack:"^1.12.14","webpack-dev-server":"1.14.1"},bundleDependencies:[],license:"MIT",engine:{node:">=0.8"},files:["core","node.js","modern","CHANGELOG","FUTURE.md","LICENSE","README.md"]}},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(){return"x"+ ++E+ +new Date}function f(){F||(F=1,D.each(G,function(a){a()}))}function g(a){var b=a||{apns:{}};return b.getPubnubMessage=function(){var a={};if(Object.keys(b.apns).length){a.pn_apns={aps:{alert:b.apns.alert,badge:b.apns.badge}};for(var c in b.apns)a.pn_apns[c]=b.apns[c];var d=["badge","alert"];for(var c in d)delete a.pn_apns[d[c]]}b.gcm&&(a.pn_gcm={data:b.gcm});for(var c in b)a[c]=b[c];var e=["apns","gcm","publish","channel","callback","error"];for(var c in e)delete a[e[c]];return a},b.publish=function(){var a=b.getPubnubMessage();b.pubnub&&b.channel&&b.pubnub.publish({message:a,channel:b.channel,callback:b.callback,error:b.error})},b}function h(a){function b(a,b){return T.encrypt(a,b||U.getCipherKey())||a}function c(a,b){return T.decrypt(a,b||U.getCipherKey())||T.decrypt(a,U.getCipherKey())||a}function d(a){var b=[];return D.each(a,function(a,c){b.push(a)}),b}function g(a){return d(a).sort()}function h(a){var b="",c=g(a);for(var d in c){var e=c[d];b+=e+"="+D.pamEncode(a[e]),d!=c.length-1&&(b+="&")}return b}function j(a,b,c){var d=!1;if("undefined"==typeof a)return b;if("number"==typeof a)d=!(a>N||0==a);else{if("boolean"==typeof a)return a?O:0;d=!0}return d?(c&&c("Presence Heartbeat value invalid. Valid range ( x > "+N+" or x = 0). Current Value : "+(b||N)),b||N):a}function l(){return clearTimeout(ta),!va||va>=500||1>va||!Y.generate_channel_list(!0).length&&!Y.generate_channel_group_list(!0).length?void(wa=!1):(wa=!0,void Da.presence_heartbeat({callback:function(a){ta=D.timeout(l,va*M)},error:function(a){S&&S("Presence Heartbeat unable to reach Pubnub servers."+JSON.stringify(a)),ta=D.timeout(l,va*M)}}))}function n(){!wa&&l()}function p(a){if(xa){if(!ja.length)return}else{if(a&&(ja.sending=0),ja.sending||!ja.length)return;ja.sending=1}Q(ja.shift())}function r(a){var b=0;return D.each(Y.generate_channel_group_list(),function(c){var d=Y.getChannelGroup(c);d&&(b++,(a||function(){})(d))}),b}function t(a){var b=0;return D.each(Y.generate_channel_list(),function(c){var d=Y.getChannel(c);d&&(b++,(a||function(){})(d))}),b}function v(a,b,c,d){var b=a.callback||b,e=a.error||S,f=J();d=d||{},d.auth||(d.auth=a.auth_key||U.getAuthKey());var g=[Z.getStandardOrigin(),"v1","channel-registration","sub-key",U.getSubscribeKey()];g.push.apply(g,c),f&&(d.callback=f),Q({callback:f,data:Z.prepareParams(d),success:function(a){u["default"].callback(a,b,e)},fail:function(a){u["default"].error(a,e)},url:g})}function x(){za()||B(1,{error:"Offline. Please check your network settings."}),V&&clearTimeout(V),V=D.timeout(x,M)}function z(){ea&&Da.time(function(a){E(function(){},a),a||B(1,{error:"Heartbeat failed to connect to Pubnub Servers.Please check your network settings."}),W&&clearTimeout(W),W=D.timeout(z,da)})}function B(a,b){oa&&oa(a,b),oa=null,clearTimeout(V),clearTimeout(W)}function C(a){var b=D.rnow()-la;return b-a/1e4}function E(a,b){function c(b){if(b){var c=b/1e4,e=(D.rnow()-d)/2;la=D.rnow()-(c+e),a&&a(la)}}var d=D.rnow();b&&c(b)||Da.time(c)}var J=a.jsonp_cb||function(){return 0},Q=a.xdr,R=a.db||{get:function(){},set:function(){}},S=a.error||function(){},T=a.crypto_obj||{encrypt:function(a,b){return a},decrypt:function(a,b){return a}},U=(new o["default"]).setInstanceId(k["default"].v4()).setAuthKey(a.auth_key||"").setSecretKey(a.secret_key||"").setSubscribeKey(a.subscribe_key).setPublishKey(a.publish_key).setCipherKey(a.cipher_key);U.setUUID(a.uuid||!a.unique_uuid&&R.get(U.getSubscribeKey()+"uuid")||k["default"].v4()),R.set(U.getSubscribeKey()+"uuid",U.getUUID());var V,W,X=(new q["default"]).setRequestIdConfig(a.use_request_id||!1).setInstanceIdConfig(a.instance_id||!1),Y=new s["default"],Z=new m["default"](a.xdr,U,a.ssl,a.origin).setCoreParams(a.params||{}),$=new w["default"]({keychain:U,config:X,networking:Z,jsonp_cb:J}),_=new y["default"]({keychain:U,config:X,networking:Z,jsonp_cb:J,error:S}),aa=new A["default"]({keychain:U,networking:Z,jsonp_cb:J,error:S,decrypt:c}),ba=+a.windowing||I,ca=(+a.timeout||K)*M,da=(+a.keepalive||L)*M,ea=a.timecheck||0,fa=a.noleave||0,ga=a.hmac_SHA256,ha=a.ssl?"s":"",ia=function(){},ja=[],ka=!0,la=0,ma=0,na=0,oa=0,pa=a.restore||0,qa=0,ra=!1,sa={},ta=null,ua=j(a.heartbeat||a.pnexpires||0,a.error),va=a.heartbeat_interval||ua/2-1,wa=!1,xa=a.no_wait_for_pending,ya=a["compatible_3.5"]||!1,za=a._is_online||function(){return 1},Aa=a.shutdown,Ba="undefined"!=typeof a.use_send_beacon?a.use_send_beacon:!0,Ca=Ba?a.sendBeacon:null;2===ua&&(va=1);var Da={LEAVE:function(a,b,c,d,e){var f,g,h={uuid:U.getUUID(),auth:c||U.getAuthKey()},i=Z.nextOrigin(!1),d=d||function(){},j=e||function(){},k=J();if(a.indexOf(H)>0)return!0;if(ya){if(!ha)return!1;if("0"==k)return!1}if(fa)return!1;if("0"!=k&&(h.callback=k),X.isInstanceIdEnabled()&&(h.instanceid=U.getInstanceId()),f=[i,"v2","presence","sub_key",U.getSubscribeKey(),"channel",D.encode(a),"leave"],g=Z.prepareParams(h),Ca){var l=D.buildURL(f,g);if(Ca(l))return d&&d({status:200,action:"leave",message:"OK",service:"Presence"}),!0}return Q({blocking:b||ha,callback:k,data:g,success:function(a){u["default"].callback(a,d,j)},fail:function(a){u["default"].error(a,j)},url:f}),!0},LEAVE_GROUP:function(a,b,c,d,e){var f,g,h={uuid:U.getUUID(),auth:c||U.getAuthKey()},i=Z.nextOrigin(!1),d=d||function(){},j=e||function(){},k=J();if(a.indexOf(H)>0)return!0;if(ya){if(!ha)return!1;if("0"==k)return!1}if(fa)return!1;if("0"!=k&&(h.callback=k),a&&a.length>0&&(h["channel-group"]=a),X.isInstanceIdEnabled()&&(h.instanceid=U.getInstanceId()),f=[i,"v2","presence","sub_key",U.getSubscribeKey(),"channel",D.encode(","),"leave"],g=Z.prepareParams(h),Ca){var l=D.buildURL(f,g);if(Ca(l))return d&&d({status:200,action:"leave",message:"OK",service:"Presence"}),!0}return Q({blocking:b||ha,callback:k,data:g,success:function(a){u["default"].callback(a,d,j)},fail:function(a){u["default"].error(a,j)},url:f}),!0},set_resumed:function(a){ra=a},get_cipher_key:function(){return U.getCipherKey()},set_cipher_key:function(a){U.setCipherKey(a)},raw_encrypt:function(a,c){return b(a,c)},raw_decrypt:function(a,b){return c(a,b)},get_heartbeat:function(){return ua},set_heartbeat:function(a,b){ua=j(a,ua,S),va=b||ua/2-1,2==ua&&(va=1),ia(),l()},get_heartbeat_interval:function(){return va},set_heartbeat_interval:function(a){va=a,l()},get_version:function(){return P},getGcmMessageObject:function(a){return{data:a}},getApnsMessageObject:function(a){var b={aps:{badge:1,alert:""}};for(var c in a)c[b]=a[c];return b},_add_param:function(a,b){Z.addCoreParam(a,b)},channel_group:function Ea(a,b){var c,Ea,d=a.channel_group,b=b||a.callback,e=a.channels||a.channel,f=a.cloak,g=[],h={},i=a.mode||"add";if(d){var j=d.split(":");j.length>1?(c="*"===j[0]?null:j[0],Ea=j[1]):Ea=j[0]}c&&g.push("namespace")&&g.push(D.encode(c)),g.push("channel-group"),Ea&&"*"!==Ea&&g.push(Ea),e?(D.isArray(e)&&(e=e.join(",")),h[i]=e,h.cloak=ka?"true":"false"):"remove"===i&&g.push("remove"),"undefined"!=typeof f&&(h.cloak=f?"true":"false"),v(a,b,g,h)},channel_group_list_groups:function(a,b){var c;c=a.namespace||a.ns||a.channel_group||null,c&&(a.channel_group=c+":*"),Da.channel_group(a,b)},channel_group_list_channels:function(a,b){return a.channel_group?void Da.channel_group(a,b):S("Missing Channel Group")},channel_group_remove_channel:function(a,b){return a.channel_group?a.channel||a.channels?(a.mode="remove",void Da.channel_group(a,b)):S("Missing Channel"):S("Missing Channel Group")},channel_group_remove_group:function(a,b){return a.channel_group?a.channel?S("Use channel_group_remove_channel if you want to remove a channel from a group."):(a.mode="remove",void Da.channel_group(a,b)):S("Missing Channel Group")},channel_group_add_channel:function(a,b){return a.channel_group?a.channel||a.channels?void Da.channel_group(a,b):S("Missing Channel"):S("Missing Channel Group")},channel_group_cloak:function(a,b){return"undefined"==typeof a.cloak?void b(ka):(ka=a.cloak,void Da.channel_group(a,b))},channel_group_list_namespaces:function(a,b){var c=["namespace"];v(a,b,c)},channel_group_remove_namespace:function(a,b){var c=["namespace",a.namespace,"remove"];v(a,b,c)},history:function(a,b){aa.fetchHistory(a,b)},replay:function(a,b){var b=b||a.callback||function(){},c=a.auth_key||U.getAuthKey(),d=a.source,e=a.destination,f=a.error||a.error||function(){},g=a.stop,h=a.start,i=a.end,j=a.reverse,k=a.limit,l=J(),m={};return d?e?U.getPublishKey()?U.getSubscribeKey()?("0"!=l&&(m.callback=l),g&&(m.stop="all"),j&&(m.reverse="true"),h&&(m.start=h),i&&(m.end=i),k&&(m.count=k),m.auth=c,void Z.fetchReplay(d,e,{callback:l,success:function(a){u["default"].callback(a,b,f)},fail:function(){b([0,"Disconnected"])},data:Z.prepareParams(m)})):S("Missing Subscribe Key"):S("Missing Publish Key"):S("Missing Destination Channel"):S("Missing Source Channel")},auth:function(a){U.setAuthKey(a),ia()},time:function(a){$.fetchTime(a)},publish:function(a,c){var d=a.message;if(!d)return S("Missing Message");var e,c=c||a.callback||d.callback||a.success||function(){},f=a.channel||d.channel,g=a.auth_key||U.getAuthKey(),h=a.cipher_key,i=a.error||d.error||function(){},j=a.post||!1,k="store_in_history"in a?a.store_in_history:!0,l=J(),m="push",n={uuid:U.getUUID(),auth:g};return a.prepend&&(m="unshift"),f?U.getPublishKey()?U.getSubscribeKey()?(d.getPubnubMessage&&(d=d.getPubnubMessage()),d=JSON.stringify(b(d,h)),e=[Z.getStandardOrigin(),"publish",U.getPublishKey(),U.getSubscribeKey(),0,D.encode(f),l,D.encode(d)],k||(n.store="0"),X.isInstanceIdEnabled()&&(n.instanceid=U.getInstanceId()),ja[m]({callback:l,url:e,data:Z.prepareParams(n),fail:function(a){u["default"].error(a,i),p(1)},success:function(a){u["default"].callback(a,c,i),p(1)},mode:j?"POST":"GET"}),void p()):S("Missing Subscribe Key"):S("Missing Publish Key"):S("Missing Channel")},unsubscribe:function(a,b){var c=a.channel,d=a.channel_group,e=a.auth_key||U.getAuthKey(),b=b||a.callback||function(){},f=a.error||function(){};if(qa=0,pa=1,!c&&!d)return S("Missing Channel or Channel Group");if(!U.getSubscribeKey())return S("Missing Subscribe Key");if(c){var g=D.isArray(c)?c:(""+c).split(","),h=[],i=[];if(D.each(g,function(a){Y.getChannel(a)&&h.push(a)}),0==h.length)return void b({action:"leave"});D.each(h,function(a){i.push(a+H)}),D.each(h.concat(i),function(a){Y.containsChannel(a)&&Y.addChannel(a,0),a in sa&&delete sa[a]});var j=!0;F&&(j=Da.LEAVE(h.join(","),0,e,b,f)),j||b({action:"leave"})}if(d){var k=D.isArray(d)?d:(""+d).split(","),l=[],m=[];if(D.each(k,function(a){Y.getChannelGroup(a)&&l.push(a)}),0==l.length)return void b({action:"leave"});D.each(l,function(a){m.push(a+H)}),D.each(l.concat(m),function(a){Y.containsChannelGroup(a)&&Y.addChannelGroup(a,0),a in sa&&delete sa[a]});var j=!0;F&&(j=Da.LEAVE_GROUP(l.join(","),0,e,b,f)),j||b({action:"leave"})}ia()},subscribe:function(a,b){function d(a){a?D.timeout(ia,w):(Z.shiftStandardOrigin(!0),Z.shiftSubscribeOrigin(!0),D.timeout(function(){Da.time(d)},M)),t(function(b){return a&&b.disconnected?(b.disconnected=0,b.reconnect(b.name)):void(a||b.disconnected||(b.disconnected=1,b.disconnect(b.name)))}),r(function(b){return a&&b.disconnected?(b.disconnected=0,b.reconnect(b.name)):void(a||b.disconnected||(b.disconnected=1,b.disconnect(b.name)))})}function e(){var a=J(),b=Y.generate_channel_list().join(","),f=Y.generate_channel_group_list().join(",");if(b||f){b||(b=","),B();var g=Z.prepareParams({uuid:U.getUUID(),auth:U.getAuthKey()});f&&(g["channel-group"]=f);var h=JSON.stringify(sa);h.length>2&&(g.state=JSON.stringify(sa)),ua&&(g.heartbeat=ua),X.isInstanceIdEnabled()&&(g.instanceid=U.getInstanceId()),n(),oa=Q({timeout:v,callback:a,fail:function(a){a&&a.error&&a.service?(u["default"].error(a,l),d(!1)):Da.time(function(b){!b&&u["default"].error(a,l),d(b)})},data:Z.prepareParams(g),url:[Z.getSubscribeOrigin(),"subscribe",U.getSubscribeKey(),D.encode(b),a,qa],success:function(a){if(!a||"object"==("undefined"==typeof a?"undefined":i(a))&&"error"in a&&a.error)return l(a),D.timeout(ia,M);if(m(a[1]),qa=!qa&&pa&&R.get(U.getSubscribeKey())||a[1],t(function(a){a.connected||(a.connected=1,a.connect(a.name))}),r(function(a){a.connected||(a.connected=1,a.connect(a.name))}),ra&&!pa)return qa=0,ra=!1,R.set(U.getSubscribeKey(),0),void D.timeout(e,w);q&&(qa=1e4,q=0),R.set(U.getSubscribeKey(),a[1]);var b=function(){var b="",c="";a.length>3?(b=a[3],c=a[2]):b=a.length>2?a[2]:D.map(Y.generate_channel_list(),function(b){return D.map(Array(a[0].length).join(",").split(","),function(){return b})}).join(",");var d=b.split(","),e=c?c.split(","):[];return function(){var a=d.shift()||na,b=e.shift(),c={};b?(a&&a.indexOf("-pnpres")>=0&&b.indexOf("-pnpres")<0&&(b+="-pnpres"),c=Y.getChannelGroup(b)||Y.getChannel(b)||{callback:function(){}}):c=Y.getChannel(a);var f=[c.callback||ma,a.split(H)[0]];return b&&f.push(b.split(H)[0]),f}}(),d=C(+a[1]);D.each(a[0],function(e){var f=b(),g=c(e,Y.getChannel(f[1])?Y.getChannel(f[1]).cipher_key:null);f[0]&&f[0](g,a,f[2]||f[1],d,f[1])}),D.timeout(e,w)}})}}var f=a.channel,g=a.channel_group,b=b||a.callback,b=b||a.message,h=a.connect||function(){},j=a.reconnect||function(){},k=a.disconnect||function(){},l=a.error||l||function(){},m=a.idle||function(){},o=a.presence||0,p=a.noheresync||0,q=a.backfill||0,s=a.timetoken||0,v=a.timeout||ca,w=a.windowing||ba,x=a.state,y=a.heartbeat||a.pnexpires,z=a.heartbeat_interval,A=a.restore||pa;return U.setAuthKey(a.auth_key||U.getAuthKey()),pa=A,qa=s,f||g?b?U.getSubscribeKey()?((y||0===y||z||0===z)&&Da.set_heartbeat(y,z),f&&D.each((f.join?f.join(","):""+f).split(","),function(c){var d=Y.getChannel(c)||{};Y.addChannel(na=c,{name:c,connected:d.connected,disconnected:d.disconnected,subscribed:1,callback:ma=b,cipher_key:a.cipher_key,connect:h,disconnect:k,reconnect:j}),x&&(c in x?sa[c]=x[c]:sa[c]=x),o&&(Da.subscribe({channel:c+H,callback:o,restore:A}),d.subscribed||p||Da.here_now({channel:c,data:Z.prepareParams({uuid:U.getUUID(),auth:U.getAuthKey()}),callback:function(a){D.each("uuids"in a?a.uuids:[],function(b){o({action:"join",uuid:b,timestamp:Math.floor(D.rnow()/1e3),occupancy:a.occupancy||1},a,c)})}}))}),g&&D.each((g.join?g.join(","):""+g).split(","),function(c){var d=Y.getChannelGroup(c)||{};Y.addChannelGroup(c,{name:c,connected:d.connected,disconnected:d.disconnected,subscribed:1,callback:ma=b,cipher_key:a.cipher_key,connect:h,disconnect:k,reconnect:j}),o&&(Da.subscribe({channel_group:c+H,callback:o,restore:A,auth_key:U.getAuthKey()}),d.subscribed||p||Da.here_now({channel_group:c,data:Z.prepareParams({uuid:U.getUUID(),auth:U.getAuthKey()}),callback:function(a){D.each("uuids"in a?a.uuids:[],function(b){o({action:"join",uuid:b,timestamp:Math.floor(D.rnow()/1e3),occupancy:a.occupancy||1},a,c)})}}))}),ia=function(){B(),D.timeout(e,w)},F?void ia():G.push(ia)):S("Missing Subscribe Key"):S("Missing Callback"):S("Missing Channel")},here_now:function(a,b){var b=a.callback||b,c=a.debug,d=a.error||function(){},e=a.auth_key||U.getAuthKey(),f=a.channel,g=a.channel_group,h=J(),i="uuids"in a?a.uuids:!0,j=a.state,k={uuid:U.getUUID(),auth:e};if(i||(k.disable_uuids=1),j&&(k.state=1),!b)return S("Missing Callback");if(!U.getSubscribeKey())return S("Missing Subscribe Key");var l=[Z.getStandardOrigin(),"v2","presence","sub_key",U.getSubscribeKey()];f&&l.push("channel")&&l.push(D.encode(f)),"0"!=h&&(k.callback=h),g&&(k["channel-group"]=g,!f&&l.push("channel")&&l.push(",")),X.isInstanceIdEnabled()&&(k.instanceid=U.getInstanceId()),Q({callback:h,data:Z.prepareParams(k),success:function(a){u["default"].callback(a,b,d)},fail:function(a){u["default"].error(a,d)},debug:c,url:l})},where_now:function(a,b){_.whereNow(a,b)},state:function Fa(a,b){var c,b=a.callback||b||function(a){},d=a.error||function(){},e=a.auth_key||U.getAuthKey(),f=J(),Fa=a.state,g=a.uuid||U.getUUID(),h=a.channel,i=a.channel_group,j=Z.prepareParams({auth:e});return U.getSubscribeKey()?g?h||i?("0"!=f&&(j.callback=f),"undefined"!=typeof h&&Y.getChannel(h)&&Y.getChannel(h).subscribed&&Fa&&(sa[h]=Fa),"undefined"!=typeof i&&Y.getChannelGroup(i)&&Y.getChannelGroup(i).subscribed&&(Fa&&(sa[i]=Fa),j["channel-group"]=i,h||(h=",")),j.state=JSON.stringify(Fa),X.isInstanceIdEnabled()&&(j.instanceid=U.getInstanceId()),c=Fa?[Z.getStandardOrigin(),"v2","presence","sub-key",U.getSubscribeKey(),"channel",h,"uuid",g,"data"]:[Z.getStandardOrigin(),"v2","presence","sub-key",U.getSubscribeKey(),"channel",h,"uuid",D.encode(g)],void Q({callback:f,data:Z.prepareParams(j),success:function(a){u["default"].callback(a,b,d)},fail:function(a){u["default"].error(a,d)},url:c})):S("Missing Channel"):S("Missing UUID"):S("Missing Subscribe Key")},grant:function(a,b){var b=a.callback||b,c=a.error||function(){},d=a.channel||a.channels,e=a.channel_group,f=J(),g=a.ttl,i=a.read?"1":"0",j=a.write?"1":"0",k=a.manage?"1":"0",l=a.auth_key||a.auth_keys;if(!b)return S("Missing Callback");if(!U.getSubscribeKey())return S("Missing Subscribe Key");if(!U.getPublishKey())return S("Missing Publish Key");if(!U.getSecretKey())return S("Missing Secret Key");var m=Math.floor((new Date).getTime()/1e3),n=U.getSubscribeKey()+"\n"+U.getPublishKey()+"\ngrant\n",o={w:j,r:i,timestamp:m};a.manage&&(o.m=k),D.isArray(d)&&(d=d.join(",")),D.isArray(l)&&(l=l.join(",")),"undefined"!=typeof d&&null!=d&&d.length>0&&(o.channel=d),"undefined"!=typeof e&&null!=e&&e.length>0&&(o["channel-group"]=e),"0"!=f&&(o.callback=f),(g||0===g)&&(o.ttl=g),l&&(o.auth=l),o=Z.prepareParams(o),l||delete o.auth,n+=h(o);var p=ga(n,U.getSecretKey());p=p.replace(/\+/g,"-"),p=p.replace(/\//g,"_"),o.signature=p,Q({callback:f,data:o,success:function(a){u["default"].callback(a,b,c)},fail:function(a){u["default"].error(a,c)},url:[Z.getStandardOrigin(),"v1","auth","grant","sub-key",U.getSubscribeKey()]})},mobile_gw_provision:function(a){var b,c=a.callback||function(){},d=a.auth_key||U.getAuthKey(),e=a.error||function(){},f=J(),g=a.channel,h=a.op,i=a.gw_type,j=a.device_id;if(!j)return S("Missing Device ID (device_id)");if(!i)return S("Missing GW Type (gw_type: gcm or apns)");if(!h)return S("Missing GW Operation (op: add or remove)");if(!g)return S("Missing gw destination Channel (channel)");if(!U.getPublishKey())return S("Missing Publish Key");if(!U.getSubscribeKey())return S("Missing Subscribe Key");var k={uuid:U.getUUID(),auth:d,type:i};b=[Z.getStandardOrigin(),"v1/push/sub-key",U.getSubscribeKey(),"devices",j],"add"==h?k.add=g:"remove"==h&&(k.remove=g),X.isInstanceIdEnabled()&&(k.instanceid=U.getInstanceId()),Q({callback:f,data:k,success:function(a){u["default"].callback(a,c,e)},fail:function(a){u["default"].error(a,e)},url:b})},audit:function(a,b){var b=a.callback||b,c=a.error||function(){},d=a.channel,e=a.channel_group,f=a.auth_key,g=J();if(!b)return S("Missing Callback");if(!U.getSubscribeKey())return S("Missing Subscribe Key");if(!U.getPublishKey())return S("Missing Publish Key");if(!U.getSecretKey())return S("Missing Secret Key");var i=Math.floor((new Date).getTime()/1e3),j=U.getSubscribeKey()+"\n"+U.getPublishKey()+"\naudit\n",k={timestamp:i};"0"!=g&&(k.callback=g),"undefined"!=typeof d&&null!=d&&d.length>0&&(k.channel=d),"undefined"!=typeof e&&null!=e&&e.length>0&&(k["channel-group"]=e),f&&(k.auth=f),k=Z.prepareParams(k),f||delete k.auth,j+=h(k);var l=ga(j,U.getSecretKey());l=l.replace(/\+/g,"-"),l=l.replace(/\//g,"_"),k.signature=l,Q({callback:g,data:k,success:function(a){u["default"].callback(a,b,c)},fail:function(a){u["default"].error(a,c)},url:[Z.getStandardOrigin(),"v1","auth","audit","sub-key",U.getSubscribeKey()]})},revoke:function(a,b){a.read=!1,a.write=!1,Da.grant(a,b)},set_uuid:function(a){U.setUUID(a),ia()},get_uuid:function(){return U.getUUID()},isArray:function(a){return D.isArray(a)},get_subscribed_channels:function(){return Y.generate_channel_list(!0)},presence_heartbeat:function(a){var b=a.callback||function(){},c=a.error||function(){},d=J(),e={uuid:U.getUUID(),auth:U.getAuthKey()},f=JSON.stringify(sa);f.length>2&&(e.state=JSON.stringify(sa)),ua>0&&320>ua&&(e.heartbeat=ua),"0"!=d&&(e.callback=d);var g=D.encode(Y.generate_channel_list(!0).join(",")),h=Y.generate_channel_group_list(!0).join(",");g||(g=","),h&&(e["channel-group"]=h),X.isInstanceIdEnabled()&&(e.instanceid=U.getInstanceId()),X.isRequestIdEnabled()&&(e.requestid=D.generateUUID()),Q({callback:d,data:Z.prepareParams(e),url:[Z.getStandardOrigin(),"v2","presence","sub-key",U.getSubscribeKey(),"channel",g,"heartbeat"],success:function(a){u["default"].callback(a,b,c)},fail:function(a){u["default"].error(a,c)}})},stop_timers:function(){clearTimeout(V),clearTimeout(W),clearTimeout(ta)},shutdown:function(){Da.stop_timers(),Aa&&Aa()},xdr:Q,ready:f,db:R,uuid:D.generateUUID,map:D.map,each:D.each,"each-channel":t,grep:D.grep,offline:function(){B(1,{message:"Offline. Please check your network settings."})},supplant:D.supplant,now:D.rnow,unique:e,updater:D.updater};return V=D.timeout(x,M),W=D.timeout(z,da),ta=D.timeout(n,(va-3)*M),E(),Da}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},j=c(5),k=d(j),l=c(7),m=d(l),n=c(8),o=d(n),p=c(45),q=d(p),r=c(46),s=d(r),t=c(60),u=d(t),v=c(66),w=d(v),x=c(67),y=d(x),z=c(68),A=d(z),B=c(3),C=c(44),D=c(43),E=1,F=!1,G=[],H="-pnpres",I=10,J=15e3,K=310,L=60,M=1e3,N=5,O=30,P=B.version;a.exports={PN_API:h,unique:e,PNmessage:g,DEF_TIMEOUT:J,timeout:D.timeout,build_url:D.buildURL,each:D.each,uuid:D.generateUUID,URLBIT:C.URLBIT,grep:D.grep,supplant:D.supplant,now:D.rnow,updater:D.updater,map:D.map}},function(a,b,c){function d(a,b,c){var d=b&&c||0,e=0;for(b=b||[],a.toLowerCase().replace(/[0-9a-f]{2}/g,function(a){16>e&&(b[d+e++]=j[a])});16>e;)b[d+e++]=0;return b}function e(a,b){var c=b||0,d=i;return d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]}function f(a,b,c){var d=b&&c||0,f=b||[];a=a||{};var g=void 0!==a.clockseq?a.clockseq:n,h=void 0!==a.msecs?a.msecs:(new Date).getTime(),i=void 0!==a.nsecs?a.nsecs:p+1,j=h-o+(i-p)/1e4;if(0>j&&void 0===a.clockseq&&(g=g+1&16383),(0>j||h>o)&&void 0===a.nsecs&&(i=0),i>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");o=h,p=i,n=g,h+=122192928e5;var k=(1e4*(268435455&h)+i)%4294967296;f[d++]=k>>>24&255,f[d++]=k>>>16&255,f[d++]=k>>>8&255,f[d++]=255&k;var l=h/4294967296*1e4&268435455;f[d++]=l>>>8&255,f[d++]=255&l,f[d++]=l>>>24&15|16,f[d++]=l>>>16&255,f[d++]=g>>>8|128,f[d++]=255&g;for(var q=a.node||m,r=0;6>r;r++)f[d+r]=q[r];return b?b:e(f)}function g(a,b,c){var d=b&&c||0;"string"==typeof a&&(b="binary"==a?new Array(16):null,a=null),a=a||{};var f=a.random||(a.rng||h)();if(f[6]=15&f[6]|64,f[8]=63&f[8]|128,b)for(var g=0;16>g;g++)b[d+g]=f[g];return b||e(f)}for(var h=c(6),i=[],j={},k=0;256>k;k++)i[k]=(k+256).toString(16).substr(1),j[i[k]]=k;var l=h(),m=[1|l[0],l[1],l[2],l[3],l[4],l[5]],n=16383&(l[6]<<8|l[7]),o=0,p=0,q=g;q.v1=f,q.v4=g,q.parse=d,q.unparse=e,a.exports=q},function(a,b){(function(b){var c;if(b.crypto&&crypto.getRandomValues){var d=new Uint8Array(16);c=function(){return crypto.getRandomValues(d),d}}if(!c){var e=new Array(16);c=function(){for(var a,b=0;16>b;b++)0===(3&b)&&(a=4294967296*Math.random()),e[b]=a>>>((3&b)<<3)&255;return e}}a.exports=c}).call(b,function(){return this}())},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=c(8),h=(d(g),c(9)),i=d(h),j=c(43),k=function(){function a(b,c){var d=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],f=arguments.length<=3||void 0===arguments[3]?"pubsub.pubnub.com":arguments[3];e(this,a),this._xdr=b,this._keychain=c,this._maxSubDomain=20,this._currentSubDomain=Math.floor(Math.random()*this._maxSubDomain),this._providedFQDN=(d?"https://":"http://")+f,this._coreParams={},this.shiftStandardOrigin(!1),this.shiftSubscribeOrigin(!1)}return f(a,[{key:"setCoreParams",value:function(a){return this._coreParams=a,this}},{key:"addCoreParam",value:function(a,b){this._coreParams[a]=b}},{key:"prepareParams",value:function(a){return(0,i["default"])(a||{},this._coreParams)}},{key:"nextOrigin",value:function(a){if(-1===this._providedFQDN.indexOf("pubsub."))return this._providedFQDN;var b=void 0;return a?b=j.generateUUID().split("-")[0]:(this._currentSubDomain=this._currentSubDomain+1,this._currentSubDomain>=this._maxSubDomain&&(this._currentSubDomain=1),b=this._currentSubDomain.toString()),this._providedFQDN.replace("pubsub","ps"+b)}},{key:"shiftStandardOrigin",value:function(){var a=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];return this._standardOrigin=this.nextOrigin(a),this._standardOrigin}},{key:"shiftSubscribeOrigin",value:function(){var a=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];return this._subscribeOrigin=this.nextOrigin(a),this._subscribeOrigin}},{key:"fetchHistory",value:function(a,b){var c=b.data,d=b.callback,e=b.success,f=b.fail,g=[this.getStandardOrigin(),"v2","history","sub-key",this._keychain.getSubscribeKey(),"channel",j.encode(a)];this._xdr({data:c,callback:d,success:e,fail:f,url:g})}},{key:"fetchReplay",value:function(a,b,c){var d=c.data,e=c.callback,f=c.success,g=c.fail,h=[this.getStandardOrigin(),"v1","replay",this._keychain.getPublishKey(),this._keychain.getSubscribeKey(),a,b];this._xdr({data:d,callback:e,success:f,fail:g,url:h})}},{key:"fetchTime",value:function(a,b){var c=b.data,d=b.callback,e=b.success,f=b.fail,g=[this.getStandardOrigin(),"time",a];this._xdr({data:c,callback:d,success:e,fail:f,url:g})}},{key:"fetchWhereNow",value:function(a,b){var c=b.data,d=b.callback,e=b.success,f=b.fail,g=[this.getStandardOrigin(),"v2","presence","sub_key",this._keychain.getSubscribeKey(),"uuid",j.encode(a)];this._xdr({data:c,callback:d,success:e,fail:f,url:g})}},{key:"getOrigin",value:function(){return this._providedFQDN}},{key:"getStandardOrigin",value:function(){return this._standardOrigin}},{key:"getSubscribeOrigin",value:function(){return this._subscribeOrigin}}]),a}();b["default"]=k},function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=function(){function a(){c(this,a)}return d(a,[{key:"setUUID",value:function(a){return this._UUID=a,this}},{key:"setCipherKey",value:function(a){return this._cipherKey=a,this}},{key:"setSubscribeKey",value:function(a){return this._subscribeKey=a,this}},{key:"setPublishKey",value:function(a){return this._publishKey=a,this}},{key:"setAuthKey",value:function(a){return this._authKey=a,this}},{key:"setInstanceId",value:function(a){return this._instanceId=a,this}},{key:"setSecretKey",value:function(a){return this._secretKey=a,this}},{key:"getCipherKey",value:function(){return this._cipherKey}},{key:"getSubscribeKey",value:function(){return this._subscribeKey}},{key:"getPublishKey",value:function(){return this._publishKey}},{key:"getAuthKey",value:function(){return this._authKey}},{key:"getInstanceId",value:function(){return this._instanceId}},{key:"getSecretKey",value:function(){return this._secretKey}},{key:"getUUID",value:function(){return this._UUID}}]),a}();b["default"]=e},function(a,b,c){
var d=c(10),e=c(11),f=c(13),g=c(25),h=g(function(a){return a.push(void 0,e),d(f,void 0,a)});a.exports=h},function(a,b){function c(a,b,c){var d=c.length;switch(d){case 0:return a.call(b);case 1:return a.call(b,c[0]);case 2:return a.call(b,c[0],c[1]);case 3:return a.call(b,c[0],c[1],c[2])}return a.apply(b,c)}a.exports=c},function(a,b,c){function d(a,b,c,d){return void 0===a||e(a,f[c])&&!g.call(d,c)?b:a}var e=c(12),f=Object.prototype,g=f.hasOwnProperty;a.exports=d},function(a,b){function c(a,b){return a===b||a!==a&&b!==b}a.exports=c},function(a,b,c){var d=c(14),e=c(16),f=c(28),g=e(function(a,b,c,e){d(b,f(b),a,e)});a.exports=g},function(a,b,c){function d(a,b,c,d){c||(c={});for(var f=-1,g=b.length;++f<g;){var h=b[f],i=d?d(c[h],a[h],h,c,a):a[h];e(c,h,i)}return c}var e=c(15);a.exports=d},function(a,b,c){function d(a,b,c){var d=a[b];g.call(a,b)&&e(d,c)&&(void 0!==c||b in a)||(a[b]=c)}var e=c(12),f=Object.prototype,g=f.hasOwnProperty;a.exports=d},function(a,b,c){function d(a){return f(function(b,c){var d=-1,f=c.length,g=f>1?c[f-1]:void 0,h=f>2?c[2]:void 0;for(g="function"==typeof g?(f--,g):void 0,h&&e(c[0],c[1],h)&&(g=3>f?void 0:g,f=1),b=Object(b);++d<f;){var i=c[d];i&&a(b,i,d,g)}return b})}var e=c(17),f=c(25);a.exports=d},function(a,b,c){function d(a,b,c){if(!h(c))return!1;var d=typeof b;return("number"==d?f(c)&&g(b,c.length):"string"==d&&b in c)?e(c[b],a):!1}var e=c(12),f=c(18),g=c(24),h=c(22);a.exports=d},function(a,b,c){function d(a){return null!=a&&g(e(a))&&!f(a)}var e=c(19),f=c(21),g=c(23);a.exports=d},function(a,b,c){var d=c(20),e=d("length");a.exports=e},function(a,b){function c(a){return function(b){return null==b?void 0:b[a]}}a.exports=c},function(a,b,c){function d(a){var b=e(a)?i.call(a):"";return b==f||b==g}var e=c(22),f="[object Function]",g="[object GeneratorFunction]",h=Object.prototype,i=h.toString;a.exports=d},function(a,b){function c(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}a.exports=c},function(a,b){function c(a){return"number"==typeof a&&a>-1&&a%1==0&&d>=a}var d=9007199254740991;a.exports=c},function(a,b){function c(a,b){return a="number"==typeof a||e.test(a)?+a:-1,b=null==b?d:b,a>-1&&a%1==0&&b>a}var d=9007199254740991,e=/^(?:0|[1-9]\d*)$/;a.exports=c},function(a,b,c){function d(a,b){if("function"!=typeof a)throw new TypeError(g);return b=h(void 0===b?a.length-1:f(b),0),function(){for(var c=arguments,d=-1,f=h(c.length-b,0),g=Array(f);++d<f;)g[d]=c[b+d];switch(b){case 0:return a.call(this,g);case 1:return a.call(this,c[0],g);case 2:return a.call(this,c[0],c[1],g)}var i=Array(b+1);for(d=-1;++d<b;)i[d]=c[d];return i[b]=g,e(a,this,i)}}var e=c(10),f=c(26),g="Expected a function",h=Math.max;a.exports=d},function(a,b,c){function d(a){if(!a)return 0===a?a:0;if(a=e(a),a===f||a===-f){var b=0>a?-1:1;return b*g}var c=a%1;return a===a?c?a-c:a:0}var e=c(27),f=1/0,g=1.7976931348623157e308;a.exports=d},function(a,b,c){function d(a){if(f(a)){var b=e(a.valueOf)?a.valueOf():a;a=f(b)?b+"":b}if("string"!=typeof a)return 0===a?a:+a;a=a.replace(h,"");var c=j.test(a);return c||k.test(a)?l(a.slice(2),c?2:8):i.test(a)?g:+a}var e=c(21),f=c(22),g=NaN,h=/^\s+|\s+$/g,i=/^[-+]0x[0-9a-f]+$/i,j=/^0b[01]+$/i,k=/^0o[0-7]+$/i,l=parseInt;a.exports=d},function(a,b,c){function d(a){for(var b=-1,c=h(a),d=e(a),i=d.length,k=f(a),l=!!k,m=k||[],n=m.length;++b<i;){var o=d[b];l&&("length"==o||g(o,n))||"constructor"==o&&(c||!j.call(a,o))||m.push(o)}return m}var e=c(29),f=c(35),g=c(24),h=c(42),i=Object.prototype,j=i.hasOwnProperty;a.exports=d},function(a,b,c){function d(a){a=null==a?a:Object(a);var b=[];for(var c in a)b.push(c);return b}var e=c(30),f=c(34),g=Object.prototype,h=e?e.enumerate:void 0,i=g.propertyIsEnumerable;h&&!i.call({valueOf:1},"valueOf")&&(d=function(a){return f(h(a))}),a.exports=d},function(a,b,c){var d=c(31),e=d.Reflect;a.exports=e},function(a,b,c){(function(a,d){var e=c(33),f={"function":!0,object:!0},g=f[typeof b]&&b&&!b.nodeType?b:void 0,h=f[typeof a]&&a&&!a.nodeType?a:void 0,i=e(g&&h&&"object"==typeof d&&d),j=e(f[typeof self]&&self),k=e(f[typeof window]&&window),l=e(f[typeof this]&&this),m=i||k!==(l&&l.window)&&k||j||l||Function("return this")();a.exports=m}).call(b,c(32)(a),function(){return this}())},function(a,b){a.exports=function(a){return a.webpackPolyfill||(a.deprecate=function(){},a.paths=[],a.children=[],a.webpackPolyfill=1),a}},function(a,b){function c(a){return a&&a.Object===Object?a:null}a.exports=c},function(a,b){function c(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c}a.exports=c},function(a,b,c){function d(a){var b=a?a.length:void 0;return h(b)&&(g(a)||i(a)||f(a))?e(b,String):null}var e=c(36),f=c(37),g=c(40),h=c(23),i=c(41);a.exports=d},function(a,b){function c(a,b){for(var c=-1,d=Array(a);++c<a;)d[c]=b(c);return d}a.exports=c},function(a,b,c){function d(a){return e(a)&&h.call(a,"callee")&&(!j.call(a,"callee")||i.call(a)==f)}var e=c(38),f="[object Arguments]",g=Object.prototype,h=g.hasOwnProperty,i=g.toString,j=g.propertyIsEnumerable;a.exports=d},function(a,b,c){function d(a){return f(a)&&e(a)}var e=c(18),f=c(39);a.exports=d},function(a,b){function c(a){return!!a&&"object"==typeof a}a.exports=c},function(a,b){var c=Array.isArray;a.exports=c},function(a,b,c){function d(a){return"string"==typeof a||!e(a)&&f(a)&&i.call(a)==g}var e=c(40),f=c(39),g="[object String]",h=Object.prototype,i=h.toString;a.exports=d},function(a,b){function c(a){var b=a&&a.constructor,c="function"==typeof b&&b.prototype||d;return a===c}var d=Object.prototype;a.exports=c},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(){return+new Date}function f(a){return!!a&&"string"!=typeof a&&(Array.isArray&&Array.isArray(a)||"number"==typeof a.length)}function g(a,b){if(a&&b)if(f(a))for(var c=0,d=a.length;d>c;)b.call(a[c],a[c],c++);else for(var c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function h(a){return encodeURIComponent(a)}function i(a,b){var c=a.join(t.URLBIT),d=[];return b?(g(b,function(a,b){var c="object"===("undefined"==typeof b?"undefined":q(b))?JSON.stringify(b):b;"undefined"!=typeof b&&null!==b&&h(c).length>0&&d.push(a+"="+h(c))}),c+="?"+d.join(t.PARAMSBIT)):c}function j(a,b){var c,d=0,f=function g(){d+b>e()?(clearTimeout(c),c=setTimeout(g,b)):(d=e(),a())};return f}function k(a,b){var c=[];return g(a||[],function(a){b(a)&&c.push(a)}),c}function l(a,b){return a.replace(u,function(a,c){return b[c]||a})}function m(a,b){return"undefined"!=typeof setTimeout?setTimeout(a,b):void 0}function n(a){var b=s["default"].v4();return a&&a(b),b}function o(a,b){var c=[];return g(a||[],function(a,d){c.push(b(a,d))}),c}function p(a){return encodeURIComponent(a).replace(/[!'()*~]/g,function(a){return"%"+a.charCodeAt(0).toString(16).toUpperCase()})}var q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},r=c(5),s=d(r),t=c(44),u=/{([\w\-]+)}/g;a.exports={buildURL:i,encode:h,each:g,updater:j,rnow:e,isArray:f,map:o,pamEncode:p,generateUUID:n,timeout:m,supplant:l,grep:k}},function(a,b){a.exports={PARAMSBIT:"&",URLBIT:"/"}},function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=function(){function a(){c(this,a),this._instanceId=!1,this._requestId=!1}return d(a,[{key:"setInstanceIdConfig",value:function(a){return this._instanceId=a,this}},{key:"setRequestIdConfig",value:function(a){return this._requestId=a,this}},{key:"isInstanceIdEnabled",value:function(){return this._instanceId}},{key:"isRequestIdEnabled",value:function(){return this._requestId}}]),a}();b["default"]=e},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=c(47),h=d(g),i=function(){function a(){e(this,a),this._channelStorage={},this._channelGroupStorage={}}return f(a,[{key:"containsChannel",value:function(a){return a in this._channelStorage}},{key:"containsChannelGroup",value:function(a){return a in this._channelGroupStorage}},{key:"getChannel",value:function(a){return this._channelStorage[a]}},{key:"getChannelGroup",value:function(a){return this._channelGroupStorage[a]}},{key:"addChannel",value:function(a,b){this._channelStorage[a]=b}},{key:"addChannelGroup",value:function(a,b){this._channelGroupStorage[a]=b}},{key:"generate_channel_list",value:function(a){var b=[];return(0,h["default"])(this._channelStorage,function(c,d){a?d.search("-pnpres")<0&&c.subscribed&&b.push(d):c.subscribed&&b.push(d)}),b.sort()}},{key:"generate_channel_group_list",value:function(a){var b=[];return(0,h["default"])(this._channelGroupStorage,function(c,d){a?d.search("-pnpres")<0&&c.subscribed&&b.push(d):c.subscribed&&b.push(d)}),b.sort()}}]),a}();b["default"]=i},function(a,b,c){a.exports=c(48)},function(a,b,c){function d(a,b){return"function"==typeof b&&h(a)?e(a,b):g(a,f(b))}var e=c(49),f=c(50),g=c(52),h=c(40);a.exports=d},function(a,b){function c(a,b){for(var c=-1,d=a.length;++c<d&&b(a[c],c,a)!==!1;);return a}a.exports=c},function(a,b,c){function d(a){return"function"==typeof a?a:e}var e=c(51);a.exports=d},function(a,b){function c(a){return a}a.exports=c},function(a,b,c){var d=c(53),e=c(59),f=e(d);a.exports=f},function(a,b,c){function d(a,b){return a&&e(a,b,f)}var e=c(54),f=c(56);a.exports=d},function(a,b,c){var d=c(55),e=d();a.exports=e},function(a,b){function c(a){return function(b,c,d){for(var e=-1,f=Object(b),g=d(b),h=g.length;h--;){var i=g[a?h:++e];if(c(f[i],i,f)===!1)break}return b}}a.exports=c},function(a,b,c){function d(a){var b=j(a);if(!b&&!h(a))return f(a);var c=g(a),d=!!c,k=c||[],l=k.length;for(var m in a)!e(a,m)||d&&("length"==m||i(m,l))||b&&"constructor"==m||k.push(m);return k}var e=c(57),f=c(58),g=c(35),h=c(18),i=c(24),j=c(42);a.exports=d},function(a,b){function c(a,b){return e.call(a,b)||"object"==typeof a&&b in a&&null===f(a)}var d=Object.prototype,e=d.hasOwnProperty,f=Object.getPrototypeOf;a.exports=c},function(a,b){function c(a){return d(Object(a))}var d=Object.keys;a.exports=c},function(a,b,c){function d(a,b){return function(c,d){if(null==c)return c;if(!e(c))return a(c,d);for(var f=c.length,g=b?f:-1,h=Object(c);(b?g--:++g<f)&&d(h[g],g,h)!==!1;);return c}}var e=c(18);a.exports=d},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c(61),i=d(h),j=function(){function a(){e(this,a)}return g(a,null,[{key:"callback",value:function(a,b,c){if("object"===("undefined"==typeof a?"undefined":f(a))){if(a.error){var d=(0,i["default"])(a,["message","payload"]);return void(c&&c(d))}if(a.payload)return void(a.next_page?b&&b(a.payload,a.next_page):b&&b(a.payload))}b&&b(a)}},{key:"error",value:function(a,b){if("object"===("undefined"==typeof a?"undefined":f(a))&&a.error){var c=(0,i["default"])(a,["message","payload"]);if(b)return b(c)}else if(b)return b(a)}}]),a}();b["default"]=j},function(a,b,c){var d=c(62),e=c(64),f=c(25),g=f(function(a,b){return null==a?{}:e(a,d(b,1))});a.exports=g},function(a,b,c){function d(a,b,c,i){i||(i=[]);for(var j=-1,k=a.length;++j<k;){var l=a[j];b>0&&h(l)&&(c||g(l)||f(l))?b>1?d(l,b-1,c,i):e(i,l):c||(i[i.length]=l)}return i}var e=c(63),f=c(37),g=c(40),h=c(38);a.exports=d},function(a,b){function c(a,b){for(var c=-1,d=b.length,e=a.length;++c<d;)a[e+c]=b[c];return a}a.exports=c},function(a,b,c){function d(a,b){return a=Object(a),e(b,function(b,c){return c in a&&(b[c]=a[c]),b},{})}var e=c(65);a.exports=d},function(a,b){function c(a,b,c,d){var e=-1,f=a.length;for(d&&f&&(c=a[++e]);++e<f;)c=b(c,a[e],e,a);return c}a.exports=c},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=c(7),h=(d(g),c(45)),i=(d(h),c(8)),j=(d(i),function(){function a(b){var c=b.networking,d=b.config,f=b.keychain,g=b.jsonp_cb;e(this,a),this._networking=c,this._config=d,this._keychain=f,this._jsonp_cb=g}return f(a,[{key:"fetchTime",value:function(a){var b=this._jsonp_cb(),c={uuid:this._keychain.getUUID(),auth:this._keychain.getAuthKey()};this._config.isInstanceIdEnabled()&&(c.instanceid=this._keychain.getInstanceId());var d=function(b){a(b[0])},e=function(){a(0)};this._networking.fetchTime(b,{callback:b,data:this._networking.prepareParams(c),success:d,fail:e})}}]),a}());b["default"]=j},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=c(7),h=(d(g),c(45)),i=(d(h),c(8)),j=(d(i),c(60)),k=d(j),l=function(){function a(b){var c=b.networking,d=b.config,f=b.keychain,g=b.jsonp_cb,h=b.error;e(this,a),this._networking=c,this._config=d,this._keychain=f,this._jsonp_cb=g,this._error=h}return f(a,[{key:"whereNow",value:function(a,b){var c=a.callback||b,d=a.error||function(){},e=a.auth_key||this._keychain.getAuthKey(),f=this._jsonp_cb(),g=a.uuid||this._keychain.getUUID(),h={auth:e};return c?this._keychain.getSubscribeKey()?(0!==f&&(h.callback=f),this._config.isInstanceIdEnabled()&&(h.instanceid=this._keychain.getInstanceId()),void this._networking.fetchWhereNow(g,{callback:f,data:this._networking.prepareParams(h),success:function(a){k["default"].callback(a,c,d)},fail:function(a){k["default"].error(a,d)}})):this._error("Missing Subscribe Key"):this._error("Missing Callback")}}]),a}();b["default"]=l},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c(7),i=(d(h),c(8)),j=(d(i),c(60)),k=d(j),l=function(){function a(b){var c=b.networking,d=b.keychain,f=b.jsonp_cb,g=b.error,h=b.decrypt;e(this,a),this._networking=c,this._keychain=d,this._jsonp_cb=f,this._error=g,this._decrypt=h}return g(a,[{key:"fetchHistory",value:function(a,b){var c=this,d=a.callback||b,e=a.count||a.limit||100,f=a.reverse||"false",g=a.error||function(){},h=a.auth_key||this._keychain.getAuthKey(),i=a.cipher_key,j=a.channel,l=a.channel_group,m=a.start,n=a.end,o=a.include_token,p=a.string_message_token||!1,q=this._jsonp_cb();if(!j&&!l)return this._error("Missing Channel");if(!d)return this._error("Missing Callback");if(!this._keychain.getSubscribeKey())return this._error("Missing Subscribe Key");var r={stringtoken:"true",count:e,reverse:f,auth:h};l&&(r["channel-group"]=l,j||(j=",")),q&&(r.callback=q),m&&(r.start=m),n&&(r.end=n),o&&(r.include_token="true"),p&&(r.string_message_token="true"),this._networking.fetchHistory(j,{callback:q,data:this._networking.prepareParams(r),success:function(a){c._handleHistoryResponse(a,g,d,o,i)},fail:function(a){k["default"].error(a,g)}})}},{key:"_handleHistoryResponse",value:function(a,b,c,d,e){if("object"===("undefined"==typeof a?"undefined":f(a))&&a.error)return void b({message:a.message,payload:a.payload});for(var g=a[0],h=[],i=0;i<g.length;i++)if(d){var j=this._decrypt(g[i].message,e),k=g[i].timetoken;try{h.push({message:JSON.parse(j),timetoken:k})}catch(l){h.push({message:j,timetoken:k})}}else{var m=this._decrypt(g[i],e);try{h.push(JSON.parse(m))}catch(l){h.push(m)}}c([h,a[1],a[2]])}}]),a}();b["default"]=l}])});