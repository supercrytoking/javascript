// 3.4.3
(function(){
function i(){return function(){}}var aa=1,l=!1,p=[],x="-pnpres",y=1E3,ba=/{([\w\-]+)}/g;function ca(){return"x"+ ++aa+""+ +new Date}function C(){return+new Date}var D,G=Math.floor(20*Math.random());D=function(a,b){return 0<a.indexOf("pubsub.")&&a.replace("pubsub","ps"+(b?H().split("-")[0]:20>++G?G:G=1))||a};function da(a,b){function c(){f+b>C()?(clearTimeout(d),d=setTimeout(c,b)):(f=C(),a())}var d,f=0;return c}function ea(a,b){var c=[];I(a||[],function(a){b(a)&&c.push(a)});return c}
function fa(a,b){return a.replace(ba,function(a,d){return b[d]||a})}function H(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}function I(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var c=0,d=a.length;c<d;)b.call(a[c],a[c],c++);else for(c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function K(a,b){var c=[];I(a||[],function(a,f){c.push(b(a,f))});return c}
function L(a){return K(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function M(a){var b=[];I(a,function(a,d){d.f&&b.push(a)});return b.sort()}function ga(){setTimeout(function(){l||(l=1,I(p,function(a){a()}))},y)}
function Q(a){function b(a){f||(f=1,clearTimeout(e),d&&(d.onerror=d.onload=null,d.abort&&d.abort(),d=null),a&&N())}function c(){if(!q){q=1;clearTimeout(e);try{response=JSON.parse(d.responseText)}catch(a){return b(1)}O(response)}}var d,f=0,q=0,e;e=setTimeout(function(){b(1)},R);var N=a.b||i(),O=a.c||i();try{d="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;d.onerror=d.onabort=function(){b(1)};d.onload=d.onloadend=c;d.timeout=R;url=a.url.join(ha);if(a.data){var u=[];url+=
"?";for(key in a.data)u.push(key+"="+a.data[key]);url+=u.join(ia)}d.open("GET",url,!0);d.send()}catch(r){return b(0),Q(a)}return b}function S(a,b,c){I(a.split(","),function(a){function f(a){a||(a=window.event);c(a)||(a.cancelBubble=!0,a.returnValue=!1,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,f,!1):b.attachEvent?b.attachEvent("on"+a,f):b["on"+a]=f})}
function ja(a,b,c){if(c)a.setAttribute(b,c);else return a&&a.getAttribute&&a.getAttribute(b)}function ka(a){return document.getElementById(a)}function la(a,b){var c=[];I(a.split(/\s+/),function(a){I((b||document).getElementsByTagName(a),function(a){c.push(a)})});return c}
function S(a,b,c){I(a.split(","),function(a){function f(a){a||(a=window.event);c(a)||(a.cancelBubble=!0,a.returnValue=!1,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,f,!1):b.attachEvent?b.attachEvent("on"+a,f):b["on"+a]=f})}function ma(a,b){for(var c in b)if(b.hasOwnProperty(c))try{a.style[c]=b[c]+(0<"|width|height|top|left|".indexOf(c)&&"number"==typeof b[c]?"px":"")}catch(d){}}
function na(a){return document.createElement(a)}
function T(a){function b(){}function c(){j.time(function(a){a||v&&v(1);setTimeout(c,u)})}function d(){oa()||v&&v(1);setTimeout(d,y)}function f(a){I(M(m),function(b){(b=m[b])&&a(b)})}function q(a){a&&(s.g=0);!s.g&&s.length&&(s.g=1,t(s.shift()))}a.db=U;a.xdr=Q;var e,N=+a.windowing||10,O=(+a.timeout||310)*y,u=(+a.keepalive||60)*y,r=a.publish_key||"",g=a.subscribe_key||"",J=a.ssl?"s":"",E="http"+J+"://"+(a.origin||"pubsub.pubnub.com"),z=D(E),W=D(E),s=[],X=0,Y=0,v=0,P=0,Z=0,F=0,m={},t=a.xdr,oa=a._is_online||
function(){return 1},w=a.jsonp_cb||function(){return 0},A=a.db||{get:i(),set:i()},B=a.uuid||A&&A.get(g+"uuid")||"",j={LEAVE:function(a,b){var c={uuid:B},d=D(E),n=w();0<a.indexOf(x)||("0"!=n&&(c.callback=n),t({l:b||J,timeout:2E3,a:n,data:c,url:[d,"v2","presence","sub_key",g,"channel",L(a),"leave"]}))},history:function(a,b){var b=a.callback||b,c=a.count||a.limit||100,d=a.reverse||"false",n=a.error||i(),f=a.channel,e=a.start,j=a.end,h={},k=w();if(!f)return error("Missing Channel");if(!b)return error("Missing Callback");
if(!g)return error("Missing Subscribe Key");h.stringtoken="true";h.count=c;h.reverse=d;k&&(h.callback=k);e&&(h.start=e);j&&(h.end=j);t({a:k,data:h,c:function(a){b(a)},b:n,url:[z,"v2","history","sub-key",g,"channel",L(f)]})},replay:function(a){var b=b||a.callback||i(),c=a.source,d=a.destination,f=a.stop,e=a.start,j=a.end,m=a.reverse,a=a.limit,h=w(),k={};if(!c)return error("Missing Source Channel");if(!d)return error("Missing Destination Channel");if(!r)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");
"0"!=h&&(k.callback=h);f&&(k.stop="all");m&&(k.reverse="true");e&&(k.start=e);j&&(k.end=j);a&&(k.count=a);t({a:h,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[z,"v1","replay",r,g,c,d],data:k})},time:function(a){var b=w();t({a:b,timeout:5*y,url:[z,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){var b=b||a.callback||i(),c=a.message,d=a.channel,e=w();if(!c)return error("Missing Message");if(!d)return error("Missing Channel");if(!r)return error("Missing Publish Key");
if(!g)return error("Missing Subscribe Key");c=JSON.stringify(c);d=[z,"publish",r,g,0,L(d),e,L(c)];s.push({a:e,timeout:5*y,url:d,data:{uuid:B},c:function(a){b(a);q(1)},b:function(){b([0,"Failed",c]);q(1)}});q()},unsubscribe:function(a){a=a.channel;F=0;P=1;a=K((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+x}).join(",");I(a.split(","),function(a){l&&j.LEAVE(a,0);m[a]=0});l&&b()},subscribe:function(a,c){function d(a){a?setTimeout(e,y):(z=D(E,1),W=D(E,1),setTimeout(function(){j.time(d)},
y));f(function(b){if(a&&b.d)return b.d=0,b.j(b.name);!a&&!b.d&&(b.d=1,b.i(b.name))})}function e(){var a=w(),b=M(m).join(",");b&&(v=t({timeout:J,a:a,b:function(){j.time(d)},data:{uuid:B},url:[W,"subscribe",g,L(b),a,F],c:function(a){if(!a)return setTimeout(e,$);f(function(a){a.e||(a.e=1,a.h(a.name))});F=!F&&P&&A.get(g)||a[1];r&&(Timetoken=1E4,r=0);A.set(g,a[1]);var b,c=(2<a.length?a[2]:"").split(",");b=function(){var a=c.shift()||"";return[(m[a]||{}).a||X,(a||Y).split(x)[0]]};I(a[0],function(c){var d=
b();if(m[d[1]].f)d[0](c,a,d[1])});setTimeout(e,$)}}))}var n=a.channel,c=(c=c||a.callback)||a.message,q=a.connect||i(),s=a.reconnect||i(),u=a.disconnect||i(),h=a.presence||0,k=a.noheresync||0,r=a.backfill||0,J=a.timeout||O,$=a.windowing||N;a.restore&&(P=1);F=0;if(!n)return error("Missing Channel");if(!c)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");I((n.join?n.join(","):""+n).split(","),function(a){var b=m[a]||{};m[Y=a]={name:a,e:b.e,d:b.d,f:1,a:X=c,h:q,i:u,j:s};h&&(j.subscribe({channel:a+
x,callback:h}),!b.f&&!k&&j.here_now({channel:a,callback:function(b){I("uuids"in b?b.uuids:[],function(c){h({action:"join",uuid:c,timestamp:C(),occupancy:b.occupancy||1},b,a)})}}))});b=function(){v&&v(1);clearTimeout(Z);Z=setTimeout(e,100)};if(!l)return p.push(b);b()},here_now:function(a,b){var b=a.callback||b,c=a.error||i(),d=a.channel,e=w(),f=null;if(!d)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");"0"!=e&&(f={},f.callback=e);t({a:e,
data:f,c:function(a){b(a)},b:c,url:[z,"v2","presence","sub_key",g,"channel",L(d)]})},xdr:t,ready:ga,db:A,uuid:H,each:I,map:K,grep:ea,supplant:fa,now:C,unique:ca,updater:da};B||(B=j.uuid());A.set(g+"uuid",B);setTimeout(d,y);setTimeout(c,u);e=j;e.init=T;e.$=ka;e.attr=ja;e.search=la;e.bind=S;e.css=ma;e.create=na;if(a.notest)return e;S("beforeunload",window,function(){each_channel(function(a){e.LEAVE(a.name,1)});return!0});S("offline",window,e._reset_offline);S("offline",document,e._reset_offline);e.ready();
return e}var ha="/",ia="&",R=31E4,U,V="undefined"!=typeof localStorage&&localStorage;U={get:function(a){try{return V?V.getItem(a):-1==document.cookie.indexOf(a)?null:((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||null}catch(b){}},set:function(a,b){try{if(V)return V.setItem(a,b)&&0;document.cookie=a+"="+b+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(c){}}};"undefined"!==typeof module&&(module.m=T)||"undefined"!==typeof exports&&(exports.k=T)||(PUBNUB=T);
})();
