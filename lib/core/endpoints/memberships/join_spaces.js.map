{"version":3,"sources":["core/endpoints/memberships/join_spaces.js"],"names":["prepareMessagePayload","modules","incomingParams","spaces","payload","length","add","forEach","addMembership","currentAdd","id","custom","push","getOperation","operationConstants","PNUpdateMembershipsOperation","validateParams","userId","getURL","config","subscribeKey","utils","encodeString","patchURL","usePatch","getRequestTimeout","getTransactionTimeout","isAuthSupported","getAuthToken","token","tokenManager","getToken","prepareParams","include","limit","page","params","includes","totalCount","count","customFields","spaceFields","customSpaceFields","includesString","join","next","start","prev","end","patchPayload","handleResponse","membershipsResponse"],"mappings":"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","sourcesContent":["/* @flow */\n\nimport {\n  AddMemberships,\n  MembershipsInput,\n  MembershipsListResponse,\n  ModulesInject,\n} from '../../flow_interfaces';\nimport operationConstants from '../../constants/operations';\nimport utils from '../../utils';\n\nfunction prepareMessagePayload(modules, incomingParams) {\n  const { spaces } = incomingParams;\n  let payload = {};\n\n  if (spaces && spaces.length > 0) {\n    payload.add = [];\n\n    spaces.forEach((addMembership) => {\n      let currentAdd: AddMemberships = { id: addMembership.id };\n\n      if (addMembership.custom) {\n        currentAdd.custom = addMembership.custom;\n      }\n\n      payload.add.push(currentAdd);\n    });\n  }\n\n  return payload;\n}\n\nexport function getOperation(): string {\n  return operationConstants.PNUpdateMembershipsOperation;\n}\n\nexport function validateParams(\n  modules: ModulesInject,\n  incomingParams: MembershipsInput\n) {\n  let { userId, spaces } = incomingParams;\n\n  if (!userId) return 'Missing userId';\n  if (!spaces) return 'Missing spaces';\n}\n\nexport function getURL(\n  modules: ModulesInject,\n  incomingParams: MembershipsInput\n): string {\n  let { config } = modules;\n\n  return `/v1/objects/${config.subscribeKey}/users/${utils.encodeString(incomingParams.userId)}/spaces`;\n}\n\nexport function patchURL(\n  modules: ModulesInject,\n  incomingParams: MembershipsInput\n): string {\n  let { config } = modules;\n\n  return `/v1/objects/${config.subscribeKey}/users/${utils.encodeString(incomingParams.userId)}/spaces`;\n}\n\nexport function usePatch() {\n  return true;\n}\n\nexport function getRequestTimeout({ config }: ModulesInject) {\n  return config.getTransactionTimeout();\n}\n\nexport function isAuthSupported() {\n  return true;\n}\n\nexport function getAuthToken(modules: ModulesInject, incomingParams: MembershipsInput): string {\n  let token =\n    modules.tokenManager.getToken('user', incomingParams.userId) ||\n    modules.tokenManager.getToken('user');\n\n  return token;\n}\n\nexport function prepareParams(\n  modules: ModulesInject,\n  incomingParams: MembershipsInput\n): Object {\n  const { include, limit, page } = incomingParams;\n  const params = {};\n\n  if (limit) {\n    params.limit = limit;\n  }\n\n  if (include) {\n    let includes = [];\n\n    if (include.totalCount) {\n      params.count = true;\n    }\n\n    if (include.customFields) {\n      includes.push('custom');\n    }\n\n    if (include.spaceFields) {\n      includes.push('space');\n    }\n\n    if (include.customSpaceFields) {\n      includes.push('space.custom');\n    }\n\n    let includesString = includes.join(',');\n\n    if (includesString.length > 0) {\n      params.include = includesString;\n    }\n  }\n\n  if (page) {\n    if (page.next) {\n      params.start = page.next;\n    }\n    if (page.prev) {\n      params.end = page.prev;\n    }\n  }\n\n  return params;\n}\n\nexport function patchPayload(\n  modules: ModulesInject,\n  incomingParams: MembershipsInput\n): Object {\n  return prepareMessagePayload(modules, incomingParams);\n}\n\nexport function handleResponse(\n  modules: ModulesInject,\n  membershipsResponse: Object\n): MembershipsListResponse {\n  return membershipsResponse;\n}\n"],"file":"join_spaces.js"}