// 3.4.3
(function(){
var l=!0,m=null,n=!1;function q(){return function(){}}function y(a){return function(){return a}}var D=1,E=n,G=[],H="-pnpres",I=10,aa=310,ba=60,L=1E3,ca=/{([\w\-]+)}/g;function da(){return"x"+ ++D+""+ +new Date}function Q(){return+new Date}var R,ea=Math.floor(20*Math.random());R=function(a,b){return 0<a.indexOf("pubsub.")&&a.replace("pubsub","ps"+(b?S().split("-")[0]:20>++ea?ea:ea=1))||a};function fa(a,b){function c(){f+b>Q()?(clearTimeout(d),d=setTimeout(c,b)):(f=Q(),a())}var d,f=0;return c}
function ga(a,b){var c=[];T(a||[],function(a){b(a)&&c.push(a)});return c}function ha(a,b){return a.replace(ca,function(a,d){return b[d]||a})}function U(a,b){return setTimeout(a,b)}function S(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}
function T(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var c=0,d=a.length;c<d;)b.call(a[c],a[c],c++);else for(c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function Y(a,b){var c=[];T(a||[],function(a,f){c.push(b(a,f))});return c}function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];T(a,function(a,d){d.f&&b.push(a)});return b.sort()}
function ia(){U(function(){E||(E=1,T(G,function(a){a()}))},L)}
function pa(a){function b(){}function c(a){a&&(t.g=0);!t.g&&t.length&&(t.g=1,p(t.shift()))}function d(a){T($(r),function(b){(b=r[b])&&a(b)})}var f=+a.windowing||I,j=(+a.timeout||aa)*L,A=(+a.keepalive||ba)*L,w=a.publish_key||"",g=a.subscribe_key||"",v=a.ssl?"s":"",s="http"+v+"://"+(a.origin||"pubsub.pubnub.com"),z=R(s),P=R(s),t=[],V=0,J=0,N=0,O=0,M=0,F=0,r={},p=a.xdr,K=a._is_online||y(1),u=a.jsonp_cb||y(0),B=a.db||{get:q(),set:q()},x=a.uuid||B&&B.get(g+"uuid")||"",e={_reset_offline:function(){N&&N(1)},
LEAVE:function(a,b){var d={uuid:x},c=R(s),h=u();0<a.indexOf(H)||("0"!=h&&(d.callback=h),p({l:b||v,timeout:2E3,a:h,data:d,url:[c,"v2","presence","sub_key",g,"channel",Z(a),"leave"]}))},history:function(a,b){var b=a.callback||b,d=a.count||a.limit||100,c=a.reverse||"false",h=a.error||q(),j=a.channel,e=a.start,f=a.end,i={},k=u();if(!j)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");i.stringtoken="true";i.count=d;i.reverse=c;k&&(i.callback=
k);e&&(i.start=e);f&&(i.end=f);p({a:k,data:i,c:function(a){b(a)},b:h,url:[z,"v2","history","sub-key",g,"channel",Z(j)]})},replay:function(a){var b=b||a.callback||q(),d=a.source,c=a.destination,h=a.stop,j=a.start,e=a.end,f=a.reverse,a=a.limit,i=u(),k={};if(!d)return error("Missing Source Channel");if(!c)return error("Missing Destination Channel");if(!w)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");"0"!=i&&(k.callback=i);h&&(k.stop="all");f&&(k.reverse="true");j&&(k.start=
j);e&&(k.end=e);a&&(k.count=a);p({a:i,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[z,"v1","replay",w,g,d,c],data:k})},time:function(a){var b=u();p({a:b,timeout:5*L,url:[z,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){var b=b||a.callback||q(),d=a.message,C=a.channel,h=u();if(!d)return error("Missing Message");if(!C)return error("Missing Channel");if(!w)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");d=JSON.stringify(d);
C=[z,"publish",w,g,0,Z(C),h,Z(d)];t.push({a:h,timeout:5*L,url:C,data:{uuid:x},c:function(a){b(a);c(1)},b:function(){b([0,"Failed",d]);c(1)}});c()},unsubscribe:function(a){a=a.channel;F=0;O=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+H}).join(",");T(a.split(","),function(a){E&&e.LEAVE(a,0);r[a]=0});E&&b()},subscribe:function(a,c){function W(a){a?U(C,L):(z=R(s,1),P=R(s,1),U(function(){e.time(W)},L));d(function(b){if(a&&b.d)return b.d=0,b.j(b.name);!a&&!b.d&&(b.d=1,b.i(b.name))})}
function C(){var a=u(),b=$(r).join(",");b&&(N=p({timeout:na,a:a,b:function(){e.time(W)},data:{uuid:x},url:[P,"subscribe",g,Z(b),a,F],c:function(a){if(!a)return U(C,t);d(function(a){a.e||(a.e=1,a.h(a.name))});(F=!F&&O&&B.get(g)||a[1])&&B.set(g,a[1]);var b,X=(2<a.length?a[2]:"").split(",");b=function(){var a=X.shift()||"";return[(r[a]||{}).a||V,(a||J).split(H)[0]]};T(a[0],function(X){var d=b();if(r[d[1]].f)d[0](X,a,d[1])});U(C,t)}}))}var h=a.channel,c=(c=c||a.callback)||a.message,ka=a.connect||q(),
la=a.reconnect||q(),Ma=a.disconnect||q(),i=a.presence||0,k=a.noheresync||0,na=a.timeout||j,t=a.windowing||f;a.restore&&(O=1);F=0;if(!h)return error("Missing Channel");if(!c)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");T((h.join?h.join(","):""+h).split(","),function(a){var b=r[a]||{};r[J=a]={name:a,e:b.e,d:b.d,f:1,a:V=c,h:ka,i:Ma,j:la};i&&(e.subscribe({channel:a+H,callback:i}),!b.f&&!k&&e.here_now({channel:a,callback:function(b){T("uuids"in b?b.uuids:[],function(X){i({action:"join",
uuid:X,timestamp:Q(),occupancy:b.occupancy||1},b,a)})}}))});b=function(){e._reset_offline();clearTimeout(M);M=U(C,100)};if(!E)return G.push(b);b()},here_now:function(a,b){var b=a.callback||b,d=a.error||q(),c=a.channel,h=u(),j=m;if(!c)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");"0"!=h&&(j={},j.callback=h);p({a:h,data:j,c:function(a){b(a)},b:d,url:[z,"v2","presence","sub_key",g,"channel",Z(c)]})},xdr:p,ready:ia,db:B,uuid:S,each:T,
map:Y,grep:ga,supplant:ha,now:Q,unique:da,updater:fa,poll_online:function(){K()||e._reset_offline();U(e.poll_online,L)},poll_online2:function(){e.time(function(a){a||e._reset_offline();U(e.poll_online2,A)})}};x||(x=e.uuid());B.set(g+"uuid",x);U(e.poll_online,L);U(e.poll_online2,A);return e}
function qa(a){function b(a){f||(f=1,clearTimeout(A),d&&(d.onerror=d.onload=m,d.abort&&d.abort(),d=m),a&&w())}function c(){if(!j){j=1;clearTimeout(A);try{response=JSON.parse(d.responseText)}catch(a){return b(1)}g(response)}}var d,f=0,j=0,A=U(function(){b(1)},ra),w=a.b||q(),g=a.c||q();try{d="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;d.onerror=d.onabort=function(){b(1)};d.onload=d.onloadend=c;d.timeout=ra;url=a.url.join(sa);if(a.data){var v=[];url+="?";for(key in a.data)v.push(key+
"="+a.data[key]);url+=v.join(ta)}d.open("GET",url,l);d.send()}catch(s){return b(0),qa(a)}return b}function ua(a,b,c){T(a.split(","),function(a){function f(a){a||(a=window.event);c(a)||(a.cancelBubble=l,a.returnValue=n,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,f,n):b.attachEvent?b.attachEvent("on"+a,f):b["on"+a]=f})}
function va(a){a.db=wa;a.xdr=qa;var b=pa(a);b.init=va;if(a.notest)return b;ua("beforeunload",window,function(){each_channel(function(a){b.LEAVE(a.name,1)});return l});ua("offline",window,b._reset_offline);ua("offline",document,b._reset_offline);b.ready();return b}var sa="/",ta="&",ra=31E4,wa,xa="undefined"!=typeof localStorage&&localStorage;
wa={get:function(a){try{return xa?xa.getItem(a):-1==document.cookie.indexOf(a)?m:((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||m}catch(b){}},set:function(a,b){try{if(xa)return xa.setItem(a,b)&&0;document.cookie=a+"="+b+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(c){}}};"undefined"!==typeof module&&(module.m=va)||"undefined"!==typeof exports&&(exports.k=va)||(PUBNUB=va);D=1;E=n;G=[];H="-pnpres";I=10;aa=310;ba=60;L=1E3;ca=/{([\w\-]+)}/g;
function da(){return"x"+ ++D+""+ +new Date}function Q(){return+new Date}var ya=Math.floor(20*Math.random());R=function(a,b){return 0<a.indexOf("pubsub.")&&a.replace("pubsub","ps"+(b?S().split("-")[0]:20>++ya?ya:ya=1))||a};function fa(a,b){function c(){f+b>Q()?(clearTimeout(d),d=setTimeout(c,b)):(f=Q(),a())}var d,f=0;return c}function ga(a,b){var c=[];T(a||[],function(a){b(a)&&c.push(a)});return c}function ha(a,b){return a.replace(ca,function(a,d){return b[d]||a})}
function U(a,b){return setTimeout(a,b)}function S(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}function T(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var c=0,d=a.length;c<d;)b.call(a[c],a[c],c++);else for(c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function Y(a,b){var c=[];T(a||[],function(a,f){c.push(b(a,f))});return c}
function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];T(a,function(a,d){d.f&&b.push(a)});return b.sort()}function ia(){U(function(){E||(E=1,T(G,function(a){a()}))},L)}
function pa(a){function b(){}function c(a){a&&(t.g=0);!t.g&&t.length&&(t.g=1,p(t.shift()))}function d(a){T($(r),function(b){(b=r[b])&&a(b)})}var f=+a.windowing||I,j=(+a.timeout||aa)*L,A=(+a.keepalive||ba)*L,w=a.publish_key||"",g=a.subscribe_key||"",v=a.ssl?"s":"",s="http"+v+"://"+(a.origin||"pubsub.pubnub.com"),z=R(s),P=R(s),t=[],V=0,J=0,N=0,O=0,M=0,F=0,r={},p=a.xdr,K=a._is_online||y(1),u=a.jsonp_cb||y(0),B=a.db||{get:q(),set:q()},x=a.uuid||B&&B.get(g+"uuid")||"",e={_reset_offline:function(){N&&N(1)},
LEAVE:function(a,b){var d={uuid:x},c=R(s),h=u();0<a.indexOf(H)||("0"!=h&&(d.callback=h),p({l:b||v,timeout:2E3,a:h,data:d,url:[c,"v2","presence","sub_key",g,"channel",Z(a),"leave"]}))},history:function(a,b){var b=a.callback||b,d=a.count||a.limit||100,c=a.reverse||"false",h=a.error||q(),j=a.channel,e=a.start,f=a.end,i={},k=u();if(!j)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");i.stringtoken="true";i.count=d;i.reverse=c;k&&(i.callback=
k);e&&(i.start=e);f&&(i.end=f);p({a:k,data:i,c:function(a){b(a)},b:h,url:[z,"v2","history","sub-key",g,"channel",Z(j)]})},replay:function(a){var b=b||a.callback||q(),d=a.source,c=a.destination,h=a.stop,j=a.start,e=a.end,f=a.reverse,a=a.limit,i=u(),k={};if(!d)return error("Missing Source Channel");if(!c)return error("Missing Destination Channel");if(!w)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");"0"!=i&&(k.callback=i);h&&(k.stop="all");f&&(k.reverse="true");j&&(k.start=
j);e&&(k.end=e);a&&(k.count=a);p({a:i,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[z,"v1","replay",w,g,d,c],data:k})},time:function(a){var b=u();p({a:b,timeout:5*L,url:[z,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){var b=b||a.callback||q(),d=a.message,C=a.channel,h=u();if(!d)return error("Missing Message");if(!C)return error("Missing Channel");if(!w)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");d=JSON.stringify(d);
C=[z,"publish",w,g,0,Z(C),h,Z(d)];t.push({a:h,timeout:5*L,url:C,data:{uuid:x},c:function(a){b(a);c(1)},b:function(){b([0,"Failed",d]);c(1)}});c()},unsubscribe:function(a){a=a.channel;F=0;O=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+H}).join(",");T(a.split(","),function(a){E&&e.LEAVE(a,0);r[a]=0});E&&b()},subscribe:function(a,c){function W(a){a?U(C,L):(z=R(s,1),P=R(s,1),U(function(){e.time(W)},L));d(function(b){if(a&&b.d)return b.d=0,b.j(b.name);!a&&!b.d&&(b.d=1,b.i(b.name))})}
function C(){var a=u(),b=$(r).join(",");b&&(N=p({timeout:na,a:a,b:function(){e.time(W)},data:{uuid:x},url:[P,"subscribe",g,Z(b),a,F],c:function(a){if(!a)return U(C,t);d(function(a){a.e||(a.e=1,a.h(a.name))});(F=!F&&O&&B.get(g)||a[1])&&B.set(g,a[1]);var b,X=(2<a.length?a[2]:"").split(",");b=function(){var a=X.shift()||"";return[(r[a]||{}).a||V,(a||J).split(H)[0]]};T(a[0],function(X){var d=b();if(r[d[1]].f)d[0](X,a,d[1])});U(C,t)}}))}var h=a.channel,c=(c=c||a.callback)||a.message,ka=a.connect||q(),
la=a.reconnect||q(),Ma=a.disconnect||q(),i=a.presence||0,k=a.noheresync||0,na=a.timeout||j,t=a.windowing||f;a.restore&&(O=1);F=0;if(!h)return error("Missing Channel");if(!c)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");T((h.join?h.join(","):""+h).split(","),function(a){var b=r[a]||{};r[J=a]={name:a,e:b.e,d:b.d,f:1,a:V=c,h:ka,i:Ma,j:la};i&&(e.subscribe({channel:a+H,callback:i}),!b.f&&!k&&e.here_now({channel:a,callback:function(b){T("uuids"in b?b.uuids:[],function(X){i({action:"join",
uuid:X,timestamp:Q(),occupancy:b.occupancy||1},b,a)})}}))});b=function(){e._reset_offline();clearTimeout(M);M=U(C,100)};if(!E)return G.push(b);b()},here_now:function(a,b){var b=a.callback||b,d=a.error||q(),c=a.channel,h=u(),j=m;if(!c)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");"0"!=h&&(j={},j.callback=h);p({a:h,data:j,c:function(a){b(a)},b:d,url:[z,"v2","presence","sub_key",g,"channel",Z(c)]})},xdr:p,ready:ia,db:B,uuid:S,each:T,
map:Y,grep:ga,supplant:ha,now:Q,unique:da,updater:fa,poll_online:function(){K()||e._reset_offline();U(e.poll_online,L)},poll_online2:function(){e.time(function(a){a||e._reset_offline();U(e.poll_online2,A)})}};x||(x=e.uuid());B.set(g+"uuid",x);U(e.poll_online,L);U(e.poll_online2,A);return e}
function za(a){function b(a){f||(f=1,clearTimeout(A),d&&(d.onerror=d.onload=m,d.abort&&d.abort(),d=m),a&&w())}function c(){if(!j){j=1;clearTimeout(A);try{response=JSON.parse(d.responseText)}catch(a){return b(1)}g(response)}}var d,f=0,j=0,A=U(function(){b(1)},Aa),w=a.b||q(),g=a.c||q();try{d="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;d.onerror=d.onabort=function(){b(1)};d.onload=d.onloadend=c;d.timeout=Aa;url=a.url.join(Ba);if(a.data){var v=[];url+="?";for(key in a.data)v.push(key+
"="+a.data[key]);url+=v.join(Ca)}d.open("GET",url,l);d.send()}catch(s){return b(0),za(a)}return b}function Da(a,b,c){T(a.split(","),function(a){function f(a){a||(a=window.event);c(a)||(a.cancelBubble=l,a.returnValue=n,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,f,n):b.attachEvent?b.attachEvent("on"+a,f):b["on"+a]=f})}
function Ea(a){a.db=Fa;a.xdr=za;var b=pa(a);b.init=Ea;if(a.notest)return b;Da("beforeunload",window,function(){each_channel(function(a){b.LEAVE(a.name,1)});return l});Da("offline",window,b._reset_offline);Da("offline",document,b._reset_offline);b.ready();return b}var Ba="/",Ca="&",Aa=31E4,Fa,Ga="undefined"!=typeof localStorage&&localStorage;
Fa={get:function(a){try{return Ga?Ga.getItem(a):-1==document.cookie.indexOf(a)?m:((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||m}catch(b){}},set:function(a,b){try{if(Ga)return Ga.setItem(a,b)&&0;document.cookie=a+"="+b+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(c){}}};"undefined"!==typeof module&&(module.m=Ea)||"undefined"!==typeof exports&&(exports.k=Ea)||(PUBNUB=Ea);D=1;E=n;G=[];H="-pnpres";I=10;aa=310;ba=60;L=1E3;ca=/{([\w\-]+)}/g;
function da(){return"x"+ ++D+""+ +new Date}function Q(){return+new Date}var Ha=Math.floor(20*Math.random());R=function(a,b){return 0<a.indexOf("pubsub.")&&a.replace("pubsub","ps"+(b?S().split("-")[0]:20>++Ha?Ha:Ha=1))||a};function fa(a,b){function c(){f+b>Q()?(clearTimeout(d),d=setTimeout(c,b)):(f=Q(),a())}var d,f=0;return c}function ga(a,b){var c=[];T(a||[],function(a){b(a)&&c.push(a)});return c}function ha(a,b){return a.replace(ca,function(a,d){return b[d]||a})}
function U(a,b){return setTimeout(a,b)}function S(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}function T(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var c=0,d=a.length;c<d;)b.call(a[c],a[c],c++);else for(c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function Y(a,b){var c=[];T(a||[],function(a,f){c.push(b(a,f))});return c}
function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];T(a,function(a,d){d.f&&b.push(a)});return b.sort()}function ia(){U(function(){E||(E=1,T(G,function(a){a()}))},L)}
function pa(a){function b(){}function c(a){a&&(t.g=0);!t.g&&t.length&&(t.g=1,p(t.shift()))}function d(a){T($(r),function(b){(b=r[b])&&a(b)})}var f=+a.windowing||I,j=(+a.timeout||aa)*L,A=(+a.keepalive||ba)*L,w=a.publish_key||"",g=a.subscribe_key||"",v=a.ssl?"s":"",s="http"+v+"://"+(a.origin||"pubsub.pubnub.com"),z=R(s),P=R(s),t=[],V=0,J=0,N=0,O=0,M=0,F=0,r={},p=a.xdr,K=a._is_online||y(1),u=a.jsonp_cb||y(0),B=a.db||{get:q(),set:q()},x=a.uuid||B&&B.get(g+"uuid")||"",e={_reset_offline:function(){N&&N(1)},
LEAVE:function(a,b){var d={uuid:x},c=R(s),h=u();0<a.indexOf(H)||("0"!=h&&(d.callback=h),p({l:b||v,timeout:2E3,a:h,data:d,url:[c,"v2","presence","sub_key",g,"channel",Z(a),"leave"]}))},history:function(a,b){var b=a.callback||b,d=a.count||a.limit||100,c=a.reverse||"false",h=a.error||q(),e=a.channel,j=a.start,f=a.end,i={},k=u();if(!e)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");i.stringtoken="true";i.count=d;i.reverse=c;k&&(i.callback=
k);j&&(i.start=j);f&&(i.end=f);p({a:k,data:i,c:function(a){b(a)},b:h,url:[z,"v2","history","sub-key",g,"channel",Z(e)]})},replay:function(a){var b=b||a.callback||q(),d=a.source,c=a.destination,h=a.stop,e=a.start,j=a.end,f=a.reverse,a=a.limit,i=u(),k={};if(!d)return error("Missing Source Channel");if(!c)return error("Missing Destination Channel");if(!w)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");"0"!=i&&(k.callback=i);h&&(k.stop="all");f&&(k.reverse="true");e&&(k.start=
e);j&&(k.end=j);a&&(k.count=a);p({a:i,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[z,"v1","replay",w,g,d,c],data:k})},time:function(a){var b=u();p({a:b,timeout:5*L,url:[z,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){var b=b||a.callback||q(),d=a.message,C=a.channel,h=u();if(!d)return error("Missing Message");if(!C)return error("Missing Channel");if(!w)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");d=JSON.stringify(d);
C=[z,"publish",w,g,0,Z(C),h,Z(d)];t.push({a:h,timeout:5*L,url:C,data:{uuid:x},c:function(a){b(a);c(1)},b:function(){b([0,"Failed",d]);c(1)}});c()},unsubscribe:function(a){a=a.channel;F=0;O=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+H}).join(",");T(a.split(","),function(a){E&&e.LEAVE(a,0);r[a]=0});E&&b()},subscribe:function(a,c){function W(a){a?U(C,L):(z=R(s,1),P=R(s,1),U(function(){e.time(W)},L));d(function(b){if(a&&b.d)return b.d=0,b.j(b.name);!a&&!b.d&&(b.d=1,b.i(b.name))})}
function C(){var a=u(),b=$(r).join(",");b&&(N=p({timeout:na,a:a,b:function(){e.time(W)},data:{uuid:x},url:[P,"subscribe",g,Z(b),a,F],c:function(a){if(!a)return U(C,w);d(function(a){a.e||(a.e=1,a.h(a.name))});(F=!F&&O&&B.get(g)||a[1])&&B.set(g,a[1]);var b,c=(2<a.length?a[2]:"").split(",");b=function(){var a=c.shift()||"";return[(r[a]||{}).a||V,(a||J).split(H)[0]]};T(a[0],function(d){var c=b();if(r[c[1]].f)c[0](d,a,c[1])});U(C,w)}}))}var h=a.channel,c=(c=c||a.callback)||a.message,ka=a.connect||q(),
la=a.reconnect||q(),t=a.disconnect||q(),i=a.presence||0,k=a.noheresync||0,na=a.timeout||j,w=a.windowing||f;a.restore&&(O=1);F=0;if(!h)return error("Missing Channel");if(!c)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");T((h.join?h.join(","):""+h).split(","),function(a){var b=r[a]||{};r[J=a]={name:a,e:b.e,d:b.d,f:1,a:V=c,h:ka,i:t,j:la};i&&(e.subscribe({channel:a+H,callback:i}),!b.f&&!k&&e.here_now({channel:a,callback:function(b){T("uuids"in b?b.uuids:[],function(d){i({action:"join",
uuid:d,timestamp:Q(),occupancy:b.occupancy||1},b,a)})}}))});b=function(){e._reset_offline();clearTimeout(M);M=U(C,100)};if(!E)return G.push(b);b()},here_now:function(a,b){var b=a.callback||b,d=a.error||q(),c=a.channel,h=u(),e=m;if(!c)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");"0"!=h&&(e={},e.callback=h);p({a:h,data:e,c:function(a){b(a)},b:d,url:[z,"v2","presence","sub_key",g,"channel",Z(c)]})},xdr:p,ready:ia,db:B,uuid:S,each:T,
map:Y,grep:ga,supplant:ha,now:Q,unique:da,updater:fa,poll_online:function(){K()||e._reset_offline();U(e.poll_online,L)},poll_online2:function(){e.time(function(a){a||e._reset_offline();U(e.poll_online2,A)})}};x||(x=e.uuid());B.set(g+"uuid",x);U(e.poll_online,L);U(e.poll_online2,A);return e}
function Ia(a){function b(a){f||(f=1,clearTimeout(A),d&&(d.onerror=d.onload=m,d.abort&&d.abort(),d=m),a&&w())}function c(){if(!j){j=1;clearTimeout(A);try{response=JSON.parse(d.responseText)}catch(a){return b(1)}g(response)}}var d,f=0,j=0,A=U(function(){b(1)},Ja),w=a.b||q(),g=a.c||q();try{d="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;d.onerror=d.onabort=function(){b(1)};d.onload=d.onloadend=c;d.timeout=Ja;url=a.url.join(Ka);if(a.data){var v=[];url+="?";for(key in a.data)v.push(key+
"="+a.data[key]);url+=v.join(La)}d.open("GET",url,l);d.send()}catch(s){return b(0),Ia(a)}return b}function Oa(a,b,c){T(a.split(","),function(a){function f(a){a||(a=window.event);c(a)||(a.cancelBubble=l,a.returnValue=n,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,f,n):b.attachEvent?b.attachEvent("on"+a,f):b["on"+a]=f})}
function Pa(a){a.db=Qa;a.xdr=Ia;var b=pa(a);b.init=Pa;if(a.notest)return b;Oa("beforeunload",window,function(){each_channel(function(a){b.LEAVE(a.name,1)});return l});Oa("offline",window,b._reset_offline);Oa("offline",document,b._reset_offline);b.ready();return b}var Ka="/",La="&",Ja=31E4,Qa,Ra="undefined"!=typeof localStorage&&localStorage;
Qa={get:function(a){try{return Ra?Ra.getItem(a):-1==document.cookie.indexOf(a)?m:((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||m}catch(b){}},set:function(a,b){try{if(Ra)return Ra.setItem(a,b)&&0;document.cookie=a+"="+b+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(c){}}};"undefined"!==typeof module&&(module.m=Pa)||"undefined"!==typeof exports&&(exports.k=Pa)||(PUBNUB=Pa);D=1;E=n;G=[];H="-pnpres";I=10;aa=310;ba=60;L=1E3;ca=/{([\w\-]+)}/g;
function da(){return"x"+ ++D+""+ +new Date}function Q(){return+new Date}var Sa=Math.floor(20*Math.random());R=function(a,b){return 0<a.indexOf("pubsub.")&&a.replace("pubsub","ps"+(b?S().split("-")[0]:20>++Sa?Sa:Sa=1))||a};function fa(a,b){function c(){f+b>Q()?(clearTimeout(d),d=setTimeout(c,b)):(f=Q(),a())}var d,f=0;return c}function ga(a,b){var c=[];T(a||[],function(a){b(a)&&c.push(a)});return c}function ha(a,b){return a.replace(ca,function(a,d){return b[d]||a})}
function U(a,b){return setTimeout(a,b)}function S(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}function T(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var c=0,d=a.length;c<d;)b.call(a[c],a[c],c++);else for(c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function Y(a,b){var c=[];T(a||[],function(a,f){c.push(b(a,f))});return c}
function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];T(a,function(a,d){d.f&&b.push(a)});return b.sort()}function ia(){U(function(){E||(E=1,T(G,function(a){a()}))},L)}
function pa(a){function b(){}function c(a){a&&(t.g=0);!t.g&&t.length&&(t.g=1,p(t.shift()))}function d(a){T($(r),function(b){(b=r[b])&&a(b)})}var f=+a.windowing||I,j=(+a.timeout||aa)*L,A=(+a.keepalive||ba)*L,w=a.publish_key||"",g=a.subscribe_key||"",v=a.ssl?"s":"",s="http"+v+"://"+(a.origin||"pubsub.pubnub.com"),z=R(s),P=R(s),t=[],V=0,J=0,N=0,O=0,M=0,F=0,r={},p=a.xdr,K=a._is_online||y(1),u=a.jsonp_cb||y(0),B=a.db||{get:q(),set:q()},x=a.uuid||B&&B.get(g+"uuid")||"",e={_reset_offline:function(){N&&N(1)},
LEAVE:function(a,b){var d={uuid:x},c=R(s),h=u();0<a.indexOf(H)||("0"!=h&&(d.callback=h),p({l:b||v,timeout:2E3,a:h,data:d,url:[c,"v2","presence","sub_key",g,"channel",Z(a),"leave"]}))},history:function(a,b){var b=a.callback||b,d=a.count||a.limit||100,c=a.reverse||"false",h=a.error||q(),e=a.channel,f=a.start,j=a.end,i={},k=u();if(!e)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");i.stringtoken="true";i.count=d;i.reverse=c;k&&(i.callback=
k);f&&(i.start=f);j&&(i.end=j);p({a:k,data:i,c:function(a){b(a)},b:h,url:[z,"v2","history","sub-key",g,"channel",Z(e)]})},replay:function(a){var b=b||a.callback||q(),d=a.source,c=a.destination,h=a.stop,e=a.start,f=a.end,j=a.reverse,a=a.limit,i=u(),k={};if(!d)return error("Missing Source Channel");if(!c)return error("Missing Destination Channel");if(!w)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");"0"!=i&&(k.callback=i);h&&(k.stop="all");j&&(k.reverse="true");e&&(k.start=
e);f&&(k.end=f);a&&(k.count=a);p({a:i,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[z,"v1","replay",w,g,d,c],data:k})},time:function(a){var b=u();p({a:b,timeout:5*L,url:[z,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){var b=b||a.callback||q(),d=a.message,C=a.channel,h=u();if(!d)return error("Missing Message");if(!C)return error("Missing Channel");if(!w)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");d=JSON.stringify(d);
C=[z,"publish",w,g,0,Z(C),h,Z(d)];t.push({a:h,timeout:5*L,url:C,data:{uuid:x},c:function(a){b(a);c(1)},b:function(){b([0,"Failed",d]);c(1)}});c()},unsubscribe:function(a){a=a.channel;F=0;O=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+H}).join(",");T(a.split(","),function(a){E&&e.LEAVE(a,0);r[a]=0});E&&b()},subscribe:function(a,c){function W(a){a?U(C,L):(z=R(s,1),P=R(s,1),U(function(){e.time(W)},L));d(function(b){if(a&&b.d)return b.d=0,b.j(b.name);!a&&!b.d&&(b.d=1,b.i(b.name))})}
function C(){var a=u(),b=$(r).join(",");b&&(N=p({timeout:w,a:a,b:function(){e.time(W)},data:{uuid:x},url:[P,"subscribe",g,Z(b),a,F],c:function(a){if(!a)return U(C,v);d(function(a){a.e||(a.e=1,a.h(a.name))});(F=!F&&O&&B.get(g)||a[1])&&B.set(g,a[1]);var b,c=(2<a.length?a[2]:"").split(",");b=function(){var a=c.shift()||"";return[(r[a]||{}).a||V,(a||J).split(H)[0]]};T(a[0],function(d){var c=b();if(r[c[1]].f)c[0](d,a,c[1])});U(C,v)}}))}var h=a.channel,c=(c=c||a.callback)||a.message,ka=a.connect||q(),la=
a.reconnect||q(),t=a.disconnect||q(),i=a.presence||0,k=a.noheresync||0,w=a.timeout||j,v=a.windowing||f;a.restore&&(O=1);F=0;if(!h)return error("Missing Channel");if(!c)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");T((h.join?h.join(","):""+h).split(","),function(a){var b=r[a]||{};r[J=a]={name:a,e:b.e,d:b.d,f:1,a:V=c,h:ka,i:t,j:la};i&&(e.subscribe({channel:a+H,callback:i}),!b.f&&!k&&e.here_now({channel:a,callback:function(b){T("uuids"in b?b.uuids:[],function(d){i({action:"join",
uuid:d,timestamp:Q(),occupancy:b.occupancy||1},b,a)})}}))});b=function(){e._reset_offline();clearTimeout(M);M=U(C,100)};if(!E)return G.push(b);b()},here_now:function(a,b){var b=a.callback||b,d=a.error||q(),c=a.channel,h=u(),e=m;if(!c)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");"0"!=h&&(e={},e.callback=h);p({a:h,data:e,c:function(a){b(a)},b:d,url:[z,"v2","presence","sub_key",g,"channel",Z(c)]})},xdr:p,ready:ia,db:B,uuid:S,each:T,
map:Y,grep:ga,supplant:ha,now:Q,unique:da,updater:fa,poll_online:function(){K()||e._reset_offline();U(e.poll_online,L)},poll_online2:function(){e.time(function(a){a||e._reset_offline();U(e.poll_online2,A)})}};x||(x=e.uuid());B.set(g+"uuid",x);U(e.poll_online,L);U(e.poll_online2,A);return e}
function Ta(a){function b(a){f||(f=1,clearTimeout(A),d&&(d.onerror=d.onload=m,d.abort&&d.abort(),d=m),a&&w())}function c(){if(!j){j=1;clearTimeout(A);try{response=JSON.parse(d.responseText)}catch(a){return b(1)}g(response)}}var d,f=0,j=0,A=U(function(){b(1)},Ua),w=a.b||q(),g=a.c||q();try{d="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;d.onerror=d.onabort=function(){b(1)};d.onload=d.onloadend=c;d.timeout=Ua;url=a.url.join(Va);if(a.data){var v=[];url+="?";for(key in a.data)v.push(key+
"="+a.data[key]);url+=v.join(Wa)}d.open("GET",url,l);d.send()}catch(s){return b(0),Ta(a)}return b}function Xa(a,b,c){T(a.split(","),function(a){function f(a){a||(a=window.event);c(a)||(a.cancelBubble=l,a.returnValue=n,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,f,n):b.attachEvent?b.attachEvent("on"+a,f):b["on"+a]=f})}
function Ya(a){a.db=Za;a.xdr=Ta;var b=pa(a);b.init=Ya;if(a.notest)return b;Xa("beforeunload",window,function(){each_channel(function(a){b.LEAVE(a.name,1)});return l});Xa("offline",window,b._reset_offline);Xa("offline",document,b._reset_offline);b.ready();return b}var Va="/",Wa="&",Ua=31E4,Za,$a="undefined"!=typeof localStorage&&localStorage;
Za={get:function(a){try{return $a?$a.getItem(a):-1==document.cookie.indexOf(a)?m:((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||m}catch(b){}},set:function(a,b){try{if($a)return $a.setItem(a,b)&&0;document.cookie=a+"="+b+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(c){}}};"undefined"!==typeof module&&(module.m=Ya)||"undefined"!==typeof exports&&(exports.k=Ya)||(PUBNUB=Ya);D=1;E=n;G=[];H="-pnpres";I=10;aa=310;ba=60;L=1E3;ca=/{([\w\-]+)}/g;
function da(){return"x"+ ++D+""+ +new Date}function Q(){return+new Date}var ab=Math.floor(20*Math.random());R=function(a,b){return 0<a.indexOf("pubsub.")&&a.replace("pubsub","ps"+(b?S().split("-")[0]:20>++ab?ab:ab=1))||a};function fa(a,b){function c(){f+b>Q()?(clearTimeout(d),d=setTimeout(c,b)):(f=Q(),a())}var d,f=0;return c}function ga(a,b){var c=[];T(a||[],function(a){b(a)&&c.push(a)});return c}function ha(a,b){return a.replace(ca,function(a,d){return b[d]||a})}
function U(a,b){return setTimeout(a,b)}function S(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}function T(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var c=0,d=a.length;c<d;)b.call(a[c],a[c],c++);else for(c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function Y(a,b){var c=[];T(a||[],function(a,f){c.push(b(a,f))});return c}
function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];T(a,function(a,d){d.f&&b.push(a)});return b.sort()}function ia(){U(function(){E||(E=1,T(G,function(a){a()}))},L)}
function pa(a){function b(){}function c(a){a&&(t.g=0);!t.g&&t.length&&(t.g=1,p(t.shift()))}function d(a){T($(r),function(b){(b=r[b])&&a(b)})}var f=+a.windowing||I,j=(+a.timeout||aa)*L,A=(+a.keepalive||ba)*L,w=a.publish_key||"",g=a.subscribe_key||"",v=a.ssl?"s":"",s="http"+v+"://"+(a.origin||"pubsub.pubnub.com"),z=R(s),P=R(s),t=[],V=0,J=0,N=0,O=0,M=0,F=0,r={},p=a.xdr,K=a._is_online||y(1),u=a.jsonp_cb||y(0),B=a.db||{get:q(),set:q()},x=a.uuid||B&&B.get(g+"uuid")||"",e={_reset_offline:function(){N&&N(1)},
LEAVE:function(a,b){var d={uuid:x},c=R(s),h=u();0<a.indexOf(H)||("0"!=h&&(d.callback=h),p({l:b||v,timeout:2E3,a:h,data:d,url:[c,"v2","presence","sub_key",g,"channel",Z(a),"leave"]}))},history:function(a,b){var b=a.callback||b,d=a.count||a.limit||100,c=a.reverse||"false",h=a.error||q(),e=a.channel,f=a.start,j=a.end,i={},k=u();if(!e)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");i.stringtoken="true";i.count=d;i.reverse=c;k&&(i.callback=
k);f&&(i.start=f);j&&(i.end=j);p({a:k,data:i,c:function(a){b(a)},b:h,url:[z,"v2","history","sub-key",g,"channel",Z(e)]})},replay:function(a){var b=b||a.callback||q(),d=a.source,c=a.destination,h=a.stop,e=a.start,f=a.end,j=a.reverse,a=a.limit,i=u(),k={};if(!d)return error("Missing Source Channel");if(!c)return error("Missing Destination Channel");if(!w)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");"0"!=i&&(k.callback=i);h&&(k.stop="all");j&&(k.reverse="true");e&&(k.start=
e);f&&(k.end=f);a&&(k.count=a);p({a:i,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[z,"v1","replay",w,g,d,c],data:k})},time:function(a){var b=u();p({a:b,timeout:5*L,url:[z,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){var b=b||a.callback||q(),d=a.message,C=a.channel,h=u();if(!d)return error("Missing Message");if(!C)return error("Missing Channel");if(!w)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");d=JSON.stringify(d);
C=[z,"publish",w,g,0,Z(C),h,Z(d)];t.push({a:h,timeout:5*L,url:C,data:{uuid:x},c:function(a){b(a);c(1)},b:function(){b([0,"Failed",d]);c(1)}});c()},unsubscribe:function(a){a=a.channel;F=0;O=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+H}).join(",");T(a.split(","),function(a){E&&e.LEAVE(a,0);r[a]=0});E&&b()},subscribe:function(a,c){function W(a){a?U(C,L):(z=R(s,1),P=R(s,1),U(function(){e.time(W)},L));d(function(b){if(a&&b.d)return b.d=0,b.j(b.name);!a&&!b.d&&(b.d=1,b.i(b.name))})}
function C(){var a=u(),b=$(r).join(",");b&&(N=p({timeout:w,a:a,b:function(){e.time(W)},data:{uuid:x},url:[P,"subscribe",g,Z(b),a,F],c:function(a){if(!a)return U(C,v);d(function(a){a.e||(a.e=1,a.h(a.name))});(F=!F&&O&&B.get(g)||a[1])&&B.set(g,a[1]);var b,c=(2<a.length?a[2]:"").split(",");b=function(){var a=c.shift()||"";return[(r[a]||{}).a||V,(a||J).split(H)[0]]};T(a[0],function(d){var c=b();if(r[c[1]].f)c[0](d,a,c[1])});U(C,v)}}))}var h=a.channel,c=(c=c||a.callback)||a.message,ka=a.connect||q(),la=
a.reconnect||q(),t=a.disconnect||q(),i=a.presence||0,k=a.noheresync||0,w=a.timeout||j,v=a.windowing||f;a.restore&&(O=1);F=0;if(!h)return error("Missing Channel");if(!c)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");T((h.join?h.join(","):""+h).split(","),function(a){var b=r[a]||{};r[J=a]={name:a,e:b.e,d:b.d,f:1,a:V=c,h:ka,i:t,j:la};i&&(e.subscribe({channel:a+H,callback:i}),!b.f&&!k&&e.here_now({channel:a,callback:function(b){T("uuids"in b?b.uuids:[],function(d){i({action:"join",
uuid:d,timestamp:Q(),occupancy:b.occupancy||1},b,a)})}}))});b=function(){e._reset_offline();clearTimeout(M);M=U(C,100)};if(!E)return G.push(b);b()},here_now:function(a,b){var b=a.callback||b,d=a.error||q(),c=a.channel,h=u(),e=m;if(!c)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");"0"!=h&&(e={},e.callback=h);p({a:h,data:e,c:function(a){b(a)},b:d,url:[z,"v2","presence","sub_key",g,"channel",Z(c)]})},xdr:p,ready:ia,db:B,uuid:S,each:T,
map:Y,grep:ga,supplant:ha,now:Q,unique:da,updater:fa,poll_online:function(){K()||e._reset_offline();U(e.poll_online,L)},poll_online2:function(){e.time(function(a){a||e._reset_offline();U(e.poll_online2,A)})}};x||(x=e.uuid());B.set(g+"uuid",x);U(e.poll_online,L);U(e.poll_online2,A);return e}
function bb(a){function b(a){f||(f=1,clearTimeout(A),d&&(d.onerror=d.onload=m,d.abort&&d.abort(),d=m),a&&w())}function c(){if(!j){j=1;clearTimeout(A);try{response=JSON.parse(d.responseText)}catch(a){return b(1)}g(response)}}var d,f=0,j=0,A=U(function(){b(1)},cb),w=a.b||q(),g=a.c||q();try{d="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;d.onerror=d.onabort=function(){b(1)};d.onload=d.onloadend=c;d.timeout=cb;url=a.url.join(db);if(a.data){var v=[];url+="?";for(key in a.data)v.push(key+
"="+a.data[key]);url+=v.join(eb)}d.open("GET",url,l);d.send()}catch(s){return b(0),bb(a)}return b}function fb(a,b,c){T(a.split(","),function(a){function f(a){a||(a=window.event);c(a)||(a.cancelBubble=l,a.returnValue=n,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,f,n):b.attachEvent?b.attachEvent("on"+a,f):b["on"+a]=f})}
function gb(a){a.db=hb;a.xdr=bb;var b=pa(a);b.init=gb;if(a.notest)return b;fb("beforeunload",window,function(){each_channel(function(a){b.LEAVE(a.name,1)});return l});fb("offline",window,b._reset_offline);fb("offline",document,b._reset_offline);b.ready();return b}var db="/",eb="&",cb=31E4,hb,ib="undefined"!=typeof localStorage&&localStorage;
hb={get:function(a){try{return ib?ib.getItem(a):-1==document.cookie.indexOf(a)?m:((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||m}catch(b){}},set:function(a,b){try{if(ib)return ib.setItem(a,b)&&0;document.cookie=a+"="+b+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(c){}}};"undefined"!==typeof module&&(module.m=gb)||"undefined"!==typeof exports&&(exports.k=gb)||(PUBNUB=gb);D=1;E=n;G=[];H="-pnpres";I=10;aa=310;ba=60;L=1E3;ca=/{([\w\-]+)}/g;
function da(){return"x"+ ++D+""+ +new Date}function Q(){return+new Date}var jb=Math.floor(20*Math.random());R=function(a,b){return 0<a.indexOf("pubsub.")&&a.replace("pubsub","ps"+(b?S().split("-")[0]:20>++jb?jb:jb=1))||a};function fa(a,b){function c(){f+b>Q()?(clearTimeout(d),d=setTimeout(c,b)):(f=Q(),a())}var d,f=0;return c}function ga(a,b){var c=[];T(a||[],function(a){b(a)&&c.push(a)});return c}function ha(a,b){return a.replace(ca,function(a,d){return b[d]||a})}
function U(a,b){return setTimeout(a,b)}function S(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}function T(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var c=0,d=a.length;c<d;)b.call(a[c],a[c],c++);else for(c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function Y(a,b){var c=[];T(a||[],function(a,f){c.push(b(a,f))});return c}
function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];T(a,function(a,d){d.f&&b.push(a)});return b.sort()}function ia(){U(function(){E||(E=1,T(G,function(a){a()}))},L)}
function pa(a){function b(){}function c(a){a&&(t.g=0);!t.g&&t.length&&(t.g=1,p(t.shift()))}function d(a){T($(r),function(b){(b=r[b])&&a(b)})}var f=+a.windowing||I,j=(+a.timeout||aa)*L,A=(+a.keepalive||ba)*L,w=a.publish_key||"",g=a.subscribe_key||"",v=a.ssl?"s":"",s="http"+v+"://"+(a.origin||"pubsub.pubnub.com"),z=R(s),P=R(s),t=[],V=0,J=0,N=0,O=0,M=0,F=0,r={},p=a.xdr,K=a._is_online||y(1),u=a.jsonp_cb||y(0),B=a.db||{get:q(),set:q()},x=a.uuid||B&&B.get(g+"uuid")||"",e={_reset_offline:function(){N&&N(1)},
LEAVE:function(a,b){var d={uuid:x},c=R(s),h=u();0<a.indexOf(H)||("0"!=h&&(d.callback=h),p({l:b||v,timeout:2E3,a:h,data:d,url:[c,"v2","presence","sub_key",g,"channel",Z(a),"leave"]}))},history:function(a,b){var b=a.callback||b,d=a.count||a.limit||100,c=a.reverse||"false",h=a.error||q(),e=a.channel,f=a.start,j=a.end,i={},k=u();if(!e)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");i.stringtoken="true";i.count=d;i.reverse=c;k&&(i.callback=
k);f&&(i.start=f);j&&(i.end=j);p({a:k,data:i,c:function(a){b(a)},b:h,url:[z,"v2","history","sub-key",g,"channel",Z(e)]})},replay:function(a){var b=b||a.callback||q(),d=a.source,c=a.destination,h=a.stop,e=a.start,f=a.end,j=a.reverse,a=a.limit,i=u(),k={};if(!d)return error("Missing Source Channel");if(!c)return error("Missing Destination Channel");if(!w)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");"0"!=i&&(k.callback=i);h&&(k.stop="all");j&&(k.reverse="true");e&&(k.start=
e);f&&(k.end=f);a&&(k.count=a);p({a:i,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[z,"v1","replay",w,g,d,c],data:k})},time:function(a){var b=u();p({a:b,timeout:5*L,url:[z,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){var b=b||a.callback||q(),d=a.message,e=a.channel,h=u();if(!d)return error("Missing Message");if(!e)return error("Missing Channel");if(!w)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");d=JSON.stringify(d);
e=[z,"publish",w,g,0,Z(e),h,Z(d)];t.push({a:h,timeout:5*L,url:e,data:{uuid:x},c:function(a){b(a);c(1)},b:function(){b([0,"Failed",d]);c(1)}});c()},unsubscribe:function(a){a=a.channel;F=0;O=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+H}).join(",");T(a.split(","),function(a){E&&e.LEAVE(a,0);r[a]=0});E&&b()},subscribe:function(a,c){function W(a){a?U(C,L):(z=R(s,1),P=R(s,1),U(function(){e.time(W)},L));d(function(b){if(a&&b.d)return b.d=0,b.j(b.name);!a&&!b.d&&(b.d=1,b.i(b.name))})}
function C(){var a=u(),b=$(r).join(",");b&&(N=p({timeout:A,a:a,b:function(){e.time(W)},data:{uuid:x},url:[P,"subscribe",g,Z(b),a,F],c:function(a){if(!a)return U(C,K);d(function(a){a.e||(a.e=1,a.h(a.name))});F=!F&&O&&B.get(g)||a[1];v&&(Timetoken=1E4,v=0);B.set(g,a[1]);var b,c=(2<a.length?a[2]:"").split(",");b=function(){var a=c.shift()||"";return[(r[a]||{}).a||V,(a||J).split(H)[0]]};T(a[0],function(d){var c=b();if(r[c[1]].f)c[0](d,a,c[1])});U(C,K)}}))}var h=a.channel,c=(c=c||a.callback)||a.message,
ka=a.connect||q(),t=a.reconnect||q(),w=a.disconnect||q(),i=a.presence||0,k=a.noheresync||0,v=a.backfill||0,A=a.timeout||j,K=a.windowing||f;a.restore&&(O=1);F=0;if(!h)return error("Missing Channel");if(!c)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");T((h.join?h.join(","):""+h).split(","),function(a){var b=r[a]||{};r[J=a]={name:a,e:b.e,d:b.d,f:1,a:V=c,h:ka,i:w,j:t};i&&(e.subscribe({channel:a+H,callback:i}),!b.f&&!k&&e.here_now({channel:a,callback:function(b){T("uuids"in
b?b.uuids:[],function(d){i({action:"join",uuid:d,timestamp:Q(),occupancy:b.occupancy||1},b,a)})}}))});b=function(){e._reset_offline();clearTimeout(M);M=U(C,100)};if(!E)return G.push(b);b()},here_now:function(a,b){var b=a.callback||b,d=a.error||q(),c=a.channel,h=u(),e=m;if(!c)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");"0"!=h&&(e={},e.callback=h);p({a:h,data:e,c:function(a){b(a)},b:d,url:[z,"v2","presence","sub_key",g,"channel",
Z(c)]})},xdr:p,ready:ia,db:B,uuid:S,each:T,map:Y,grep:ga,supplant:ha,now:Q,unique:da,updater:fa,poll_online:function(){K()||e._reset_offline();U(e.poll_online,L)},poll_online2:function(){e.time(function(a){a||e._reset_offline();U(e.poll_online2,A)})}};x||(x=e.uuid());B.set(g+"uuid",x);U(e.poll_online,L);U(e.poll_online2,A);return e}
function kb(a){function b(a){f||(f=1,clearTimeout(A),d&&(d.onerror=d.onload=m,d.abort&&d.abort(),d=m),a&&w())}function c(){if(!j){j=1;clearTimeout(A);try{response=JSON.parse(d.responseText)}catch(a){return b(1)}g(response)}}var d,f=0,j=0,A=U(function(){b(1)},lb),w=a.b||q(),g=a.c||q();try{d="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;d.onerror=d.onabort=function(){b(1)};d.onload=d.onloadend=c;d.timeout=lb;url=a.url.join(mb);if(a.data){var v=[];url+="?";for(key in a.data)v.push(key+
"="+a.data[key]);url+=v.join(nb)}d.open("GET",url,l);d.send()}catch(s){return b(0),kb(a)}return b}function ob(a,b,c){T(a.split(","),function(a){function f(a){a||(a=window.event);c(a)||(a.cancelBubble=l,a.returnValue=n,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,f,n):b.attachEvent?b.attachEvent("on"+a,f):b["on"+a]=f})}
function pb(a){a.db=qb;a.xdr=kb;var b=pa(a);b.init=pb;if(a.notest)return b;ob("beforeunload",window,function(){each_channel(function(a){b.LEAVE(a.name,1)});return l});ob("offline",window,b._reset_offline);ob("offline",document,b._reset_offline);b.ready();return b}var mb="/",nb="&",lb=31E4,qb,rb="undefined"!=typeof localStorage&&localStorage;
qb={get:function(a){try{return rb?rb.getItem(a):-1==document.cookie.indexOf(a)?m:((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||m}catch(b){}},set:function(a,b){try{if(rb)return rb.setItem(a,b)&&0;document.cookie=a+"="+b+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(c){}}};"undefined"!==typeof module&&(module.m=pb)||"undefined"!==typeof exports&&(exports.k=pb)||(PUBNUB=pb);D=1;E=n;G=[];H="-pnpres";I=10;aa=310;ba=60;L=1E3;ca=/{([\w\-]+)}/g;
function da(){return"x"+ ++D+""+ +new Date}function Q(){return+new Date}var sb=Math.floor(20*Math.random());R=function(a,b){return 0<a.indexOf("pubsub.")&&a.replace("pubsub","ps"+(b?S().split("-")[0]:20>++sb?sb:sb=1))||a};function fa(a,b){function c(){f+b>Q()?(clearTimeout(d),d=setTimeout(c,b)):(f=Q(),a())}var d,f=0;return c}function ga(a,b){var c=[];T(a||[],function(a){b(a)&&c.push(a)});return c}function ha(a,b){return a.replace(ca,function(a,d){return b[d]||a})}
function U(a,b){return setTimeout(a,b)}function S(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}function T(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var c=0,d=a.length;c<d;)b.call(a[c],a[c],c++);else for(c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function Y(a,b){var c=[];T(a||[],function(a,f){c.push(b(a,f))});return c}
function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];T(a,function(a,d){d.f&&b.push(a)});return b.sort()}function ia(){U(function(){E||(E=1,T(G,function(a){a()}))},L)}
function pa(a){function b(){}function c(a){a&&(t.g=0);!t.g&&t.length&&(t.g=1,p(t.shift()))}function d(a){T($(r),function(b){(b=r[b])&&a(b)})}var f=+a.windowing||I,j=(+a.timeout||aa)*L,A=(+a.keepalive||ba)*L,w=a.publish_key||"",g=a.subscribe_key||"",v=a.ssl?"s":"",s="http"+v+"://"+(a.origin||"pubsub.pubnub.com"),z=R(s),P=R(s),t=[],V=0,J=0,N=0,O=0,M=0,F=0,r={},p=a.xdr,K=a._is_online||y(1),u=a.jsonp_cb||y(0),B=a.db||{get:q(),set:q()},x=a.uuid||B&&B.get(g+"uuid")||"",e={_reset_offline:function(){N&&N(1)},
LEAVE:function(a,b){var d={uuid:x},c=R(s),h=u();0<a.indexOf(H)||("0"!=h&&(d.callback=h),p({l:b||v,timeout:2E3,a:h,data:d,url:[c,"v2","presence","sub_key",g,"channel",Z(a),"leave"]}))},history:function(a,b){var b=a.callback||b,d=a.count||a.limit||100,c=a.reverse||"false",h=a.error||q(),e=a.channel,f=a.start,j=a.end,i={},k=u();if(!e)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");i.stringtoken="true";i.count=d;i.reverse=c;k&&(i.callback=
k);f&&(i.start=f);j&&(i.end=j);p({a:k,data:i,c:function(a){b(a)},b:h,url:[z,"v2","history","sub-key",g,"channel",Z(e)]})},replay:function(a){var b=b||a.callback||q(),d=a.source,c=a.destination,h=a.stop,e=a.start,f=a.end,j=a.reverse,a=a.limit,i=u(),k={};if(!d)return error("Missing Source Channel");if(!c)return error("Missing Destination Channel");if(!w)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");"0"!=i&&(k.callback=i);h&&(k.stop="all");j&&(k.reverse="true");e&&(k.start=
e);f&&(k.end=f);a&&(k.count=a);p({a:i,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[z,"v1","replay",w,g,d,c],data:k})},time:function(a){var b=u();p({a:b,timeout:5*L,url:[z,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){var b=b||a.callback||q(),d=a.message,e=a.channel,h=u();if(!d)return error("Missing Message");if(!e)return error("Missing Channel");if(!w)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");d=JSON.stringify(d);
e=[z,"publish",w,g,0,Z(e),h,Z(d)];t.push({a:h,timeout:5*L,url:e,data:{uuid:x},c:function(a){b(a);c(1)},b:function(){b([0,"Failed",d]);c(1)}});c()},unsubscribe:function(a){a=a.channel;F=0;O=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+H}).join(",");T(a.split(","),function(a){E&&e.LEAVE(a,0);r[a]=0});E&&b()},subscribe:function(a,c){function W(a){a?U(C,L):(z=R(s,1),P=R(s,1),U(function(){e.time(W)},L));d(function(b){if(a&&b.d)return b.d=0,b.j(b.name);!a&&!b.d&&(b.d=1,b.i(b.name))})}
function C(){var a=u(),b=$(r).join(",");b&&(N=p({timeout:K,a:a,b:function(){e.time(W)},data:{uuid:x},url:[P,"subscribe",g,Z(b),a,F],c:function(a){if(!a)return U(C,ma);d(function(a){a.e||(a.e=1,a.h(a.name))});F=!F&&O&&B.get(g)||a[1];A&&(Timetoken=1E4,A=0);B.set(g,a[1]);var b,c=(2<a.length?a[2]:"").split(",");b=function(){var a=c.shift()||"";return[(r[a]||{}).a||V,(a||J).split(H)[0]]};T(a[0],function(d){var c=b();if(r[c[1]].f)c[0](d,a,c[1])});U(C,ma)}}))}var h=a.channel,c=(c=c||a.callback)||a.message,
t=a.connect||q(),w=a.reconnect||q(),v=a.disconnect||q(),i=a.presence||0,k=a.noheresync||0,A=a.backfill||0,K=a.timeout||j,ma=a.windowing||f;a.restore&&(O=1);F=0;if(!h)return error("Missing Channel");if(!c)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");T((h.join?h.join(","):""+h).split(","),function(a){var b=r[a]||{};r[J=a]={name:a,e:b.e,d:b.d,f:1,a:V=c,h:t,i:v,j:w};i&&(e.subscribe({channel:a+H,callback:i}),!b.f&&!k&&e.here_now({channel:a,callback:function(b){T("uuids"in
b?b.uuids:[],function(d){i({action:"join",uuid:d,timestamp:Q(),occupancy:b.occupancy||1},b,a)})}}))});b=function(){e._reset_offline();clearTimeout(M);M=U(C,100)};if(!E)return G.push(b);b()},here_now:function(a,b){var b=a.callback||b,d=a.error||q(),c=a.channel,e=u(),f=m;if(!c)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");"0"!=e&&(f={},f.callback=e);p({a:e,data:f,c:function(a){b(a)},b:d,url:[z,"v2","presence","sub_key",g,"channel",
Z(c)]})},xdr:p,ready:ia,db:B,uuid:S,each:T,map:Y,grep:ga,supplant:ha,now:Q,unique:da,updater:fa,poll_online:function(){K()||e._reset_offline();U(e.poll_online,L)},poll_online2:function(){e.time(function(a){a||e._reset_offline();U(e.poll_online2,A)})}};x||(x=e.uuid());B.set(g+"uuid",x);U(e.poll_online,L);U(e.poll_online2,A);return e}
function tb(a){function b(a){f||(f=1,clearTimeout(A),d&&(d.onerror=d.onload=m,d.abort&&d.abort(),d=m),a&&w())}function c(){if(!j){j=1;clearTimeout(A);try{response=JSON.parse(d.responseText)}catch(a){return b(1)}g(response)}}var d,f=0,j=0,A=U(function(){b(1)},ub),w=a.b||q(),g=a.c||q();try{d="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;d.onerror=d.onabort=function(){b(1)};d.onload=d.onloadend=c;d.timeout=ub;url=a.url.join(vb);if(a.data){var v=[];url+="?";for(key in a.data)v.push(key+
"="+a.data[key]);url+=v.join(wb)}d.open("GET",url,l);d.send()}catch(s){return b(0),tb(a)}return b}function xb(a,b,c){T(a.split(","),function(a){function f(a){a||(a=window.event);c(a)||(a.cancelBubble=l,a.returnValue=n,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,f,n):b.attachEvent?b.attachEvent("on"+a,f):b["on"+a]=f})}
function yb(a){a.db=zb;a.xdr=tb;var b=pa(a);b.init=yb;if(a.notest)return b;xb("beforeunload",window,function(){each_channel(function(a){b.LEAVE(a.name,1)});return l});xb("offline",window,b._reset_offline);xb("offline",document,b._reset_offline);b.ready();return b}var vb="/",wb="&",ub=31E4,zb,Ab="undefined"!=typeof localStorage&&localStorage;
zb={get:function(a){try{return Ab?Ab.getItem(a):-1==document.cookie.indexOf(a)?m:((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||m}catch(b){}},set:function(a,b){try{if(Ab)return Ab.setItem(a,b)&&0;document.cookie=a+"="+b+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(c){}}};"undefined"!==typeof module&&(module.m=yb)||"undefined"!==typeof exports&&(exports.k=yb)||(PUBNUB=yb);D=1;E=n;G=[];H="-pnpres";I=10;aa=310;ba=60;L=1E3;ca=/{([\w\-]+)}/g;
function da(){return"x"+ ++D+""+ +new Date}function Q(){return+new Date}var Bb=Math.floor(20*Math.random());R=function(a,b){return 0<a.indexOf("pubsub.")&&a.replace("pubsub","ps"+(b?S().split("-")[0]:20>++Bb?Bb:Bb=1))||a};function fa(a,b){function c(){f+b>Q()?(clearTimeout(d),d=setTimeout(c,b)):(f=Q(),a())}var d,f=0;return c}function ga(a,b){var c=[];T(a||[],function(a){b(a)&&c.push(a)});return c}function ha(a,b){return a.replace(ca,function(a,d){return b[d]||a})}
function U(a,b){return setTimeout(a,b)}function S(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}function T(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var c=0,d=a.length;c<d;)b.call(a[c],a[c],c++);else for(c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function Y(a,b){var c=[];T(a||[],function(a,f){c.push(b(a,f))});return c}
function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];T(a,function(a,d){d.f&&b.push(a)});return b.sort()}function ia(){U(function(){E||(E=1,T(G,function(a){a()}))},L)}
function pa(a){function b(){}function c(a){a&&(t.g=0);!t.g&&t.length&&(t.g=1,p(t.shift()))}function d(a){T($(r),function(b){(b=r[b])&&a(b)})}var f=+a.windowing||I,j=(+a.timeout||aa)*L,A=(+a.keepalive||ba)*L,w=a.publish_key||"",g=a.subscribe_key||"",v=a.ssl?"s":"",s="http"+v+"://"+(a.origin||"pubsub.pubnub.com"),z=R(s),P=R(s),t=[],V=0,J=0,N=0,O=0,M=0,F=0,r={},p=a.xdr,K=a._is_online||y(1),u=a.jsonp_cb||y(0),B=a.db||{get:q(),set:q()},x=a.uuid||B&&B.get(g+"uuid")||"",e={_reset_offline:function(){N&&N(1)},
LEAVE:function(a,b){var d={uuid:x},c=R(s),e=u();0<a.indexOf(H)||("0"!=e&&(d.callback=e),p({l:b||v,timeout:2E3,a:e,data:d,url:[c,"v2","presence","sub_key",g,"channel",Z(a),"leave"]}))},history:function(a,b){var b=a.callback||b,d=a.count||a.limit||100,c=a.reverse||"false",e=a.error||q(),f=a.channel,j=a.start,s=a.end,i={},k=u();if(!f)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");i.stringtoken="true";i.count=d;i.reverse=c;k&&(i.callback=
k);j&&(i.start=j);s&&(i.end=s);p({a:k,data:i,c:function(a){b(a)},b:e,url:[z,"v2","history","sub-key",g,"channel",Z(f)]})},replay:function(a){var b=b||a.callback||q(),d=a.source,c=a.destination,e=a.stop,f=a.start,j=a.end,s=a.reverse,a=a.limit,i=u(),k={};if(!d)return error("Missing Source Channel");if(!c)return error("Missing Destination Channel");if(!w)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");"0"!=i&&(k.callback=i);e&&(k.stop="all");s&&(k.reverse="true");f&&(k.start=
f);j&&(k.end=j);a&&(k.count=a);p({a:i,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[z,"v1","replay",w,g,d,c],data:k})},time:function(a){var b=u();p({a:b,timeout:5*L,url:[z,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){var b=b||a.callback||q(),d=a.message,e=a.channel,h=u();if(!d)return error("Missing Message");if(!e)return error("Missing Channel");if(!w)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");d=JSON.stringify(d);
e=[z,"publish",w,g,0,Z(e),h,Z(d)];t.push({a:h,timeout:5*L,url:e,data:{uuid:x},c:function(a){b(a);c(1)},b:function(){b([0,"Failed",d]);c(1)}});c()},unsubscribe:function(a){a=a.channel;F=0;O=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+H}).join(",");T(a.split(","),function(a){E&&e.LEAVE(a,0);r[a]=0});E&&b()},subscribe:function(a,c){function W(a){a?U(C,L):(z=R(s,1),P=R(s,1),U(function(){e.time(W)},L));d(function(b){if(a&&b.d)return b.d=0,b.j(b.name);!a&&!b.d&&(b.d=1,b.i(b.name))})}
function C(){var a=u(),b=$(r).join(",");b&&(N=p({timeout:K,a:a,b:function(){e.time(W)},data:{uuid:x},url:[P,"subscribe",g,Z(b),a,F],c:function(a){if(!a)return U(C,ma);d(function(a){a.e||(a.e=1,a.h(a.name))});F=!F&&O&&B.get(g)||a[1];A&&(Timetoken=1E4,A=0);B.set(g,a[1]);var b,c=(2<a.length?a[2]:"").split(",");b=function(){var a=c.shift()||"";return[(r[a]||{}).a||V,(a||J).split(H)[0]]};T(a[0],function(d){var c=b();if(r[c[1]].f)c[0](d,a,c[1])});U(C,ma)}}))}var h=a.channel,c=(c=c||a.callback)||a.message,
t=a.connect||q(),w=a.reconnect||q(),v=a.disconnect||q(),i=a.presence||0,k=a.noheresync||0,A=a.backfill||0,K=a.timeout||j,ma=a.windowing||f;a.restore&&(O=1);F=0;if(!h)return error("Missing Channel");if(!c)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");T((h.join?h.join(","):""+h).split(","),function(a){var b=r[a]||{};r[J=a]={name:a,e:b.e,d:b.d,f:1,a:V=c,h:t,i:v,j:w};i&&(e.subscribe({channel:a+H,callback:i}),!b.f&&!k&&e.here_now({channel:a,callback:function(b){T("uuids"in
b?b.uuids:[],function(d){i({action:"join",uuid:d,timestamp:Q(),occupancy:b.occupancy||1},b,a)})}}))});b=function(){e._reset_offline();clearTimeout(M);M=U(C,100)};if(!E)return G.push(b);b()},here_now:function(a,b){var b=a.callback||b,d=a.error||q(),c=a.channel,e=u(),f=m;if(!c)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");"0"!=e&&(f={},f.callback=e);p({a:e,data:f,c:function(a){b(a)},b:d,url:[z,"v2","presence","sub_key",g,"channel",
Z(c)]})},xdr:p,ready:ia,db:B,uuid:S,each:T,map:Y,grep:ga,supplant:ha,now:Q,unique:da,updater:fa,poll_online:function(){K()||e._reset_offline();U(e.poll_online,L)},poll_online2:function(){e.time(function(a){a||e._reset_offline();U(e.poll_online2,A)})}};x||(x=e.uuid());B.set(g+"uuid",x);U(e.poll_online,L);U(e.poll_online2,A);return e}
function Cb(a){function b(a){f||(f=1,clearTimeout(A),d&&(d.onerror=d.onload=m,d.abort&&d.abort(),d=m),a&&w())}function c(){if(!j){j=1;clearTimeout(A);try{response=JSON.parse(d.responseText)}catch(a){return b(1)}g(response)}}var d,f=0,j=0,A=U(function(){b(1)},Db),w=a.b||q(),g=a.c||q();try{d="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;d.onerror=d.onabort=function(){b(1)};d.onload=d.onloadend=c;d.timeout=Db;url=a.url.join(Eb);if(a.data){var v=[];url+="?";for(key in a.data)v.push(key+
"="+a.data[key]);url+=v.join(Fb)}d.open("GET",url,l);d.send()}catch(s){return b(0),Cb(a)}return b}function Gb(a,b,c){T(a.split(","),function(a){function f(a){a||(a=window.event);c(a)||(a.cancelBubble=l,a.returnValue=n,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,f,n):b.attachEvent?b.attachEvent("on"+a,f):b["on"+a]=f})}
function Hb(a){a.db=Ib;a.xdr=Cb;var b=pa(a);b.init=Hb;if(a.notest)return b;Gb("beforeunload",window,function(){each_channel(function(a){b.LEAVE(a.name,1)});return l});Gb("offline",window,b._reset_offline);Gb("offline",document,b._reset_offline);b.ready();return b}var Eb="/",Fb="&",Db=31E4,Ib,Jb="undefined"!=typeof localStorage&&localStorage;
Ib={get:function(a){try{return Jb?Jb.getItem(a):-1==document.cookie.indexOf(a)?m:((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||m}catch(b){}},set:function(a,b){try{if(Jb)return Jb.setItem(a,b)&&0;document.cookie=a+"="+b+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(c){}}};"undefined"!==typeof module&&(module.m=Hb)||"undefined"!==typeof exports&&(exports.k=Hb)||(PUBNUB=Hb);D=1;E=n;G=[];H="-pnpres";I=10;aa=310;ba=60;L=1E3;ca=/{([\w\-]+)}/g;
function da(){return"x"+ ++D+""+ +new Date}function Q(){return+new Date}var Kb=Math.floor(20*Math.random());R=function(a,b){return 0<a.indexOf("pubsub.")&&a.replace("pubsub","ps"+(b?S().split("-")[0]:20>++Kb?Kb:Kb=1))||a};function fa(a,b){function c(){f+b>Q()?(clearTimeout(d),d=setTimeout(c,b)):(f=Q(),a())}var d,f=0;return c}function ga(a,b){var c=[];T(a||[],function(a){b(a)&&c.push(a)});return c}function ha(a,b){return a.replace(ca,function(a,d){return b[d]||a})}
function U(a,b){return setTimeout(a,b)}function S(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}function T(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var c=0,d=a.length;c<d;)b.call(a[c],a[c],c++);else for(c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function Y(a,b){var c=[];T(a||[],function(a,f){c.push(b(a,f))});return c}
function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];T(a,function(a,d){d.f&&b.push(a)});return b.sort()}function ia(){U(function(){E||(E=1,T(G,function(a){a()}))},L)}
function pa(a){function b(){}function c(a){a&&(t.g=0);!t.g&&t.length&&(t.g=1,p(t.shift()))}function d(a){T($(r),function(b){(b=r[b])&&a(b)})}var f=+a.windowing||I,j=(+a.timeout||aa)*L,A=(+a.keepalive||ba)*L,w=a.publish_key||"",g=a.subscribe_key||"",v=a.ssl?"s":"",s="http"+v+"://"+(a.origin||"pubsub.pubnub.com"),z=R(s),P=R(s),t=[],V=0,J=0,N=0,O=0,M=0,F=0,r={},p=a.xdr,K=a._is_online||y(1),u=a.jsonp_cb||y(0),B=a.db||{get:q(),set:q()},x=a.uuid||B&&B.get(g+"uuid")||"",e={_reset_offline:function(){N&&N(1)},
LEAVE:function(a,b){var d={uuid:x},c=R(s),e=u();0<a.indexOf(H)||("0"!=e&&(d.callback=e),p({l:b||v,timeout:2E3,a:e,data:d,url:[c,"v2","presence","sub_key",g,"channel",Z(a),"leave"]}))},history:function(a,b){var b=a.callback||b,d=a.count||a.limit||100,c=a.reverse||"false",e=a.error||q(),f=a.channel,j=a.start,s=a.end,i={},k=u();if(!f)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");i.stringtoken="true";i.count=d;i.reverse=c;k&&(i.callback=
k);j&&(i.start=j);s&&(i.end=s);p({a:k,data:i,c:function(a){b(a)},b:e,url:[z,"v2","history","sub-key",g,"channel",Z(f)]})},replay:function(a){var b=b||a.callback||q(),d=a.source,c=a.destination,e=a.stop,f=a.start,j=a.end,s=a.reverse,a=a.limit,i=u(),k={};if(!d)return error("Missing Source Channel");if(!c)return error("Missing Destination Channel");if(!w)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");"0"!=i&&(k.callback=i);e&&(k.stop="all");s&&(k.reverse="true");f&&(k.start=
f);j&&(k.end=j);a&&(k.count=a);p({a:i,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[z,"v1","replay",w,g,d,c],data:k})},time:function(a){var b=u();p({a:b,timeout:5*L,url:[z,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){var b=b||a.callback||q(),d=a.message,e=a.channel,f=u();if(!d)return error("Missing Message");if(!e)return error("Missing Channel");if(!w)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");d=JSON.stringify(d);
e=[z,"publish",w,g,0,Z(e),f,Z(d)];t.push({a:f,timeout:5*L,url:e,data:{uuid:x},c:function(a){b(a);c(1)},b:function(){b([0,"Failed",d]);c(1)}});c()},unsubscribe:function(a){a=a.channel;F=0;O=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+H}).join(",");T(a.split(","),function(a){E&&e.LEAVE(a,0);r[a]=0});E&&b()},subscribe:function(a,c){function W(a){a?U(C,L):(z=R(s,1),P=R(s,1),U(function(){e.time(W)},L));d(function(b){if(a&&b.d)return b.d=0,b.j(b.name);!a&&!b.d&&(b.d=1,b.i(b.name))})}
function C(){var a=u(),b=$(r).join(",");b&&(N=p({timeout:K,a:a,b:function(){e.time(W)},data:{uuid:x},url:[P,"subscribe",g,Z(b),a,F],c:function(a){if(!a)return U(C,ma);d(function(a){a.e||(a.e=1,a.h(a.name))});F=!F&&O&&B.get(g)||a[1];A&&(Timetoken=1E4,A=0);B.set(g,a[1]);var b,c=(2<a.length?a[2]:"").split(",");b=function(){var a=c.shift()||"";return[(r[a]||{}).a||V,(a||J).split(H)[0]]};T(a[0],function(d){var c=b();if(r[c[1]].f)c[0](d,a,c[1])});U(C,ma)}}))}var h=a.channel,c=(c=c||a.callback)||a.message,
t=a.connect||q(),w=a.reconnect||q(),v=a.disconnect||q(),i=a.presence||0,k=a.noheresync||0,A=a.backfill||0,K=a.timeout||j,ma=a.windowing||f;a.restore&&(O=1);F=0;if(!h)return error("Missing Channel");if(!c)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");T((h.join?h.join(","):""+h).split(","),function(a){var b=r[a]||{};r[J=a]={name:a,e:b.e,d:b.d,f:1,a:V=c,h:t,i:v,j:w};i&&(e.subscribe({channel:a+H,callback:i}),!b.f&&!k&&e.here_now({channel:a,callback:function(b){T("uuids"in
b?b.uuids:[],function(d){i({action:"join",uuid:d,timestamp:Q(),occupancy:b.occupancy||1},b,a)})}}))});b=function(){e._reset_offline();clearTimeout(M);M=U(C,100)};if(!E)return G.push(b);b()},here_now:function(a,b){var b=a.callback||b,d=a.error||q(),c=a.channel,e=u(),f=m;if(!c)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");"0"!=e&&(f={},f.callback=e);p({a:e,data:f,c:function(a){b(a)},b:d,url:[z,"v2","presence","sub_key",g,"channel",
Z(c)]})},xdr:p,ready:ia,db:B,uuid:S,each:T,map:Y,grep:ga,supplant:ha,now:Q,unique:da,updater:fa,poll_online:function(){K()||e._reset_offline();U(e.poll_online,L)},poll_online2:function(){e.time(function(a){a||e._reset_offline();U(e.poll_online2,A)})}};x||(x=e.uuid());B.set(g+"uuid",x);U(e.poll_online,L);U(e.poll_online2,A);return e}
function Lb(a){function b(a){f||(f=1,clearTimeout(A),d&&(d.onerror=d.onload=m,d.abort&&d.abort(),d=m),a&&w())}function c(){if(!j){j=1;clearTimeout(A);try{response=JSON.parse(d.responseText)}catch(a){return b(1)}g(response)}}var d,f=0,j=0,A=U(function(){b(1)},Mb),w=a.b||q(),g=a.c||q();try{d="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;d.onerror=d.onabort=function(){b(1)};d.onload=d.onloadend=c;d.timeout=Mb;url=a.url.join(Nb);if(a.data){var v=[];url+="?";for(key in a.data)v.push(key+
"="+a.data[key]);url+=v.join(Ob)}d.open("GET",url,l);d.send()}catch(s){return b(0),Lb(a)}return b}function Pb(a,b,c){T(a.split(","),function(a){function f(a){a||(a=window.event);c(a)||(a.cancelBubble=l,a.returnValue=n,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,f,n):b.attachEvent?b.attachEvent("on"+a,f):b["on"+a]=f})}
function Qb(a){a.db=Rb;a.xdr=Lb;var b=pa(a);b.init=Qb;if(a.notest)return b;Pb("beforeunload",window,function(){each_channel(function(a){b.LEAVE(a.name,1)});return l});Pb("offline",window,b._reset_offline);Pb("offline",document,b._reset_offline);b.ready();return b}var Nb="/",Ob="&",Mb=31E4,Rb,Sb="undefined"!=typeof localStorage&&localStorage;
Rb={get:function(a){try{return Sb?Sb.getItem(a):-1==document.cookie.indexOf(a)?m:((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||m}catch(b){}},set:function(a,b){try{if(Sb)return Sb.setItem(a,b)&&0;document.cookie=a+"="+b+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(c){}}};"undefined"!==typeof module&&(module.m=Qb)||"undefined"!==typeof exports&&(exports.k=Qb)||(PUBNUB=Qb);D=1;E=n;G=[];H="-pnpres";I=10;aa=310;ba=60;L=1E3;ca=/{([\w\-]+)}/g;
function da(){return"x"+ ++D+""+ +new Date}function Q(){return+new Date}var Tb=Math.floor(20*Math.random());R=function(a,b){return 0<a.indexOf("pubsub.")&&a.replace("pubsub","ps"+(b?S().split("-")[0]:20>++Tb?Tb:Tb=1))||a};function fa(a,b){function c(){f+b>Q()?(clearTimeout(d),d=setTimeout(c,b)):(f=Q(),a())}var d,f=0;return c}function ga(a,b){var c=[];T(a||[],function(a){b(a)&&c.push(a)});return c}function ha(a,b){return a.replace(ca,function(a,d){return b[d]||a})}
function U(a,b){return setTimeout(a,b)}function S(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}function T(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var c=0,d=a.length;c<d;)b.call(a[c],a[c],c++);else for(c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function Y(a,b){var c=[];T(a||[],function(a,f){c.push(b(a,f))});return c}
function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];T(a,function(a,d){d.f&&b.push(a)});return b.sort()}function ia(){U(function(){E||(E=1,T(G,function(a){a()}))},L)}
function pa(a){function b(){}function c(a){a&&(J.g=0);!J.g&&J.length&&(J.g=1,u(J.shift()))}function d(a){T($(K),function(b){(b=K[b])&&a(b)})}function f(){B()||M&&M(1);U(f,L)}function j(){ja.time(function(a){a||M&&M(1);U(j,g)})}var A=+a.windowing||I,w=(+a.timeout||aa)*L,g=(+a.keepalive||ba)*L,v=a.publish_key||"",s=a.subscribe_key||"",z=a.ssl?"s":"",P="http"+z+"://"+(a.origin||"pubsub.pubnub.com"),t=R(P),V=R(P),J=[],N=0,O=0,M=0,F=0,r=0,p=0,K={},u=a.xdr,B=a._is_online||y(1),x=a.jsonp_cb||y(0),e=a.db||
{get:q(),set:q()},X=a.uuid||e&&e.get(s+"uuid")||"",ja={LEAVE:function(a,b){var c={uuid:X},d=R(P),e=x();0<a.indexOf(H)||("0"!=e&&(c.callback=e),u({l:b||z,timeout:2E3,a:e,data:c,url:[d,"v2","presence","sub_key",s,"channel",Z(a),"leave"]}))},history:function(a,b){var b=a.callback||b,c=a.count||a.limit||100,d=a.reverse||"false",e=a.error||q(),f=a.channel,g=a.start,k=a.end,j={},p=x();if(!f)return error("Missing Channel");if(!b)return error("Missing Callback");if(!s)return error("Missing Subscribe Key");
j.stringtoken="true";j.count=c;j.reverse=d;p&&(j.callback=p);g&&(j.start=g);k&&(j.end=k);u({a:p,data:j,c:function(a){b(a)},b:e,url:[t,"v2","history","sub-key",s,"channel",Z(f)]})},replay:function(a){var b=b||a.callback||q(),c=a.source,d=a.destination,e=a.stop,f=a.start,g=a.end,j=a.reverse,a=a.limit,p=x(),r={};if(!c)return error("Missing Source Channel");if(!d)return error("Missing Destination Channel");if(!v)return error("Missing Publish Key");if(!s)return error("Missing Subscribe Key");"0"!=p&&(r.callback=
p);e&&(r.stop="all");j&&(r.reverse="true");f&&(r.start=f);g&&(r.end=g);a&&(r.count=a);u({a:p,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[t,"v1","replay",v,s,c,d],data:r})},time:function(a){var b=x();u({a:b,timeout:5*L,url:[t,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){var b=b||a.callback||q(),d=a.message,e=a.channel,f=x();if(!d)return error("Missing Message");if(!e)return error("Missing Channel");if(!v)return error("Missing Publish Key");if(!s)return error("Missing Subscribe Key");
d=JSON.stringify(d);e=[t,"publish",v,s,0,Z(e),f,Z(d)];J.push({a:f,timeout:5*L,url:e,data:{uuid:X},c:function(a){b(a);c(1)},b:function(){b([0,"Failed",d]);c(1)}});c()},unsubscribe:function(a){a=a.channel;p=0;F=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+H}).join(",");T(a.split(","),function(a){E&&ja.LEAVE(a,0);K[a]=0});E&&b()},subscribe:function(a,c){function f(a){a?U(g,L):(t=R(P,1),V=R(P,1),U(function(){ja.time(f)},L));d(function(b){if(a&&b.d)return b.d=0,b.j(b.name);!a&&
!b.d&&(b.d=1,b.i(b.name))})}function g(){var a=x(),b=$(K).join(",");b&&(M=u({timeout:Na,a:a,b:function(){ja.time(f)},data:{uuid:X},url:[V,"subscribe",s,Z(b),a,p],c:function(a){if(!a)return U(g,oa);d(function(a){a.e||(a.e=1,a.h(a.name))});p=!p&&F&&e.get(s)||a[1];J&&(Timetoken=1E4,J=0);e.set(s,a[1]);var b,c=(2<a.length?a[2]:"").split(",");b=function(){var a=c.shift()||"";return[(K[a]||{}).a||N,(a||O).split(H)[0]]};T(a[0],function(c){var d=b();if(K[d[1]].f)d[0](c,a,d[1])});U(g,oa)}}))}var j=a.channel,
c=(c=c||a.callback)||a.message,v=a.connect||q(),i=a.reconnect||q(),k=a.disconnect||q(),z=a.presence||0,B=a.noheresync||0,J=a.backfill||0,Na=a.timeout||w,oa=a.windowing||A;a.restore&&(F=1);p=0;if(!j)return error("Missing Channel");if(!c)return error("Missing Callback");if(!s)return error("Missing Subscribe Key");T((j.join?j.join(","):""+j).split(","),function(a){var b=K[a]||{};K[O=a]={name:a,e:b.e,d:b.d,f:1,a:N=c,h:v,i:k,j:i};z&&(ja.subscribe({channel:a+H,callback:z}),!b.f&&!B&&ja.here_now({channel:a,
callback:function(b){T("uuids"in b?b.uuids:[],function(c){z({action:"join",uuid:c,timestamp:Q(),occupancy:b.occupancy||1},b,a)})}}))});b=function(){M&&M(1);clearTimeout(r);r=U(g,100)};if(!E)return G.push(b);b()},here_now:function(a,b){var b=a.callback||b,c=a.error||q(),d=a.channel,e=x(),f=m;if(!d)return error("Missing Channel");if(!b)return error("Missing Callback");if(!s)return error("Missing Subscribe Key");"0"!=e&&(f={},f.callback=e);u({a:e,data:f,c:function(a){b(a)},b:c,url:[t,"v2","presence",
"sub_key",s,"channel",Z(d)]})},xdr:u,ready:ia,db:e,uuid:S,each:T,map:Y,grep:ga,supplant:ha,now:Q,unique:da,updater:fa};X||(X=ja.uuid());e.set(s+"uuid",X);U(f,L);U(j,g);return ja}
function Ub(a){function b(a){f||(f=1,clearTimeout(A),d&&(d.onerror=d.onload=m,d.abort&&d.abort(),d=m),a&&w())}function c(){if(!j){j=1;clearTimeout(A);try{response=JSON.parse(d.responseText)}catch(a){return b(1)}g(response)}}var d,f=0,j=0,A=U(function(){b(1)},Vb),w=a.b||q(),g=a.c||q();try{d="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;d.onerror=d.onabort=function(){b(1)};d.onload=d.onloadend=c;d.timeout=Vb;url=a.url.join(Wb);if(a.data){var v=[];url+="?";for(key in a.data)v.push(key+
"="+a.data[key]);url+=v.join(Xb)}d.open("GET",url,l);d.send()}catch(s){return b(0),Ub(a)}return b}function Yb(a,b,c){T(a.split(","),function(a){function f(a){a||(a=window.event);c(a)||(a.cancelBubble=l,a.returnValue=n,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,f,n):b.attachEvent?b.attachEvent("on"+a,f):b["on"+a]=f})}
function Zb(a){a.db=$b;a.xdr=Ub;var b=pa(a);b.init=Zb;if(a.notest)return b;Yb("beforeunload",window,function(){each_channel(function(a){b.LEAVE(a.name,1)});return l});Yb("offline",window,b._reset_offline);Yb("offline",document,b._reset_offline);b.ready();return b}var Wb="/",Xb="&",Vb=31E4,$b,ac="undefined"!=typeof localStorage&&localStorage;
$b={get:function(a){try{return ac?ac.getItem(a):-1==document.cookie.indexOf(a)?m:((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||m}catch(b){}},set:function(a,b){try{if(ac)return ac.setItem(a,b)&&0;document.cookie=a+"="+b+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(c){}}};"undefined"!==typeof module&&(module.m=Zb)||"undefined"!==typeof exports&&(exports.k=Zb)||(PUBNUB=Zb);D=1;E=n;G=[];H="-pnpres";I=10;aa=310;ba=60;L=1E3;ca=/{([\w\-]+)}/g;
function da(){return"x"+ ++D+""+ +new Date}function Q(){return+new Date}var bc=Math.floor(20*Math.random());R=function(a,b){return 0<a.indexOf("pubsub.")&&a.replace("pubsub","ps"+(b?S().split("-")[0]:20>++bc?bc:bc=1))||a};function fa(a,b){function c(){f+b>Q()?(clearTimeout(d),d=setTimeout(c,b)):(f=Q(),a())}var d,f=0;return c}function ga(a,b){var c=[];T(a||[],function(a){b(a)&&c.push(a)});return c}function ha(a,b){return a.replace(ca,function(a,d){return b[d]||a})}
function U(a,b){return setTimeout(a,b)}function S(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}function T(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var c=0,d=a.length;c<d;)b.call(a[c],a[c],c++);else for(c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function Y(a,b){var c=[];T(a||[],function(a,f){c.push(b(a,f))});return c}
function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];T(a,function(a,d){d.f&&b.push(a)});return b.sort()}function ia(){U(function(){E||(E=1,T(G,function(a){a()}))},L)}
function pa(a){function b(){}function c(a){a&&(J.g=0);!J.g&&J.length&&(J.g=1,u(J.shift()))}function d(a){T($(K),function(b){(b=K[b])&&a(b)})}function f(){B()||M&&M(1);U(f,L)}function j(){ja.time(function(a){a||M&&M(1);U(j,g)})}var A=+a.windowing||I,w=(+a.timeout||aa)*L,g=(+a.keepalive||ba)*L,v=a.publish_key||"",s=a.subscribe_key||"",z=a.ssl?"s":"",P="http"+z+"://"+(a.origin||"pubsub.pubnub.com"),t=R(P),V=R(P),J=[],N=0,O=0,M=0,F=0,r=0,p=0,K={},u=a.xdr,B=a._is_online||y(1),x=a.jsonp_cb||y(0),e=a.db||
{get:q(),set:q()},X=a.uuid||e&&e.get(s+"uuid")||"",ja={LEAVE:function(a,b){var c={uuid:X},d=R(P),e=x();0<a.indexOf(H)||("0"!=e&&(c.callback=e),u({l:b||z,timeout:2E3,a:e,data:c,url:[d,"v2","presence","sub_key",s,"channel",Z(a),"leave"]}))},history:function(a,b){var b=a.callback||b,c=a.count||a.limit||100,d=a.reverse||"false",e=a.error||q(),f=a.channel,g=a.start,j=a.end,p={},r=x();if(!f)return error("Missing Channel");if(!b)return error("Missing Callback");if(!s)return error("Missing Subscribe Key");
p.stringtoken="true";p.count=c;p.reverse=d;r&&(p.callback=r);g&&(p.start=g);j&&(p.end=j);u({a:r,data:p,c:function(a){b(a)},b:e,url:[t,"v2","history","sub-key",s,"channel",Z(f)]})},replay:function(a){var b=b||a.callback||q(),c=a.source,d=a.destination,e=a.stop,f=a.start,g=a.end,j=a.reverse,a=a.limit,p=x(),r={};if(!c)return error("Missing Source Channel");if(!d)return error("Missing Destination Channel");if(!v)return error("Missing Publish Key");if(!s)return error("Missing Subscribe Key");"0"!=p&&(r.callback=
p);e&&(r.stop="all");j&&(r.reverse="true");f&&(r.start=f);g&&(r.end=g);a&&(r.count=a);u({a:p,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[t,"v1","replay",v,s,c,d],data:r})},time:function(a){var b=x();u({a:b,timeout:5*L,url:[t,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){var b=b||a.callback||q(),d=a.message,e=a.channel,f=x();if(!d)return error("Missing Message");if(!e)return error("Missing Channel");if(!v)return error("Missing Publish Key");if(!s)return error("Missing Subscribe Key");
d=JSON.stringify(d);e=[t,"publish",v,s,0,Z(e),f,Z(d)];J.push({a:f,timeout:5*L,url:e,data:{uuid:X},c:function(a){b(a);c(1)},b:function(){b([0,"Failed",d]);c(1)}});c()},unsubscribe:function(a){a=a.channel;p=0;F=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+H}).join(",");T(a.split(","),function(a){E&&ja.LEAVE(a,0);K[a]=0});E&&b()},subscribe:function(a,c){function f(a){a?U(g,L):(t=R(P,1),V=R(P,1),U(function(){ja.time(f)},L));d(function(b){if(a&&b.d)return b.d=0,b.j(b.name);!a&&
!b.d&&(b.d=1,b.i(b.name))})}function g(){var a=x(),b=$(K).join(",");b&&(M=u({timeout:Na,a:a,b:function(){ja.time(f)},data:{uuid:X},url:[V,"subscribe",s,Z(b),a,p],c:function(a){if(!a)return U(g,oa);d(function(a){a.e||(a.e=1,a.h(a.name))});p=!p&&F&&e.get(s)||a[1];J&&(Timetoken=1E4,J=0);e.set(s,a[1]);var b,c=(2<a.length?a[2]:"").split(",");b=function(){var a=c.shift()||"";return[(K[a]||{}).a||N,(a||O).split(H)[0]]};T(a[0],function(c){var d=b();if(K[d[1]].f)d[0](c,a,d[1])});U(g,oa)}}))}var j=a.channel,
c=(c=c||a.callback)||a.message,v=a.connect||q(),i=a.reconnect||q(),k=a.disconnect||q(),z=a.presence||0,B=a.noheresync||0,J=a.backfill||0,Na=a.timeout||w,oa=a.windowing||A;a.restore&&(F=1);p=0;if(!j)return error("Missing Channel");if(!c)return error("Missing Callback");if(!s)return error("Missing Subscribe Key");T((j.join?j.join(","):""+j).split(","),function(a){var b=K[a]||{};K[O=a]={name:a,e:b.e,d:b.d,f:1,a:N=c,h:v,i:k,j:i};z&&(ja.subscribe({channel:a+H,callback:z}),!b.f&&!B&&ja.here_now({channel:a,
callback:function(b){T("uuids"in b?b.uuids:[],function(c){z({action:"join",uuid:c,timestamp:Q(),occupancy:b.occupancy||1},b,a)})}}))});b=function(){M&&M(1);clearTimeout(r);r=U(g,100)};if(!E)return G.push(b);b()},here_now:function(a,b){var b=a.callback||b,c=a.error||q(),d=a.channel,e=x(),f=m;if(!d)return error("Missing Channel");if(!b)return error("Missing Callback");if(!s)return error("Missing Subscribe Key");"0"!=e&&(f={},f.callback=e);u({a:e,data:f,c:function(a){b(a)},b:c,url:[t,"v2","presence",
"sub_key",s,"channel",Z(d)]})},xdr:u,ready:ia,db:e,uuid:S,each:T,map:Y,grep:ga,supplant:ha,now:Q,unique:da,updater:fa};X||(X=ja.uuid());e.set(s+"uuid",X);U(f,L);U(j,g);return ja}
function cc(a){function b(a){f||(f=1,clearTimeout(A),d&&(d.onerror=d.onload=m,d.abort&&d.abort(),d=m),a&&w())}function c(){if(!j){j=1;clearTimeout(A);try{response=JSON.parse(d.responseText)}catch(a){return b(1)}g(response)}}var d,f=0,j=0,A=U(function(){b(1)},dc),w=a.b||q(),g=a.c||q();try{d="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;d.onerror=d.onabort=function(){b(1)};d.onload=d.onloadend=c;d.timeout=dc;url=a.url.join(ec);if(a.data){var v=[];url+="?";for(key in a.data)v.push(key+
"="+a.data[key]);url+=v.join(fc)}d.open("GET",url,l);d.send()}catch(s){return b(0),cc(a)}return b}function gc(a,b,c){T(a.split(","),function(a){function f(a){a||(a=window.event);c(a)||(a.cancelBubble=l,a.returnValue=n,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,f,n):b.attachEvent?b.attachEvent("on"+a,f):b["on"+a]=f})}
function hc(a){a.db=ic;a.xdr=cc;var b=pa(a);b.init=hc;if(a.notest)return b;gc("beforeunload",window,function(){each_channel(function(a){b.LEAVE(a.name,1)});return l});gc("offline",window,b._reset_offline);gc("offline",document,b._reset_offline);b.ready();return b}var ec="/",fc="&",dc=31E4,ic,jc="undefined"!=typeof localStorage&&localStorage;
ic={get:function(a){try{return jc?jc.getItem(a):-1==document.cookie.indexOf(a)?m:((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||m}catch(b){}},set:function(a,b){try{if(jc)return jc.setItem(a,b)&&0;document.cookie=a+"="+b+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(c){}}};"undefined"!==typeof module&&(module.m=hc)||"undefined"!==typeof exports&&(exports.k=hc)||(PUBNUB=hc);
})();
