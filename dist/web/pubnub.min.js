!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.PUBNUB=t():e.PUBNUB=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){var n=l.HmacSHA256(e,t);return n.toString(l.enc.Base64)}function o(){return"onLine"in navigator?navigator.onLine:!0}function a(e){return navigator&&"sendBeacon"in navigator?void navigator.sendBeacon(e):!1}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e){e.db=f,e.error=e.error,e.hmac_SHA256=i,e.crypto_obj=c(),e._is_online=o,e.sendBeacon=a;var t=(0,u["default"])(e);return window.addEventListener("beforeunload",t.unloadTriggered()),window.addEventListener("offline",t.offlineTriggered()),t};var s=n(1),u=r(s),c=n(50),l=n(51),f={get:function(e){return localStorage.getItem(e)},set:function(e,t){return localStorage.setItem(e,t)}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e){function t(e,t){return p.encrypt(e,t||y.getCipherKey())||e}function n(e,t){return p.decrypt(e,t||y.getCipherKey())||p.decrypt(e,y.getCipherKey())||e}var r=e.shutdown,i="undefined"!=typeof e.use_send_beacon?e.use_send_beacon:!0,o=i?e.sendBeacon:null,s=e.db||{get:function(){},set:function(){}},c=e.error||function(){},f=e.hmac_SHA256,p=e.crypto_obj||{encrypt:function(e){return e},decrypt:function(e){return e}},y=(new h["default"]).setInstanceId(a["default"].v4()).setAuthKey(e.authKey||"").setSecretKey(e.secretKey||"").setSubscribeKey(e.subscribeKey).setPublishKey(e.publishKey).setCipherKey(e.cipherKey);y.setUUID(e.uuid||!e.unique_uuid&&s.get(y.getSubscribeKey()+"uuid")||a["default"].v4()),s.set(y.getSubscribeKey()+"uuid",y.getUUID());var _=(new d["default"]).setRequestIdConfig(e.use_request_id||!1).setPresenceTimeout(L.validateHeartbeat(e.heartbeat||e.pnexpires||0,c)).setSupressLeaveEvents(e.noleave||0).setInstanceIdConfig(e.instance_id||!1);_.setHeartbeatInterval(e.heartbeat_interval||_.getPresenceTimeout()/2-1);var b=new v["default"],k=new l["default"](_,y,e.ssl,e.origin).addBeaconDispatcher(o).setCoreParams(e.params||{}),S=new g["default"]({networking:k}),E=(0,u["default"])({}),T=new x["default"]({networking:k}),P=new O["default"]({networking:k,decrypt:n}),j=new D["default"]({networking:k}),K=new U["default"]({publishQueue:S,encrypt:t}),A=new I["default"]({keychain:y,config:_,networking:k,error:c}),B=new C["default"]({keychain:y,config:_,networking:k,error:c,state:b}),N=new M["default"]({keychain:y,config:_,networking:k,error:c,hmac_SHA256:f}),G=new R["default"]({keychain:y,networking:k,presenceEndpoints:B,error:c,config:_,state:b}),F=new m["default"](_,b,B,E,c),z=new w["default"]({eventEmitter:E,networking:k,timeEndpoint:T});2===_.getPresenceTimeout()&&_.setHeartbeatInterval(1);var q={accessManager:{grant:N.grant.bind(N),audit:N.audit.bind(N),revoke:N.revoke.bind(N)},channelGroups:{listGroups:j.listGroups.bind(j),deleteGroup:j.removeGroup.bind(j),listChannels:j.listChannels.bind(j),addChannel:j.addChannel.bind(j),removeChannel:j.addChannel.bind(j)},history:P.fetch.bind(P),time:T.fetch.bind(T),publish:K.publish.bind(K),presence:{hereNow:function(e,t){B.hereNow(e,t)},whereNow:function(e,t){B.whereNow(e,t)},state:function(e,t){B.performState(e,t)}},push:{provisionDevice:function(e){A.provisionDevice(e)},sendPushNotification:function(e){return e}},unsubscribe:function(e,t){TIMETOKEN=0,SUB_RESTORE=1,G.performUnsubscribe(e,t),CONNECT()},subscribe:function(e,t){},getCipherKey:function(){return y.getCipherKey()},setCipherKey:function(e){y.setCipherKey(e)},rawEncrypt:function(e,n){return t(e,n)},rawDecrypt:function(e,t){return n(e,t)},getHeartbeat:function(){return _.getPresenceTimeout()},setHeartbeat:function(e,t){_.setPresenceTimeout(L.validateHeartbeat(e,_.getPresenceTimeout(),c)),_.setHeartbeatInterval(t||_.getPresenceTimeout()/2-1),2===_.getPresenceTimeout()&&_.setHeartbeatInterval(1),E.emit("presenceHeartbeatChanged")},getHeartbeatInterval:function(){return _.getHeartbeatInterval()},setHeartbeatInterval:function(e){_.setHeartbeatInterval(e),E.emit("presenceHeartbeatChanged")},getVersion:function(){return H.version},addParam:function(e,t){k.addCoreParam(e,t)},setAuthKey:function(e){y.setAuthKey(e),E.emit("keychainChanged")},setUUID:function(e){y.setUUID(e),E.emit("keychainChanged")},getUUID:function(){return y.getUUID()},getSubscribedChannels:function(){return b.generate_channel_list(!0)},stopTimers:function(){z.stop(),F.stop()},shutdown:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){q.stopTimers(),r&&r()})};return q}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=i;var o=n(2),a=r(o),s=n(4),u=r(s),c=n(19),l=r(c),f=n(27),h=r(f),p=n(29),d=r(p),y=n(32),v=r(y),_=n(33),g=r(_),b=n(34),m=r(b),k=n(38),w=r(k),S=n(39),x=r(S),E=n(35),C=r(E),T=n(40),O=r(T),P=n(41),I=r(P),j=n(45),M=r(j),K=n(46),D=r(K),A=n(47),R=r(A),B=n(48),U=r(B),H=n(49),L=n(30)},function(e,t,n){function r(e,t,n){var r=t&&n||0,i=0;for(t=t||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){16>i&&(t[r+i++]=c[e])});16>i;)t[r+i++]=0;return t}function i(e,t){var n=t||0,r=u;return r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]}function o(e,t,n){var r=t&&n||0,o=t||[];e=e||{};var a=void 0!==e.clockseq?e.clockseq:p,s=void 0!==e.msecs?e.msecs:(new Date).getTime(),u=void 0!==e.nsecs?e.nsecs:y+1,c=s-d+(u-y)/1e4;if(0>c&&void 0===e.clockseq&&(a=a+1&16383),(0>c||s>d)&&void 0===e.nsecs&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");d=s,y=u,p=a,s+=122192928e5;var l=(1e4*(268435455&s)+u)%4294967296;o[r++]=l>>>24&255,o[r++]=l>>>16&255,o[r++]=l>>>8&255,o[r++]=255&l;var f=s/4294967296*1e4&268435455;o[r++]=f>>>8&255,o[r++]=255&f,o[r++]=f>>>24&15|16,o[r++]=f>>>16&255,o[r++]=a>>>8|128,o[r++]=255&a;for(var v=e.node||h,_=0;6>_;_++)o[r+_]=v[_];return t?t:i(o)}function a(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"==e?new Array(16):null,e=null),e=e||{};var o=e.random||(e.rng||s)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var a=0;16>a;a++)t[r+a]=o[a];return t||i(o)}for(var s=n(3),u=[],c={},l=0;256>l;l++)u[l]=(l+256).toString(16).substr(1),c[u[l]]=l;var f=s(),h=[1|f[0],f[1],f[2],f[3],f[4],f[5]],p=16383&(f[6]<<8|f[7]),d=0,y=0,v=a;v.v1=o,v.v4=a,v.parse=r,v.unparse=i,e.exports=v},function(e,t){(function(t){var n;if(t.crypto&&crypto.getRandomValues){var r=new Uint8Array(16);n=function(){return crypto.getRandomValues(r),r}}if(!n){var i=new Array(16);n=function(){for(var e,t=0;16>t;t++)0===(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}e.exports=n}).call(t,function(){return this}())},function(e,t,n){"use strict";var r,i,o,a,s,u,c,l=n(5),f=n(18),h=Function.prototype.apply,p=Function.prototype.call,d=Object.create,y=Object.defineProperty,v=Object.defineProperties,_=Object.prototype.hasOwnProperty,g={configurable:!0,enumerable:!1,writable:!0};r=function(e,t){var n;return f(t),_.call(this,"__ee__")?n=this.__ee__:(n=g.value=d(null),y(this,"__ee__",g),g.value=null),n[e]?"object"==typeof n[e]?n[e].push(t):n[e]=[n[e],t]:n[e]=t,this},i=function(e,t){var n,i;return f(t),i=this,r.call(this,e,n=function(){o.call(i,e,n),h.call(t,this,arguments)}),n.__eeOnceListener__=t,this},o=function(e,t){var n,r,i,o;if(f(t),!_.call(this,"__ee__"))return this;if(n=this.__ee__,!n[e])return this;if(r=n[e],"object"==typeof r)for(o=0;i=r[o];++o)i!==t&&i.__eeOnceListener__!==t||(2===r.length?n[e]=r[o?0:1]:r.splice(o,1));else r!==t&&r.__eeOnceListener__!==t||delete n[e];return this},a=function(e){var t,n,r,i,o;if(_.call(this,"__ee__")&&(i=this.__ee__[e]))if("object"==typeof i){for(n=arguments.length,o=new Array(n-1),t=1;n>t;++t)o[t-1]=arguments[t];for(i=i.slice(),t=0;r=i[t];++t)h.call(r,this,o)}else switch(arguments.length){case 1:p.call(i,this);break;case 2:p.call(i,this,arguments[1]);break;case 3:p.call(i,this,arguments[1],arguments[2]);break;default:for(n=arguments.length,o=new Array(n-1),t=1;n>t;++t)o[t-1]=arguments[t];h.call(i,this,o)}},s={on:r,once:i,off:o,emit:a},u={on:l(r),once:l(i),off:l(o),emit:l(a)},c=v({},u),e.exports=t=function(e){return null==e?d(c):v(Object(e),u)},t.methods=s},function(e,t,n){"use strict";var r,i=n(6),o=n(13),a=n(14),s=n(15);r=e.exports=function(e,t){var n,r,a,u,c;return arguments.length<2||"string"!=typeof e?(u=t,t=e,e=null):u=arguments[2],null==e?(n=a=!0,r=!1):(n=s.call(e,"c"),r=s.call(e,"e"),a=s.call(e,"w")),c={value:t,configurable:n,enumerable:r,writable:a},u?i(o(u),c):c},r.gs=function(e,t,n){var r,u,c,l;return"string"!=typeof e?(c=n,n=t,t=e,e=null):c=arguments[3],null==t?t=void 0:a(t)?null==n?n=void 0:a(n)||(c=n,n=void 0):(c=t,t=n=void 0),null==e?(r=!0,u=!1):(r=s.call(e,"c"),u=s.call(e,"e")),l={get:t,set:n,configurable:r,enumerable:u},c?i(o(c),l):l}},function(e,t,n){"use strict";e.exports=n(7)()?Object.assign:n(8)},function(e,t){"use strict";e.exports=function(){var e,t=Object.assign;return"function"!=typeof t?!1:(e={foo:"raz"},t(e,{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}},function(e,t,n){"use strict";var r=n(9),i=n(12),o=Math.max;e.exports=function(e,t){var n,a,s,u=o(arguments.length,2);for(e=Object(i(e)),s=function(r){try{e[r]=t[r]}catch(i){n||(n=i)}},a=1;u>a;++a)t=arguments[a],r(t).forEach(s);if(void 0!==n)throw n;return e}},function(e,t,n){"use strict";e.exports=n(10)()?Object.keys:n(11)},function(e,t){"use strict";e.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},function(e,t){"use strict";var n=Object.keys;e.exports=function(e){return n(null==e?e:Object(e))}},function(e,t){"use strict";e.exports=function(e){if(null==e)throw new TypeError("Cannot use null or undefined");return e}},function(e,t){"use strict";var n=Array.prototype.forEach,r=Object.create,i=function(e,t){var n;for(n in e)t[n]=e[n]};e.exports=function(e){var t=r(null);return n.call(arguments,function(e){null!=e&&i(Object(e),t)}),t}},function(e,t){"use strict";e.exports=function(e){return"function"==typeof e}},function(e,t,n){"use strict";e.exports=n(16)()?String.prototype.contains:n(17)},function(e,t){"use strict";var n="razdwatrzy";e.exports=function(){return"function"!=typeof n.contains?!1:n.contains("dwa")===!0&&n.contains("foo")===!1}},function(e,t){"use strict";var n=String.prototype.indexOf;e.exports=function(e){return n.call(this,e,arguments[1])>-1}},function(e,t){"use strict";e.exports=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(20),u=r(s),c=n(27),l=(r(c),n(28)),f=r(l),h=n(29),p=(r(h),n(30)),d=r(p),y=function(){function e(t,n){var r=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],o=arguments.length<=3||void 0===arguments[3]?"pubsub.pubnub.com":arguments[3];i(this,e),this._config=t,this._keychain=n,this._r=new f["default"]("#networking"),this._maxSubDomain=20,this._currentSubDomain=Math.floor(Math.random()*this._maxSubDomain),this._providedFQDN=(r?"https://":"http://")+o,this._coreParams={},this.shiftStandardOrigin(!1),this.shiftSubscribeOrigin(!1)}return a(e,[{key:"setCoreParams",value:function(e){return this._coreParams=e,this}},{key:"addCoreParam",value:function(e,t){this._coreParams[e]=t}},{key:"addBeaconDispatcher",value:function(e){return this._sendBeacon=e,this}},{key:"prepareParams",value:function(e){return e||(e={}),d["default"].each(this._coreParams,function(t,n){t in e||(e[t]=n)}),this._config.isInstanceIdEnabled()&&(e.instanceid=this._keychain.getInstanceId()),e}},{key:"nextOrigin",value:function(e){if(-1===this._providedFQDN.indexOf("pubsub."))return this._providedFQDN;var t=void 0;return e?t=d["default"].generateUUID().split("-")[0]:(this._currentSubDomain=this._currentSubDomain+1,this._currentSubDomain>=this._maxSubDomain&&(this._currentSubDomain=1),t=this._currentSubDomain.toString()),this._providedFQDN.replace("pubsub","ps"+t)}},{key:"shiftStandardOrigin",value:function(){var e=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];return this._standardOrigin=this.nextOrigin(e),this._standardOrigin}},{key:"shiftSubscribeOrigin",value:function(){var e=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];return this._subscribeOrigin=this.nextOrigin(e),this._subscribeOrigin}},{key:"fetchHistory",value:function(e,t,n){if(!this._keychain.getSubscribeKey())return n(this._r.validationError("Missing Subscribe Key"));var r=[this.getStandardOrigin(),"v2","history","sub-key",this._keychain.getSubscribeKey(),"channel",d["default"].encode(e)],i=this.prepareParams(t);this._keychain.getAuthKey()&&(i.auth=this._keychain.getAuthKey()),this._xdr({data:i,callback:n,url:r})}},{key:"performChannelGroupOperation",value:function(e,t,n,r){if(!this._keychain.getSubscribeKey())return r(this._r.validationError("Missing Subscribe Key"));var i=[this.getStandardOrigin(),"v1","channel-registration","sub-key",this._keychain.getSubscribeKey(),"channel-group"];e&&"*"!==e&&i.push(e),"remove"===t&&i.push("remove");var o=this.prepareParams(n);this._keychain.getAuthKey()&&(o.auth=this._keychain.getAuthKey()),this._xdr({data:o,callback:r,url:i})}},{key:"provisionDeviceForPush",value:function(e,t){var n=[this.getStandardOrigin(),"v1","push","sub-key",this._keychain.getSubscribeKey(),"devices",e];return t.uuid=this._keychain.getUUID(),t.auth=this._keychain.getAuthKey(),this._xdr({data:t,url:n})}},{key:"performGrant",value:function(e){var t=e.data,n=e.success,r=e.fail,i=[this.getStandardOrigin(),"v1","auth","grant","sub-key",this._keychain.getSubscribeKey()];this._xdr({data:t,success:n,fail:r,url:i})}},{key:"performHeartbeat",value:function(e,t){var n=t.data,r=t.success,i=t.fail,o=[this.getStandardOrigin(),"v2","presence","sub-key",this._keychain.getSubscribeKey(),"channel",e,"heartbeat"];this._xdr({data:n,success:r,fail:i,url:o})}},{key:"performState",value:function(e,t,n,r){var i=r.data,o=r.success,a=r.fail,s=[this.getStandardOrigin(),"v2","presence","sub-key",this._keychain.getSubscribeKey(),"channel",t];e?s.push("uuid",n,"data"):s.push("uuid",d["default"].encode(n)),this._xdr({data:i,success:o,fail:a,url:s})}},{key:"performAudit",value:function(e){var t=e.data,n=e.success,r=e.fail,i=[this.getStandardOrigin(),"v1","auth","audit","sub-key",this._keychain.getSubscribeKey()];this._xdr({data:t,success:n,fail:r,url:i})}},{key:"performChannelLeave",value:function(e,t){var n=t.data,r=t.success,i=t.fail,o=this.nextOrigin(!1),a=[o,"v2","presence","sub_key",this._keychain.getSubscribeKey(),"channel",d["default"].encode(e),"leave"];this._sendBeacon?this._sendBeacon(d["default"].buildURL(a,n))&&r({status:200,action:"leave",message:"OK",service:"Presence"}):this._xdr({data:n,success:r,fail:i,url:a})}},{key:"performChannelGroupLeave",value:function(e){var t=e.data,n=e.success,r=e.fail,i=this.nextOrigin(!1),o=[i,"v2","presence","sub_key",this._keychain.getSubscribeKey(),"channel",d["default"].encode(","),"leave"];"undefined"!=typeof this._sendBeacon?this._sendBeacon(d["default"].buildURL(o,t))&&n({status:200,action:"leave",message:"OK",service:"Presence"}):this._xdr({data:t,success:n,fail:r,url:o})}},{key:"fetchTime",value:function(e){var t=this.prepareParams({}),n=[this.getStandardOrigin(),"time",0];this._keychain.getUUID()&&(t.uuid=this._keychain.getUUID()),this._keychain.getAuthKey()&&(t.auth=this._keychain.getAuthKey()),this._xdr({data:t,callback:e,url:n})}},{key:"fetchWhereNow",value:function(e,t){var n=t.data,r=t.success,i=t.fail,o=[this.getStandardOrigin(),"v2","presence","sub_key",this._keychain.getSubscribeKey(),"uuid",d["default"].encode(e)];this._xdr({data:n,success:r,fail:i,url:o})}},{key:"fetchHereNow",value:function(e,t,n){var r=n.data,i=n.success,o=n.fail,a=[this.getStandardOrigin(),"v2","presence","sub_key",this._keychain.getSubscribeKey()];e&&(a.push("channel"),a.push(d["default"].encode(e))),t&&!e&&(a.push("channel"),a.push(",")),this._xdr({data:r,success:i,fail:o,url:a})}},{key:"performPublish",value:function(e,t,n,r,i){if(!this._keychain.getSubscribeKey())return i(this._r.validationError("Missing Subscribe Key"));if(!this._keychain.getPublishKey())return i(this._r.validationError("Missing Publish Key"));var o=[this.getStandardOrigin(),"publish",this._keychain.getPublishKey(),this._keychain.getSubscribeKey(),0,d["default"].encode(e),0,d["default"].encode(t)],a=this.prepareParams(n);this._keychain.getUUID()&&(a.uuid=this._keychain.getUUID()),this._keychain.getAuthKey()&&(a.auth=this._keychain.getAuthKey()),"POST"===r?this._postXDR({data:a,callback:i,url:o}):this._xdr({data:a,callback:i,url:o})}},{key:"getOrigin",value:function(){return this._providedFQDN}},{key:"getStandardOrigin",value:function(){return this._standardOrigin}},{key:"getSubscribeOrigin",value:function(){return this._subscribeOrigin}},{key:"_postXDR",value:function(e){var t=e.data,n=e.url,r=e.callback,i=u["default"].post(n.join("/")).query(t);this._abstractedXDR(i,r)}},{key:"_xdr",value:function(e){var t=e.data,n=e.url,r=e.callback,i=u["default"].get(n.join("/")).query(t);this._abstractedXDR(i,r)}},{key:"_abstractedXDR",value:function(e,t){e.type("json").end(function(e,n){return e?t(e,null):"object"===("undefined"==typeof n?"undefined":o(n))&&n.error?void t(n.error,null):void t(null,JSON.parse(n.text))})}}]),e}();t["default"]=y},function(e,t,n){function r(){}function i(e){var t={}.toString.call(e);switch(t){case"[object File]":case"[object Blob]":case"[object FormData]":return!0;default:return!1}}function o(e){if(!b(e))return e;var t=[];for(var n in e)null!=e[n]&&a(t,n,e[n]);return t.join("&")}function a(e,t,n){return Array.isArray(n)?n.forEach(function(n){a(e,t,n)}):void e.push(encodeURIComponent(t)+"="+encodeURIComponent(n))}function s(e){for(var t,n,r={},i=e.split("&"),o=0,a=i.length;a>o;++o)n=i[o],t=n.split("="),r[decodeURIComponent(t[0])]=decodeURIComponent(t[1]);return r}function u(e){var t,n,r,i,o=e.split(/\r?\n/),a={};o.pop();for(var s=0,u=o.length;u>s;++s)n=o[s],t=n.indexOf(":"),r=n.slice(0,t).toLowerCase(),i=k(n.slice(t+1)),a[r]=i;return a}function c(e){return/[\/+]json\b/.test(e)}function l(e){return e.split(/ *; */).shift()}function f(e){return _(e.split(/ *; */),function(e,t){var n=t.split(/ *= */),r=n.shift(),i=n.shift();return r&&i&&(e[r]=i),e},{})}function h(e,t){t=t||{},this.req=e,this.xhr=this.req.xhr,this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||"undefined"==typeof this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText,this.setStatusProperties(this.xhr.status),this.header=this.headers=u(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this.setHeaderProperties(this.header),this.body="HEAD"!=this.req.method?this.parseBody(this.text?this.text:this.xhr.response):null}function p(e,t){var n=this;this._query=this._query||[],this.method=e,this.url=t,this.header={},this._header={},this.on("end",function(){var e=null,t=null;try{t=new h(n)}catch(r){return e=new Error("Parser is unable to parse the response"),e.parse=!0,e.original=r,e.rawResponse=n.xhr&&n.xhr.responseText?n.xhr.responseText:null,e.statusCode=n.xhr&&n.xhr.status?n.xhr.status:null,n.callback(e)}if(n.emit("response",t),e)return n.callback(e,t);if(t.status>=200&&t.status<300)return n.callback(e,t);var i=new Error(t.statusText||"Unsuccessful HTTP response");i.original=e,i.response=t,i.status=t.status,n.callback(i,t)})}function d(e,t){var n=m("DELETE",e);return t&&n.end(t),n}var y,v=n(21),_=n(22),g=n(23),b=n(24);y="undefined"!=typeof window?window:"undefined"!=typeof self?self:this;var m=e.exports=n(26).bind(null,p);m.getXHR=function(){if(!(!y.XMLHttpRequest||y.location&&"file:"==y.location.protocol&&y.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}return!1};var k="".trim?function(e){return e.trim()}:function(e){return e.replace(/(^\s*|\s*$)/g,"")};m.serializeObject=o,m.parseString=s,m.types={html:"text/html",json:"application/json",xml:"application/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},m.serialize={"application/x-www-form-urlencoded":o,"application/json":JSON.stringify},m.parse={"application/x-www-form-urlencoded":s,"application/json":JSON.parse},h.prototype.get=function(e){return this.header[e.toLowerCase()]},h.prototype.setHeaderProperties=function(e){var t=this.header["content-type"]||"";this.type=l(t);var n=f(t);for(var r in n)this[r]=n[r]},h.prototype.parseBody=function(e){var t=m.parse[this.type];return t&&e&&(e.length||e instanceof Object)?t(e):null},h.prototype.setStatusProperties=function(e){1223===e&&(e=204);var t=e/100|0;this.status=this.statusCode=e,this.statusType=t,this.info=1==t,this.ok=2==t,this.clientError=4==t,this.serverError=5==t,this.error=4==t||5==t?this.toError():!1,this.accepted=202==e,this.noContent=204==e,this.badRequest=400==e,this.unauthorized=401==e,this.notAcceptable=406==e,this.notFound=404==e,this.forbidden=403==e},h.prototype.toError=function(){var e=this.req,t=e.method,n=e.url,r="cannot "+t+" "+n+" ("+this.status+")",i=new Error(r);return i.status=this.status,i.method=t,i.url=n,i},m.Response=h,v(p.prototype);for(var w in g)p.prototype[w]=g[w];p.prototype.abort=function(){return this.aborted?void 0:(this.aborted=!0,this.xhr.abort(),this.clearTimeout(),this.emit("abort"),this)},p.prototype.type=function(e){return this.set("Content-Type",m.types[e]||e),this},p.prototype.responseType=function(e){return this._responseType=e,this},p.prototype.accept=function(e){return this.set("Accept",m.types[e]||e),this},p.prototype.auth=function(e,t,n){switch(n||(n={type:"basic"}),n.type){case"basic":var r=btoa(e+":"+t);this.set("Authorization","Basic "+r);break;case"auto":this.username=e,this.password=t}return this},p.prototype.query=function(e){return"string"!=typeof e&&(e=o(e)),e&&this._query.push(e),this},p.prototype.attach=function(e,t,n){return this._formData||(this._formData=new y.FormData),this._formData.append(e,t,n||t.name),this},p.prototype.send=function(e){var t=b(e),n=this._header["content-type"];if(t&&b(this._data))for(var r in e)this._data[r]=e[r];else"string"==typeof e?(n||this.type("form"),n=this._header["content-type"],"application/x-www-form-urlencoded"==n?this._data=this._data?this._data+"&"+e:e:this._data=(this._data||"")+e):this._data=e;return!t||i(e)?this:(n||this.type("json"),this)},p.prototype.callback=function(e,t){var n=this._callback;this.clearTimeout(),n(e,t)},p.prototype.crossDomainError=function(){var e=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");e.crossDomain=!0,e.status=this.status,e.method=this.method,e.url=this.url,this.callback(e)},p.prototype.timeoutError=function(){var e=this._timeout,t=new Error("timeout of "+e+"ms exceeded");t.timeout=e,this.callback(t)},p.prototype.withCredentials=function(){return this._withCredentials=!0,this},p.prototype.end=function(e){var t=this,n=this.xhr=m.getXHR(),o=this._query.join("&"),a=this._timeout,s=this._formData||this._data;this._callback=e||r,n.onreadystatechange=function(){if(4==n.readyState){var e;try{e=n.status}catch(r){e=0}if(0==e){if(t.timedout)return t.timeoutError();if(t.aborted)return;return t.crossDomainError()}t.emit("end")}};var u=function(e){e.total>0&&(e.percent=e.loaded/e.total*100),e.direction="download",t.emit("progress",e)};this.hasListeners("progress")&&(n.onprogress=u);try{n.upload&&this.hasListeners("progress")&&(n.upload.onprogress=u)}catch(l){}if(a&&!this._timer&&(this._timer=setTimeout(function(){t.timedout=!0,t.abort()},a)),o&&(o=m.serializeObject(o),this.url+=~this.url.indexOf("?")?"&"+o:"?"+o),this.username&&this.password?n.open(this.method,this.url,!0,this.username,this.password):n.open(this.method,this.url,!0),this._withCredentials&&(n.withCredentials=!0),"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof s&&!i(s)){var f=this._header["content-type"],h=this._parser||m.serialize[f?f.split(";")[0]:""];!h&&c(f)&&(h=m.serialize["application/json"]),h&&(s=h(s))}for(var p in this.header)null!=this.header[p]&&n.setRequestHeader(p,this.header[p]);return this._responseType&&(n.responseType=this._responseType),this.emit("request",this),n.send("undefined"!=typeof s?s:null),this},m.Request=p,m.get=function(e,t,n){var r=m("GET",e);return"function"==typeof t&&(n=t,t=null),t&&r.query(t),n&&r.end(n),r},m.head=function(e,t,n){var r=m("HEAD",e);return"function"==typeof t&&(n=t,t=null),t&&r.send(t),n&&r.end(n),r},m.del=d,m["delete"]=d,m.patch=function(e,t,n){var r=m("PATCH",e);return"function"==typeof t&&(n=t,t=null),t&&r.send(t),n&&r.end(n),r},m.post=function(e,t,n){var r=m("POST",e);return"function"==typeof t&&(n=t,t=null),t&&r.send(t),n&&r.end(n),r},m.put=function(e,t,n){var r=m("PUT",e);return"function"==typeof t&&(n=t,t=null),t&&r.send(t),n&&r.end(n),r}},function(e,t){function n(e){return e?r(e):void 0}function r(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}e.exports=n,n.prototype.on=n.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},n.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var r,i=0;i<n.length;i++)if(r=n[i],r===t||r.fn===t){n.splice(i,1);break}return this},n.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks["$"+e];if(n){n=n.slice(0);for(var r=0,i=n.length;i>r;++r)n[r].apply(this,t)}return this},n.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t){e.exports=function(e,t,n){for(var r=0,i=e.length,o=3==arguments.length?n:e[r++];i>r;)o=t.call(null,o,e[r],++r,e);return o}},function(e,t,n){var r=n(24),i=n(25);t.clearTimeout=function(){return this._timeout=0,clearTimeout(this._timer),this},t.parse=function(e){return this._parser=e,this},t.timeout=function(e){return this._timeout=e,this},t.then=function(e,t){return this.end(function(n,r){n?t(n):e(r)})},t.use=function(e){return e(this),this},t.get=function(e){return this._header[e.toLowerCase()]},t.getHeader=t.get,t.set=function(e,t){if(r(e)){for(var n in e)this.set(n,e[n]);return this}return this._header[e.toLowerCase()]=t,this.header[e]=t,this},t.unset=function(e){return delete this._header[e.toLowerCase()],delete this.header[e],this},t.field=function(e,t){return this._formData||(this._formData=new i),this._formData.append(e,t),this}},function(e,t){function n(e){return null!=e&&"object"==typeof e}e.exports=n},function(e,t){e.exports=FormData},function(e,t){function n(e,t,n){return"function"==typeof n?new e("GET",t).end(n):2==arguments.length?new e("GET",t):new e(t,n)}e.exports=n},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(){n(this,e)}return r(e,[{key:"setUUID",value:function(e){return this._UUID=e,this}},{key:"setCipherKey",value:function(e){return this._cipherKey=e,this}},{key:"setSubscribeKey",value:function(e){return this._subscribeKey=e,this}},{key:"setPublishKey",value:function(e){return this._publishKey=e,this}},{key:"setAuthKey",value:function(e){return this._authKey=e,this}},{key:"setInstanceId",value:function(e){return this._instanceId=e,this}},{key:"setSecretKey",value:function(e){return this._secretKey=e,this}},{key:"getCipherKey",value:function(){return this._cipherKey}},{key:"getSubscribeKey",value:function(){return this._subscribeKey}},{key:"getPublishKey",value:function(){return this._publishKey}},{key:"getAuthKey",value:function(){return this._authKey}},{key:"getInstanceId",value:function(){return this._instanceId}},{key:"getSecretKey",value:function(){return this._secretKey}},{key:"getUUID",value:function(){return this._UUID}}]),e}();t["default"]=i},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t){n(this,e),this._componentName=t}return i(e,[{key:"callback",value:function(e,t){if("object"===("undefined"==typeof e?"undefined":r(e))){if(e.error)return void this.error(e,t);if(e.payload)return void(e.next_page?t&&t(e.payload,e.next_page):t&&t(e.payload))}t&&t(e)}},{key:"error",value:function(e,t){if("object"===("undefined"==typeof e?"undefined":r(e))&&e.error){var n=_pick(e,["message","payload"]);return this._createError(t,n,"httpResultError")}return this._createError(t,{message:e},"httpResultError")}},{key:"validationError",value:function(e){return this._createError({message:e},"validationError")}},{key:"_createError",value:function(e,t){return e.component=this._componentName,e.type=t,e}}]),e}();t["default"]=o},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(){n(this,e),this._instanceId=!1,this._requestId=!1}return r(e,[{key:"setInstanceIdConfig",value:function(e){return this._instanceId=e,this}},{key:"setRequestIdConfig",value:function(e){return this._requestId=e,this}},{key:"setHeartbeatInterval",value:function(e){return this._heartbeatInterval=e,this}},{key:"setPresenceTimeout",value:function(e){return this._presenceTimeout=e,this}},{key:"setSupressLeaveEvents",value:function(e){
return this._suppressLeaveEvents=e,this}},{key:"isInstanceIdEnabled",value:function(){return this._instanceId}},{key:"isRequestIdEnabled",value:function(){return this._requestId}},{key:"isSuppressingLeaveEvents",value:function(){return this._suppressLeaveEvents}},{key:"getHeartbeatInterval",value:function(){return this._heartbeatInterval}},{key:"getPresenceTimeout",value:function(){return this._presenceTimeout}}]),e}();t["default"]=i},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(){return+new Date}function o(){return"x"+ ++w+ +new Date}function a(e){return!!e&&"string"!=typeof e&&(Array.isArray&&Array.isArray(e)||"number"==typeof e.length)}function s(e,t){if(e&&t)if(a(e))for(var n=0,r=e.length;r>n;)t.call(e[n],e[n],n++);else for(var n in e)e.hasOwnProperty&&e.hasOwnProperty(n)&&t.call(e[n],n,e[n])}function u(e){return encodeURIComponent(e)}function c(e,t){var n=e.join(k.URLBIT),r=[];return t?(s(t,function(e,t){var n="object"===("undefined"==typeof t?"undefined":g(t))?JSON.stringify(t):t;"undefined"!=typeof t&&null!==t&&u(n).length>0&&r.push(e+"="+u(n))}),n+="?"+r.join(k.PARAMSBIT)):n}function l(e,t){return"undefined"!=typeof setTimeout?setTimeout(e,t):void 0}function f(e){var t=m["default"].v4();return e&&e(t),t}function h(e,t){var n=[];return s(e||[],function(e,r){n.push(t(e,r))}),n}function p(e){return encodeURIComponent(e).replace(/[!'()*~]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}function d(e){var t=[];return s(e,function(e){t.push(e)}),t}function y(e){return d(e).sort()}function v(e){var t=y(e);return h(t,function(t){return t+"="+p(e[t])}).join("&")}function _(e,t,n){var r=!1;if("undefined"==typeof e)return t;if("number"==typeof e)r=!(e>k._minimumHeartbeatInterval||0===e);else{if("boolean"==typeof e)return e?k._defaultHeartbeatInterval:0;r=!0}if(r){if(n){var i="Presence Heartbeat value invalid. Valid range ( x >";i+=k._minimumHeartbeatInterval+" or x = 0). Current Value : ",i+=t||k._minimumHeartbeatInterval,n(i)}return t||k._minimumHeartbeatInterval}return e}var g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},b=n(2),m=r(b),k=n(31),w=1;e.exports={buildURL:c,encode:u,each:s,rnow:i,isArray:a,map:h,pamEncode:p,generateUUID:f,timeout:l,_get_pam_sign_input_from_params:v,_object_to_key_list_sorted:y,_object_to_key_list:d,validateHeartbeat:_,unique:o}},function(e,t){e.exports={PARAMSBIT:"&",URLBIT:"/",defaultHeartbeatInterval:30,minimumHeartbeatInterval:5,PRESENCE_SUFFIX:"-pnpres",SECOND:1e3}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(30),s=r(a),u=function(){function e(){i(this,e),this._channelStorage={},this._channelGroupStorage={},this._presenceState={}}return o(e,[{key:"containsChannel",value:function(e){return e in this._channelStorage}},{key:"containsChannelGroup",value:function(e){return e in this._channelGroupStorage}},{key:"getChannel",value:function(e){return this._channelStorage[e]}},{key:"getChannelGroup",value:function(e){return this._channelGroupStorage[e]}},{key:"addChannel",value:function(e,t){this._channelStorage[e]=t}},{key:"addChannelGroup",value:function(e,t){this._channelGroupStorage[e]=t}},{key:"addToPresenceState",value:function(e,t){this._presenceState[e]=t}},{key:"isInPresenceState",value:function(e){return e in this._presenceState}},{key:"removeFromPresenceState",value:function(e){delete this._presenceState[e]}},{key:"getPresenceState",value:function(){return this._presenceState}},{key:"setIsReady",value:function(e){this._ready=e}},{key:"getIsReady",value:function(){return this._ready}},{key:"getChannels",value:function(e){var t=[];return s["default"].each(this._channelStorage,function(n,r){e?n.search("-pnpres")<0&&r.subscribed&&t.push(n):r.subscribed&&t.push(n)}),t.sort()}},{key:"getChannelGroups",value:function(e){var t=[];return s["default"].each(this._channelGroupStorage,function(n,r){e?n.search("-pnpres")<0&&r.subscribed&&t.push(n):r.subscribed&&t.push(n)}),t.sort()}},{key:"each_channel_group",value:function(e){var t=0;return s["default"].each(this.getChannelGroups(),function(n){var r=this.getChannelGroup(n);r&&(t++,(e||function(){})(r))}),t}},{key:"each_channel",value:function(e){var t=0;return s["default"].each(this.getChannels(),function(n){var r=this.getChannel(n);r&&(t++,(e||function(){})(r))}),t}}]),e}();t["default"]=u},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(19),s=(r(a),function c(){i(this,c)}),u=function(){function e(t){var n=t.networking,r=t.parallelPublish,o=void 0===r?!1:r;i(this,e),this._publishQueue=[],this._networking=n,this._parallelPublish=o,this._isSending=!1}return o(e,[{key:"newQueueable",value:function(){return new s}},{key:"queueItem",value:function(e){this._publishQueue.push(e),this._sendNext()}},{key:"_sendNext",value:function(){return 0!==this._publishQueue.length?this._parallelPublish?this.__publishNext():void(this._isSending||(this._isSending=!0,this.__publishNext())):void 0}},{key:"__publishNext",value:function(){var e=this,t=this._publishQueue.shift(),n=t.channel,r=t.payload,i=t.params,o=t.httpMethod,a=t.callback,s=function(t,n){e._isSending=!1,e._sendNext(),a(t,n)};this._networking.performPublish(n,r,i,o,s)}}]),e}();t["default"]=u},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(29),s=(r(a),n(32)),u=(r(s),n(35)),c=(r(u),n(36)),l=r(c),f=n(4),h=(r(f),n(31)),p=l["default"].getLogger("component/presenceHeartbeat"),d=function(){function e(t,n,r,o,a){i(this,e),this._error=a,this._state=n,this._config=t,this._presence=r,p.debug("init",{config:t,state:n,presence:r,error:a}),o.on("internetConnected",this.__start),o.on("internetDisconnected",this.__stop),o.on("presenceHeartbeatChanged",this.__start),o.on("subscriptionChange",this.__start)}return o(e,[{key:"__start",value:function(){p.debug("(re-)starting presence heartbeat"),this.__start(),this.__periodicHeartbeat()}},{key:"__stop",value:function(){p.debug("stopping presence heartbeat"),clearTimeout(this._intervalId),this._intervalId=null}},{key:"__periodicHeartbeat",value:function(){var e=this._config.getHeartbeatInterval()*h.SECOND;return _range(this._config.getHeartbeatInterval(),1,501)?this._state.getChannels(!0).length||this._state.getChannelGroups(!0).length?void this._presence.heartbeat({callback:function(){this._intervalId=setTimeout(this._presence_heartbeat,e)},error:function(t){this._error&&this._error("Presence Heartbeat unable to reach Pubnub servers",t),this._intervalId=setTimeout(this._presence_heartbeat,e)}}):void p.debug("there are no channels / channel groups to heartbeat; aborting"):void p.debug("interval is greater than 500 or below 1; aborting")}}]),e}();t["default"]=d},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(19),s=(r(a),n(29)),u=(r(s),n(27)),c=(r(u),n(32)),l=(r(c),n(28)),f=r(l),h=n(30),p=r(h),d=n(31),y=r(d),v=function(){function e(t){var n=t.networking,r=t.config,o=t.keychain,a=t.state,s=t.error;i(this,e),this._networking=n,this._config=r,this._keychain=o,this._state=a,this._error=s}return o(e,[{key:"hereNow",value:function(e,t){var n=e.callback||t,r=e.error||function(){},i=e.auth_key||this._keychain.getAuthKey(),o=e.channel,a=e.channel_group,s="uuids"in e?e.uuids:!0,u=e.state,c={uuid:this._keychain.getUUID(),auth:i};return s||(c.disable_uuids=1),u&&(c.state=1),n?this._keychain.getSubscribeKey()?(a&&(c["channel-group"]=a),this._config.isInstanceIdEnabled()&&(c.instanceid=this._keychain.getInstanceId()),void this._networking.fetchHereNow(o,a,{data:this._networking.prepareParams(c),success:function(e){f["default"].callback(e,n,r)},fail:function(e){f["default"].error(e,r)}})):this._error("Missing Subscribe Key"):this._error("Missing Callback")}},{key:"whereNow",value:function(e,t){var n=e.callback||t,r=e.error||function(){},i=e.auth_key||this._keychain.getAuthKey(),o=e.uuid||this._keychain.getUUID(),a={auth:i};return n?this._keychain.getSubscribeKey()?(this._config.isInstanceIdEnabled()&&(a.instanceid=this._keychain.getInstanceId()),void this._networking.fetchWhereNow(o,{data:this._networking.prepareParams(a),success:function(e){f["default"].callback(e,n,r)},fail:function(e){f["default"].error(e,r)}})):this._error("Missing Subscribe Key"):this._error("Missing Callback")}},{key:"heartbeat",value:function(e){var t=e.callback||function(){},n=e.error||function(){},r={uuid:this._keychain.getUUID(),auth:this._keychain.getAuthKey()},i=JSON.stringify(this._state.getPresenceState());i.length>2&&(r.state=JSON.stringify(this._state.getPresenceState())),this._config.getPresenceTimeout()>0&&this._config.getPresenceTimeout()<320&&(r.heartbeat=this._config.getPresenceTimeout());var o=p["default"].encode(this._state.generate_channel_list(!0).join(",")),a=this._state.generate_channel_group_list(!0).join(",");o||(o=","),a&&(r["channel-group"]=a),this._config.isInstanceIdEnabled()&&(r.instanceid=this._keychain.getInstanceId()),this._config.isRequestIdEnabled()&&(r.requestid=p["default"].generateUUID()),this._networking.performHeartbeat(o,{data:this._networking.prepareParams(r),success:function(e){f["default"].callback(e,t,n)},fail:function(e){f["default"].error(e,n)}})}},{key:"performState",value:function(e,t){var n=e.callback||t||function(){},r=e.error||function(){},i=e.auth_key||this._keychain.getAuthKey(),o=e.state,a=e.uuid||this._keychain.getUUID(),s=e.channel,u=e.channel_group,c=this._networking.prepareParams({auth:i});return this._keychain.getSubscribeKey()?a?s||u?("undefined"!=typeof s&&this._state.getChannel(s)&&this._state.getChannel(s).subscribed&&o&&this._state.addToPresenceState(s,o),"undefined"!=typeof u&&this._state.getChannelGroup(u)&&this._state.getChannelGroup(u).subscribed&&(o&&this._state.addToPresenceState(u,o),c["channel-group"]=u,s||(s=",")),c.state=JSON.stringify(o),this._config.isInstanceIdEnabled()&&(c.instanceid=this._keychain.getInstanceId()),void this._networking.performState(o,s,a,{data:this._networking.prepareParams(c),success:function(e){f["default"].callback(e,n,r)},fail:function(e){f["default"].error(e,r)}})):this._error("Missing Channel"):this._error("Missing UUID"):this._error("Missing Subscribe Key")}},{key:"announceChannelLeave",value:function(e,t,n,r){var i={uuid:this._keychain.getUUID(),auth:t||this._keychain.getAuthKey()},o=n||function(){},a=r||function(){};return e.indexOf(y["default"].PRESENCE_SUFFIX)>0?!0:this._config.isSuppressingLeaveEvents()?!1:(this._config.isInstanceIdEnabled()&&(i.instanceid=this._keychain.getInstanceId()),void this._networking.performChannelLeave(e,{data:this._networking.prepareParams(i),success:function(e){f["default"].callback(e,o,a)},fail:function(e){f["default"].error(e,a)}}))}},{key:"announceChannelGroupLeave",value:function(e,t,n,r){var i={uuid:this._keychain.getUUID(),auth:t||this._keychain.getAuthKey()},o=n||function(){},a=r||function(){};return e.indexOf(y["default"].PRESENCE_SUFFIX)>0?!0:this._config.isSuppressingLeaveEvents()?!1:(e&&e.length>0&&(i["channel-group"]=e),this._config.isInstanceIdEnabled()&&(i.instanceid=this._keychain.getInstanceId()),void this._networking.performChannelGroupLeave({data:this._networking.prepareParams(i),success:function(e){f["default"].callback(e,o,a)},fail:function(e){f["default"].error(e,a)}}))}}]),e}();t["default"]=v},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(37),s=r(a),u=function(){function e(t){i(this,e),this._moduleName=t}return o(e,[{key:"__commonLogger",value:function(e,t){s["default"][e]({component:this._moduleName,data:t,timestamp:new Date})}},{key:"error",value:function(e){this.__commonLogger("error",e)}},{key:"debug",value:function(e){this.__commonLogger("debug",e)}}]),e}();t["default"]={getLogger:function(e){return new u(e)}}},function(e,t,n){var r,i;!function(o,a){"use strict";"object"==typeof e&&e.exports?e.exports=a():(r=a,i="function"==typeof r?r.call(t,n,t,e):r,!(void 0!==i&&(e.exports=i)))}(this,function(){"use strict";function e(e){return typeof console===s?!1:void 0!==console[e]?t(console,e):void 0!==console.log?t(console,"log"):a}function t(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(r){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function n(e,t,n){return function(){typeof console!==s&&(r.call(this,t,n),this[e].apply(this,arguments))}}function r(e,t){for(var n=0;n<u.length;n++){var r=u[n];this[r]=e>n?a:this.methodFactory(r,e,t)}}function i(t,r,i){return e(t)||n.apply(this,arguments)}function o(e,t,n){function o(e){var t=(u[e]||"silent").toUpperCase();try{return void(window.localStorage[f]=t)}catch(n){}try{window.document.cookie=encodeURIComponent(f)+"="+t+";"}catch(n){}}function a(){var e;try{e=window.localStorage[f]}catch(t){}if(typeof e===s)try{var n=window.document.cookie,r=n.indexOf(encodeURIComponent(f)+"=");r&&(e=/^([^;]+)/.exec(n.slice(r))[1])}catch(t){}return void 0===l.levels[e]&&(e=void 0),e}var c,l=this,f="loglevel";e&&(f+=":"+e),l.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},l.methodFactory=n||i,l.getLevel=function(){return c},l.setLevel=function(t,n){if("string"==typeof t&&void 0!==l.levels[t.toUpperCase()]&&(t=l.levels[t.toUpperCase()]),!("number"==typeof t&&t>=0&&t<=l.levels.SILENT))throw"log.setLevel() called with invalid level: "+t;return c=t,n!==!1&&o(t),r.call(l,t,e),typeof console===s&&t<l.levels.SILENT?"No console available for logging":void 0},l.setDefaultLevel=function(e){a()||l.setLevel(e,!1)},l.enableAll=function(e){l.setLevel(l.levels.TRACE,e)},l.disableAll=function(e){l.setLevel(l.levels.SILENT,e)};var h=a();null==h&&(h=null==t?"WARN":t),l.setLevel(h,!1)}var a=function(){},s="undefined",u=["trace","debug","info","warn","error"],c=new o,l={};c.getLogger=function(e){if("string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=l[e];return t||(t=l[e]=new o(e,c.getLevel(),c.methodFactory)),t};var f=typeof window!==s?window.log:void 0;return c.noConflict=function(){return typeof window!==s&&window.log===c&&(window.log=f),c},c})},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(4),s=(r(a),n(30)),u=r(s),c=n(19),l=(r(c),n(36)),f=r(l),h=n(39),p=(r(h),f["default"].getLogger("component/Connectivity"),function(){function e(t){var n=t.eventEmitter,r=t.networking,o=t.timeEndpoint;i(this,e),this._eventEmitter=n,this._networking=r,this._timeEndpoint=o,this._eventEmitter.on("unreachableHTTP",this.__onUnreachableHTTP)}return o(e,[{key:"detect_latency",value:function(e){var t=u["default"].rnow()-this._timeDrift;return t-e/1e4}},{key:"start",value:function(){this.__detect_time_delta(function(){},null)}},{key:"stop",value:function(){}},{key:"__onUnreachableHTTP",value:function(){console.log("HTTP FAILED")}},{key:"__poll_online",value:function(){_is_online()||_reset_offline(1,{error:"Offline. Please check your network settings."}),_poll_timer&&clearTimeout(_poll_timer),_poll_timer=u["default"].timeout(_poll_online,constants.SECOND)}},{key:"__poll_online2",value:function(){SELF.time(function(e){detect_time_detla(function(){},e),e||_reset_offline(1,{error:"Heartbeat failed to connect to Pubnub Servers.Please check your network settings."}),_poll_timer2&&clearTimeout(_poll_timer2),_poll_timer2=u["default"].timeout(_poll_online2,KEEPALIVE)})}},{key:"__detect_time_delta",value:function(e,t){var n=this,r=u["default"].rnow(),i=function(t){if(t){var i=t/1e4,o=(u["default"].rnow()-r)/2;n._timeDrift=u["default"].rnow()-(i+o),e&&e(n._timeDrift)}};t?i(t):this._timeEndpoint.fetchTime(i)}}]),e}());t["default"]=p},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(19),s=(r(a),function(){function e(t){var n=t.networking;i(this,e),this._networking=n}return o(e,[{key:"fetch",value:function(e){this._networking.fetchTime(function(t,n){return t?e(t):void e(null,n[0])})}}]),e}());t["default"]=s},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(19),s=(r(a),n(28)),u=r(s),c=n(36),l=r(c),f=function(){function e(t){var n=t.networking,r=t.decrypt;i(this,e),this._networking=n,this._decrypt=r,this._r=new u["default"]("#endpoints/history"),this._l=l["default"].getLogger("#endpoints/history")}return o(e,[{key:"fetch",value:function(e,t){var n=this,r=e.channel,i=e.channelGroup,o=e.cipherKey,a=e.start,s=e.end,u=e.includeToken,c=e.count||e.limit||100,l=e.reverse||"false",f=e.stringMessageToken||!1;if(!r&&!i)return t(this._r.validationError("Missing channel and/or channel group"));if(!t)return this._l.error("Missing Callback");var h={count:c,reverse:l,stringtoken:"true"};i&&(h["channel-group"]=i,r||(r=",")),a&&(h.start=a),s&&(h.end=s),u&&(h.include_token="true"),f&&(h.string_message_token="true"),this._networking.fetchHistory(r,h,function(e,r){return e?t(e,null):void t(null,n._parseResponse(r,u,o))})}},{key:"_parseResponse",value:function(e,t,n){var r=this,i=e[0],o=[];return i.forEach(function(e){if(t){var i=r._decrypt(e.message,n),a=e.timetoken;try{o.push({timetoken:a,message:JSON.parse(i)})}catch(s){o.push({timetoken:a,message:i})}}else{var u=r._decrypt(e,n);try{o.push(JSON.parse(u))}catch(s){o.push(u)}}}),[o,e[1],e[2]]}}]),e}();t["default"]=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(19),s=(r(a),n(27)),u=(r(s),n(28)),c=r(u),l=n(42),f=r(l),h=function(e,t){var n=f["default"].defer();return e?n.resolve():n.reject(t),n.promise},p=function(){function e(t){var n=t.networking;i(this,e),this._networking=n,this._r=new c["default"]("endpoints/push")}return o(e,[{key:"addDevice",value:function(e){var t=e.pushGateway,n=e.device,r=e.channel,i={operation:"add",pushGateway:t,device:n,channel:r};return this.__provisionDevice(i)}},{key:"removeDevice",value:function(e){var t=e.pushGateway,n=e.device,r=e.channel,i={operation:"remove",pushGateway:t,device:n,channel:r};return this.__provisionDevice(i)}},{key:"__provisionDevice",value:function(e){var t=this,n=e.operation,r=e.pushGateway,i=e.device,o=e.channel,a=f["default"].defer();return h(i,"Missing Device ID (device)").then(h(r,"Missing GW Type (pushGateway: gcm or apns)")).then(h(n,"Missing GW Operation (operation: add or remove)")).then(h(o,"Missing gw destination Channel (channel)")).then(h(this._networking.validateSubscribeKey(),"Missing Subscribe Key")).then(h(this._networking.validatePublishKey(),"Missing Publish Key")).fail(function(e){a.reject(t._r.validationError(e))}),a.promise}},{key:"createNotification",value:function(){}}]),e}();t["default"]=p},function(e,t,n){(function(t,n){!function(t){"use strict";if("function"==typeof bootstrap)bootstrap("promise",t);else{e.exports=t()}}(function(){"use strict";function e(e){return function(){return $.apply(e,arguments)}}function r(e){return e===Object(e)}function i(e){return"[object StopIteration]"===ie(e)||e instanceof X}function o(e,t){if(F&&t.stack&&"object"==typeof e&&null!==e&&e.stack&&-1===e.stack.indexOf(oe)){for(var n=[],r=t;r;r=r.source)r.stack&&n.unshift(r.stack);n.unshift(e.stack);var i=n.join("\n"+oe+"\n");e.stack=a(i)}}function a(e){for(var t=e.split("\n"),n=[],r=0;r<t.length;++r){var i=t[r];c(i)||s(i)||!i||n.push(i)}return n.join("\n")}function s(e){return-1!==e.indexOf("(module.js:")||-1!==e.indexOf("(node.js:")}function u(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(t)return[t[1],Number(t[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(n)return[n[1],Number(n[2])];var r=/.*@(.+):(\d+)$/.exec(e);return r?[r[1],Number(r[2])]:void 0}function c(e){var t=u(e);if(!t)return!1;var n=t[0],r=t[1];return n===q&&r>=Q&&le>=r}function l(){if(F)try{throw new Error}catch(e){var t=e.stack.split("\n"),n=t[0].indexOf("@")>0?t[1]:t[2],r=u(n);if(!r)return;return q=r[0],r[1]}}function f(e,t,n){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t+" is deprecated, use "+n+" instead.",new Error("").stack),e.apply(e,arguments)}}function h(e){return e instanceof v?e:m(e)?P(e):O(e)}function p(){function e(e){t=e,o.source=e,Y(n,function(t,n){h.nextTick(function(){e.promiseDispatch.apply(e,n)})},void 0),n=void 0,r=void 0}var t,n=[],r=[],i=te(p.prototype),o=te(v.prototype);if(o.promiseDispatch=function(e,i,o){var a=V(arguments);n?(n.push(a),"when"===i&&o[1]&&r.push(o[1])):h.nextTick(function(){t.promiseDispatch.apply(t,a)})},o.valueOf=function(){if(n)return o;var e=g(t);return b(e)&&(t=e),e},o.inspect=function(){return t?t.inspect():{state:"pending"}},h.longStackSupport&&F)try{throw new Error}catch(a){o.stack=a.stack.substring(a.stack.indexOf("\n")+1)}return i.promise=o,i.resolve=function(n){t||e(h(n))},i.fulfill=function(n){t||e(O(n))},i.reject=function(n){t||e(T(n))},i.notify=function(e){t||Y(r,function(t,n){h.nextTick(function(){n(e)})},void 0)},i}function d(e){if("function"!=typeof e)throw new TypeError("resolver must be a function.");var t=p();try{e(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}return t.promise}function y(e){return d(function(t,n){for(var r=0,i=e.length;i>r;r++)h(e[r]).then(t,n)})}function v(e,t,n){void 0===t&&(t=function(e){return T(new Error("Promise does not support operation: "+e))}),void 0===n&&(n=function(){return{state:"unknown"}});var r=te(v.prototype);if(r.promiseDispatch=function(n,i,o){var a;try{a=e[i]?e[i].apply(r,o):t.call(r,i,o)}catch(s){a=T(s)}n&&n(a)},r.inspect=n,n){var i=n();"rejected"===i.state&&(r.exception=i.reason),r.valueOf=function(){var e=n();return"pending"===e.state||"rejected"===e.state?r:e.value}}return r}function _(e,t,n,r){return h(e).then(t,n,r)}function g(e){if(b(e)){var t=e.inspect();if("fulfilled"===t.state)return t.value}return e}function b(e){return e instanceof v}function m(e){return r(e)&&"function"==typeof e.then}function k(e){return b(e)&&"pending"===e.inspect().state}function w(e){return!b(e)||"fulfilled"===e.inspect().state}function S(e){return b(e)&&"rejected"===e.inspect().state}function x(){ae.length=0,se.length=0,ce||(ce=!0)}function E(e,n){ce&&("object"==typeof t&&"function"==typeof t.emit&&h.nextTick.runAfter(function(){-1!==Z(se,e)&&(t.emit("unhandledRejection",n,e),ue.push(e))}),se.push(e),n&&"undefined"!=typeof n.stack?ae.push(n.stack):ae.push("(no stack) "+n))}function C(e){if(ce){var n=Z(se,e);-1!==n&&("object"==typeof t&&"function"==typeof t.emit&&h.nextTick.runAfter(function(){var r=Z(ue,e);-1!==r&&(t.emit("rejectionHandled",ae[n],e),ue.splice(r,1))}),se.splice(n,1),ae.splice(n,1))}}function T(e){var t=v({when:function(t){return t&&C(this),t?t(e):this}},function(){return this},function(){return{state:"rejected",reason:e}});return E(t,e),t}function O(e){return v({when:function(){return e},get:function(t){return e[t]},set:function(t,n){e[t]=n},"delete":function(t){delete e[t]},post:function(t,n){return null===t||void 0===t?e.apply(void 0,n):e[t].apply(e,n)},apply:function(t,n){return e.apply(t,n)},keys:function(){return re(e)}},void 0,function(){return{state:"fulfilled",value:e}})}function P(e){var t=p();return h.nextTick(function(){try{e.then(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}}),t.promise}function I(e){return v({isDef:function(){}},function(t,n){return R(e,t,n)},function(){return h(e).inspect()})}function j(e,t,n){return h(e).spread(t,n)}function M(e){return function(){function t(e,t){var a;if("undefined"==typeof StopIteration){try{a=n[e](t)}catch(s){return T(s)}return a.done?h(a.value):_(a.value,r,o)}try{a=n[e](t)}catch(s){return i(s)?h(s.value):T(s)}return _(a,r,o)}var n=e.apply(this,arguments),r=t.bind(t,"next"),o=t.bind(t,"throw");return r()}}function K(e){h.done(h.async(e)())}function D(e){throw new X(e)}function A(e){return function(){return j([this,B(arguments)],function(t,n){return e.apply(t,n)})}}function R(e,t,n){return h(e).dispatch(t,n)}function B(e){return _(e,function(e){var t=0,n=p();return Y(e,function(r,i,o){var a;b(i)&&"fulfilled"===(a=i.inspect()).state?e[o]=a.value:(++t,_(i,function(r){e[o]=r,0===--t&&n.resolve(e)},n.reject,function(e){n.notify({index:o,value:e})}))},void 0),0===t&&n.resolve(e),n.promise})}function U(e){if(0===e.length)return h.resolve();var t=h.defer(),n=0;return Y(e,function(r,i,o){function a(e){t.resolve(e)}function s(){n--,0===n&&t.reject(new Error("Can't get fulfillment value from any promise, all promises were rejected."))}function u(e){t.notify({index:o,value:e})}var c=e[o];n++,_(c,a,s,u)},void 0),t.promise}function H(e){return _(e,function(e){return e=ee(e,h),_(B(ee(e,function(e){return _(e,J,J)})),function(){return e})})}function L(e){return h(e).allSettled()}function N(e,t){return h(e).then(void 0,void 0,t)}function G(e,t){return h(e).nodeify(t)}var F=!1;try{throw new Error}catch(z){F=!!z.stack}var q,X,Q=l(),J=function(){},W=function(){function e(){for(var e,t;i.next;)i=i.next,e=i.task,i.task=void 0,t=i.domain,t&&(i.domain=void 0,t.enter()),r(e,t);for(;c.length;)e=c.pop(),r(e);a=!1}function r(t,n){try{t()}catch(r){if(u)throw n&&n.exit(),setTimeout(e,0),n&&n.enter(),r;setTimeout(function(){throw r},0)}n&&n.exit()}var i={task:void 0,next:null},o=i,a=!1,s=void 0,u=!1,c=[];if(W=function(e){o=o.next={task:e,domain:u&&t.domain,next:null},a||(a=!0,s())},"object"==typeof t&&"[object process]"===t.toString()&&t.nextTick)u=!0,s=function(){t.nextTick(e)};else if("function"==typeof n)s="undefined"!=typeof window?n.bind(window,e):function(){n(e)};else if("undefined"!=typeof MessageChannel){var l=new MessageChannel;l.port1.onmessage=function(){s=f,l.port1.onmessage=e,e()};var f=function(){l.port2.postMessage(0)};s=function(){setTimeout(e,0),f()}}else s=function(){setTimeout(e,0)};return W.runAfter=function(e){c.push(e),a||(a=!0,s())},W}(),$=Function.call,V=e(Array.prototype.slice),Y=e(Array.prototype.reduce||function(e,t){var n=0,r=this.length;if(1===arguments.length)for(;;){if(n in this){t=this[n++];break}if(++n>=r)throw new TypeError}for(;r>n;n++)n in this&&(t=e(t,this[n],n));return t}),Z=e(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),ee=e(Array.prototype.map||function(e,t){var n=this,r=[];return Y(n,function(i,o,a){r.push(e.call(t,o,a,n))},void 0),r}),te=Object.create||function(e){function t(){}return t.prototype=e,new t},ne=e(Object.prototype.hasOwnProperty),re=Object.keys||function(e){var t=[];for(var n in e)ne(e,n)&&t.push(n);return t},ie=e(Object.prototype.toString);X="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e};var oe="From previous event:";h.resolve=h,h.nextTick=W,h.longStackSupport=!1,"object"==typeof t&&t&&t.env&&t.env.Q_DEBUG&&(h.longStackSupport=!0),h.defer=p,p.prototype.makeNodeResolver=function(){var e=this;return function(t,n){t?e.reject(t):arguments.length>2?e.resolve(V(arguments,1)):e.resolve(n)}},h.Promise=d,h.promise=d,d.race=y,d.all=B,d.reject=T,d.resolve=h,h.passByCopy=function(e){return e},v.prototype.passByCopy=function(){return this},h.join=function(e,t){return h(e).join(t)},v.prototype.join=function(e){return h([this,e]).spread(function(e,t){if(e===t)return e;throw new Error("Can't join: not the same: "+e+" "+t)})},h.race=y,v.prototype.race=function(){return this.then(h.race)},h.makePromise=v,v.prototype.toString=function(){return"[object Promise]"},v.prototype.then=function(e,t,n){function r(t){try{return"function"==typeof e?e(t):t}catch(n){return T(n)}}function i(e){if("function"==typeof t){o(e,s);try{return t(e)}catch(n){return T(n)}}return T(e)}function a(e){return"function"==typeof n?n(e):e}var s=this,u=p(),c=!1;return h.nextTick(function(){s.promiseDispatch(function(e){c||(c=!0,u.resolve(r(e)))},"when",[function(e){c||(c=!0,u.resolve(i(e)))}])}),s.promiseDispatch(void 0,"when",[void 0,function(e){var t,n=!1;try{t=a(e)}catch(r){if(n=!0,!h.onerror)throw r;h.onerror(r)}n||u.notify(t)}]),u.promise},h.tap=function(e,t){return h(e).tap(t)},v.prototype.tap=function(e){return e=h(e),this.then(function(t){return e.fcall(t).thenResolve(t)})},h.when=_,v.prototype.thenResolve=function(e){return this.then(function(){return e})},h.thenResolve=function(e,t){return h(e).thenResolve(t)},v.prototype.thenReject=function(e){return this.then(function(){throw e})},h.thenReject=function(e,t){return h(e).thenReject(t)},h.nearer=g,h.isPromise=b,h.isPromiseAlike=m,h.isPending=k,v.prototype.isPending=function(){return"pending"===this.inspect().state},h.isFulfilled=w,v.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},h.isRejected=S,v.prototype.isRejected=function(){
return"rejected"===this.inspect().state};var ae=[],se=[],ue=[],ce=!0;h.resetUnhandledRejections=x,h.getUnhandledReasons=function(){return ae.slice()},h.stopUnhandledRejectionTracking=function(){x(),ce=!1},x(),h.reject=T,h.fulfill=O,h.master=I,h.spread=j,v.prototype.spread=function(e,t){return this.all().then(function(t){return e.apply(void 0,t)},t)},h.async=M,h.spawn=K,h["return"]=D,h.promised=A,h.dispatch=R,v.prototype.dispatch=function(e,t){var n=this,r=p();return h.nextTick(function(){n.promiseDispatch(r.resolve,e,t)}),r.promise},h.get=function(e,t){return h(e).dispatch("get",[t])},v.prototype.get=function(e){return this.dispatch("get",[e])},h.set=function(e,t,n){return h(e).dispatch("set",[t,n])},v.prototype.set=function(e,t){return this.dispatch("set",[e,t])},h.del=h["delete"]=function(e,t){return h(e).dispatch("delete",[t])},v.prototype.del=v.prototype["delete"]=function(e){return this.dispatch("delete",[e])},h.mapply=h.post=function(e,t,n){return h(e).dispatch("post",[t,n])},v.prototype.mapply=v.prototype.post=function(e,t){return this.dispatch("post",[e,t])},h.send=h.mcall=h.invoke=function(e,t){return h(e).dispatch("post",[t,V(arguments,2)])},v.prototype.send=v.prototype.mcall=v.prototype.invoke=function(e){return this.dispatch("post",[e,V(arguments,1)])},h.fapply=function(e,t){return h(e).dispatch("apply",[void 0,t])},v.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])},h["try"]=h.fcall=function(e){return h(e).dispatch("apply",[void 0,V(arguments,1)])},v.prototype.fcall=function(){return this.dispatch("apply",[void 0,V(arguments)])},h.fbind=function(e){var t=h(e),n=V(arguments,1);return function(){return t.dispatch("apply",[this,n.concat(V(arguments))])}},v.prototype.fbind=function(){var e=this,t=V(arguments);return function(){return e.dispatch("apply",[this,t.concat(V(arguments))])}},h.keys=function(e){return h(e).dispatch("keys",[])},v.prototype.keys=function(){return this.dispatch("keys",[])},h.all=B,v.prototype.all=function(){return B(this)},h.any=U,v.prototype.any=function(){return U(this)},h.allResolved=f(H,"allResolved","allSettled"),v.prototype.allResolved=function(){return H(this)},h.allSettled=L,v.prototype.allSettled=function(){return this.then(function(e){return B(ee(e,function(e){function t(){return e.inspect()}return e=h(e),e.then(t,t)}))})},h.fail=h["catch"]=function(e,t){return h(e).then(void 0,t)},v.prototype.fail=v.prototype["catch"]=function(e){return this.then(void 0,e)},h.progress=N,v.prototype.progress=function(e){return this.then(void 0,void 0,e)},h.fin=h["finally"]=function(e,t){return h(e)["finally"](t)},v.prototype.fin=v.prototype["finally"]=function(e){return e=h(e),this.then(function(t){return e.fcall().then(function(){return t})},function(t){return e.fcall().then(function(){throw t})})},h.done=function(e,t,n,r){return h(e).done(t,n,r)},v.prototype.done=function(e,n,r){var i=function(e){h.nextTick(function(){if(o(e,a),!h.onerror)throw e;h.onerror(e)})},a=e||n||r?this.then(e,n,r):this;"object"==typeof t&&t&&t.domain&&(i=t.domain.bind(i)),a.then(void 0,i)},h.timeout=function(e,t,n){return h(e).timeout(t,n)},v.prototype.timeout=function(e,t){var n=p(),r=setTimeout(function(){t&&"string"!=typeof t||(t=new Error(t||"Timed out after "+e+" ms"),t.code="ETIMEDOUT"),n.reject(t)},e);return this.then(function(e){clearTimeout(r),n.resolve(e)},function(e){clearTimeout(r),n.reject(e)},n.notify),n.promise},h.delay=function(e,t){return void 0===t&&(t=e,e=void 0),h(e).delay(t)},v.prototype.delay=function(e){return this.then(function(t){var n=p();return setTimeout(function(){n.resolve(t)},e),n.promise})},h.nfapply=function(e,t){return h(e).nfapply(t)},v.prototype.nfapply=function(e){var t=p(),n=V(e);return n.push(t.makeNodeResolver()),this.fapply(n).fail(t.reject),t.promise},h.nfcall=function(e){var t=V(arguments,1);return h(e).nfapply(t)},v.prototype.nfcall=function(){var e=V(arguments),t=p();return e.push(t.makeNodeResolver()),this.fapply(e).fail(t.reject),t.promise},h.nfbind=h.denodeify=function(e){var t=V(arguments,1);return function(){var n=t.concat(V(arguments)),r=p();return n.push(r.makeNodeResolver()),h(e).fapply(n).fail(r.reject),r.promise}},v.prototype.nfbind=v.prototype.denodeify=function(){var e=V(arguments);return e.unshift(this),h.denodeify.apply(void 0,e)},h.nbind=function(e,t){var n=V(arguments,2);return function(){function r(){return e.apply(t,arguments)}var i=n.concat(V(arguments)),o=p();return i.push(o.makeNodeResolver()),h(r).fapply(i).fail(o.reject),o.promise}},v.prototype.nbind=function(){var e=V(arguments,0);return e.unshift(this),h.nbind.apply(void 0,e)},h.nmapply=h.npost=function(e,t,n){return h(e).npost(t,n)},v.prototype.nmapply=v.prototype.npost=function(e,t){var n=V(t||[]),r=p();return n.push(r.makeNodeResolver()),this.dispatch("post",[e,n]).fail(r.reject),r.promise},h.nsend=h.nmcall=h.ninvoke=function(e,t){var n=V(arguments,2),r=p();return n.push(r.makeNodeResolver()),h(e).dispatch("post",[t,n]).fail(r.reject),r.promise},v.prototype.nsend=v.prototype.nmcall=v.prototype.ninvoke=function(e){var t=V(arguments,1),n=p();return t.push(n.makeNodeResolver()),this.dispatch("post",[e,t]).fail(n.reject),n.promise},h.nodeify=G,v.prototype.nodeify=function(e){return e?void this.then(function(t){h.nextTick(function(){e(null,t)})},function(t){h.nextTick(function(){e(t)})}):this},h.noConflict=function(){throw new Error("Q.noConflict only works when Q is used as a global")};var le=l();return h})}).call(t,n(43),n(44).setImmediate)},function(e,t){function n(){c=!1,a.length?u=a.concat(u):l=-1,u.length&&r()}function r(){if(!c){var e=setTimeout(n);c=!0;for(var t=u.length;t;){for(a=u,u=[];++l<t;)a&&a[l].run();l=-1,t=u.length}a=null,c=!1,clearTimeout(e)}}function i(e,t){this.fun=e,this.array=t}function o(){}var a,s=e.exports={},u=[],c=!1,l=-1;s.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new i(e,t)),1!==u.length||c||setTimeout(r,0)},i.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=o,s.addListener=o,s.once=o,s.off=o,s.removeListener=o,s.removeAllListeners=o,s.emit=o,s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},function(e,t,n){(function(e,r){function i(e,t){this._id=e,this._clearFn=t}var o=n(43).nextTick,a=Function.prototype.apply,s=Array.prototype.slice,u={},c=0;t.setTimeout=function(){return new i(a.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new i(a.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},t.setImmediate="function"==typeof e?e:function(e){var n=c++,r=arguments.length<2?!1:s.call(arguments,1);return u[n]=!0,o(function(){u[n]&&(r?e.apply(null,r):e.call(null),t.clearImmediate(n))}),n},t.clearImmediate="function"==typeof r?r:function(e){delete u[e]}}).call(t,n(44).setImmediate,n(44).clearImmediate)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(19),s=(r(a),n(29)),u=(r(s),n(27)),c=(r(u),n(28)),l=r(c),f=n(30),h=r(f),p=function(){function e(t){var n=t.networking,r=t.config,o=t.keychain,a=t.error,s=t.hmac_SHA256;i(this,e),this._networking=n,this._keychain=o,this._config=r,this._error=a,this._hmac_SHA256=s}return o(e,[{key:"revoke",value:function(e,t){e.read=!1,e.write=!1,SELF.grant(e,callback)}},{key:"grant",value:function(e,t){var n=e.callback||t,r=e.error||function(){},i=e.channel||e.channels,o=e.channel_group,a=e.ttl,s=e.read?"1":"0",u=e.write?"1":"0",c=e.manage?"1":"0",f=e.auth_key||e.auth_keys;if(!n)return this._error("Missing Callback");if(!this._keychain.getSubscribeKey())return this._error("Missing Subscribe Key");if(!this._keychain.getPublishKey())return this._error("Missing Publish Key");if(!this._keychain.getSecretKey())return this._error("Missing Secret Key");var p=Math.floor((new Date).getTime()/1e3),d=this._keychain.getSubscribeKey()+"\n"+this._keychain.getPublishKey()+"\ngrant\n",y={w:u,r:s,timestamp:p};e.manage&&(y.m=c),h["default"].isArray(i)&&(i=i.join(",")),h["default"].isArray(f)&&(f=f.join(",")),"undefined"!=typeof i&&null!==i&&i.length>0&&(y.channel=i),"undefined"!=typeof o&&null!==o&&o.length>0&&(y["channel-group"]=o),(a||0===a)&&(y.ttl=a),f&&(y.auth=f),y=this._networking.prepareParams(y),f||delete y.auth,d+=h["default"]._get_pam_sign_input_from_params(y);var v=this._hmac_SHA256(d,this._keychain.getSecretKey());v=v.replace(/\+/g,"-"),v=v.replace(/\//g,"_"),y.signature=v,this._networking.performGrant({data:y,success:function(e){l["default"].callback(e,n,r)},fail:function(e){l["default"].error(e,r)}})}},{key:"audit",value:function(e,t){var n=e.callback||t,r=e.error||function(){},i=e.channel,o=e.channel_group,a=e.auth_key;if(!n)return this._error("Missing Callback");if(!this._keychain.getSubscribeKey())return this._error("Missing Subscribe Key");if(!this._keychain.getPublishKey())return this._error("Missing Publish Key");if(!this._keychain.getSecretKey())return this._error("Missing Secret Key");var s=Math.floor((new Date).getTime()/1e3),u=this._keychain.getSubscribeKey()+"\n"+this._keychain.getPublishKey()+"\naudit\n",c={timestamp:s};"undefined"!=typeof i&&null!==i&&i.length>0&&(c.channel=i),"undefined"!=typeof o&&null!==o&&o.length>0&&(c["channel-group"]=o),a&&(c.auth=a),c=this._networking.prepareParams(c),a||delete c.auth,u+=h["default"]._get_pam_sign_input_from_params(c);var f=this._hmac_SHA256(u,this._keychain.getSecretKey());f=f.replace(/\+/g,"-"),f=f.replace(/\//g,"_"),c.signature=f,this._networking.performAudit({data:c,success:function(e){l["default"].callback(e,n,r)},fail:function(e){l["default"].error(e,r)}})}}]),e}();t["default"]=p},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(19),s=(r(a),n(36)),u=r(s),c=n(28),l=r(c),f=n(30),h=r(f),p=function(){function e(t){var n=t.networking;i(this,e),this._networking=n,this._r=new l["default"]("#endpoints/history"),this._l=u["default"].getLogger("#endpoints/history")}return o(e,[{key:"channelGroup",value:function(e,t){var n=e.channelGroup,r=e.channels||e.channel,i="",o={},a=e.mode||"add";if(n){var s=n.split(":");i=s.length>1?s[1]:s[0]}r&&(h["default"].isArray(r)&&(r=r.join(",")),o[a]=r),this._networking.performChannelGroupOperation(i,a,o,t)}},{key:"listChannels",value:function(e,t){return e.channelGroup?void this.channelGroup(e,t):t(this._r.validationError("Missing Channel Group"))}},{key:"removeGroup",value:function(e,t){var n="Use channel_group_remove_channel if you want to remove a channel from a group.";return e.channelGroup?e.channel?t(this._r.validationError(n)):(e.mode="remove",void this.channelGroup(e,t)):t(this._r.validationError("Missing Channel Group"))}},{key:"listGroups",value:function(e,t){this.channelGroup(e,t)}},{key:"addChannel",value:function(e,t){return e.channelGroup?e.channel||e.channels?void this.channelGroup(e,t):t(this._r.validationError("Missing Channel")):t(this._r.validationError("Missing Channel Group"))}},{key:"removeChannel",value:function(e,t){return e.channelGroup?e.channel||e.channels?(e.mode="remove",void this.channelGroup(e,t)):t(this._r.validationError("Missing Channel")):t(this._r.validationError("Missing Channel Group"))}}]),e}();t["default"]=p},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(19),u=(r(s),n(29)),c=(r(u),n(27)),l=(r(c),n(32)),f=(r(l),n(33)),h=(r(f),n(35)),p=(r(h),n(28)),d=r(p),y=n(30),v=r(y),_=n(31),g=r(_),b=function(){function e(t){var n=t.networking,r=t.config,o=t.keychain,a=t.presenceEndpoints,s=t.publishQueue,u=t.state,c=t.error;i(this,e),this._networking=n,this._config=r,this._keychain=o,this._state=u,this._error=c,this._presence=a,this._publishQueue=s}return a(e,[{key:"subscribe",value:function(e,t,n){var r=this,i=e.channel,o=e.channel_group,a=(e.timetoken||0,e.cipher_key);e.timeout||SUB_TIMEOUT,e.windowing||SUB_WINDOWING;if(!i&&!o)return this._error("Missing Channel");if(!t)return this._error("Missing Callback");if(!this._keychain.getSubscribeKey())return this._error("Missing Subscribe Key");if(i){var s=(i.join?i.join(","):""+i).split(",");v["default"].each(s,function(e){r.__subscribeToChannel(e,a,t,n)})}if(o){var u=(o.join?o.join(","):""+o).split(",");v["default"].each(u,function(e){r.__subscribeToChannelGroup(e,a,t,n)})}}},{key:"__restartSubscribeLoop",value:function(){var e=this._state.generate_channel_list().join(","),t=stateStorage.generate_channel_group_list().join(",");if(e||t){e||(e=","),_reset_offline();var n=networking.prepareParams({uuid:keychain.getUUID(),auth:keychain.getAuthKey()});t&&(n["channel-group"]=t);var r=JSON.stringify(stateStorage.getPresenceState());r.length>2&&(n.state=JSON.stringify(stateStorage.getPresenceState())),config.getPresenceTimeout()&&(n.heartbeat=config.getPresenceTimeout()),config.isInstanceIdEnabled()&&(n.instanceid=keychain.getInstanceId()),SUB_RECEIVER=xdr({timeout:sub_timeout,fail:function(e){e&&e.error&&e.service?(d["default"].error(e,SUB_ERROR),_test_connection(!1)):SELF.time(function(t){!t&&d["default"].error(e,SUB_ERROR),_test_connection(t)})},data:networking.prepareParams(n),url:[networking.getSubscribeOrigin(),"subscribe",keychain.getSubscribeKey(),v["default"].encode(e),0,TIMETOKEN],success:function(e){if(!e||"object"==("undefined"==typeof e?"undefined":o(e))&&"error"in e&&e.error)return SUB_ERROR(e),v["default"].timeout(CONNECT,g["default"].SECOND);TIMETOKEN=!TIMETOKEN&&SUB_RESTORE&&db.get(keychain.getSubscribeKey())||e[1];var t=v["default"].detect_latency(+e[1]);v["default"].each(e[0],function(n){var r=next_callback(),i=decrypt(n,stateStorage.getChannel(r[1])?stateStorage.getChannel(r[1]).cipher_key:null);r[0]&&r[0](i,e,r[2]||r[1],t,r[1])}),v["default"].timeout(_connect,windowing)}})}}},{key:"__subscribeToChannel",value:function(e,t,n,r){this._state.addChannel(e,{name:e,subscribed:1,callback:n,cipher_key:t}),r&&this._state.addChannel(e,{name:e+g["default"].PRESENCE_SUFFIX,subscribed:1,callback:r})}},{key:"__subscribeToChannelGroup",value:function(e,t,n,r){this._state.addChannelGroup(e,{name:e,subscribed:1,callback:n,cipher_key:t}),r&&this._state.addChannel(e,{name:e+g["default"].PRESENCE_SUFFIX,subscribed:1,callback:r})}},{key:"performUnsubscribe",value:function(e,t){var n=e.channel,r=e.channel_group,i=e.auth_key||this._keychain.getAuthKey(),o=t||e.callback||function(){},a=e.error||function(){};if(!n&&!r)return this._error("Missing Channel or Channel Group");if(!this._keychain.getSubscribeKey())return this._error("Missing Subscribe Key");if(n){var s=v["default"].isArray(n)?n:(""+n).split(","),u=[],c=[];if(v["default"].each(s,function(e){this._state.getChannel(e)&&u.push(e)}),0===u.length)return void o({action:"leave"});v["default"].each(u,function(e){c.push(e+g["default"].PRESENCE_SUFFIX)}),v["default"].each(u.concat(c),function(e){this._state.containsChannel(e)&&this._state.removeChannel(e),this._state.isInPresenceState(e)&&this._state.removeFromPresenceState(e)}),this._presence.announceChannelLeave(u.join(","),i,o,a)}if(r){var l=v["default"].isArray(r)?r:(""+r).split(","),f=[],h=[];if(v["default"].each(l,function(e){this._state.getChannelGroup(e)&&f.push(e)}),0===f.length)return void o({action:"leave"});v["default"].each(f,function(e){h.push(e+g["default"].PRESENCE_SUFFIX)}),v["default"].each(f.concat(h),function(e){this._state.containsChannelGroup(e)&&this._state.removeChannelGroup(e),this._state.isInPresenceState(e)&&this._state.removeFromPresenceState(e)}),this._presence.announceChannelGroupLeave(f.join(","),i,o,a)}}}]),e}();t["default"]=b},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(33),s=(r(a),n(28)),u=r(s),c=n(36),l=r(c),f=function(){function e(t){var n=t.encrypt,r=t.publishQueue;i(this,e),this._encrypt=n,this._publishQueue=r,this._r=new u["default"]("#endpoints/publish"),this._l=l["default"].getLogger("#endpoints/publish")}return o(e,[{key:"publish",value:function(e,t){var n=e.message,r=e.channel,i=e.cipherKey,o=e.sendByPost,a=void 0===o?!1:o,s=e.storeInHistory,u=void 0===s?!0:s;if(!n)return t(this._r.validationError("Missing Message"));if(!r)return t(this._r.validationError("Missing Channel"));var c={},l=this._publishQueue.newQueueable();u||(c.store="0"),l.payload=JSON.stringify(this._encrypt(n,i)),l.channel=r,l.params=c,l.httpMethod=a?"POST":"GET",l.callback=t,this._publishQueue.queueItem(l)}}]),e}();t["default"]=f},function(e,t){e.exports={name:"pubnub",preferGlobal:!1,version:"4.0.0-beta1",author:"PubNub <support@pubnub.com>",description:"Publish & Subscribe Real-time Messaging with PubNub",contributors:[{name:"Stephen Blum",email:"stephen@pubnub.com"}],bin:{},scripts:{test:"grunt test --force"},main:"./node.js/pubnub.js",browser:"./modern/dist/pubnub.js",repository:{type:"git",url:"git://github.com/pubnub/javascript.git"},keywords:["cloud","publish","subscribe","websockets","comet","bosh","xmpp","real-time","messaging"],dependencies:{agentkeepalive:"~0.2","event-emitter":"^0.3.4",lodash:"^4.1.0",loglevel:"^1.4.0",q:"^1.4.1","sinon-as-promised":"^4.0.0",superagent:"^1.8.0",uuid:"^2.0.1"},noAnalyze:!1,devDependencies:{"babel-core":"^6.6.5","babel-eslint":"5.0.0","babel-plugin-transform-class-properties":"^6.6.0","babel-plugin-transform-flow-strip-types":"^6.6.5","babel-preset-es2015":"^6.6.0","babel-register":"^6.6.5",chai:"^3.5.0","chai-as-promised":"^5.2.0",eslint:"2.2.0","eslint-config-airbnb":"6.0.2","eslint-plugin-flowtype":"2.1.0","eslint-plugin-mocha":"2.0.0","eslint-plugin-react":"4.1.0","flow-bin":"^0.22.1",gulp:"^3.9.1","gulp-babel":"^6.1.2","gulp-clean":"^0.3.2","gulp-exec":"^2.1.2","gulp-flowtype":"^0.4.9","gulp-mocha":"^2.2.0","gulp-rename":"^1.2.2","gulp-webpack":"^1.5.0","imports-loader":"0.6.5","json-loader":"0.5.4",karma:"0.13.21","karma-chai":"0.1.0","karma-mocha":"^0.2.2","karma-phantomjs-launcher":"1.0.0","karma-spec-reporter":"0.0.24",mocha:"2.4.5","node-uuid":"1.4.7","phantomjs-prebuilt":"2.1.4",proxyquire:"1.7.4","run-sequence":"^1.1.5",sinon:"^1.17.3","uglify-js":"^2.6.2",underscore:"1.7.0",webpack:"^1.12.14","webpack-dev-server":"1.14.1"},bundleDependencies:[],license:"MIT",engine:{node:">=0.8"}}},function(e,t,n){function r(){function e(e){return i.SHA256(e).toString(i.enc.Hex)}function t(e){return e=e||{},e.hasOwnProperty("encryptKey")||(e.encryptKey=f.encryptKey),e.hasOwnProperty("keyEncoding")||(e.keyEncoding=f.keyEncoding),e.hasOwnProperty("keyLength")||(e.keyLength=f.keyLength),e.hasOwnProperty("mode")||(e.mode=f.mode),-1==u.indexOf(e.keyEncoding.toLowerCase())&&(e.keyEncoding=f.keyEncoding),-1==c.indexOf(parseInt(e.keyLength,10))&&(e.keyLength=f.keyLength),-1==l.indexOf(e.mode.toLowerCase())&&(e.mode=f.mode),e}function n(e,t){return"base64"===t.keyEncoding?i.enc.Base64.parse(e):"hex"===t.keyEncoding?i.enc.Hex.parse(e):e}function r(t,r){return t=n(t,r),r.encryptKey?i.enc.Utf8.parse(e(t).slice(0,32)):t}function o(e){return"ecb"===e.mode?i.mode.ECB:i.mode.CBC}function a(e){return"cbc"===e.mode?i.enc.Utf8.parse(s):null}var s="0123456789012345",u=["hex","utf8","base64","binary"],c=[128,256],l=["ecb","cbc"],f={encryptKey:!0,keyEncoding:"utf8",keyLength:256,mode:"cbc"};return{encrypt:function(e,n,s){if(!n)return e;s=t(s);var u=a(s),c=o(s),l=r(n,s),f=JSON.stringify(e),h=i.AES.encrypt(f,l,{iv:u,mode:c}).ciphertext,p=h.toString(i.enc.Base64);return p||e},decrypt:function(e,n,s){if(!n)return e;s=t(s);var u=a(s),c=o(s),l=r(n,s);try{var f=i.enc.Base64.parse(e),h=i.AES.decrypt({ciphertext:f},l,{iv:u,mode:c}).toString(i.enc.Utf8),p=JSON.parse(h);return p}catch(d){return}}}}var i=n(51);e.exports=r},function(e,t){var n=n||function(e,t){var n={},r=n.lib={},i=function(){},o=r.Base={extend:function(e){i.prototype=this;var t=new i;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=r.WordArray=o.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=n!=t?n:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes;if(e=e.sigBytes,this.clamp(),r%4)for(var i=0;e>i;i++)t[r+i>>>2]|=(n[i>>>2]>>>24-8*(i%4)&255)<<24-8*((r+i)%4);else if(65535<n.length)for(i=0;e>i;i+=4)t[r+i>>>2]=n[i>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-8*(n%4),t.length=e.ceil(n/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],r=0;t>r;r+=4)n.push(4294967296*e.random()|0);return new a.init(n,t)}}),s=n.enc={},u=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;e>r;r++){var i=t[r>>>2]>>>24-8*(r%4)&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;t>r;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-4*(r%8);return new a.init(n,t/2)}},c=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;e>r;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-8*(r%4)&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;t>r;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-8*(r%4);return new a.init(n,t)}},l=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},f=r.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,o=this.blockSize,s=i/(4*o),s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0);if(t=s*o,i=e.min(4*t,i),t){for(var u=0;t>u;u+=o)this._doProcessBlock(r,u);u=r.splice(0,t),n.sigBytes-=i}return new a.init(u,i)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});r.Hasher=f.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new h.HMAC.init(e,n).finalize(t)}}});var h=n.algo={};return n}(Math);!function(e){for(var t=n,r=t.lib,i=r.WordArray,o=r.Hasher,r=t.algo,a=[],s=[],u=function(e){return 4294967296*(e-(0|e))|0},c=2,l=0;64>l;){var f;e:{f=c;for(var h=e.sqrt(f),p=2;h>=p;p++)if(!(f%p)){f=!1;break e}f=!0}f&&(8>l&&(a[l]=u(e.pow(c,.5))),s[l]=u(e.pow(c,1/3)),l++),c++}var d=[],r=r.SHA256=o.extend({_doReset:function(){this._hash=new i.init(a.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],o=n[2],a=n[3],u=n[4],c=n[5],l=n[6],f=n[7],h=0;64>h;h++){if(16>h)d[h]=0|e[t+h];else{var p=d[h-15],y=d[h-2];d[h]=((p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3)+d[h-7]+((y<<15|y>>>17)^(y<<13|y>>>19)^y>>>10)+d[h-16]}p=f+((u<<26|u>>>6)^(u<<21|u>>>11)^(u<<7|u>>>25))+(u&c^~u&l)+s[h]+d[h],y=((r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22))+(r&i^r&o^i&o),f=l,l=c,c=u,u=a+p|0,a=o,o=i,i=r,r=p+y|0}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+o|0,n[3]=n[3]+a|0,n[4]=n[4]+u|0,n[5]=n[5]+c|0,n[6]=n[6]+l|0,n[7]=n[7]+f|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;return n[i>>>5]|=128<<24-i%32,n[(i+64>>>9<<4)+14]=e.floor(r/4294967296),n[(i+64>>>9<<4)+15]=r,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=o._createHelper(r),t.HmacSHA256=o._createHmacHelper(r)}(Math),function(){var e=n,t=e.enc.Utf8;e.algo.HMAC=e.lib.Base.extend({init:function(e,n){e=this._hasher=new e.init,"string"==typeof n&&(n=t.parse(n));var r=e.blockSize,i=4*r;n.sigBytes>i&&(n=e.finalize(n)),n.clamp();for(var o=this._oKey=n.clone(),a=this._iKey=n.clone(),s=o.words,u=a.words,c=0;r>c;c++)s[c]^=1549556828,u[c]^=909522486;o.sigBytes=a.sigBytes=i,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;return e=t.finalize(e),t.reset(),t.finalize(this._oKey.clone().concat(e))}})}(),function(){var e=n,t=e.lib.WordArray;e.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp(),e=[];for(var i=0;n>i;i+=3)for(var o=(t[i>>>2]>>>24-8*(i%4)&255)<<16|(t[i+1>>>2]>>>24-8*((i+1)%4)&255)<<8|t[i+2>>>2]>>>24-8*((i+2)%4)&255,a=0;4>a&&n>i+.75*a;a++)e.push(r.charAt(o>>>6*(3-a)&63));if(t=r.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var n=e.length,r=this._map,i=r.charAt(64);i&&(i=e.indexOf(i),-1!=i&&(n=i));for(var i=[],o=0,a=0;n>a;a++)if(a%4){var s=r.indexOf(e.charAt(a-1))<<2*(a%4),u=r.indexOf(e.charAt(a))>>>6-2*(a%4);i[o>>>2]|=(s|u)<<24-8*(o%4),o++}return t.create(i,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(e){function t(e,t,n,r,i,o,a){return e=e+(t&n|~t&r)+i+a,(e<<o|e>>>32-o)+t}function r(e,t,n,r,i,o,a){return e=e+(t&r|n&~r)+i+a,(e<<o|e>>>32-o)+t}function i(e,t,n,r,i,o,a){return e=e+(t^n^r)+i+a,(e<<o|e>>>32-o)+t}function o(e,t,n,r,i,o,a){return e=e+(n^(t|~r))+i+a,(e<<o|e>>>32-o)+t}for(var a=n,s=a.lib,u=s.WordArray,c=s.Hasher,s=a.algo,l=[],f=0;64>f;f++)l[f]=4294967296*e.abs(e.sin(f+1))|0;s=s.MD5=c.extend({_doReset:function(){this._hash=new u.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,n){for(var a=0;16>a;a++){var s=n+a,u=e[s];e[s]=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8)}var a=this._hash.words,s=e[n+0],u=e[n+1],c=e[n+2],f=e[n+3],h=e[n+4],p=e[n+5],d=e[n+6],y=e[n+7],v=e[n+8],_=e[n+9],g=e[n+10],b=e[n+11],m=e[n+12],k=e[n+13],w=e[n+14],S=e[n+15],x=a[0],E=a[1],C=a[2],T=a[3],x=t(x,E,C,T,s,7,l[0]),T=t(T,x,E,C,u,12,l[1]),C=t(C,T,x,E,c,17,l[2]),E=t(E,C,T,x,f,22,l[3]),x=t(x,E,C,T,h,7,l[4]),T=t(T,x,E,C,p,12,l[5]),C=t(C,T,x,E,d,17,l[6]),E=t(E,C,T,x,y,22,l[7]),x=t(x,E,C,T,v,7,l[8]),T=t(T,x,E,C,_,12,l[9]),C=t(C,T,x,E,g,17,l[10]),E=t(E,C,T,x,b,22,l[11]),x=t(x,E,C,T,m,7,l[12]),T=t(T,x,E,C,k,12,l[13]),C=t(C,T,x,E,w,17,l[14]),E=t(E,C,T,x,S,22,l[15]),x=r(x,E,C,T,u,5,l[16]),T=r(T,x,E,C,d,9,l[17]),C=r(C,T,x,E,b,14,l[18]),E=r(E,C,T,x,s,20,l[19]),x=r(x,E,C,T,p,5,l[20]),T=r(T,x,E,C,g,9,l[21]),C=r(C,T,x,E,S,14,l[22]),E=r(E,C,T,x,h,20,l[23]),x=r(x,E,C,T,_,5,l[24]),T=r(T,x,E,C,w,9,l[25]),C=r(C,T,x,E,f,14,l[26]),E=r(E,C,T,x,v,20,l[27]),x=r(x,E,C,T,k,5,l[28]),T=r(T,x,E,C,c,9,l[29]),C=r(C,T,x,E,y,14,l[30]),E=r(E,C,T,x,m,20,l[31]),x=i(x,E,C,T,p,4,l[32]),T=i(T,x,E,C,v,11,l[33]),C=i(C,T,x,E,b,16,l[34]),E=i(E,C,T,x,w,23,l[35]),x=i(x,E,C,T,u,4,l[36]),T=i(T,x,E,C,h,11,l[37]),C=i(C,T,x,E,y,16,l[38]),E=i(E,C,T,x,g,23,l[39]),x=i(x,E,C,T,k,4,l[40]),T=i(T,x,E,C,s,11,l[41]),C=i(C,T,x,E,f,16,l[42]),E=i(E,C,T,x,d,23,l[43]),x=i(x,E,C,T,_,4,l[44]),T=i(T,x,E,C,m,11,l[45]),C=i(C,T,x,E,S,16,l[46]),E=i(E,C,T,x,c,23,l[47]),x=o(x,E,C,T,s,6,l[48]),T=o(T,x,E,C,y,10,l[49]),C=o(C,T,x,E,w,15,l[50]),E=o(E,C,T,x,p,21,l[51]),x=o(x,E,C,T,m,6,l[52]),T=o(T,x,E,C,f,10,l[53]),C=o(C,T,x,E,g,15,l[54]),E=o(E,C,T,x,u,21,l[55]),x=o(x,E,C,T,v,6,l[56]),T=o(T,x,E,C,S,10,l[57]),C=o(C,T,x,E,d,15,l[58]),E=o(E,C,T,x,k,21,l[59]),x=o(x,E,C,T,h,6,l[60]),T=o(T,x,E,C,b,10,l[61]),C=o(C,T,x,E,c,15,l[62]),E=o(E,C,T,x,_,21,l[63]);a[0]=a[0]+x|0,a[1]=a[1]+E|0,a[2]=a[2]+C|0,a[3]=a[3]+T|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;n[i>>>5]|=128<<24-i%32;var o=e.floor(r/4294967296);for(n[(i+64>>>9<<4)+15]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),n[(i+64>>>9<<4)+14]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),t.sigBytes=4*(n.length+1),this._process(),t=this._hash,n=t.words,r=0;4>r;r++)i=n[r],n[r]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8);return t},clone:function(){var e=c.clone.call(this);return e._hash=this._hash.clone(),e}}),a.MD5=c._createHelper(s),a.HmacMD5=c._createHmacHelper(s)}(Math),function(){var e=n,t=e.lib,r=t.Base,i=t.WordArray,t=e.algo,o=t.EvpKDF=r.extend({cfg:r.extend({keySize:4,hasher:t.MD5,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=this.cfg,r=n.hasher.create(),o=i.create(),a=o.words,s=n.keySize,n=n.iterations;a.length<s;){u&&r.update(u);var u=r.update(e).finalize(t);r.reset();for(var c=1;n>c;c++)u=r.finalize(u),r.reset();o.concat(u)}return o.sigBytes=4*s,o}});e.EvpKDF=function(e,t,n){return o.create(n).compute(e,t)}}(),n.lib.Cipher||function(e){var t=n,r=t.lib,i=r.Base,o=r.WordArray,a=r.BufferedBlockAlgorithm,s=t.enc.Base64,u=t.algo.EvpKDF,c=r.Cipher=a.extend({cfg:i.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){a.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(t,n,r){return("string"==typeof n?y:d).encrypt(e,t,n,r)},decrypt:function(t,n,r){return("string"==typeof n?y:d).decrypt(e,t,n,r)}}}});r.StreamCipher=c.extend({_doFinalize:function(){
return this._process(!0)},blockSize:1});var l=t.mode={},f=function(t,n,r){var i=this._iv;i?this._iv=e:i=this._prevBlock;for(var o=0;r>o;o++)t[n+o]^=i[o]},h=(r.BlockCipherMode=i.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}})).extend();h.Encryptor=h.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize;f.call(this,e,t,r),n.encryptBlock(e,t),this._prevBlock=e.slice(t,t+r)}}),h.Decryptor=h.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize,i=e.slice(t,t+r);n.decryptBlock(e,t),f.call(this,e,t,r),this._prevBlock=i}}),l=l.CBC=h,h=(t.pad={}).Pkcs7={pad:function(e,t){for(var n=4*t,n=n-e.sigBytes%n,r=n<<24|n<<16|n<<8|n,i=[],a=0;n>a;a+=4)i.push(r);n=o.create(i,n),e.concat(n)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},r.BlockCipher=c.extend({cfg:c.cfg.extend({mode:l,padding:h}),reset:function(){c.reset.call(this);var e=this.cfg,t=e.iv,e=e.mode;if(this._xformMode==this._ENC_XFORM_MODE)var n=e.createEncryptor;else n=e.createDecryptor,this._minBufferSize=1;this._mode=n.call(e,this,t&&t.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else t=this._process(!0),e.unpad(t);return t},blockSize:4});var p=r.CipherParams=i.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),l=(t.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return e=e.salt,(e?o.create([1398893684,1701076831]).concat(e).concat(t):t).toString(s)},parse:function(e){e=s.parse(e);var t=e.words;if(1398893684==t[0]&&1701076831==t[1]){var n=o.create(t.slice(2,4));t.splice(0,4),e.sigBytes-=16}return p.create({ciphertext:e,salt:n})}},d=r.SerializableCipher=i.extend({cfg:i.extend({format:l}),encrypt:function(e,t,n,r){r=this.cfg.extend(r);var i=e.createEncryptor(n,r);return t=i.finalize(t),i=i.cfg,p.create({ciphertext:t,key:n,iv:i.iv,algorithm:e,mode:i.mode,padding:i.padding,blockSize:e.blockSize,formatter:r.format})},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),e.createDecryptor(n,r).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),t=(t.kdf={}).OpenSSL={execute:function(e,t,n,r){return r||(r=o.random(8)),e=u.create({keySize:t+n}).compute(e,r),n=o.create(e.words.slice(t),4*n),e.sigBytes=4*t,p.create({key:e,iv:n,salt:r})}},y=r.PasswordBasedCipher=d.extend({cfg:d.cfg.extend({kdf:t}),encrypt:function(e,t,n,r){return r=this.cfg.extend(r),n=r.kdf.execute(n,e.keySize,e.ivSize),r.iv=n.iv,e=d.encrypt.call(this,e,t,n.key,r),e.mixIn(n),e},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),n=r.kdf.execute(n,e.keySize,e.ivSize,t.salt),r.iv=n.iv,d.decrypt.call(this,e,t,n.key,r)}})}(),function(){for(var e=n,t=e.lib.BlockCipher,r=e.algo,i=[],o=[],a=[],s=[],u=[],c=[],l=[],f=[],h=[],p=[],d=[],y=0;256>y;y++)d[y]=128>y?y<<1:y<<1^283;for(var v=0,_=0,y=0;256>y;y++){var g=_^_<<1^_<<2^_<<3^_<<4,g=g>>>8^255&g^99;i[v]=g,o[g]=v;var b=d[v],m=d[b],k=d[m],w=257*d[g]^16843008*g;a[v]=w<<24|w>>>8,s[v]=w<<16|w>>>16,u[v]=w<<8|w>>>24,c[v]=w,w=16843009*k^65537*m^257*b^16843008*v,l[g]=w<<24|w>>>8,f[g]=w<<16|w>>>16,h[g]=w<<8|w>>>24,p[g]=w,v?(v=b^d[d[d[k^b]]],_^=d[d[_]]):v=_=1}var S=[0,1,2,4,8,16,32,64,128,27,54],r=r.AES=t.extend({_doReset:function(){for(var e=this._key,t=e.words,n=e.sigBytes/4,e=4*((this._nRounds=n+6)+1),r=this._keySchedule=[],o=0;e>o;o++)if(n>o)r[o]=t[o];else{var a=r[o-1];o%n?n>6&&4==o%n&&(a=i[a>>>24]<<24|i[a>>>16&255]<<16|i[a>>>8&255]<<8|i[255&a]):(a=a<<8|a>>>24,a=i[a>>>24]<<24|i[a>>>16&255]<<16|i[a>>>8&255]<<8|i[255&a],a^=S[o/n|0]<<24),r[o]=r[o-n]^a}for(t=this._invKeySchedule=[],n=0;e>n;n++)o=e-n,a=n%4?r[o]:r[o-4],t[n]=4>n||4>=o?a:l[i[a>>>24]]^f[i[a>>>16&255]]^h[i[a>>>8&255]]^p[i[255&a]]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,a,s,u,c,i)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,l,f,h,p,o),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,r,i,o,a,s){for(var u=this._nRounds,c=e[t]^n[0],l=e[t+1]^n[1],f=e[t+2]^n[2],h=e[t+3]^n[3],p=4,d=1;u>d;d++)var y=r[c>>>24]^i[l>>>16&255]^o[f>>>8&255]^a[255&h]^n[p++],v=r[l>>>24]^i[f>>>16&255]^o[h>>>8&255]^a[255&c]^n[p++],_=r[f>>>24]^i[h>>>16&255]^o[c>>>8&255]^a[255&l]^n[p++],h=r[h>>>24]^i[c>>>16&255]^o[l>>>8&255]^a[255&f]^n[p++],c=y,l=v,f=_;y=(s[c>>>24]<<24|s[l>>>16&255]<<16|s[f>>>8&255]<<8|s[255&h])^n[p++],v=(s[l>>>24]<<24|s[f>>>16&255]<<16|s[h>>>8&255]<<8|s[255&c])^n[p++],_=(s[f>>>24]<<24|s[h>>>16&255]<<16|s[c>>>8&255]<<8|s[255&l])^n[p++],h=(s[h>>>24]<<24|s[c>>>16&255]<<16|s[l>>>8&255]<<8|s[255&f])^n[p++],e[t]=y,e[t+1]=v,e[t+2]=_,e[t+3]=h},keySize:8});e.AES=t._createHelper(r)}(),n.mode.ECB=function(){var e=n.lib.BlockCipherMode.extend();return e.Encryptor=e.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),e.Decryptor=e.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),e}(),e.exports=n}])});