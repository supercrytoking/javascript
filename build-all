#!/bin/bash

echo $1

googleminify=$1

if [ -z "$googleminify" ]; then googleminify="/opt/minify/compiler.jar"; fi

echo -e "  "
echo -e "  USING: $googleminify TO MINIFY..."
echo -e "  COMPILING PUBNUB JAVASCRIPT API..."

## -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
## Web Build
## -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
cat ./core/json.js ./core/websocket.js ./core/pubnub.js > ./web/pubnub.js
echo "(function(){" > ./web/pubnub.min.js
java -jar $googleminify --js=./web/pubnub.js --compilation_level=ADVANCED_OPTIMIZATIONS >> ./web/pubnub.min.js
echo "})();" >> ./web/pubnub.min.js
echo -e "  >>COMPRESSING<< PUBNUB JAVASCRIPT API..."
cat ./web/pubnub.min.js | gzip -c9 > ./web/pubnub.min.js.gz
echo -e "  "
echo -e "  DONE WEB BUILD!\n"
