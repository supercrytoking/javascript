{"version":3,"sources":["core/endpoints/publish.js"],"names":[],"mappings":"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","file":"core/endpoints/publish.js","sourcesContent":["/* @flow */\n\nimport { PublishResponse, PublishArguments } from '../flow_interfaces';\n\nfunction prepareMessagePayload(modules, messagePayload) {\n  const { crypto, config } = modules;\n  let stringifiedPayload = JSON.stringify(messagePayload);\n\n  if (config.cipherKey) {\n    stringifiedPayload = crypto.encrypt(stringifiedPayload);\n    stringifiedPayload = JSON.stringify(stringifiedPayload);\n  }\n\n  return stringifiedPayload;\n}\n\nexport function getOperation(): string {\n  return 'PNPublishOperation';\n}\n\nexport function validateParams(modules, incomingParams: PublishArguments) {\n  let { message, channel } = incomingParams;\n  let { config } = modules;\n\n  if (!channel) return 'Missing Channel';\n  if (!message) return 'Missing Message';\n  if (!config.subscribeKey) return 'Missing Subscribe Key';\n}\n\nexport function usePost(modules, incomingParams) {\n  let { sendByPost = false } = incomingParams;\n  return sendByPost;\n}\n\nexport function getURL(modules, incomingParams: PublishArguments): string {\n  const { config } = modules;\n  const { channel, message } = incomingParams;\n  let stringifiedPayload = prepareMessagePayload(modules, message);\n  return '/publish/' + config.publishKey + '/' + config.subscribeKey + '/0/' + encodeURIComponent(channel) + '/0/' + encodeURIComponent(stringifiedPayload);\n}\n\nexport function postURL(modules, incomingParams: PublishArguments): string {\n  const { config } = modules;\n  const { channel } = incomingParams;\n  return '/publish/' + config.publishKey + '/' + config.subscribeKey + '/0/' + encodeURIComponent(channel) + '/0';\n}\n\nexport function postPayload(modules, incomingParams: PublishArguments): string {\n  const { message } = incomingParams;\n  return prepareMessagePayload(modules, message);\n}\n\nexport function prepareParams(modules, incomingParams: PublishArguments): Object {\n  const { meta, replicate = true, storeInHistory } = incomingParams;\n  const params = {};\n\n  if (storeInHistory != null) {\n    if (storeInHistory) {\n      params.store = '1';\n    } else {\n      params.store = '0';\n    }\n  }\n\n  if (replicate === false) {\n    params.norep = 'true';\n  }\n\n  if (meta && typeof meta === 'object') {\n    params.meta = JSON.stringify(meta);\n  }\n\n  return params;\n}\n\nexport function handleResponse(modules, serverResponse: Object): PublishResponse {\n  return { timetoken: serverResponse[2] };\n}\n"],"sourceRoot":"/source/"}