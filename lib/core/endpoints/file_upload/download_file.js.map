{"version":3,"sources":["core/endpoints/file_upload/download_file.js"],"names":["endpoint","getOperation","operationConstants","PNDownloadFileOperation","validateParams","_","params","channel","name","id","useGetFile","getFileURL","config","subscribeKey","getRequestTimeout","getTransactionTimeout","isAuthSupported","ignoreBody","forceBuffered","prepareParams","handleResponse","res","PubNubFile","cryptography","body","response","supportsEncryptFile","cipherKey","decrypt","create","data","mimeType","type"],"mappings":";;;;;;;;;;;;;AAGA;;AAGA,IAAMA,QAAgE,GAAG;AACvEC,EAAAA,YAAY,EAAE;AAAA,WAAMC,uBAAmBC,uBAAzB;AAAA,GADyD;AAGvEC,EAAAA,cAAc,EAAE,wBAACC,CAAD,EAAIC,MAAJ,EAAe;AAC7B,QAAI,EAACA,MAAD,aAACA,MAAD,uBAACA,MAAM,CAAEC,OAAT,CAAJ,EAAsB;AACpB,aAAO,wBAAP;AACD;;AAED,QAAI,EAACD,MAAD,aAACA,MAAD,uBAACA,MAAM,CAAEE,IAAT,CAAJ,EAAmB;AACjB,aAAO,qBAAP;AACD;;AAED,QAAI,EAACF,MAAD,aAACA,MAAD,uBAACA,MAAM,CAAEG,EAAT,CAAJ,EAAiB;AACf,aAAO,mBAAP;AACD;AACF,GAfsE;AAiBvEC,EAAAA,UAAU,EAAE;AAAA,WAAM,IAAN;AAAA,GAjB2D;AAmBvEC,EAAAA,UAAU,EAAE,0BAAaL,MAAb;AAAA,QAAGM,MAAH,QAAGA,MAAH;AAAA,+BACGA,MAAM,CAACC,YADV,uBACmCP,MAAM,CAACC,OAD1C,oBAC2DD,MAAM,CAACG,EADlE,cACwEH,MAAM,CAACE,IAD/E;AAAA,GAnB2D;AAsBvEM,EAAAA,iBAAiB,EAAE;AAAA,QAAGF,MAAH,SAAGA,MAAH;AAAA,WAAgBA,MAAM,CAACG,qBAAP,EAAhB;AAAA,GAtBoD;AAwBvEC,EAAAA,eAAe,EAAE;AAAA,WAAM,IAAN;AAAA,GAxBsD;AAyBvEC,EAAAA,UAAU,EAAE;AAAA,WAAM,IAAN;AAAA,GAzB2D;AA0BvEC,EAAAA,aAAa,EAAE;AAAA,WAAM,IAAN;AAAA,GA1BwD;AA4BvEC,EAAAA,aAAa,EAAE;AAAA,WAAO,EAAP;AAAA,GA5BwD;AA8BvEC,EAAAA,cAAc;AAAA,0FAAE,wBAA6CC,GAA7C,EAAkDf,MAAlD;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;AAASgB,cAAAA,UAAT,SAASA,UAAT,EAAqBV,MAArB,SAAqBA,MAArB,EAA6BW,YAA7B,SAA6BA,YAA7B;AACVC,cAAAA,IADU,GACHH,GAAG,CAACI,QAAJ,CAAaD,IADV;;AAAA,oBAGVF,UAAU,CAACI,mBAAX,IAAmCd,MAAM,CAACe,SAHhC;AAAA;AAAA;AAAA;;AAAA;AAAA,qBAICJ,YAAY,CAACK,OAAb,sBAAqBtB,MAAM,CAACqB,SAA5B,iEAAyCf,MAAM,CAACe,SAAhD,EAA2DH,IAA3D,CAJD;;AAAA;AAIZA,cAAAA,IAJY;;AAAA;AAAA,+CAOPF,UAAU,CAACO,MAAX,CAAkB;AACvBC,gBAAAA,IAAI,EAAEN,IADiB;AAEvBhB,gBAAAA,IAAI,wBAAEa,GAAG,CAACI,QAAJ,CAAajB,IAAf,mEAAuBF,MAAM,CAACE,IAFX;AAGvBuB,gBAAAA,QAAQ,EAAEV,GAAG,CAACI,QAAJ,CAAaO;AAHA,eAAlB,CAPO;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAF;;AAAA;AAAA;AAAA;;AAAA;AAAA;AA9ByD,CAAzE;eA6CehC,Q","sourcesContent":["/** @flow */\n\nimport type { EndpointConfig } from '../endpoint';\nimport operationConstants from '../../constants/operations';\nimport type { DownloadFileParams, DownloadFileResult } from './types';\n\nconst endpoint: EndpointConfig<DownloadFileParams, DownloadFileResult> = {\n  getOperation: () => operationConstants.PNDownloadFileOperation,\n\n  validateParams: (_, params) => {\n    if (!params?.channel) {\n      return \"channel can't be empty\";\n    }\n\n    if (!params?.name) {\n      return \"name can't be empty\";\n    }\n\n    if (!params?.id) {\n      return \"id can't be empty\";\n    }\n  },\n\n  useGetFile: () => true,\n\n  getFileURL: ({ config }, params) =>\n    `/v1/files/${config.subscribeKey}/channels/${params.channel}/files/${params.id}/${params.name}`,\n\n  getRequestTimeout: ({ config }) => config.getTransactionTimeout(),\n\n  isAuthSupported: () => true,\n  ignoreBody: () => true,\n  forceBuffered: () => true,\n\n  prepareParams: () => ({}),\n\n  handleResponse: async ({ PubNubFile, config, cryptography }, res, params): Promise<DownloadFileResult> => {\n    let body = res.response.body;\n\n    if (PubNubFile.supportsEncryptFile && (config.cipherKey)) {\n      body = await cryptography.decrypt(params.cipherKey ?? config.cipherKey, body);\n    }\n\n    return PubNubFile.create({\n      data: body,\n      name: res.response.name ?? params.name,\n      mimeType: res.response.type,\n    });\n  },\n};\n\nexport default endpoint;\n"],"file":"download_file.js"}