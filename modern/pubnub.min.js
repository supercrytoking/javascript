// 3.4.3
(function(){
var k=!0,l=null,n=!1;function q(){return function(){}}function x(a){return function(){return a}}var C=1,D=n,F=[],G="-pnpres",H=10,J=310,N=60,O=1E3,aa=/{([\w\-]+)}/g;function ba(){return"x"+ ++C+""+ +new Date}function P(){return+new Date}var Q,ca=Math.floor(20*Math.random());Q=function(a,b){return 0<a.indexOf("pubsub.")&&a.replace("pubsub","ps"+(b?R().split("-")[0]:20>++ca?ca:ca=1))||a};function da(a,b){function d(){f+b>P()?(clearTimeout(c),c=setTimeout(d,b)):(f=P(),a())}var c,f=0;return d}
function ea(a,b){var d=[];W(a||[],function(a){b(a)&&d.push(a)});return d}function fa(a,b){return a.replace(aa,function(a,c){return b[c]||a})}function X(a,b){return setTimeout(a,b)}function R(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}
function W(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var d=0,c=a.length;d<c;)b.call(a[d],a[d],d++);else for(d in a)a.hasOwnProperty&&a.hasOwnProperty(d)&&b.call(a[d],d,a[d])}function Y(a,b){var d=[];W(a||[],function(a,f){d.push(b(a,f))});return d}function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];W(a,function(a,c){c.f&&b.push(a)});return b.sort()}
function ga(){X(function(){D||(D=1,W(F,function(a){a()}))},O)}
function pa(a){function b(){}function d(a){a&&(r.g=0);!r.g&&r.length&&(r.g=1,t(r.shift()))}function c(a){W($(j),function(b){(b=j[b])&&a(b)})}var f=+a.windowing||H,p=(+a.timeout||J)*O,u=(+a.keepalive||N)*O,s=a.publish_key||"",g=a.subscribe_key||"",w=a.ssl?"s":"",y="http"+w+"://"+(a.origin||"pubsub.pubnub.com"),z=Q(y),S=Q(y),r=[],T=0,U=0,K=0,L=0,V=0,E=0,j={},t=a.xdr,M=a._is_online||x(1),v=a.jsonp_cb||x(0),A=a.db||{get:q(),set:q()},B=a.uuid||A&&A.get(g+"uuid")||"",e={_reset_offline:function(){K&&K(1)},
LEAVE:function(a,b){var c={uuid:B},d=Q(y),m=v();0<a.indexOf(G)||("0"!=m&&(c.callback=m),t({l:b||w,timeout:2E3,a:m,data:c,url:[d,"v2","presence","sub_key",g,"channel",Z(a),"leave"]}))},history:function(a,b){var b=a.callback||b,c=a.count||a.limit||100,d=a.reverse||"false",m=a.error||q(),e=a.channel,p=a.start,f=a.end,h={},i=v();if(!e)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");h.stringtoken="true";h.count=c;h.reverse=d;i&&(h.callback=
i);p&&(h.start=p);f&&(h.end=f);t({a:i,data:h,c:function(a){b(a)},b:m,url:[z,"v2","history","sub-key",g,"channel",Z(e)]})},replay:function(a){var b=b||a.callback||q(),c=a.source,d=a.destination,m=a.stop,e=a.start,p=a.end,f=a.reverse,a=a.limit,h=v(),i={};if(!c)return error("Missing Source Channel");if(!d)return error("Missing Destination Channel");if(!s)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");"0"!=h&&(i.callback=h);m&&(i.stop="all");f&&(i.reverse="true");e&&(i.start=
e);p&&(i.end=p);a&&(i.count=a);t({a:h,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[z,"v1","replay",s,g,c,d],data:i})},time:function(a){var b=v();t({a:b,timeout:5*O,url:[z,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){var b=b||a.callback||q(),c=a.message,I=a.channel,m=v();if(!c)return error("Missing Message");if(!I)return error("Missing Channel");if(!s)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");c=JSON.stringify(c);
I=[z,"publish",s,g,0,Z(I),m,Z(c)];r.push({a:m,timeout:5*O,url:I,data:{uuid:B},c:function(a){b(a);d(1)},b:function(){b([0,"Failed",c]);d(1)}});d()},unsubscribe:function(a){a=a.channel;E=0;L=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+G}).join(",");W(a.split(","),function(a){D&&e.LEAVE(a,0);j[a]=0});D&&b()},subscribe:function(a,la){function d(a){a?X(I,O):(z=Q(y,1),S=Q(y,1),X(function(){e.time(d)},O));c(function(b){if(a&&b.d)return b.d=0,b.j(b.name);!a&&!b.d&&(b.d=1,b.i(b.name))})}
function I(){var a=v(),b=$(j).join(",");b&&(K=t({timeout:s,a:a,b:function(){e.time(d)},data:{uuid:B},url:[S,"subscribe",g,Z(b),a,E],c:function(a){if(!a)return X(I,u);c(function(a){a.e||(a.e=1,a.h(a.name))});(E=!E&&L&&A.get(g)||a[1])&&A.set(g,a[1]);var b,ha=(2<a.length?a[2]:"").split(",");b=function(){var a=ha.shift()||"";return[(j[a]||{}).a||T,(a||U).split(G)[0]]};W(a[0],function(ha){var c=b();if(j[c[1]].f)c[0](ha,a,c[1])});X(I,u)}}))}var m=a.channel,la=(la=la||a.callback)||a.message,ka=a.connect||
q(),ma=a.reconnect||q(),r=a.disconnect||q(),h=a.presence||0,i=a.noheresync||0,s=a.timeout||p,u=a.windowing||f;a.restore&&(L=1);E=0;if(!m)return error("Missing Channel");if(!la)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");W((m.join?m.join(","):""+m).split(","),function(a){var b=j[a]||{};j[U=a]={name:a,e:b.e,d:b.d,f:1,a:T=la,h:ka,i:r,j:ma};h&&(e.subscribe({channel:a+G,callback:h}),!b.f&&!i&&e.here_now({channel:a,callback:function(b){W("uuids"in b?b.uuids:[],function(ha){h({action:"join",
uuid:ha,timestamp:P(),occupancy:b.occupancy||1},b,a)})}}))});b=function(){e._reset_offline();clearTimeout(V);V=X(I,100)};if(!D)return F.push(b);b()},here_now:function(a,b){var b=a.callback||b,c=a.error||q(),d=a.channel,m=v(),e=l;if(!d)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");"0"!=m&&(e={},e.callback=m);t({a:m,data:e,c:function(a){b(a)},b:c,url:[z,"v2","presence","sub_key",g,"channel",Z(d)]})},xdr:t,ready:ga,db:A,uuid:R,each:W,
map:Y,grep:ea,supplant:fa,now:P,unique:ba,updater:da,poll_online:function(){M()||e._reset_offline();X(e.poll_online,O)},poll_online2:function(){e.time(function(a){a||e._reset_offline();X(e.poll_online2,u)})}};B||(B=e.uuid());A.set(g+"uuid",B);X(e.poll_online,O);X(e.poll_online2,u);return e}
function qa(a){function b(a){f||(f=1,clearTimeout(u),c&&(c.onerror=c.onload=l,c.abort&&c.abort(),c=l),a&&s())}function d(){if(!p){p=1;clearTimeout(u);try{response=JSON.parse(c.responseText)}catch(a){return b(1)}g(response)}}var c,f=0,p=0,u=X(function(){b(1)},ra),s=a.b||q(),g=a.c||q();try{c="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;c.onerror=c.onabort=function(){b(1)};c.onload=c.onloadend=d;c.timeout=ra;url=a.url.join(sa);if(a.data){var w=[];url+="?";for(key in a.data)w.push(key+
"="+a.data[key]);url+=w.join(ta)}c.open("GET",url,k);c.send()}catch(y){return b(0),qa(a)}return b}function ua(a,b,d){W(a.split(","),function(a){function f(a){a||(a=window.event);d(a)||(a.cancelBubble=k,a.returnValue=n,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,f,n):b.attachEvent?b.attachEvent("on"+a,f):b["on"+a]=f})}
function va(a){a.db=wa;a.xdr=qa;var b=pa(a);b.init=va;if(a.notest)return b;ua("beforeunload",window,function(){each_channel(function(a){b.LEAVE(a.name,1)});return k});ua("offline",window,b._reset_offline);ua("offline",document,b._reset_offline);b.ready();return b}var sa="/",ta="&",ra=31E4,wa,xa="undefined"!=typeof localStorage&&localStorage;
wa={get:function(a){try{return xa?xa.getItem(a):-1==document.cookie.indexOf(a)?l:((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||l}catch(b){}},set:function(a,b){try{if(xa)return xa.setItem(a,b)&&0;document.cookie=a+"="+b+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(d){}}};"undefined"!==typeof module&&(module.m=va)||"undefined"!==typeof exports&&(exports.k=va)||(PUBNUB=va);C=1;D=n;F=[];G="-pnpres";H=10;J=310;N=60;O=1E3;aa=/{([\w\-]+)}/g;
function ba(){return"x"+ ++C+""+ +new Date}function P(){return+new Date}var ya=Math.floor(20*Math.random());Q=function(a,b){return 0<a.indexOf("pubsub.")&&a.replace("pubsub","ps"+(b?R().split("-")[0]:20>++ya?ya:ya=1))||a};function da(a,b){function d(){f+b>P()?(clearTimeout(c),c=setTimeout(d,b)):(f=P(),a())}var c,f=0;return d}function ea(a,b){var d=[];W(a||[],function(a){b(a)&&d.push(a)});return d}function fa(a,b){return a.replace(aa,function(a,c){return b[c]||a})}
function X(a,b){return setTimeout(a,b)}function R(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}function W(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var d=0,c=a.length;d<c;)b.call(a[d],a[d],d++);else for(d in a)a.hasOwnProperty&&a.hasOwnProperty(d)&&b.call(a[d],d,a[d])}function Y(a,b){var d=[];W(a||[],function(a,f){d.push(b(a,f))});return d}
function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];W(a,function(a,c){c.f&&b.push(a)});return b.sort()}function ga(){X(function(){D||(D=1,W(F,function(a){a()}))},O)}
function pa(a){function b(){}function d(a){a&&(r.g=0);!r.g&&r.length&&(r.g=1,t(r.shift()))}function c(a){W($(j),function(b){(b=j[b])&&a(b)})}var f=+a.windowing||H,p=(+a.timeout||J)*O,u=(+a.keepalive||N)*O,s=a.publish_key||"",g=a.subscribe_key||"",w=a.ssl?"s":"",y="http"+w+"://"+(a.origin||"pubsub.pubnub.com"),z=Q(y),S=Q(y),r=[],T=0,U=0,K=0,L=0,V=0,E=0,j={},t=a.xdr,M=a._is_online||x(1),v=a.jsonp_cb||x(0),A=a.db||{get:q(),set:q()},B=a.uuid||A&&A.get(g+"uuid")||"",e={_reset_offline:function(){K&&K(1)},
LEAVE:function(a,b){var c={uuid:B},d=Q(y),m=v();0<a.indexOf(G)||("0"!=m&&(c.callback=m),t({l:b||w,timeout:2E3,a:m,data:c,url:[d,"v2","presence","sub_key",g,"channel",Z(a),"leave"]}))},history:function(a,b){var b=a.callback||b,c=a.count||a.limit||100,d=a.reverse||"false",m=a.error||q(),e=a.channel,f=a.start,p=a.end,h={},i=v();if(!e)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");h.stringtoken="true";h.count=c;h.reverse=d;i&&(h.callback=
i);f&&(h.start=f);p&&(h.end=p);t({a:i,data:h,c:function(a){b(a)},b:m,url:[z,"v2","history","sub-key",g,"channel",Z(e)]})},replay:function(a){var b=b||a.callback||q(),c=a.source,d=a.destination,m=a.stop,e=a.start,f=a.end,p=a.reverse,a=a.limit,h=v(),i={};if(!c)return error("Missing Source Channel");if(!d)return error("Missing Destination Channel");if(!s)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");"0"!=h&&(i.callback=h);m&&(i.stop="all");p&&(i.reverse="true");e&&(i.start=
e);f&&(i.end=f);a&&(i.count=a);t({a:h,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[z,"v1","replay",s,g,c,d],data:i})},time:function(a){var b=v();t({a:b,timeout:5*O,url:[z,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){var b=b||a.callback||q(),c=a.message,I=a.channel,m=v();if(!c)return error("Missing Message");if(!I)return error("Missing Channel");if(!s)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");c=JSON.stringify(c);
I=[z,"publish",s,g,0,Z(I),m,Z(c)];r.push({a:m,timeout:5*O,url:I,data:{uuid:B},c:function(a){b(a);d(1)},b:function(){b([0,"Failed",c]);d(1)}});d()},unsubscribe:function(a){a=a.channel;E=0;L=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+G}).join(",");W(a.split(","),function(a){D&&e.LEAVE(a,0);j[a]=0});D&&b()},subscribe:function(a,d){function ia(a){a?X(I,O):(z=Q(y,1),S=Q(y,1),X(function(){e.time(ia)},O));c(function(b){if(a&&b.d)return b.d=0,b.j(b.name);!a&&!b.d&&(b.d=1,b.i(b.name))})}
function I(){var a=v(),b=$(j).join(",");b&&(K=t({timeout:s,a:a,b:function(){e.time(ia)},data:{uuid:B},url:[S,"subscribe",g,Z(b),a,E],c:function(a){if(!a)return X(I,u);c(function(a){a.e||(a.e=1,a.h(a.name))});(E=!E&&L&&A.get(g)||a[1])&&A.set(g,a[1]);var b,ha=(2<a.length?a[2]:"").split(",");b=function(){var a=ha.shift()||"";return[(j[a]||{}).a||T,(a||U).split(G)[0]]};W(a[0],function(ha){var c=b();if(j[c[1]].f)c[0](ha,a,c[1])});X(I,u)}}))}var m=a.channel,d=(d=d||a.callback)||a.message,ka=a.connect||
q(),ma=a.reconnect||q(),r=a.disconnect||q(),h=a.presence||0,i=a.noheresync||0,s=a.timeout||p,u=a.windowing||f;a.restore&&(L=1);E=0;if(!m)return error("Missing Channel");if(!d)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");W((m.join?m.join(","):""+m).split(","),function(a){var b=j[a]||{};j[U=a]={name:a,e:b.e,d:b.d,f:1,a:T=d,h:ka,i:r,j:ma};h&&(e.subscribe({channel:a+G,callback:h}),!b.f&&!i&&e.here_now({channel:a,callback:function(b){W("uuids"in b?b.uuids:[],function(ha){h({action:"join",
uuid:ha,timestamp:P(),occupancy:b.occupancy||1},b,a)})}}))});b=function(){e._reset_offline();clearTimeout(V);V=X(I,100)};if(!D)return F.push(b);b()},here_now:function(a,b){var b=a.callback||b,c=a.error||q(),d=a.channel,m=v(),e=l;if(!d)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");"0"!=m&&(e={},e.callback=m);t({a:m,data:e,c:function(a){b(a)},b:c,url:[z,"v2","presence","sub_key",g,"channel",Z(d)]})},xdr:t,ready:ga,db:A,uuid:R,each:W,
map:Y,grep:ea,supplant:fa,now:P,unique:ba,updater:da,poll_online:function(){M()||e._reset_offline();X(e.poll_online,O)},poll_online2:function(){e.time(function(a){a||e._reset_offline();X(e.poll_online2,u)})}};B||(B=e.uuid());A.set(g+"uuid",B);X(e.poll_online,O);X(e.poll_online2,u);return e}
function za(a){function b(a){f||(f=1,clearTimeout(u),c&&(c.onerror=c.onload=l,c.abort&&c.abort(),c=l),a&&s())}function d(){if(!p){p=1;clearTimeout(u);try{response=JSON.parse(c.responseText)}catch(a){return b(1)}g(response)}}var c,f=0,p=0,u=X(function(){b(1)},Aa),s=a.b||q(),g=a.c||q();try{c="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;c.onerror=c.onabort=function(){b(1)};c.onload=c.onloadend=d;c.timeout=Aa;url=a.url.join(Ba);if(a.data){var w=[];url+="?";for(key in a.data)w.push(key+
"="+a.data[key]);url+=w.join(Ca)}c.open("GET",url,k);c.send()}catch(y){return b(0),za(a)}return b}function Da(a,b,d){W(a.split(","),function(a){function f(a){a||(a=window.event);d(a)||(a.cancelBubble=k,a.returnValue=n,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,f,n):b.attachEvent?b.attachEvent("on"+a,f):b["on"+a]=f})}
function Ea(a){a.db=Fa;a.xdr=za;var b=pa(a);b.init=Ea;if(a.notest)return b;Da("beforeunload",window,function(){each_channel(function(a){b.LEAVE(a.name,1)});return k});Da("offline",window,b._reset_offline);Da("offline",document,b._reset_offline);b.ready();return b}var Ba="/",Ca="&",Aa=31E4,Fa,Ga="undefined"!=typeof localStorage&&localStorage;
Fa={get:function(a){try{return Ga?Ga.getItem(a):-1==document.cookie.indexOf(a)?l:((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||l}catch(b){}},set:function(a,b){try{if(Ga)return Ga.setItem(a,b)&&0;document.cookie=a+"="+b+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(d){}}};"undefined"!==typeof module&&(module.m=Ea)||"undefined"!==typeof exports&&(exports.k=Ea)||(PUBNUB=Ea);C=1;D=n;F=[];G="-pnpres";H=10;J=310;N=60;O=1E3;aa=/{([\w\-]+)}/g;
function ba(){return"x"+ ++C+""+ +new Date}function P(){return+new Date}var Ha=Math.floor(20*Math.random());Q=function(a,b){return 0<a.indexOf("pubsub.")&&a.replace("pubsub","ps"+(b?R().split("-")[0]:20>++Ha?Ha:Ha=1))||a};function da(a,b){function d(){f+b>P()?(clearTimeout(c),c=setTimeout(d,b)):(f=P(),a())}var c,f=0;return d}function ea(a,b){var d=[];W(a||[],function(a){b(a)&&d.push(a)});return d}function fa(a,b){return a.replace(aa,function(a,c){return b[c]||a})}
function X(a,b){return setTimeout(a,b)}function R(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}function W(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var d=0,c=a.length;d<c;)b.call(a[d],a[d],d++);else for(d in a)a.hasOwnProperty&&a.hasOwnProperty(d)&&b.call(a[d],d,a[d])}function Y(a,b){var d=[];W(a||[],function(a,f){d.push(b(a,f))});return d}
function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];W(a,function(a,c){c.f&&b.push(a)});return b.sort()}function ga(){X(function(){D||(D=1,W(F,function(a){a()}))},O)}
function pa(a){function b(){}function d(a){a&&(r.g=0);!r.g&&r.length&&(r.g=1,t(r.shift()))}function c(a){W($(j),function(b){(b=j[b])&&a(b)})}var f=+a.windowing||H,p=(+a.timeout||J)*O,u=(+a.keepalive||N)*O,s=a.publish_key||"",g=a.subscribe_key||"",w=a.ssl?"s":"",y="http"+w+"://"+(a.origin||"pubsub.pubnub.com"),z=Q(y),S=Q(y),r=[],T=0,U=0,K=0,L=0,V=0,E=0,j={},t=a.xdr,M=a._is_online||x(1),v=a.jsonp_cb||x(0),A=a.db||{get:q(),set:q()},B=a.uuid||A&&A.get(g+"uuid")||"",e={_reset_offline:function(){K&&K(1)},
LEAVE:function(a,b){var c={uuid:B},d=Q(y),m=v();0<a.indexOf(G)||("0"!=m&&(c.callback=m),t({l:b||w,timeout:2E3,a:m,data:c,url:[d,"v2","presence","sub_key",g,"channel",Z(a),"leave"]}))},history:function(a,b){var b=a.callback||b,c=a.count||a.limit||100,d=a.reverse||"false",m=a.error||q(),e=a.channel,f=a.start,p=a.end,h={},i=v();if(!e)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");h.stringtoken="true";h.count=c;h.reverse=d;i&&(h.callback=
i);f&&(h.start=f);p&&(h.end=p);t({a:i,data:h,c:function(a){b(a)},b:m,url:[z,"v2","history","sub-key",g,"channel",Z(e)]})},replay:function(a){var b=b||a.callback||q(),c=a.source,d=a.destination,m=a.stop,e=a.start,f=a.end,p=a.reverse,a=a.limit,h=v(),i={};if(!c)return error("Missing Source Channel");if(!d)return error("Missing Destination Channel");if(!s)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");"0"!=h&&(i.callback=h);m&&(i.stop="all");p&&(i.reverse="true");e&&(i.start=
e);f&&(i.end=f);a&&(i.count=a);t({a:h,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[z,"v1","replay",s,g,c,d],data:i})},time:function(a){var b=v();t({a:b,timeout:5*O,url:[z,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){var b=b||a.callback||q(),c=a.message,e=a.channel,m=v();if(!c)return error("Missing Message");if(!e)return error("Missing Channel");if(!s)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");c=JSON.stringify(c);
e=[z,"publish",s,g,0,Z(e),m,Z(c)];r.push({a:m,timeout:5*O,url:e,data:{uuid:B},c:function(a){b(a);d(1)},b:function(){b([0,"Failed",c]);d(1)}});d()},unsubscribe:function(a){a=a.channel;E=0;L=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+G}).join(",");W(a.split(","),function(a){D&&e.LEAVE(a,0);j[a]=0});D&&b()},subscribe:function(a,d){function ia(a){a?X(I,O):(z=Q(y,1),S=Q(y,1),X(function(){e.time(ia)},O));c(function(b){if(a&&b.d)return b.d=0,b.j(b.name);!a&&!b.d&&(b.d=1,b.i(b.name))})}
function I(){var a=v(),b=$(j).join(",");b&&(K=t({timeout:s,a:a,b:function(){e.time(ia)},data:{uuid:B},url:[S,"subscribe",g,Z(b),a,E],c:function(a){if(!a)return X(I,u);c(function(a){a.e||(a.e=1,a.h(a.name))});(E=!E&&L&&A.get(g)||a[1])&&A.set(g,a[1]);var b,ha=(2<a.length?a[2]:"").split(",");b=function(){var a=ha.shift()||"";return[(j[a]||{}).a||T,(a||U).split(G)[0]]};W(a[0],function(ha){var c=b();if(j[c[1]].f)c[0](ha,a,c[1])});X(I,u)}}))}var m=a.channel,d=(d=d||a.callback)||a.message,ka=a.connect||
q(),ma=a.reconnect||q(),r=a.disconnect||q(),h=a.presence||0,i=a.noheresync||0,s=a.timeout||p,u=a.windowing||f;a.restore&&(L=1);E=0;if(!m)return error("Missing Channel");if(!d)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");W((m.join?m.join(","):""+m).split(","),function(a){var b=j[a]||{};j[U=a]={name:a,e:b.e,d:b.d,f:1,a:T=d,h:ka,i:r,j:ma};h&&(e.subscribe({channel:a+G,callback:h}),!b.f&&!i&&e.here_now({channel:a,callback:function(b){W("uuids"in b?b.uuids:[],function(ha){h({action:"join",
uuid:ha,timestamp:P(),occupancy:b.occupancy||1},b,a)})}}))});b=function(){e._reset_offline();clearTimeout(V);V=X(I,100)};if(!D)return F.push(b);b()},here_now:function(a,b){var b=a.callback||b,c=a.error||q(),d=a.channel,m=v(),e=l;if(!d)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");"0"!=m&&(e={},e.callback=m);t({a:m,data:e,c:function(a){b(a)},b:c,url:[z,"v2","presence","sub_key",g,"channel",Z(d)]})},xdr:t,ready:ga,db:A,uuid:R,each:W,
map:Y,grep:ea,supplant:fa,now:P,unique:ba,updater:da,poll_online:function(){M()||e._reset_offline();X(e.poll_online,O)},poll_online2:function(){e.time(function(a){a||e._reset_offline();X(e.poll_online2,u)})}};B||(B=e.uuid());A.set(g+"uuid",B);X(e.poll_online,O);X(e.poll_online2,u);return e}
function Ia(a){function b(a){f||(f=1,clearTimeout(u),c&&(c.onerror=c.onload=l,c.abort&&c.abort(),c=l),a&&s())}function d(){if(!p){p=1;clearTimeout(u);try{response=JSON.parse(c.responseText)}catch(a){return b(1)}g(response)}}var c,f=0,p=0,u=X(function(){b(1)},Ja),s=a.b||q(),g=a.c||q();try{c="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;c.onerror=c.onabort=function(){b(1)};c.onload=c.onloadend=d;c.timeout=Ja;url=a.url.join(Ka);if(a.data){var w=[];url+="?";for(key in a.data)w.push(key+
"="+a.data[key]);url+=w.join(La)}c.open("GET",url,k);c.send()}catch(y){return b(0),Ia(a)}return b}function Ma(a,b,d){W(a.split(","),function(a){function f(a){a||(a=window.event);d(a)||(a.cancelBubble=k,a.returnValue=n,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,f,n):b.attachEvent?b.attachEvent("on"+a,f):b["on"+a]=f})}
function Na(a){a.db=Oa;a.xdr=Ia;var b=pa(a);b.init=Na;if(a.notest)return b;Ma("beforeunload",window,function(){each_channel(function(a){b.LEAVE(a.name,1)});return k});Ma("offline",window,b._reset_offline);Ma("offline",document,b._reset_offline);b.ready();return b}var Ka="/",La="&",Ja=31E4,Oa,Pa="undefined"!=typeof localStorage&&localStorage;
Oa={get:function(a){try{return Pa?Pa.getItem(a):-1==document.cookie.indexOf(a)?l:((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||l}catch(b){}},set:function(a,b){try{if(Pa)return Pa.setItem(a,b)&&0;document.cookie=a+"="+b+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(d){}}};"undefined"!==typeof module&&(module.m=Na)||"undefined"!==typeof exports&&(exports.k=Na)||(PUBNUB=Na);C=1;D=n;F=[];G="-pnpres";H=10;J=310;N=60;O=1E3;aa=/{([\w\-]+)}/g;
function ba(){return"x"+ ++C+""+ +new Date}function P(){return+new Date}var Qa=Math.floor(20*Math.random());Q=function(a,b){return 0<a.indexOf("pubsub.")&&a.replace("pubsub","ps"+(b?R().split("-")[0]:20>++Qa?Qa:Qa=1))||a};function da(a,b){function d(){f+b>P()?(clearTimeout(c),c=setTimeout(d,b)):(f=P(),a())}var c,f=0;return d}function ea(a,b){var d=[];W(a||[],function(a){b(a)&&d.push(a)});return d}function fa(a,b){return a.replace(aa,function(a,c){return b[c]||a})}
function X(a,b){return setTimeout(a,b)}function R(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}function W(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var d=0,c=a.length;d<c;)b.call(a[d],a[d],d++);else for(d in a)a.hasOwnProperty&&a.hasOwnProperty(d)&&b.call(a[d],d,a[d])}function Y(a,b){var d=[];W(a||[],function(a,f){d.push(b(a,f))});return d}
function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];W(a,function(a,c){c.f&&b.push(a)});return b.sort()}function ga(){X(function(){D||(D=1,W(F,function(a){a()}))},O)}
function pa(a){function b(){}function d(a){a&&(r.g=0);!r.g&&r.length&&(r.g=1,t(r.shift()))}function c(a){W($(j),function(b){(b=j[b])&&a(b)})}var f=+a.windowing||H,p=(+a.timeout||J)*O,u=(+a.keepalive||N)*O,s=a.publish_key||"",g=a.subscribe_key||"",w=a.ssl?"s":"",y="http"+w+"://"+(a.origin||"pubsub.pubnub.com"),z=Q(y),S=Q(y),r=[],T=0,U=0,K=0,L=0,V=0,E=0,j={},t=a.xdr,M=a._is_online||x(1),v=a.jsonp_cb||x(0),A=a.db||{get:q(),set:q()},B=a.uuid||A&&A.get(g+"uuid")||"",e={_reset_offline:function(){K&&K(1)},
LEAVE:function(a,b){var c={uuid:B},d=Q(y),m=v();0<a.indexOf(G)||("0"!=m&&(c.callback=m),t({l:b||w,timeout:2E3,a:m,data:c,url:[d,"v2","presence","sub_key",g,"channel",Z(a),"leave"]}))},history:function(a,b){var b=a.callback||b,c=a.count||a.limit||100,d=a.reverse||"false",m=a.error||q(),e=a.channel,f=a.start,p=a.end,h={},i=v();if(!e)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");h.stringtoken="true";h.count=c;h.reverse=d;i&&(h.callback=
i);f&&(h.start=f);p&&(h.end=p);t({a:i,data:h,c:function(a){b(a)},b:m,url:[z,"v2","history","sub-key",g,"channel",Z(e)]})},replay:function(a){var b=b||a.callback||q(),c=a.source,d=a.destination,e=a.stop,f=a.start,p=a.end,j=a.reverse,a=a.limit,h=v(),i={};if(!c)return error("Missing Source Channel");if(!d)return error("Missing Destination Channel");if(!s)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");"0"!=h&&(i.callback=h);e&&(i.stop="all");j&&(i.reverse="true");f&&(i.start=
f);p&&(i.end=p);a&&(i.count=a);t({a:h,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[z,"v1","replay",s,g,c,d],data:i})},time:function(a){var b=v();t({a:b,timeout:5*O,url:[z,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){var b=b||a.callback||q(),c=a.message,e=a.channel,m=v();if(!c)return error("Missing Message");if(!e)return error("Missing Channel");if(!s)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");c=JSON.stringify(c);
e=[z,"publish",s,g,0,Z(e),m,Z(c)];r.push({a:m,timeout:5*O,url:e,data:{uuid:B},c:function(a){b(a);d(1)},b:function(){b([0,"Failed",c]);d(1)}});d()},unsubscribe:function(a){a=a.channel;E=0;L=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+G}).join(",");W(a.split(","),function(a){D&&e.LEAVE(a,0);j[a]=0});D&&b()},subscribe:function(a,d){function ia(a){a?X(I,O):(z=Q(y,1),S=Q(y,1),X(function(){e.time(ia)},O));c(function(b){if(a&&b.d)return b.d=0,b.j(b.name);!a&&!b.d&&(b.d=1,b.i(b.name))})}
function I(){var a=v(),b=$(j).join(",");b&&(K=t({timeout:u,a:a,b:function(){e.time(ia)},data:{uuid:B},url:[S,"subscribe",g,Z(b),a,E],c:function(a){if(!a)return X(I,w);c(function(a){a.e||(a.e=1,a.h(a.name))});(E=!E&&L&&A.get(g)||a[1])&&A.set(g,a[1]);var b,d=(2<a.length?a[2]:"").split(",");b=function(){var a=d.shift()||"";return[(j[a]||{}).a||T,(a||U).split(G)[0]]};W(a[0],function(c){var d=b();if(j[d[1]].f)d[0](c,a,d[1])});X(I,w)}}))}var m=a.channel,d=(d=d||a.callback)||a.message,ka=a.connect||q(),
r=a.reconnect||q(),s=a.disconnect||q(),h=a.presence||0,i=a.noheresync||0,u=a.timeout||p,w=a.windowing||f;a.restore&&(L=1);E=0;if(!m)return error("Missing Channel");if(!d)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");W((m.join?m.join(","):""+m).split(","),function(a){var b=j[a]||{};j[U=a]={name:a,e:b.e,d:b.d,f:1,a:T=d,h:ka,i:s,j:r};h&&(e.subscribe({channel:a+G,callback:h}),!b.f&&!i&&e.here_now({channel:a,callback:function(b){W("uuids"in b?b.uuids:[],function(c){h({action:"join",
uuid:c,timestamp:P(),occupancy:b.occupancy||1},b,a)})}}))});b=function(){e._reset_offline();clearTimeout(V);V=X(I,100)};if(!D)return F.push(b);b()},here_now:function(a,b){var b=a.callback||b,c=a.error||q(),d=a.channel,e=v(),f=l;if(!d)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");"0"!=e&&(f={},f.callback=e);t({a:e,data:f,c:function(a){b(a)},b:c,url:[z,"v2","presence","sub_key",g,"channel",Z(d)]})},xdr:t,ready:ga,db:A,uuid:R,each:W,
map:Y,grep:ea,supplant:fa,now:P,unique:ba,updater:da,poll_online:function(){M()||e._reset_offline();X(e.poll_online,O)},poll_online2:function(){e.time(function(a){a||e._reset_offline();X(e.poll_online2,u)})}};B||(B=e.uuid());A.set(g+"uuid",B);X(e.poll_online,O);X(e.poll_online2,u);return e}
function Ra(a){function b(a){f||(f=1,clearTimeout(u),c&&(c.onerror=c.onload=l,c.abort&&c.abort(),c=l),a&&s())}function d(){if(!p){p=1;clearTimeout(u);try{response=JSON.parse(c.responseText)}catch(a){return b(1)}g(response)}}var c,f=0,p=0,u=X(function(){b(1)},Sa),s=a.b||q(),g=a.c||q();try{c="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;c.onerror=c.onabort=function(){b(1)};c.onload=c.onloadend=d;c.timeout=Sa;url=a.url.join(Ta);if(a.data){var w=[];url+="?";for(key in a.data)w.push(key+
"="+a.data[key]);url+=w.join(Ua)}c.open("GET",url,k);c.send()}catch(y){return b(0),Ra(a)}return b}function Va(a,b,d){W(a.split(","),function(a){function f(a){a||(a=window.event);d(a)||(a.cancelBubble=k,a.returnValue=n,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,f,n):b.attachEvent?b.attachEvent("on"+a,f):b["on"+a]=f})}
function Wa(a){a.db=Xa;a.xdr=Ra;var b=pa(a);b.init=Wa;if(a.notest)return b;Va("beforeunload",window,function(){each_channel(function(a){b.LEAVE(a.name,1)});return k});Va("offline",window,b._reset_offline);Va("offline",document,b._reset_offline);b.ready();return b}var Ta="/",Ua="&",Sa=31E4,Xa,Ya="undefined"!=typeof localStorage&&localStorage;
Xa={get:function(a){try{return Ya?Ya.getItem(a):-1==document.cookie.indexOf(a)?l:((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||l}catch(b){}},set:function(a,b){try{if(Ya)return Ya.setItem(a,b)&&0;document.cookie=a+"="+b+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(d){}}};"undefined"!==typeof module&&(module.m=Wa)||"undefined"!==typeof exports&&(exports.k=Wa)||(PUBNUB=Wa);C=1;D=n;F=[];G="-pnpres";H=10;J=310;N=60;O=1E3;aa=/{([\w\-]+)}/g;
function ba(){return"x"+ ++C+""+ +new Date}function P(){return+new Date}var Za=Math.floor(20*Math.random());Q=function(a,b){return 0<a.indexOf("pubsub.")&&a.replace("pubsub","ps"+(b?R().split("-")[0]:20>++Za?Za:Za=1))||a};function da(a,b){function d(){f+b>P()?(clearTimeout(c),c=setTimeout(d,b)):(f=P(),a())}var c,f=0;return d}function ea(a,b){var d=[];W(a||[],function(a){b(a)&&d.push(a)});return d}function fa(a,b){return a.replace(aa,function(a,c){return b[c]||a})}
function X(a,b){return setTimeout(a,b)}function R(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}function W(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var d=0,c=a.length;d<c;)b.call(a[d],a[d],d++);else for(d in a)a.hasOwnProperty&&a.hasOwnProperty(d)&&b.call(a[d],d,a[d])}function Y(a,b){var d=[];W(a||[],function(a,f){d.push(b(a,f))});return d}
function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];W(a,function(a,c){c.f&&b.push(a)});return b.sort()}function ga(){X(function(){D||(D=1,W(F,function(a){a()}))},O)}
function pa(a){function b(){}function d(a){a&&(r.g=0);!r.g&&r.length&&(r.g=1,t(r.shift()))}function c(a){W($(j),function(b){(b=j[b])&&a(b)})}var f=+a.windowing||H,p=(+a.timeout||J)*O,u=(+a.keepalive||N)*O,s=a.publish_key||"",g=a.subscribe_key||"",w=a.ssl?"s":"",y="http"+w+"://"+(a.origin||"pubsub.pubnub.com"),z=Q(y),S=Q(y),r=[],T=0,U=0,K=0,L=0,V=0,E=0,j={},t=a.xdr,M=a._is_online||x(1),v=a.jsonp_cb||x(0),A=a.db||{get:q(),set:q()},B=a.uuid||A&&A.get(g+"uuid")||"",e={_reset_offline:function(){K&&K(1)},
LEAVE:function(a,b){var c={uuid:B},d=Q(y),e=v();0<a.indexOf(G)||("0"!=e&&(c.callback=e),t({l:b||w,timeout:2E3,a:e,data:c,url:[d,"v2","presence","sub_key",g,"channel",Z(a),"leave"]}))},history:function(a,b){var b=a.callback||b,c=a.count||a.limit||100,d=a.reverse||"false",e=a.error||q(),f=a.channel,p=a.start,j=a.end,h={},i=v();if(!f)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");h.stringtoken="true";h.count=c;h.reverse=d;i&&(h.callback=
i);p&&(h.start=p);j&&(h.end=j);t({a:i,data:h,c:function(a){b(a)},b:e,url:[z,"v2","history","sub-key",g,"channel",Z(f)]})},replay:function(a){var b=b||a.callback||q(),c=a.source,d=a.destination,e=a.stop,f=a.start,p=a.end,j=a.reverse,a=a.limit,h=v(),i={};if(!c)return error("Missing Source Channel");if(!d)return error("Missing Destination Channel");if(!s)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");"0"!=h&&(i.callback=h);e&&(i.stop="all");j&&(i.reverse="true");f&&(i.start=
f);p&&(i.end=p);a&&(i.count=a);t({a:h,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[z,"v1","replay",s,g,c,d],data:i})},time:function(a){var b=v();t({a:b,timeout:5*O,url:[z,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){var b=b||a.callback||q(),c=a.message,e=a.channel,m=v();if(!c)return error("Missing Message");if(!e)return error("Missing Channel");if(!s)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");c=JSON.stringify(c);
e=[z,"publish",s,g,0,Z(e),m,Z(c)];r.push({a:m,timeout:5*O,url:e,data:{uuid:B},c:function(a){b(a);d(1)},b:function(){b([0,"Failed",c]);d(1)}});d()},unsubscribe:function(a){a=a.channel;E=0;L=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+G}).join(",");W(a.split(","),function(a){D&&e.LEAVE(a,0);j[a]=0});D&&b()},subscribe:function(a,d){function ia(a){a?X(I,O):(z=Q(y,1),S=Q(y,1),X(function(){e.time(ia)},O));c(function(b){if(a&&b.d)return b.d=0,b.j(b.name);!a&&!b.d&&(b.d=1,b.i(b.name))})}
function I(){var a=v(),b=$(j).join(",");b&&(K=t({timeout:w,a:a,b:function(){e.time(ia)},data:{uuid:B},url:[S,"subscribe",g,Z(b),a,E],c:function(a){if(!a)return X(I,M);c(function(a){a.e||(a.e=1,a.h(a.name))});(E=!E&&L&&A.get(g)||a[1])&&A.set(g,a[1]);var b,d=(2<a.length?a[2]:"").split(",");b=function(){var a=d.shift()||"";return[(j[a]||{}).a||T,(a||U).split(G)[0]]};W(a[0],function(c){var d=b();if(j[d[1]].f)d[0](c,a,d[1])});X(I,M)}}))}var m=a.channel,d=(d=d||a.callback)||a.message,r=a.connect||q(),s=
a.reconnect||q(),u=a.disconnect||q(),h=a.presence||0,i=a.noheresync||0,w=a.timeout||p,M=a.windowing||f;a.restore&&(L=1);E=0;if(!m)return error("Missing Channel");if(!d)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");W((m.join?m.join(","):""+m).split(","),function(a){var b=j[a]||{};j[U=a]={name:a,e:b.e,d:b.d,f:1,a:T=d,h:r,i:u,j:s};h&&(e.subscribe({channel:a+G,callback:h}),!b.f&&!i&&e.here_now({channel:a,callback:function(b){W("uuids"in b?b.uuids:[],function(c){h({action:"join",
uuid:c,timestamp:P(),occupancy:b.occupancy||1},b,a)})}}))});b=function(){e._reset_offline();clearTimeout(V);V=X(I,100)};if(!D)return F.push(b);b()},here_now:function(a,b){var b=a.callback||b,c=a.error||q(),d=a.channel,e=v(),f=l;if(!d)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");"0"!=e&&(f={},f.callback=e);t({a:e,data:f,c:function(a){b(a)},b:c,url:[z,"v2","presence","sub_key",g,"channel",Z(d)]})},xdr:t,ready:ga,db:A,uuid:R,each:W,
map:Y,grep:ea,supplant:fa,now:P,unique:ba,updater:da,poll_online:function(){M()||e._reset_offline();X(e.poll_online,O)},poll_online2:function(){e.time(function(a){a||e._reset_offline();X(e.poll_online2,u)})}};B||(B=e.uuid());A.set(g+"uuid",B);X(e.poll_online,O);X(e.poll_online2,u);return e}
function $a(a){function b(a){f||(f=1,clearTimeout(u),c&&(c.onerror=c.onload=l,c.abort&&c.abort(),c=l),a&&s())}function d(){if(!p){p=1;clearTimeout(u);try{response=JSON.parse(c.responseText)}catch(a){return b(1)}g(response)}}var c,f=0,p=0,u=X(function(){b(1)},ab),s=a.b||q(),g=a.c||q();try{c="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;c.onerror=c.onabort=function(){b(1)};c.onload=c.onloadend=d;c.timeout=ab;url=a.url.join(bb);if(a.data){var w=[];url+="?";for(key in a.data)w.push(key+
"="+a.data[key]);url+=w.join(cb)}c.open("GET",url,k);c.send()}catch(y){return b(0),$a(a)}return b}function db(a,b,d){W(a.split(","),function(a){function f(a){a||(a=window.event);d(a)||(a.cancelBubble=k,a.returnValue=n,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,f,n):b.attachEvent?b.attachEvent("on"+a,f):b["on"+a]=f})}
function eb(a){a.db=fb;a.xdr=$a;var b=pa(a);b.init=eb;if(a.notest)return b;db("beforeunload",window,function(){each_channel(function(a){b.LEAVE(a.name,1)});return k});db("offline",window,b._reset_offline);db("offline",document,b._reset_offline);b.ready();return b}var bb="/",cb="&",ab=31E4,fb,gb="undefined"!=typeof localStorage&&localStorage;
fb={get:function(a){try{return gb?gb.getItem(a):-1==document.cookie.indexOf(a)?l:((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||l}catch(b){}},set:function(a,b){try{if(gb)return gb.setItem(a,b)&&0;document.cookie=a+"="+b+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(d){}}};"undefined"!==typeof module&&(module.m=eb)||"undefined"!==typeof exports&&(exports.k=eb)||(PUBNUB=eb);C=1;D=n;F=[];G="-pnpres";H=10;J=310;N=60;O=1E3;aa=/{([\w\-]+)}/g;
function ba(){return"x"+ ++C+""+ +new Date}function P(){return+new Date}var hb=Math.floor(20*Math.random());Q=function(a,b){return 0<a.indexOf("pubsub.")&&a.replace("pubsub","ps"+(b?R().split("-")[0]:20>++hb?hb:hb=1))||a};function da(a,b){function d(){f+b>P()?(clearTimeout(c),c=setTimeout(d,b)):(f=P(),a())}var c,f=0;return d}function ea(a,b){var d=[];W(a||[],function(a){b(a)&&d.push(a)});return d}function fa(a,b){return a.replace(aa,function(a,c){return b[c]||a})}
function X(a,b){return setTimeout(a,b)}function R(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}function W(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var d=0,c=a.length;d<c;)b.call(a[d],a[d],d++);else for(d in a)a.hasOwnProperty&&a.hasOwnProperty(d)&&b.call(a[d],d,a[d])}function Y(a,b){var d=[];W(a||[],function(a,f){d.push(b(a,f))});return d}
function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];W(a,function(a,c){c.f&&b.push(a)});return b.sort()}function ga(){X(function(){D||(D=1,W(F,function(a){a()}))},O)}
function pa(a){function b(){}function d(a){a&&(r.g=0);!r.g&&r.length&&(r.g=1,t(r.shift()))}function c(a){W($(j),function(b){(b=j[b])&&a(b)})}var f=+a.windowing||H,p=(+a.timeout||J)*O,u=(+a.keepalive||N)*O,s=a.publish_key||"",g=a.subscribe_key||"",w=a.ssl?"s":"",y="http"+w+"://"+(a.origin||"pubsub.pubnub.com"),z=Q(y),S=Q(y),r=[],T=0,U=0,K=0,L=0,V=0,E=0,j={},t=a.xdr,M=a._is_online||x(1),v=a.jsonp_cb||x(0),A=a.db||{get:q(),set:q()},B=a.uuid||A&&A.get(g+"uuid")||"",e={_reset_offline:function(){K&&K(1)},
LEAVE:function(a,b){var c={uuid:B},d=Q(y),e=v();0<a.indexOf(G)||("0"!=e&&(c.callback=e),t({l:b||w,timeout:2E3,a:e,data:c,url:[d,"v2","presence","sub_key",g,"channel",Z(a),"leave"]}))},history:function(a,b){var b=a.callback||b,c=a.count||a.limit||100,d=a.reverse||"false",e=a.error||q(),f=a.channel,p=a.start,j=a.end,h={},i=v();if(!f)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");h.stringtoken="true";h.count=c;h.reverse=d;i&&(h.callback=
i);p&&(h.start=p);j&&(h.end=j);t({a:i,data:h,c:function(a){b(a)},b:e,url:[z,"v2","history","sub-key",g,"channel",Z(f)]})},replay:function(a){var b=b||a.callback||q(),c=a.source,d=a.destination,e=a.stop,f=a.start,p=a.end,j=a.reverse,a=a.limit,h=v(),i={};if(!c)return error("Missing Source Channel");if(!d)return error("Missing Destination Channel");if(!s)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");"0"!=h&&(i.callback=h);e&&(i.stop="all");j&&(i.reverse="true");f&&(i.start=
f);p&&(i.end=p);a&&(i.count=a);t({a:h,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[z,"v1","replay",s,g,c,d],data:i})},time:function(a){var b=v();t({a:b,timeout:5*O,url:[z,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){var b=b||a.callback||q(),c=a.message,e=a.channel,f=v();if(!c)return error("Missing Message");if(!e)return error("Missing Channel");if(!s)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");c=JSON.stringify(c);
e=[z,"publish",s,g,0,Z(e),f,Z(c)];r.push({a:f,timeout:5*O,url:e,data:{uuid:B},c:function(a){b(a);d(1)},b:function(){b([0,"Failed",c]);d(1)}});d()},unsubscribe:function(a){a=a.channel;E=0;L=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+G}).join(",");W(a.split(","),function(a){D&&e.LEAVE(a,0);j[a]=0});D&&b()},subscribe:function(a,d){function ia(a){a?X(I,O):(z=Q(y,1),S=Q(y,1),X(function(){e.time(ia)},O));c(function(b){if(a&&b.d)return b.d=0,b.j(b.name);!a&&!b.d&&(b.d=1,b.i(b.name))})}
function I(){var a=v(),b=$(j).join(",");b&&(K=t({timeout:M,a:a,b:function(){e.time(ia)},data:{uuid:B},url:[S,"subscribe",g,Z(b),a,E],c:function(a){if(!a)return X(I,ja);c(function(a){a.e||(a.e=1,a.h(a.name))});E=!E&&L&&A.get(g)||a[1];w&&(Timetoken=1E4,w=0);A.set(g,a[1]);var b,d=(2<a.length?a[2]:"").split(",");b=function(){var a=d.shift()||"";return[(j[a]||{}).a||T,(a||U).split(G)[0]]};W(a[0],function(c){var d=b();if(j[d[1]].f)d[0](c,a,d[1])});X(I,ja)}}))}var m=a.channel,d=(d=d||a.callback)||a.message,
r=a.connect||q(),s=a.reconnect||q(),u=a.disconnect||q(),h=a.presence||0,i=a.noheresync||0,w=a.backfill||0,M=a.timeout||p,ja=a.windowing||f;a.restore&&(L=1);E=0;if(!m)return error("Missing Channel");if(!d)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");W((m.join?m.join(","):""+m).split(","),function(a){var b=j[a]||{};j[U=a]={name:a,e:b.e,d:b.d,f:1,a:T=d,h:r,i:u,j:s};h&&(e.subscribe({channel:a+G,callback:h}),!b.f&&!i&&e.here_now({channel:a,callback:function(b){W("uuids"in
b?b.uuids:[],function(c){h({action:"join",uuid:c,timestamp:P(),occupancy:b.occupancy||1},b,a)})}}))});b=function(){e._reset_offline();clearTimeout(V);V=X(I,100)};if(!D)return F.push(b);b()},here_now:function(a,b){var b=a.callback||b,c=a.error||q(),d=a.channel,e=v(),f=l;if(!d)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");"0"!=e&&(f={},f.callback=e);t({a:e,data:f,c:function(a){b(a)},b:c,url:[z,"v2","presence","sub_key",g,"channel",
Z(d)]})},xdr:t,ready:ga,db:A,uuid:R,each:W,map:Y,grep:ea,supplant:fa,now:P,unique:ba,updater:da,poll_online:function(){M()||e._reset_offline();X(e.poll_online,O)},poll_online2:function(){e.time(function(a){a||e._reset_offline();X(e.poll_online2,u)})}};B||(B=e.uuid());A.set(g+"uuid",B);X(e.poll_online,O);X(e.poll_online2,u);return e}
function ib(a){function b(a){f||(f=1,clearTimeout(u),c&&(c.onerror=c.onload=l,c.abort&&c.abort(),c=l),a&&s())}function d(){if(!p){p=1;clearTimeout(u);try{response=JSON.parse(c.responseText)}catch(a){return b(1)}g(response)}}var c,f=0,p=0,u=X(function(){b(1)},jb),s=a.b||q(),g=a.c||q();try{c="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;c.onerror=c.onabort=function(){b(1)};c.onload=c.onloadend=d;c.timeout=jb;url=a.url.join(kb);if(a.data){var w=[];url+="?";for(key in a.data)w.push(key+
"="+a.data[key]);url+=w.join(lb)}c.open("GET",url,k);c.send()}catch(y){return b(0),ib(a)}return b}function mb(a,b,d){W(a.split(","),function(a){function f(a){a||(a=window.event);d(a)||(a.cancelBubble=k,a.returnValue=n,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,f,n):b.attachEvent?b.attachEvent("on"+a,f):b["on"+a]=f})}
function nb(a){a.db=ob;a.xdr=ib;var b=pa(a);b.init=nb;if(a.notest)return b;mb("beforeunload",window,function(){each_channel(function(a){b.LEAVE(a.name,1)});return k});mb("offline",window,b._reset_offline);mb("offline",document,b._reset_offline);b.ready();return b}var kb="/",lb="&",jb=31E4,ob,pb="undefined"!=typeof localStorage&&localStorage;
ob={get:function(a){try{return pb?pb.getItem(a):-1==document.cookie.indexOf(a)?l:((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||l}catch(b){}},set:function(a,b){try{if(pb)return pb.setItem(a,b)&&0;document.cookie=a+"="+b+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(d){}}};"undefined"!==typeof module&&(module.m=nb)||"undefined"!==typeof exports&&(exports.k=nb)||(PUBNUB=nb);C=1;D=n;F=[];G="-pnpres";H=10;J=310;N=60;O=1E3;aa=/{([\w\-]+)}/g;
function ba(){return"x"+ ++C+""+ +new Date}function P(){return+new Date}var qb=Math.floor(20*Math.random());Q=function(a,b){return 0<a.indexOf("pubsub.")&&a.replace("pubsub","ps"+(b?R().split("-")[0]:20>++qb?qb:qb=1))||a};function da(a,b){function d(){f+b>P()?(clearTimeout(c),c=setTimeout(d,b)):(f=P(),a())}var c,f=0;return d}function ea(a,b){var d=[];W(a||[],function(a){b(a)&&d.push(a)});return d}function fa(a,b){return a.replace(aa,function(a,c){return b[c]||a})}
function X(a,b){return setTimeout(a,b)}function R(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}function W(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var d=0,c=a.length;d<c;)b.call(a[d],a[d],d++);else for(d in a)a.hasOwnProperty&&a.hasOwnProperty(d)&&b.call(a[d],d,a[d])}function Y(a,b){var d=[];W(a||[],function(a,f){d.push(b(a,f))});return d}
function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];W(a,function(a,c){c.f&&b.push(a)});return b.sort()}function ga(){X(function(){D||(D=1,W(F,function(a){a()}))},O)}
function pa(a){function b(){}function d(a){a&&(r.g=0);!r.g&&r.length&&(r.g=1,t(r.shift()))}function c(a){W($(j),function(b){(b=j[b])&&a(b)})}var f=+a.windowing||H,p=(+a.timeout||J)*O,u=(+a.keepalive||N)*O,s=a.publish_key||"",g=a.subscribe_key||"",w=a.ssl?"s":"",y="http"+w+"://"+(a.origin||"pubsub.pubnub.com"),z=Q(y),S=Q(y),r=[],T=0,U=0,K=0,L=0,V=0,E=0,j={},t=a.xdr,M=a._is_online||x(1),v=a.jsonp_cb||x(0),A=a.db||{get:q(),set:q()},B=a.uuid||A&&A.get(g+"uuid")||"",e={_reset_offline:function(){K&&K(1)},
LEAVE:function(a,b){var c={uuid:B},d=Q(y),e=v();0<a.indexOf(G)||("0"!=e&&(c.callback=e),t({l:b||w,timeout:2E3,a:e,data:c,url:[d,"v2","presence","sub_key",g,"channel",Z(a),"leave"]}))},history:function(a,b){var b=a.callback||b,c=a.count||a.limit||100,d=a.reverse||"false",e=a.error||q(),f=a.channel,p=a.start,j=a.end,h={},i=v();if(!f)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");h.stringtoken="true";h.count=c;h.reverse=d;i&&(h.callback=
i);p&&(h.start=p);j&&(h.end=j);t({a:i,data:h,c:function(a){b(a)},b:e,url:[z,"v2","history","sub-key",g,"channel",Z(f)]})},replay:function(a){var b=b||a.callback||q(),c=a.source,d=a.destination,e=a.stop,f=a.start,p=a.end,j=a.reverse,a=a.limit,h=v(),i={};if(!c)return error("Missing Source Channel");if(!d)return error("Missing Destination Channel");if(!s)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");"0"!=h&&(i.callback=h);e&&(i.stop="all");j&&(i.reverse="true");f&&(i.start=
f);p&&(i.end=p);a&&(i.count=a);t({a:h,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[z,"v1","replay",s,g,c,d],data:i})},time:function(a){var b=v();t({a:b,timeout:5*O,url:[z,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){var b=b||a.callback||q(),c=a.message,e=a.channel,f=v();if(!c)return error("Missing Message");if(!e)return error("Missing Channel");if(!s)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");c=JSON.stringify(c);
e=[z,"publish",s,g,0,Z(e),f,Z(c)];r.push({a:f,timeout:5*O,url:e,data:{uuid:B},c:function(a){b(a);d(1)},b:function(){b([0,"Failed",c]);d(1)}});d()},unsubscribe:function(a){a=a.channel;E=0;L=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+G}).join(",");W(a.split(","),function(a){D&&e.LEAVE(a,0);j[a]=0});D&&b()},subscribe:function(a,d){function r(a){a?X(I,O):(z=Q(y,1),S=Q(y,1),X(function(){e.time(r)},O));c(function(b){if(a&&b.d)return b.d=0,b.j(b.name);!a&&!b.d&&(b.d=1,b.i(b.name))})}
function I(){var a=v(),b=$(j).join(",");b&&(K=t({timeout:oa,a:a,b:function(){e.time(r)},data:{uuid:B},url:[S,"subscribe",g,Z(b),a,E],c:function(a){if(!a)return X(I,ja);c(function(a){a.e||(a.e=1,a.h(a.name))});E=!E&&L&&A.get(g)||a[1];M&&(Timetoken=1E4,M=0);A.set(g,a[1]);var b,d=(2<a.length?a[2]:"").split(",");b=function(){var a=d.shift()||"";return[(j[a]||{}).a||T,(a||U).split(G)[0]]};W(a[0],function(c){var d=b();if(j[d[1]].f)d[0](c,a,d[1])});X(I,ja)}}))}var m=a.channel,d=(d=d||a.callback)||a.message,
s=a.connect||q(),u=a.reconnect||q(),w=a.disconnect||q(),h=a.presence||0,i=a.noheresync||0,M=a.backfill||0,oa=a.timeout||p,ja=a.windowing||f;a.restore&&(L=1);E=0;if(!m)return error("Missing Channel");if(!d)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");W((m.join?m.join(","):""+m).split(","),function(a){var b=j[a]||{};j[U=a]={name:a,e:b.e,d:b.d,f:1,a:T=d,h:s,i:w,j:u};h&&(e.subscribe({channel:a+G,callback:h}),!b.f&&!i&&e.here_now({channel:a,callback:function(b){W("uuids"in
b?b.uuids:[],function(c){h({action:"join",uuid:c,timestamp:P(),occupancy:b.occupancy||1},b,a)})}}))});b=function(){e._reset_offline();clearTimeout(V);V=X(I,100)};if(!D)return F.push(b);b()},here_now:function(a,b){var b=a.callback||b,c=a.error||q(),d=a.channel,e=v(),f=l;if(!d)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");"0"!=e&&(f={},f.callback=e);t({a:e,data:f,c:function(a){b(a)},b:c,url:[z,"v2","presence","sub_key",g,"channel",
Z(d)]})},xdr:t,ready:ga,db:A,uuid:R,each:W,map:Y,grep:ea,supplant:fa,now:P,unique:ba,updater:da,poll_online:function(){M()||e._reset_offline();X(e.poll_online,O)},poll_online2:function(){e.time(function(a){a||e._reset_offline();X(e.poll_online2,u)})}};B||(B=e.uuid());A.set(g+"uuid",B);X(e.poll_online,O);X(e.poll_online2,u);return e}
function rb(a){function b(a){f||(f=1,clearTimeout(u),c&&(c.onerror=c.onload=l,c.abort&&c.abort(),c=l),a&&s())}function d(){if(!p){p=1;clearTimeout(u);try{response=JSON.parse(c.responseText)}catch(a){return b(1)}g(response)}}var c,f=0,p=0,u=X(function(){b(1)},sb),s=a.b||q(),g=a.c||q();try{c="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;c.onerror=c.onabort=function(){b(1)};c.onload=c.onloadend=d;c.timeout=sb;url=a.url.join(tb);if(a.data){var w=[];url+="?";for(key in a.data)w.push(key+
"="+a.data[key]);url+=w.join(ub)}c.open("GET",url,k);c.send()}catch(y){return b(0),rb(a)}return b}function vb(a,b,d){W(a.split(","),function(a){function f(a){a||(a=window.event);d(a)||(a.cancelBubble=k,a.returnValue=n,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,f,n):b.attachEvent?b.attachEvent("on"+a,f):b["on"+a]=f})}
function wb(a){a.db=xb;a.xdr=rb;var b=pa(a);b.init=wb;if(a.notest)return b;vb("beforeunload",window,function(){each_channel(function(a){b.LEAVE(a.name,1)});return k});vb("offline",window,b._reset_offline);vb("offline",document,b._reset_offline);b.ready();return b}var tb="/",ub="&",sb=31E4,xb,yb="undefined"!=typeof localStorage&&localStorage;
xb={get:function(a){try{return yb?yb.getItem(a):-1==document.cookie.indexOf(a)?l:((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||l}catch(b){}},set:function(a,b){try{if(yb)return yb.setItem(a,b)&&0;document.cookie=a+"="+b+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(d){}}};"undefined"!==typeof module&&(module.m=wb)||"undefined"!==typeof exports&&(exports.k=wb)||(PUBNUB=wb);C=1;D=n;F=[];G="-pnpres";H=10;J=310;N=60;O=1E3;aa=/{([\w\-]+)}/g;
function ba(){return"x"+ ++C+""+ +new Date}function P(){return+new Date}var zb=Math.floor(20*Math.random());Q=function(a,b){return 0<a.indexOf("pubsub.")&&a.replace("pubsub","ps"+(b?R().split("-")[0]:20>++zb?zb:zb=1))||a};function da(a,b){function d(){f+b>P()?(clearTimeout(c),c=setTimeout(d,b)):(f=P(),a())}var c,f=0;return d}function ea(a,b){var d=[];W(a||[],function(a){b(a)&&d.push(a)});return d}function fa(a,b){return a.replace(aa,function(a,c){return b[c]||a})}
function X(a,b){return setTimeout(a,b)}function R(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}function W(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var d=0,c=a.length;d<c;)b.call(a[d],a[d],d++);else for(d in a)a.hasOwnProperty&&a.hasOwnProperty(d)&&b.call(a[d],d,a[d])}function Y(a,b){var d=[];W(a||[],function(a,f){d.push(b(a,f))});return d}
function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];W(a,function(a,c){c.f&&b.push(a)});return b.sort()}function ga(){X(function(){D||(D=1,W(F,function(a){a()}))},O)}
function pa(a){function b(){}function d(a){a&&(r.g=0);!r.g&&r.length&&(r.g=1,t(r.shift()))}function c(a){W($(j),function(b){(b=j[b])&&a(b)})}var f=+a.windowing||H,p=(+a.timeout||J)*O,u=(+a.keepalive||N)*O,s=a.publish_key||"",g=a.subscribe_key||"",w=a.ssl?"s":"",y="http"+w+"://"+(a.origin||"pubsub.pubnub.com"),z=Q(y),S=Q(y),r=[],T=0,U=0,K=0,L=0,V=0,E=0,j={},t=a.xdr,M=a._is_online||x(1),v=a.jsonp_cb||x(0),A=a.db||{get:q(),set:q()},B=a.uuid||A&&A.get(g+"uuid")||"",e={_reset_offline:function(){K&&K(1)},
LEAVE:function(a,b){var c={uuid:B},d=Q(y),e=v();0<a.indexOf(G)||("0"!=e&&(c.callback=e),t({l:b||w,timeout:2E3,a:e,data:c,url:[d,"v2","presence","sub_key",g,"channel",Z(a),"leave"]}))},history:function(a,b){var b=a.callback||b,c=a.count||a.limit||100,d=a.reverse||"false",e=a.error||q(),f=a.channel,p=a.start,j=a.end,h={},i=v();if(!f)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");h.stringtoken="true";h.count=c;h.reverse=d;i&&(h.callback=
i);p&&(h.start=p);j&&(h.end=j);t({a:i,data:h,c:function(a){b(a)},b:e,url:[z,"v2","history","sub-key",g,"channel",Z(f)]})},replay:function(a){var b=b||a.callback||q(),c=a.source,d=a.destination,e=a.stop,f=a.start,p=a.end,j=a.reverse,a=a.limit,h=v(),i={};if(!c)return error("Missing Source Channel");if(!d)return error("Missing Destination Channel");if(!s)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");"0"!=h&&(i.callback=h);e&&(i.stop="all");j&&(i.reverse="true");f&&(i.start=
f);p&&(i.end=p);a&&(i.count=a);t({a:h,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[z,"v1","replay",s,g,c,d],data:i})},time:function(a){var b=v();t({a:b,timeout:5*O,url:[z,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){var b=b||a.callback||q(),c=a.message,e=a.channel,f=v();if(!c)return error("Missing Message");if(!e)return error("Missing Channel");if(!s)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");c=JSON.stringify(c);
e=[z,"publish",s,g,0,Z(e),f,Z(c)];r.push({a:f,timeout:5*O,url:e,data:{uuid:B},c:function(a){b(a);d(1)},b:function(){b([0,"Failed",c]);d(1)}});d()},unsubscribe:function(a){a=a.channel;E=0;L=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+G}).join(",");W(a.split(","),function(a){D&&e.LEAVE(a,0);j[a]=0});D&&b()},subscribe:function(a,d){function r(a){a?X(s,O):(z=Q(y,1),S=Q(y,1),X(function(){e.time(r)},O));c(function(b){if(a&&b.d)return b.d=0,b.j(b.name);!a&&!b.d&&(b.d=1,b.i(b.name))})}
function s(){var a=v(),b=$(j).join(",");b&&(K=t({timeout:oa,a:a,b:function(){e.time(r)},data:{uuid:B},url:[S,"subscribe",g,Z(b),a,E],c:function(a){if(!a)return X(s,ja);c(function(a){a.e||(a.e=1,a.h(a.name))});E=!E&&L&&A.get(g)||a[1];na&&(Timetoken=1E4,na=0);A.set(g,a[1]);var b,d=(2<a.length?a[2]:"").split(",");b=function(){var a=d.shift()||"";return[(j[a]||{}).a||T,(a||U).split(G)[0]]};W(a[0],function(c){var d=b();if(j[d[1]].f)d[0](c,a,d[1])});X(s,ja)}}))}var m=a.channel,d=(d=d||a.callback)||a.message,
u=a.connect||q(),w=a.reconnect||q(),M=a.disconnect||q(),h=a.presence||0,i=a.noheresync||0,na=a.backfill||0,oa=a.timeout||p,ja=a.windowing||f;a.restore&&(L=1);E=0;if(!m)return error("Missing Channel");if(!d)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");W((m.join?m.join(","):""+m).split(","),function(a){var b=j[a]||{};j[U=a]={name:a,e:b.e,d:b.d,f:1,a:T=d,h:u,i:M,j:w};h&&(e.subscribe({channel:a+G,callback:h}),!b.f&&!i&&e.here_now({channel:a,callback:function(b){W("uuids"in
b?b.uuids:[],function(c){h({action:"join",uuid:c,timestamp:P(),occupancy:b.occupancy||1},b,a)})}}))});b=function(){e._reset_offline();clearTimeout(V);V=X(s,100)};if(!D)return F.push(b);b()},here_now:function(a,b){var b=a.callback||b,c=a.error||q(),d=a.channel,e=v(),f=l;if(!d)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");"0"!=e&&(f={},f.callback=e);t({a:e,data:f,c:function(a){b(a)},b:c,url:[z,"v2","presence","sub_key",g,"channel",
Z(d)]})},xdr:t,ready:ga,db:A,uuid:R,each:W,map:Y,grep:ea,supplant:fa,now:P,unique:ba,updater:da,poll_online:function(){M()||e._reset_offline();X(e.poll_online,O)},poll_online2:function(){e.time(function(a){a||e._reset_offline();X(e.poll_online2,u)})}};B||(B=e.uuid());A.set(g+"uuid",B);X(e.poll_online,O);X(e.poll_online2,u);return e}
function Ab(a){function b(a){f||(f=1,clearTimeout(u),c&&(c.onerror=c.onload=l,c.abort&&c.abort(),c=l),a&&s())}function d(){if(!p){p=1;clearTimeout(u);try{response=JSON.parse(c.responseText)}catch(a){return b(1)}g(response)}}var c,f=0,p=0,u=X(function(){b(1)},Bb),s=a.b||q(),g=a.c||q();try{c="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;c.onerror=c.onabort=function(){b(1)};c.onload=c.onloadend=d;c.timeout=Bb;url=a.url.join(Cb);if(a.data){var w=[];url+="?";for(key in a.data)w.push(key+
"="+a.data[key]);url+=w.join(Db)}c.open("GET",url,k);c.send()}catch(y){return b(0),Ab(a)}return b}function Eb(a,b,d){W(a.split(","),function(a){function f(a){a||(a=window.event);d(a)||(a.cancelBubble=k,a.returnValue=n,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,f,n):b.attachEvent?b.attachEvent("on"+a,f):b["on"+a]=f})}
function Fb(a){a.db=Gb;a.xdr=Ab;var b=pa(a);b.init=Fb;if(a.notest)return b;Eb("beforeunload",window,function(){each_channel(function(a){b.LEAVE(a.name,1)});return k});Eb("offline",window,b._reset_offline);Eb("offline",document,b._reset_offline);b.ready();return b}var Cb="/",Db="&",Bb=31E4,Gb,Hb="undefined"!=typeof localStorage&&localStorage;
Gb={get:function(a){try{return Hb?Hb.getItem(a):-1==document.cookie.indexOf(a)?l:((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||l}catch(b){}},set:function(a,b){try{if(Hb)return Hb.setItem(a,b)&&0;document.cookie=a+"="+b+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(d){}}};"undefined"!==typeof module&&(module.m=Fb)||"undefined"!==typeof exports&&(exports.k=Fb)||(PUBNUB=Fb);C=1;D=n;F=[];G="-pnpres";H=10;J=310;N=60;O=1E3;aa=/{([\w\-]+)}/g;
function ba(){return"x"+ ++C+""+ +new Date}function P(){return+new Date}var Ib=Math.floor(20*Math.random());Q=function(a,b){return 0<a.indexOf("pubsub.")&&a.replace("pubsub","ps"+(b?R().split("-")[0]:20>++Ib?Ib:Ib=1))||a};function da(a,b){function d(){f+b>P()?(clearTimeout(c),c=setTimeout(d,b)):(f=P(),a())}var c,f=0;return d}function ea(a,b){var d=[];W(a||[],function(a){b(a)&&d.push(a)});return d}function fa(a,b){return a.replace(aa,function(a,c){return b[c]||a})}
function X(a,b){return setTimeout(a,b)}function R(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}function W(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var d=0,c=a.length;d<c;)b.call(a[d],a[d],d++);else for(d in a)a.hasOwnProperty&&a.hasOwnProperty(d)&&b.call(a[d],d,a[d])}function Y(a,b){var d=[];W(a||[],function(a,f){d.push(b(a,f))});return d}
function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];W(a,function(a,c){c.f&&b.push(a)});return b.sort()}function ga(){X(function(){D||(D=1,W(F,function(a){a()}))},O)}
function pa(a){function b(){}function d(a){a&&(r.g=0);!r.g&&r.length&&(r.g=1,t(r.shift()))}function c(a){W($(j),function(b){(b=j[b])&&a(b)})}var f=+a.windowing||H,p=(+a.timeout||J)*O,u=(+a.keepalive||N)*O,s=a.publish_key||"",g=a.subscribe_key||"",w=a.ssl?"s":"",y="http"+w+"://"+(a.origin||"pubsub.pubnub.com"),z=Q(y),S=Q(y),r=[],T=0,U=0,K=0,L=0,V=0,E=0,j={},t=a.xdr,M=a._is_online||x(1),v=a.jsonp_cb||x(0),A=a.db||{get:q(),set:q()},B=a.uuid||A&&A.get(g+"uuid")||"",e={_reset_offline:function(){K&&K(1)},
LEAVE:function(a,b){var c={uuid:B},d=Q(y),e=v();0<a.indexOf(G)||("0"!=e&&(c.callback=e),t({l:b||w,timeout:2E3,a:e,data:c,url:[d,"v2","presence","sub_key",g,"channel",Z(a),"leave"]}))},history:function(a,b){var b=a.callback||b,c=a.count||a.limit||100,d=a.reverse||"false",e=a.error||q(),f=a.channel,j=a.start,p=a.end,h={},i=v();if(!f)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");h.stringtoken="true";h.count=c;h.reverse=d;i&&(h.callback=
i);j&&(h.start=j);p&&(h.end=p);t({a:i,data:h,c:function(a){b(a)},b:e,url:[z,"v2","history","sub-key",g,"channel",Z(f)]})},replay:function(a){var b=b||a.callback||q(),c=a.source,d=a.destination,e=a.stop,f=a.start,j=a.end,p=a.reverse,a=a.limit,h=v(),i={};if(!c)return error("Missing Source Channel");if(!d)return error("Missing Destination Channel");if(!s)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");"0"!=h&&(i.callback=h);e&&(i.stop="all");p&&(i.reverse="true");f&&(i.start=
f);j&&(i.end=j);a&&(i.count=a);t({a:h,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[z,"v1","replay",s,g,c,d],data:i})},time:function(a){var b=v();t({a:b,timeout:5*O,url:[z,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){var b=b||a.callback||q(),c=a.message,e=a.channel,f=v();if(!c)return error("Missing Message");if(!e)return error("Missing Channel");if(!s)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");c=JSON.stringify(c);
e=[z,"publish",s,g,0,Z(e),f,Z(c)];r.push({a:f,timeout:5*O,url:e,data:{uuid:B},c:function(a){b(a);d(1)},b:function(){b([0,"Failed",c]);d(1)}});d()},unsubscribe:function(a){a=a.channel;E=0;L=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+G}).join(",");W(a.split(","),function(a){D&&e.LEAVE(a,0);j[a]=0});D&&b()},subscribe:function(a,d){function s(a){a?X(r,O):(z=Q(y,1),S=Q(y,1),X(function(){e.time(s)},O));c(function(b){if(a&&b.d)return b.d=0,b.j(b.name);!a&&!b.d&&(b.d=1,b.i(b.name))})}
function r(){var a=v(),b=$(j).join(",");b&&(K=t({timeout:oa,a:a,b:function(){e.time(s)},data:{uuid:B},url:[S,"subscribe",g,Z(b),a,E],c:function(a){if(!a)return X(r,ja);c(function(a){a.e||(a.e=1,a.h(a.name))});E=!E&&L&&A.get(g)||a[1];na&&(Timetoken=1E4,na=0);A.set(g,a[1]);var b,d=(2<a.length?a[2]:"").split(",");b=function(){var a=d.shift()||"";return[(j[a]||{}).a||T,(a||U).split(G)[0]]};W(a[0],function(c){var d=b();if(j[d[1]].f)d[0](c,a,d[1])});X(r,ja)}}))}var m=a.channel,d=(d=d||a.callback)||a.message,
u=a.connect||q(),w=a.reconnect||q(),M=a.disconnect||q(),h=a.presence||0,i=a.noheresync||0,na=a.backfill||0,oa=a.timeout||p,ja=a.windowing||f;a.restore&&(L=1);E=0;if(!m)return error("Missing Channel");if(!d)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");W((m.join?m.join(","):""+m).split(","),function(a){var b=j[a]||{};j[U=a]={name:a,e:b.e,d:b.d,f:1,a:T=d,h:u,i:M,j:w};h&&(e.subscribe({channel:a+G,callback:h}),!b.f&&!i&&e.here_now({channel:a,callback:function(b){W("uuids"in
b?b.uuids:[],function(c){h({action:"join",uuid:c,timestamp:P(),occupancy:b.occupancy||1},b,a)})}}))});b=function(){e._reset_offline();clearTimeout(V);V=X(r,100)};if(!D)return F.push(b);b()},here_now:function(a,b){var b=a.callback||b,c=a.error||q(),d=a.channel,e=v(),f=l;if(!d)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");"0"!=e&&(f={},f.callback=e);t({a:e,data:f,c:function(a){b(a)},b:c,url:[z,"v2","presence","sub_key",g,"channel",
Z(d)]})},xdr:t,ready:ga,db:A,uuid:R,each:W,map:Y,grep:ea,supplant:fa,now:P,unique:ba,updater:da,poll_online:function(){M()||e._reset_offline();X(e.poll_online,O)},poll_online2:function(){e.time(function(a){a||e._reset_offline();X(e.poll_online2,u)})}};B||(B=e.uuid());A.set(g+"uuid",B);X(e.poll_online,O);X(e.poll_online2,u);return e}
function Jb(a){function b(a){f||(f=1,clearTimeout(u),c&&(c.onerror=c.onload=l,c.abort&&c.abort(),c=l),a&&s())}function d(){if(!p){p=1;clearTimeout(u);try{response=JSON.parse(c.responseText)}catch(a){return b(1)}g(response)}}var c,f=0,p=0,u=X(function(){b(1)},Kb),s=a.b||q(),g=a.c||q();try{c="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;c.onerror=c.onabort=function(){b(1)};c.onload=c.onloadend=d;c.timeout=Kb;url=a.url.join(Lb);if(a.data){var w=[];url+="?";for(key in a.data)w.push(key+
"="+a.data[key]);url+=w.join(Mb)}c.open("GET",url,k);c.send()}catch(y){return b(0),Jb(a)}return b}function Nb(a,b,d){W(a.split(","),function(a){function f(a){a||(a=window.event);d(a)||(a.cancelBubble=k,a.returnValue=n,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,f,n):b.attachEvent?b.attachEvent("on"+a,f):b["on"+a]=f})}
function Ob(a){a.db=Pb;a.xdr=Jb;var b=pa(a);b.init=Ob;if(a.notest)return b;Nb("beforeunload",window,function(){each_channel(function(a){b.LEAVE(a.name,1)});return k});Nb("offline",window,b._reset_offline);Nb("offline",document,b._reset_offline);b.ready();return b}var Lb="/",Mb="&",Kb=31E4,Pb,Qb="undefined"!=typeof localStorage&&localStorage;
Pb={get:function(a){try{return Qb?Qb.getItem(a):-1==document.cookie.indexOf(a)?l:((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||l}catch(b){}},set:function(a,b){try{if(Qb)return Qb.setItem(a,b)&&0;document.cookie=a+"="+b+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(d){}}};"undefined"!==typeof module&&(module.m=Ob)||"undefined"!==typeof exports&&(exports.k=Ob)||(PUBNUB=Ob);
})();
