// 3.4.3
(function(){
var p=!0,r=null,t=!1;function u(){return function(){}}function z(a){return function(){return a}}var E=1,F=t,I=[],K="-pnpres",L=10,aa=310,ba=60,O=1E3,ca=/{([\w\-]+)}/g;function da(){return"x"+ ++E+""+ +new Date}function R(){return+new Date}var U=function(){var a=Math.floor(20*Math.random());return function(b,c){return 0<b.indexOf("pubsub.")&&b.replace("pubsub","ps"+(c?T().split("-")[0]:20>++a?a:a=1))||b}}();
function ea(a,b){function c(){v+b>R()?(clearTimeout(d),d=setTimeout(c,b)):(v=R(),a())}var d,v=0;return c}function fa(a,b){var c=[];V(a||[],function(a){b(a)&&c.push(a)});return c}function ga(a,b){return a.replace(ca,function(a,d){return b[d]||a})}function W(a,b){return setTimeout(a,b)}function T(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}
function V(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var c=0,d=a.length;c<d;)b.call(a[c],a[c],c++);else for(c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function Y(a,b){var c=[];V(a||[],function(a,v){c.push(b(a,v))});return c}function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];V(a,function(a,d){d.f&&b.push(a)});return b.sort()}
function ha(){W(function(){F||(F=1,V(I,function(a){a()}))},O)}
function ia(a){function b(){}function c(f){f&&(g.g=0);!g.g&&g.length&&(g.g=1,w(g.shift()))}function d(f){V($(q),function(a){(a=q[a])&&f(a)})}var v=+a.windowing||L,J=(+a.timeout||aa)*O,y=(+a.keepalive||ba)*O,m=a.publish_key||"",k=a.subscribe_key||"",l=a.ssl?"s":"",e="http"+l+"://"+(a.origin||"pubsub.pubnub.com"),s=U(e),n=U(e),g=[],N=0,M=0,C=0,H=0,S=0,D=0,q={},w=a.xdr,Q=a._is_online||z(1),x=a.jsonp_cb||z(0),A=a.db||{get:u(),set:u()},B=a.uuid||A&&A.get(k+"uuid")||"",h={_reset_offline:function(){C&&C(1)},
LEAVE:function(f,a){var b={uuid:B},c=U(e),d=x();0<f.indexOf(K)||("0"!=d&&(b.callback=d),w({k:a||l,timeout:2E3,a:d,data:b,url:[c,"v2","presence","sub_key",k,"channel",Z(f),"leave"]}))},history:function(f,a){a=f.callback||a;var b=f.count||f.limit||100,c=f.reverse||"false",e=f.error||u(),d=f.channel,m=f.start,n=f.end,g={},h=x();if(!d)return error("Missing Channel");if(!a)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");g.stringtoken="true";g.count=b;g.reverse=c;h&&(g.callback=
h);m&&(g.start=m);n&&(g.end=n);w({a:h,data:g,c:function(f){a(f)},b:e,url:[s,"v2","history","sub-key",k,"channel",Z(d)]})},replay:function(f){var a=a||f.callback||u(),b=f.source,c=f.destination,e=f.stop,d=f.start,n=f.end,g=f.reverse;f=f.limit;var h=x(),l={};if(!b)return error("Missing Source Channel");if(!c)return error("Missing Destination Channel");if(!m)return error("Missing Publish Key");if(!k)return error("Missing Subscribe Key");"0"!=h&&(l.callback=h);e&&(l.stop="all");g&&(l.reverse="true");
d&&(l.start=d);n&&(l.end=n);f&&(l.count=f);w({a:h,c:function(f){a(f)},b:function(){a([0,"Disconnected"])},url:[s,"v1","replay",m,k,b,c],data:l})},time:function(f){var a=x();w({a:a,timeout:5*O,url:[s,"time",a],c:function(a){f(a[0])},b:function(){f(0)}})},publish:function(f,a){a=a||f.callback||u();var b=f.message,e=f.channel,d=x();if(!b)return error("Missing Message");if(!e)return error("Missing Channel");if(!m)return error("Missing Publish Key");if(!k)return error("Missing Subscribe Key");b=JSON.stringify(b);
e=[s,"publish",m,k,0,Z(e),d,Z(b)];g.push({a:d,timeout:5*O,url:e,data:{uuid:B},c:function(f){a(f);c(1)},b:function(){a([0,"Failed",b]);c(1)}});c()},unsubscribe:function(f){f=f.channel;D=0;H=1;f=Y((f.join?f.join(","):""+f).split(","),function(f){return f+","+f+K}).join(",");V(f.split(","),function(f){F&&h.LEAVE(f,0);q[f]=0});F&&b()},subscribe:function(f,a){function c(f){f?W(ma,O):(s=U(e,1),n=U(e,1),W(function(){h.time(c)},O));d(function(a){if(f&&a.d)return a.d=0,a.i(a.name);!f&&!a.d&&(a.d=1,a.disconnect(a.name))})}
function ma(){var f=x(),a=$(q).join(",");a&&(C=w({timeout:X,a:f,b:function(){h.time(c)},data:{uuid:B},url:[n,"subscribe",k,Z(a),f,D],c:function(f){if(!f)return W(ma,y);d(function(f){f.e||(f.e=1,f.h(f.name))});(D=!D&&H&&A.get(k)||f[1])&&A.set(k,f[1]);var a=function(){var a=(2<f.length?f[2]:"").split(",");return function(){var f=a.shift()||"";return[(q[f]||{}).a||N,(f||M).split(K)[0]]}}();V(f[0],function(b){var qa=a();if(q[qa[1]].f)qa[0](b,f,qa[1])});W(ma,y)}}))}var la=f.channel;a=(a=a||f.callback)||
f.message;var m=f.connect||u(),g=f.reconnect||u(),l=f.disconnect||u(),P=f.presence||0,G=f.noheresync||0,X=f.timeout||J,y=f.windowing||v;f.restore&&(H=1);D=0;if(!la)return error("Missing Channel");if(!a)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");V((la.join?la.join(","):""+la).split(","),function(f){var b=q[f]||{};q[M=f]={name:f,e:b.e,d:b.d,f:1,a:N=a,h:m,disconnect:l,i:g};P&&(h.subscribe({channel:f+K,callback:P}),!b.f&&!G&&h.here_now({channel:f,callback:function(a){V("uuids"in
a?a.uuids:[],function(b){P({action:"join",uuid:b,timestamp:R(),occupancy:a.occupancy||1},a,f)})}}))});b=function(){h._reset_offline();clearTimeout(S);S=W(ma,100)};if(!F)return I.push(b);b()},here_now:function(f,a){a=f.callback||a;var b=f.error||u(),c=f.channel,e=x(),d=r;if(!c)return error("Missing Channel");if(!a)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");"0"!=e&&(d={},d.callback=e);w({a:e,data:d,c:function(f){a(f)},b:b,url:[s,"v2","presence","sub_key",k,"channel",
Z(c)]})},xdr:w,ready:ha,db:A,uuid:T,each:V,map:Y,grep:fa,supplant:ga,now:R,unique:da,updater:ea,poll_online:function(){Q()||h._reset_offline();W(h.poll_online,O)},poll_online2:function(){h.time(function(f){f||h._reset_offline();W(h.poll_online2,y)})}};B||(B=h.uuid());A.set(k+"uuid",B);W(h.poll_online,O);W(h.poll_online2,y);return h}
(function(){function a(b){function k(a){s||(s=1,clearTimeout(g),e&&(e.onerror=e.onload=r,e.abort&&e.abort(),e=r),a&&N())}function c(){if(!n){n=1;clearTimeout(g);try{response=JSON.parse(e.responseText)}catch(a){return k(1)}M(response)}}var e,s=0,n=0,g=W(function(){k(1)},J),N=b.b||u(),M=b.c||u();try{e="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;e.onerror=e.onabort=function(){k(1)};e.onload=e.onloadend=c;e.timeout=J;url=b.url.join(d);if(b.data){var C=[];url+="?";for(key in b.data)C.push(key+
"="+b.data[key]);url+=C.join(v)}e.open("GET",url,p);e.send()}catch(H){return k(0),a(b)}return k}function b(a,b,c){V(a.split(","),function(a){function d(a){a||(a=window.event);c(a)||(a.cancelBubble=p,a.returnValue=t,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,d,t):b.attachEvent?b.attachEvent("on"+a,d):b["on"+a]=d})}function c(d){d.db=y;d.xdr=a;var k=ia(d);k.init=c;if(d.notest)return k;b("beforeunload",window,function(){each_channel(function(a){k.LEAVE(a.name,
1)});return p});b("offline",window,k._reset_offline);b("offline",document,k._reset_offline);k.ready();return k}var d="/",v="&",J=31E4,y=function(){var a="undefined"!=typeof localStorage&&localStorage;return{get:function(b){try{return a?a.getItem(b):-1==document.cookie.indexOf(b)?r:((document.cookie||"").match(RegExp(b+"=([^;]+)"))||[])[1]||r}catch(c){}},set:function(b,c){try{if(a)return a.setItem(b,c)&&0;document.cookie=b+"="+c+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(e){}}}}();"undefined"!==
typeof module&&(module.l=c)||"undefined"!==typeof exports&&(exports.j=c)||(PUBNUB=c)})();E=1;F=t;I=[];K="-pnpres";L=10;aa=310;ba=60;O=1E3;ca=/{([\w\-]+)}/g;function da(){return"x"+ ++E+""+ +new Date}function R(){return+new Date}U=function(){var a=Math.floor(20*Math.random());return function(b,c){return 0<b.indexOf("pubsub.")&&b.replace("pubsub","ps"+(c?T().split("-")[0]:20>++a?a:a=1))||b}}();function ea(a,b){function c(){v+b>R()?(clearTimeout(d),d=setTimeout(c,b)):(v=R(),a())}var d,v=0;return c}
function fa(a,b){var c=[];V(a||[],function(a){b(a)&&c.push(a)});return c}function ga(a,b){return a.replace(ca,function(a,d){return b[d]||a})}function W(a,b){return setTimeout(a,b)}function T(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}
function V(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var c=0,d=a.length;c<d;)b.call(a[c],a[c],c++);else for(c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function Y(a,b){var c=[];V(a||[],function(a,v){c.push(b(a,v))});return c}function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];V(a,function(a,d){d.f&&b.push(a)});return b.sort()}
function ha(){W(function(){F||(F=1,V(I,function(a){a()}))},O)}
function ia(a){function b(){}function c(f){f&&(g.g=0);!g.g&&g.length&&(g.g=1,w(g.shift()))}function d(f){V($(q),function(a){(a=q[a])&&f(a)})}var v=+a.windowing||L,J=(+a.timeout||aa)*O,y=(+a.keepalive||ba)*O,m=a.publish_key||"",k=a.subscribe_key||"",l=a.ssl?"s":"",e="http"+l+"://"+(a.origin||"pubsub.pubnub.com"),s=U(e),n=U(e),g=[],N=0,M=0,C=0,H=0,S=0,D=0,q={},w=a.xdr,Q=a._is_online||z(1),x=a.jsonp_cb||z(0),A=a.db||{get:u(),set:u()},B=a.uuid||A&&A.get(k+"uuid")||"",h={_reset_offline:function(){C&&C(1)},
LEAVE:function(f,a){var b={uuid:B},c=U(e),d=x();0<f.indexOf(K)||("0"!=d&&(b.callback=d),w({k:a||l,timeout:2E3,a:d,data:b,url:[c,"v2","presence","sub_key",k,"channel",Z(f),"leave"]}))},history:function(f,a){a=f.callback||a;var b=f.count||f.limit||100,c=f.reverse||"false",e=f.error||u(),d=f.channel,m=f.start,g=f.end,n={},h=x();if(!d)return error("Missing Channel");if(!a)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");n.stringtoken="true";n.count=b;n.reverse=c;h&&(n.callback=
h);m&&(n.start=m);g&&(n.end=g);w({a:h,data:n,c:function(f){a(f)},b:e,url:[s,"v2","history","sub-key",k,"channel",Z(d)]})},replay:function(f){var a=a||f.callback||u(),b=f.source,c=f.destination,e=f.stop,d=f.start,n=f.end,g=f.reverse;f=f.limit;var h=x(),l={};if(!b)return error("Missing Source Channel");if(!c)return error("Missing Destination Channel");if(!m)return error("Missing Publish Key");if(!k)return error("Missing Subscribe Key");"0"!=h&&(l.callback=h);e&&(l.stop="all");g&&(l.reverse="true");
d&&(l.start=d);n&&(l.end=n);f&&(l.count=f);w({a:h,c:function(f){a(f)},b:function(){a([0,"Disconnected"])},url:[s,"v1","replay",m,k,b,c],data:l})},time:function(f){var a=x();w({a:a,timeout:5*O,url:[s,"time",a],c:function(a){f(a[0])},b:function(){f(0)}})},publish:function(f,a){a=a||f.callback||u();var b=f.message,e=f.channel,d=x();if(!b)return error("Missing Message");if(!e)return error("Missing Channel");if(!m)return error("Missing Publish Key");if(!k)return error("Missing Subscribe Key");b=JSON.stringify(b);
e=[s,"publish",m,k,0,Z(e),d,Z(b)];g.push({a:d,timeout:5*O,url:e,data:{uuid:B},c:function(f){a(f);c(1)},b:function(){a([0,"Failed",b]);c(1)}});c()},unsubscribe:function(f){f=f.channel;D=0;H=1;f=Y((f.join?f.join(","):""+f).split(","),function(f){return f+","+f+K}).join(",");V(f.split(","),function(f){F&&h.LEAVE(f,0);q[f]=0});F&&b()},subscribe:function(f,a){function c(f){f?W(ma,O):(s=U(e,1),n=U(e,1),W(function(){h.time(c)},O));d(function(a){if(f&&a.d)return a.d=0,a.i(a.name);!f&&!a.d&&(a.d=1,a.disconnect(a.name))})}
function ma(){var f=x(),a=$(q).join(",");a&&(C=w({timeout:X,a:f,b:function(){h.time(c)},data:{uuid:B},url:[n,"subscribe",k,Z(a),f,D],c:function(f){if(!f)return W(ma,y);d(function(f){f.e||(f.e=1,f.h(f.name))});(D=!D&&H&&A.get(k)||f[1])&&A.set(k,f[1]);var a=function(){var a=(2<f.length?f[2]:"").split(",");return function(){var f=a.shift()||"";return[(q[f]||{}).a||N,(f||M).split(K)[0]]}}();V(f[0],function(b){var c=a();if(q[c[1]].f)c[0](b,f,c[1])});W(ma,y)}}))}var la=f.channel;a=(a=a||f.callback)||f.message;
var m=f.connect||u(),g=f.reconnect||u(),l=f.disconnect||u(),P=f.presence||0,G=f.noheresync||0,X=f.timeout||J,y=f.windowing||v;f.restore&&(H=1);D=0;if(!la)return error("Missing Channel");if(!a)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");V((la.join?la.join(","):""+la).split(","),function(f){var b=q[f]||{};q[M=f]={name:f,e:b.e,d:b.d,f:1,a:N=a,h:m,disconnect:l,i:g};P&&(h.subscribe({channel:f+K,callback:P}),!b.f&&!G&&h.here_now({channel:f,callback:function(a){V("uuids"in
a?a.uuids:[],function(b){P({action:"join",uuid:b,timestamp:R(),occupancy:a.occupancy||1},a,f)})}}))});b=function(){h._reset_offline();clearTimeout(S);S=W(ma,100)};if(!F)return I.push(b);b()},here_now:function(f,a){a=f.callback||a;var b=f.error||u(),c=f.channel,e=x(),d=r;if(!c)return error("Missing Channel");if(!a)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");"0"!=e&&(d={},d.callback=e);w({a:e,data:d,c:function(f){a(f)},b:b,url:[s,"v2","presence","sub_key",k,"channel",
Z(c)]})},xdr:w,ready:ha,db:A,uuid:T,each:V,map:Y,grep:fa,supplant:ga,now:R,unique:da,updater:ea,poll_online:function(){Q()||h._reset_offline();W(h.poll_online,O)},poll_online2:function(){h.time(function(f){f||h._reset_offline();W(h.poll_online2,y)})}};B||(B=h.uuid());A.set(k+"uuid",B);W(h.poll_online,O);W(h.poll_online2,y);return h}
(function(){function a(b){function c(a){s||(s=1,clearTimeout(g),e&&(e.onerror=e.onload=r,e.abort&&e.abort(),e=r),a&&N())}function l(){if(!n){n=1;clearTimeout(g);try{response=JSON.parse(e.responseText)}catch(a){return c(1)}M(response)}}var e,s=0,n=0,g=W(function(){c(1)},J),N=b.b||u(),M=b.c||u();try{e="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;e.onerror=e.onabort=function(){c(1)};e.onload=e.onloadend=l;e.timeout=J;url=b.url.join(d);if(b.data){var C=[];url+="?";for(key in b.data)C.push(key+
"="+b.data[key]);url+=C.join(v)}e.open("GET",url,p);e.send()}catch(H){return c(0),a(b)}return c}function b(a,b,c){V(a.split(","),function(a){function d(a){a||(a=window.event);c(a)||(a.cancelBubble=p,a.returnValue=t,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,d,t):b.attachEvent?b.attachEvent("on"+a,d):b["on"+a]=d})}function c(d){d.db=y;d.xdr=a;var k=ia(d);k.init=c;if(d.notest)return k;b("beforeunload",window,function(){each_channel(function(a){k.LEAVE(a.name,
1)});return p});b("offline",window,k._reset_offline);b("offline",document,k._reset_offline);k.ready();return k}var d="/",v="&",J=31E4,y=function(){var a="undefined"!=typeof localStorage&&localStorage;return{get:function(b){try{return a?a.getItem(b):-1==document.cookie.indexOf(b)?r:((document.cookie||"").match(RegExp(b+"=([^;]+)"))||[])[1]||r}catch(c){}},set:function(b,c){try{if(a)return a.setItem(b,c)&&0;document.cookie=b+"="+c+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(e){}}}}();"undefined"!==
typeof module&&(module.l=c)||"undefined"!==typeof exports&&(exports.j=c)||(PUBNUB=c)})();E=1;F=t;I=[];K="-pnpres";L=10;aa=310;ba=60;O=1E3;ca=/{([\w\-]+)}/g;function da(){return"x"+ ++E+""+ +new Date}function R(){return+new Date}U=function(){var a=Math.floor(20*Math.random());return function(b,c){return 0<b.indexOf("pubsub.")&&b.replace("pubsub","ps"+(c?T().split("-")[0]:20>++a?a:a=1))||b}}();function ea(a,b){function c(){v+b>R()?(clearTimeout(d),d=setTimeout(c,b)):(v=R(),a())}var d,v=0;return c}
function fa(a,b){var c=[];V(a||[],function(a){b(a)&&c.push(a)});return c}function ga(a,b){return a.replace(ca,function(a,d){return b[d]||a})}function W(a,b){return setTimeout(a,b)}function T(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}
function V(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var c=0,d=a.length;c<d;)b.call(a[c],a[c],c++);else for(c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function Y(a,b){var c=[];V(a||[],function(a,v){c.push(b(a,v))});return c}function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];V(a,function(a,d){d.f&&b.push(a)});return b.sort()}
function ha(){W(function(){F||(F=1,V(I,function(a){a()}))},O)}
function ia(a){function b(){}function c(f){f&&(g.g=0);!g.g&&g.length&&(g.g=1,w(g.shift()))}function d(f){V($(q),function(a){(a=q[a])&&f(a)})}var v=+a.windowing||L,J=(+a.timeout||aa)*O,y=(+a.keepalive||ba)*O,m=a.publish_key||"",k=a.subscribe_key||"",l=a.ssl?"s":"",e="http"+l+"://"+(a.origin||"pubsub.pubnub.com"),s=U(e),n=U(e),g=[],N=0,M=0,C=0,H=0,S=0,D=0,q={},w=a.xdr,Q=a._is_online||z(1),x=a.jsonp_cb||z(0),A=a.db||{get:u(),set:u()},B=a.uuid||A&&A.get(k+"uuid")||"",h={_reset_offline:function(){C&&C(1)},
LEAVE:function(f,a){var b={uuid:B},c=U(e),d=x();0<f.indexOf(K)||("0"!=d&&(b.callback=d),w({k:a||l,timeout:2E3,a:d,data:b,url:[c,"v2","presence","sub_key",k,"channel",Z(f),"leave"]}))},history:function(f,a){a=f.callback||a;var b=f.count||f.limit||100,c=f.reverse||"false",e=f.error||u(),d=f.channel,g=f.start,n=f.end,h={},m=x();if(!d)return error("Missing Channel");if(!a)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");h.stringtoken="true";h.count=b;h.reverse=c;m&&(h.callback=
m);g&&(h.start=g);n&&(h.end=n);w({a:m,data:h,c:function(f){a(f)},b:e,url:[s,"v2","history","sub-key",k,"channel",Z(d)]})},replay:function(f){var a=a||f.callback||u(),b=f.source,c=f.destination,e=f.stop,d=f.start,g=f.end,h=f.reverse;f=f.limit;var n=x(),l={};if(!b)return error("Missing Source Channel");if(!c)return error("Missing Destination Channel");if(!m)return error("Missing Publish Key");if(!k)return error("Missing Subscribe Key");"0"!=n&&(l.callback=n);e&&(l.stop="all");h&&(l.reverse="true");
d&&(l.start=d);g&&(l.end=g);f&&(l.count=f);w({a:n,c:function(f){a(f)},b:function(){a([0,"Disconnected"])},url:[s,"v1","replay",m,k,b,c],data:l})},time:function(f){var a=x();w({a:a,timeout:5*O,url:[s,"time",a],c:function(a){f(a[0])},b:function(){f(0)}})},publish:function(f,a){a=a||f.callback||u();var b=f.message,e=f.channel,d=x();if(!b)return error("Missing Message");if(!e)return error("Missing Channel");if(!m)return error("Missing Publish Key");if(!k)return error("Missing Subscribe Key");b=JSON.stringify(b);
e=[s,"publish",m,k,0,Z(e),d,Z(b)];g.push({a:d,timeout:5*O,url:e,data:{uuid:B},c:function(f){a(f);c(1)},b:function(){a([0,"Failed",b]);c(1)}});c()},unsubscribe:function(f){f=f.channel;D=0;H=1;f=Y((f.join?f.join(","):""+f).split(","),function(f){return f+","+f+K}).join(",");V(f.split(","),function(f){F&&h.LEAVE(f,0);q[f]=0});F&&b()},subscribe:function(f,a){function c(f){f?W(g,O):(s=U(e,1),n=U(e,1),W(function(){h.time(c)},O));d(function(a){if(f&&a.d)return a.d=0,a.i(a.name);!f&&!a.d&&(a.d=1,a.disconnect(a.name))})}
function g(){var f=x(),a=$(q).join(",");a&&(C=w({timeout:X,a:f,b:function(){h.time(c)},data:{uuid:B},url:[n,"subscribe",k,Z(a),f,D],c:function(f){if(!f)return W(g,y);d(function(f){f.e||(f.e=1,f.h(f.name))});(D=!D&&H&&A.get(k)||f[1])&&A.set(k,f[1]);var a=function(){var a=(2<f.length?f[2]:"").split(",");return function(){var f=a.shift()||"";return[(q[f]||{}).a||N,(f||M).split(K)[0]]}}();V(f[0],function(b){var c=a();if(q[c[1]].f)c[0](b,f,c[1])});W(g,y)}}))}var la=f.channel;a=(a=a||f.callback)||f.message;
var m=f.connect||u(),l=f.reconnect||u(),ka=f.disconnect||u(),P=f.presence||0,G=f.noheresync||0,X=f.timeout||J,y=f.windowing||v;f.restore&&(H=1);D=0;if(!la)return error("Missing Channel");if(!a)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");V((la.join?la.join(","):""+la).split(","),function(f){var b=q[f]||{};q[M=f]={name:f,e:b.e,d:b.d,f:1,a:N=a,h:m,disconnect:ka,i:l};P&&(h.subscribe({channel:f+K,callback:P}),!b.f&&!G&&h.here_now({channel:f,callback:function(a){V("uuids"in
a?a.uuids:[],function(b){P({action:"join",uuid:b,timestamp:R(),occupancy:a.occupancy||1},a,f)})}}))});b=function(){h._reset_offline();clearTimeout(S);S=W(g,100)};if(!F)return I.push(b);b()},here_now:function(f,a){a=f.callback||a;var b=f.error||u(),c=f.channel,e=x(),d=r;if(!c)return error("Missing Channel");if(!a)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");"0"!=e&&(d={},d.callback=e);w({a:e,data:d,c:function(f){a(f)},b:b,url:[s,"v2","presence","sub_key",k,"channel",
Z(c)]})},xdr:w,ready:ha,db:A,uuid:T,each:V,map:Y,grep:fa,supplant:ga,now:R,unique:da,updater:ea,poll_online:function(){Q()||h._reset_offline();W(h.poll_online,O)},poll_online2:function(){h.time(function(f){f||h._reset_offline();W(h.poll_online2,y)})}};B||(B=h.uuid());A.set(k+"uuid",B);W(h.poll_online,O);W(h.poll_online2,y);return h}
(function(){function a(b){function c(a){s||(s=1,clearTimeout(g),e&&(e.onerror=e.onload=r,e.abort&&e.abort(),e=r),a&&N())}function l(){if(!n){n=1;clearTimeout(g);try{response=JSON.parse(e.responseText)}catch(a){return c(1)}M(response)}}var e,s=0,n=0,g=W(function(){c(1)},J),N=b.b||u(),M=b.c||u();try{e="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;e.onerror=e.onabort=function(){c(1)};e.onload=e.onloadend=l;e.timeout=J;url=b.url.join(d);if(b.data){var C=[];url+="?";for(key in b.data)C.push(key+
"="+b.data[key]);url+=C.join(v)}e.open("GET",url,p);e.send()}catch(H){return c(0),a(b)}return c}function b(a,b,c){V(a.split(","),function(a){function d(a){a||(a=window.event);c(a)||(a.cancelBubble=p,a.returnValue=t,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,d,t):b.attachEvent?b.attachEvent("on"+a,d):b["on"+a]=d})}function c(d){d.db=y;d.xdr=a;var k=ia(d);k.init=c;if(d.notest)return k;b("beforeunload",window,function(){each_channel(function(a){k.LEAVE(a.name,
1)});return p});b("offline",window,k._reset_offline);b("offline",document,k._reset_offline);k.ready();return k}var d="/",v="&",J=31E4,y=function(){var a="undefined"!=typeof localStorage&&localStorage;return{get:function(b){try{return a?a.getItem(b):-1==document.cookie.indexOf(b)?r:((document.cookie||"").match(RegExp(b+"=([^;]+)"))||[])[1]||r}catch(c){}},set:function(b,c){try{if(a)return a.setItem(b,c)&&0;document.cookie=b+"="+c+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(e){}}}}();"undefined"!==
typeof module&&(module.l=c)||"undefined"!==typeof exports&&(exports.j=c)||(PUBNUB=c)})();E=1;F=t;I=[];K="-pnpres";L=10;aa=310;ba=60;O=1E3;ca=/{([\w\-]+)}/g;function da(){return"x"+ ++E+""+ +new Date}function R(){return+new Date}U=function(){var a=Math.floor(20*Math.random());return function(b,c){return 0<b.indexOf("pubsub.")&&b.replace("pubsub","ps"+(c?T().split("-")[0]:20>++a?a:a=1))||b}}();function ea(a,b){function c(){v+b>R()?(clearTimeout(d),d=setTimeout(c,b)):(v=R(),a())}var d,v=0;return c}
function fa(a,b){var c=[];V(a||[],function(a){b(a)&&c.push(a)});return c}function ga(a,b){return a.replace(ca,function(a,d){return b[d]||a})}function W(a,b){return setTimeout(a,b)}function T(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}
function V(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var c=0,d=a.length;c<d;)b.call(a[c],a[c],c++);else for(c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function Y(a,b){var c=[];V(a||[],function(a,v){c.push(b(a,v))});return c}function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];V(a,function(a,d){d.f&&b.push(a)});return b.sort()}
function ha(){W(function(){F||(F=1,V(I,function(a){a()}))},O)}
function ia(a){function b(){}function c(a){a&&(g.g=0);!g.g&&g.length&&(g.g=1,w(g.shift()))}function d(a){V($(q),function(b){(b=q[b])&&a(b)})}var v=+a.windowing||L,J=(+a.timeout||aa)*O,y=(+a.keepalive||ba)*O,m=a.publish_key||"",k=a.subscribe_key||"",l=a.ssl?"s":"",e="http"+l+"://"+(a.origin||"pubsub.pubnub.com"),s=U(e),n=U(e),g=[],N=0,M=0,C=0,H=0,S=0,D=0,q={},w=a.xdr,Q=a._is_online||z(1),x=a.jsonp_cb||z(0),A=a.db||{get:u(),set:u()},B=a.uuid||A&&A.get(k+"uuid")||"",h={_reset_offline:function(){C&&C(1)},
LEAVE:function(a,b){var c={uuid:B},d=U(e),g=x();0<a.indexOf(K)||("0"!=g&&(c.callback=g),w({k:b||l,timeout:2E3,a:g,data:c,url:[d,"v2","presence","sub_key",k,"channel",Z(a),"leave"]}))},history:function(a,b){b=a.callback||b;var c=a.count||a.limit||100,e=a.reverse||"false",d=a.error||u(),g=a.channel,h=a.start,n=a.end,l={},m=x();if(!g)return error("Missing Channel");if(!b)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");l.stringtoken="true";l.count=c;l.reverse=e;m&&(l.callback=
m);h&&(l.start=h);n&&(l.end=n);w({a:m,data:l,c:function(a){b(a)},b:d,url:[s,"v2","history","sub-key",k,"channel",Z(g)]})},replay:function(a){var b=b||a.callback||u(),c=a.source,e=a.destination,d=a.stop,g=a.start,h=a.end,n=a.reverse;a=a.limit;var l=x(),G={};if(!c)return error("Missing Source Channel");if(!e)return error("Missing Destination Channel");if(!m)return error("Missing Publish Key");if(!k)return error("Missing Subscribe Key");"0"!=l&&(G.callback=l);d&&(G.stop="all");n&&(G.reverse="true");
g&&(G.start=g);h&&(G.end=h);a&&(G.count=a);w({a:l,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[s,"v1","replay",m,k,c,e],data:G})},time:function(a){var b=x();w({a:b,timeout:5*O,url:[s,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){b=b||a.callback||u();var e=a.message,d=a.channel,h=x();if(!e)return error("Missing Message");if(!d)return error("Missing Channel");if(!m)return error("Missing Publish Key");if(!k)return error("Missing Subscribe Key");e=JSON.stringify(e);
d=[s,"publish",m,k,0,Z(d),h,Z(e)];g.push({a:h,timeout:5*O,url:d,data:{uuid:B},c:function(a){b(a);c(1)},b:function(){b([0,"Failed",e]);c(1)}});c()},unsubscribe:function(a){a=a.channel;D=0;H=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+K}).join(",");V(a.split(","),function(a){F&&h.LEAVE(a,0);q[a]=0});F&&b()},subscribe:function(a,c){function g(a){a?W(l,O):(s=U(e,1),n=U(e,1),W(function(){h.time(g)},O));d(function(f){if(a&&f.d)return f.d=0,f.i(f.name);!a&&!f.d&&(f.d=1,f.disconnect(f.name))})}
function l(){var a=x(),f=$(q).join(",");f&&(C=w({timeout:X,a:a,b:function(){h.time(g)},data:{uuid:B},url:[n,"subscribe",k,Z(f),a,D],c:function(a){if(!a)return W(l,Q);d(function(a){a.e||(a.e=1,a.h(a.name))});(D=!D&&H&&A.get(k)||a[1])&&A.set(k,a[1]);var f=function(){var f=(2<a.length?a[2]:"").split(",");return function(){var a=f.shift()||"";return[(q[a]||{}).a||N,(a||M).split(K)[0]]}}();V(a[0],function(b){var c=f();if(q[c[1]].f)c[0](b,a,c[1])});W(l,Q)}}))}var m=a.channel;c=(c=c||a.callback)||a.message;
var na=a.connect||u(),oa=a.reconnect||u(),y=a.disconnect||u(),P=a.presence||0,G=a.noheresync||0,X=a.timeout||J,Q=a.windowing||v;a.restore&&(H=1);D=0;if(!m)return error("Missing Channel");if(!c)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");V((m.join?m.join(","):""+m).split(","),function(a){var f=q[a]||{};q[M=a]={name:a,e:f.e,d:f.d,f:1,a:N=c,h:na,disconnect:y,i:oa};P&&(h.subscribe({channel:a+K,callback:P}),!f.f&&!G&&h.here_now({channel:a,callback:function(f){V("uuids"in
f?f.uuids:[],function(b){P({action:"join",uuid:b,timestamp:R(),occupancy:f.occupancy||1},f,a)})}}))});b=function(){h._reset_offline();clearTimeout(S);S=W(l,100)};if(!F)return I.push(b);b()},here_now:function(a,b){b=a.callback||b;var c=a.error||u(),e=a.channel,d=x(),g=r;if(!e)return error("Missing Channel");if(!b)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");"0"!=d&&(g={},g.callback=d);w({a:d,data:g,c:function(a){b(a)},b:c,url:[s,"v2","presence","sub_key",k,"channel",
Z(e)]})},xdr:w,ready:ha,db:A,uuid:T,each:V,map:Y,grep:fa,supplant:ga,now:R,unique:da,updater:ea,poll_online:function(){Q()||h._reset_offline();W(h.poll_online,O)},poll_online2:function(){h.time(function(a){a||h._reset_offline();W(h.poll_online2,y)})}};B||(B=h.uuid());A.set(k+"uuid",B);W(h.poll_online,O);W(h.poll_online2,y);return h}
(function(){function a(b){function c(a){s||(s=1,clearTimeout(g),e&&(e.onerror=e.onload=r,e.abort&&e.abort(),e=r),a&&N())}function l(){if(!n){n=1;clearTimeout(g);try{response=JSON.parse(e.responseText)}catch(a){return c(1)}M(response)}}var e,s=0,n=0,g=W(function(){c(1)},J),N=b.b||u(),M=b.c||u();try{e="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;e.onerror=e.onabort=function(){c(1)};e.onload=e.onloadend=l;e.timeout=J;url=b.url.join(d);if(b.data){var C=[];url+="?";for(key in b.data)C.push(key+
"="+b.data[key]);url+=C.join(v)}e.open("GET",url,p);e.send()}catch(H){return c(0),a(b)}return c}function b(a,b,c){V(a.split(","),function(a){function d(a){a||(a=window.event);c(a)||(a.cancelBubble=p,a.returnValue=t,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,d,t):b.attachEvent?b.attachEvent("on"+a,d):b["on"+a]=d})}function c(d){d.db=y;d.xdr=a;var k=ia(d);k.init=c;if(d.notest)return k;b("beforeunload",window,function(){each_channel(function(a){k.LEAVE(a.name,
1)});return p});b("offline",window,k._reset_offline);b("offline",document,k._reset_offline);k.ready();return k}var d="/",v="&",J=31E4,y=function(){var a="undefined"!=typeof localStorage&&localStorage;return{get:function(b){try{return a?a.getItem(b):-1==document.cookie.indexOf(b)?r:((document.cookie||"").match(RegExp(b+"=([^;]+)"))||[])[1]||r}catch(c){}},set:function(b,c){try{if(a)return a.setItem(b,c)&&0;document.cookie=b+"="+c+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(e){}}}}();"undefined"!==
typeof module&&(module.l=c)||"undefined"!==typeof exports&&(exports.j=c)||(PUBNUB=c)})();E=1;F=t;I=[];K="-pnpres";L=10;aa=310;ba=60;O=1E3;ca=/{([\w\-]+)}/g;function da(){return"x"+ ++E+""+ +new Date}function R(){return+new Date}U=function(){var a=Math.floor(20*Math.random());return function(b,c){return 0<b.indexOf("pubsub.")&&b.replace("pubsub","ps"+(c?T().split("-")[0]:20>++a?a:a=1))||b}}();function ea(a,b){function c(){v+b>R()?(clearTimeout(d),d=setTimeout(c,b)):(v=R(),a())}var d,v=0;return c}
function fa(a,b){var c=[];V(a||[],function(a){b(a)&&c.push(a)});return c}function ga(a,b){return a.replace(ca,function(a,d){return b[d]||a})}function W(a,b){return setTimeout(a,b)}function T(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}
function V(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var c=0,d=a.length;c<d;)b.call(a[c],a[c],c++);else for(c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function Y(a,b){var c=[];V(a||[],function(a,v){c.push(b(a,v))});return c}function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];V(a,function(a,d){d.f&&b.push(a)});return b.sort()}
function ha(){W(function(){F||(F=1,V(I,function(a){a()}))},O)}
function ia(a){function b(){}function c(a){a&&(g.g=0);!g.g&&g.length&&(g.g=1,w(g.shift()))}function d(a){V($(q),function(b){(b=q[b])&&a(b)})}var v=+a.windowing||L,J=(+a.timeout||aa)*O,y=(+a.keepalive||ba)*O,m=a.publish_key||"",k=a.subscribe_key||"",l=a.ssl?"s":"",e="http"+l+"://"+(a.origin||"pubsub.pubnub.com"),s=U(e),n=U(e),g=[],N=0,M=0,C=0,H=0,S=0,D=0,q={},w=a.xdr,Q=a._is_online||z(1),x=a.jsonp_cb||z(0),A=a.db||{get:u(),set:u()},B=a.uuid||A&&A.get(k+"uuid")||"",h={_reset_offline:function(){C&&C(1)},
LEAVE:function(a,b){var c={uuid:B},d=U(e),g=x();0<a.indexOf(K)||("0"!=g&&(c.callback=g),w({k:b||l,timeout:2E3,a:g,data:c,url:[d,"v2","presence","sub_key",k,"channel",Z(a),"leave"]}))},history:function(a,b){b=a.callback||b;var c=a.count||a.limit||100,e=a.reverse||"false",d=a.error||u(),g=a.channel,h=a.start,n=a.end,l={},m=x();if(!g)return error("Missing Channel");if(!b)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");l.stringtoken="true";l.count=c;l.reverse=e;m&&(l.callback=
m);h&&(l.start=h);n&&(l.end=n);w({a:m,data:l,c:function(a){b(a)},b:d,url:[s,"v2","history","sub-key",k,"channel",Z(g)]})},replay:function(a){var b=b||a.callback||u(),c=a.source,e=a.destination,d=a.stop,g=a.start,h=a.end,l=a.reverse;a=a.limit;var n=x(),G={};if(!c)return error("Missing Source Channel");if(!e)return error("Missing Destination Channel");if(!m)return error("Missing Publish Key");if(!k)return error("Missing Subscribe Key");"0"!=n&&(G.callback=n);d&&(G.stop="all");l&&(G.reverse="true");
g&&(G.start=g);h&&(G.end=h);a&&(G.count=a);w({a:n,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[s,"v1","replay",m,k,c,e],data:G})},time:function(a){var b=x();w({a:b,timeout:5*O,url:[s,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){b=b||a.callback||u();var e=a.message,d=a.channel,h=x();if(!e)return error("Missing Message");if(!d)return error("Missing Channel");if(!m)return error("Missing Publish Key");if(!k)return error("Missing Subscribe Key");e=JSON.stringify(e);
d=[s,"publish",m,k,0,Z(d),h,Z(e)];g.push({a:h,timeout:5*O,url:d,data:{uuid:B},c:function(a){b(a);c(1)},b:function(){b([0,"Failed",e]);c(1)}});c()},unsubscribe:function(a){a=a.channel;D=0;H=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+K}).join(",");V(a.split(","),function(a){F&&h.LEAVE(a,0);q[a]=0});F&&b()},subscribe:function(a,c){function g(a){a?W(l,O):(s=U(e,1),n=U(e,1),W(function(){h.time(g)},O));d(function(f){if(a&&f.d)return f.d=0,f.i(f.name);!a&&!f.d&&(f.d=1,f.disconnect(f.name))})}
function l(){var a=x(),f=$(q).join(",");f&&(C=w({timeout:X,a:a,b:function(){h.time(g)},data:{uuid:B},url:[n,"subscribe",k,Z(f),a,D],c:function(a){if(!a)return W(l,Q);d(function(a){a.e||(a.e=1,a.h(a.name))});(D=!D&&H&&A.get(k)||a[1])&&A.set(k,a[1]);var f=function(){var f=(2<a.length?a[2]:"").split(",");return function(){var a=f.shift()||"";return[(q[a]||{}).a||N,(a||M).split(K)[0]]}}();V(a[0],function(b){var c=f();if(q[c[1]].f)c[0](b,a,c[1])});W(l,Q)}}))}var m=a.channel;c=(c=c||a.callback)||a.message;
var na=a.connect||u(),oa=a.reconnect||u(),y=a.disconnect||u(),P=a.presence||0,G=a.noheresync||0,X=a.timeout||J,Q=a.windowing||v;a.restore&&(H=1);D=0;if(!m)return error("Missing Channel");if(!c)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");V((m.join?m.join(","):""+m).split(","),function(a){var f=q[a]||{};q[M=a]={name:a,e:f.e,d:f.d,f:1,a:N=c,h:na,disconnect:y,i:oa};P&&(h.subscribe({channel:a+K,callback:P}),!f.f&&!G&&h.here_now({channel:a,callback:function(f){V("uuids"in
f?f.uuids:[],function(b){P({action:"join",uuid:b,timestamp:R(),occupancy:f.occupancy||1},f,a)})}}))});b=function(){h._reset_offline();clearTimeout(S);S=W(l,100)};if(!F)return I.push(b);b()},here_now:function(a,b){b=a.callback||b;var c=a.error||u(),e=a.channel,d=x(),g=r;if(!e)return error("Missing Channel");if(!b)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");"0"!=d&&(g={},g.callback=d);w({a:d,data:g,c:function(a){b(a)},b:c,url:[s,"v2","presence","sub_key",k,"channel",
Z(e)]})},xdr:w,ready:ha,db:A,uuid:T,each:V,map:Y,grep:fa,supplant:ga,now:R,unique:da,updater:ea,poll_online:function(){Q()||h._reset_offline();W(h.poll_online,O)},poll_online2:function(){h.time(function(a){a||h._reset_offline();W(h.poll_online2,y)})}};B||(B=h.uuid());A.set(k+"uuid",B);W(h.poll_online,O);W(h.poll_online2,y);return h}
(function(){function a(b){function c(a){s||(s=1,clearTimeout(g),e&&(e.onerror=e.onload=r,e.abort&&e.abort(),e=r),a&&N())}function l(){if(!n){n=1;clearTimeout(g);try{response=JSON.parse(e.responseText)}catch(a){return c(1)}M(response)}}var e,s=0,n=0,g=W(function(){c(1)},J),N=b.b||u(),M=b.c||u();try{e="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;e.onerror=e.onabort=function(){c(1)};e.onload=e.onloadend=l;e.timeout=J;url=b.url.join(d);if(b.data){var C=[];url+="?";for(key in b.data)C.push(key+
"="+b.data[key]);url+=C.join(v)}e.open("GET",url,p);e.send()}catch(H){return c(0),a(b)}return c}function b(a,b,c){V(a.split(","),function(a){function d(a){a||(a=window.event);c(a)||(a.cancelBubble=p,a.returnValue=t,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,d,t):b.attachEvent?b.attachEvent("on"+a,d):b["on"+a]=d})}function c(d){d.db=y;d.xdr=a;var k=ia(d);k.init=c;if(d.notest)return k;b("beforeunload",window,function(){each_channel(function(a){k.LEAVE(a.name,
1)});return p});b("offline",window,k._reset_offline);b("offline",document,k._reset_offline);k.ready();return k}var d="/",v="&",J=31E4,y=function(){var a="undefined"!=typeof localStorage&&localStorage;return{get:function(b){try{return a?a.getItem(b):-1==document.cookie.indexOf(b)?r:((document.cookie||"").match(RegExp(b+"=([^;]+)"))||[])[1]||r}catch(c){}},set:function(b,c){try{if(a)return a.setItem(b,c)&&0;document.cookie=b+"="+c+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(e){}}}}();"undefined"!==
typeof module&&(module.l=c)||"undefined"!==typeof exports&&(exports.j=c)||(PUBNUB=c)})();E=1;F=t;I=[];K="-pnpres";L=10;aa=310;ba=60;O=1E3;ca=/{([\w\-]+)}/g;function da(){return"x"+ ++E+""+ +new Date}function R(){return+new Date}U=function(){var a=Math.floor(20*Math.random());return function(b,c){return 0<b.indexOf("pubsub.")&&b.replace("pubsub","ps"+(c?T().split("-")[0]:20>++a?a:a=1))||b}}();function ea(a,b){function c(){v+b>R()?(clearTimeout(d),d=setTimeout(c,b)):(v=R(),a())}var d,v=0;return c}
function fa(a,b){var c=[];V(a||[],function(a){b(a)&&c.push(a)});return c}function ga(a,b){return a.replace(ca,function(a,d){return b[d]||a})}function W(a,b){return setTimeout(a,b)}function T(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}
function V(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var c=0,d=a.length;c<d;)b.call(a[c],a[c],c++);else for(c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function Y(a,b){var c=[];V(a||[],function(a,v){c.push(b(a,v))});return c}function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];V(a,function(a,d){d.f&&b.push(a)});return b.sort()}
function ha(){W(function(){F||(F=1,V(I,function(a){a()}))},O)}
function ia(a){function b(){}function c(a){a&&(g.g=0);!g.g&&g.length&&(g.g=1,w(g.shift()))}function d(a){V($(q),function(b){(b=q[b])&&a(b)})}var v=+a.windowing||L,J=(+a.timeout||aa)*O,y=(+a.keepalive||ba)*O,m=a.publish_key||"",k=a.subscribe_key||"",l=a.ssl?"s":"",e="http"+l+"://"+(a.origin||"pubsub.pubnub.com"),s=U(e),n=U(e),g=[],N=0,M=0,C=0,H=0,S=0,D=0,q={},w=a.xdr,Q=a._is_online||z(1),x=a.jsonp_cb||z(0),A=a.db||{get:u(),set:u()},B=a.uuid||A&&A.get(k+"uuid")||"",h={_reset_offline:function(){C&&C(1)},
LEAVE:function(a,b){var c={uuid:B},d=U(e),g=x();0<a.indexOf(K)||("0"!=g&&(c.callback=g),w({k:b||l,timeout:2E3,a:g,data:c,url:[d,"v2","presence","sub_key",k,"channel",Z(a),"leave"]}))},history:function(a,b){b=a.callback||b;var c=a.count||a.limit||100,e=a.reverse||"false",d=a.error||u(),g=a.channel,h=a.start,l=a.end,n={},m=x();if(!g)return error("Missing Channel");if(!b)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");n.stringtoken="true";n.count=c;n.reverse=e;m&&(n.callback=
m);h&&(n.start=h);l&&(n.end=l);w({a:m,data:n,c:function(a){b(a)},b:d,url:[s,"v2","history","sub-key",k,"channel",Z(g)]})},replay:function(a){var b=b||a.callback||u(),c=a.source,e=a.destination,d=a.stop,g=a.start,h=a.end,l=a.reverse;a=a.limit;var n=x(),G={};if(!c)return error("Missing Source Channel");if(!e)return error("Missing Destination Channel");if(!m)return error("Missing Publish Key");if(!k)return error("Missing Subscribe Key");"0"!=n&&(G.callback=n);d&&(G.stop="all");l&&(G.reverse="true");
g&&(G.start=g);h&&(G.end=h);a&&(G.count=a);w({a:n,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[s,"v1","replay",m,k,c,e],data:G})},time:function(a){var b=x();w({a:b,timeout:5*O,url:[s,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){b=b||a.callback||u();var e=a.message,d=a.channel,h=x();if(!e)return error("Missing Message");if(!d)return error("Missing Channel");if(!m)return error("Missing Publish Key");if(!k)return error("Missing Subscribe Key");e=JSON.stringify(e);
d=[s,"publish",m,k,0,Z(d),h,Z(e)];g.push({a:h,timeout:5*O,url:d,data:{uuid:B},c:function(a){b(a);c(1)},b:function(){b([0,"Failed",e]);c(1)}});c()},unsubscribe:function(a){a=a.channel;D=0;H=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+K}).join(",");V(a.split(","),function(a){F&&h.LEAVE(a,0);q[a]=0});F&&b()},subscribe:function(a,c){function g(a){a?W(l,O):(s=U(e,1),n=U(e,1),W(function(){h.time(g)},O));d(function(f){if(a&&f.d)return f.d=0,f.i(f.name);!a&&!f.d&&(f.d=1,f.disconnect(f.name))})}
function l(){var a=x(),f=$(q).join(",");f&&(C=w({timeout:Q,a:a,b:function(){h.time(g)},data:{uuid:B},url:[n,"subscribe",k,Z(f),a,D],c:function(a){if(!a)return W(l,ja);d(function(a){a.e||(a.e=1,a.h(a.name))});D=!D&&H&&A.get(k)||a[1];X&&(Timetoken=1E4,X=0);A.set(k,a[1]);var f=function(){var f=(2<a.length?a[2]:"").split(",");return function(){var a=f.shift()||"";return[(q[a]||{}).a||N,(a||M).split(K)[0]]}}();V(a[0],function(b){var c=f();if(q[c[1]].f)c[0](b,a,c[1])});W(l,ja)}}))}var m=a.channel;c=(c=
c||a.callback)||a.message;var na=a.connect||u(),oa=a.reconnect||u(),y=a.disconnect||u(),P=a.presence||0,G=a.noheresync||0,X=a.backfill||0,Q=a.timeout||J,ja=a.windowing||v;a.restore&&(H=1);D=0;if(!m)return error("Missing Channel");if(!c)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");V((m.join?m.join(","):""+m).split(","),function(a){var f=q[a]||{};q[M=a]={name:a,e:f.e,d:f.d,f:1,a:N=c,h:na,disconnect:y,i:oa};P&&(h.subscribe({channel:a+K,callback:P}),!f.f&&!G&&h.here_now({channel:a,
callback:function(f){V("uuids"in f?f.uuids:[],function(b){P({action:"join",uuid:b,timestamp:R(),occupancy:f.occupancy||1},f,a)})}}))});b=function(){h._reset_offline();clearTimeout(S);S=W(l,100)};if(!F)return I.push(b);b()},here_now:function(a,b){b=a.callback||b;var c=a.error||u(),e=a.channel,d=x(),g=r;if(!e)return error("Missing Channel");if(!b)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");"0"!=d&&(g={},g.callback=d);w({a:d,data:g,c:function(a){b(a)},b:c,url:[s,"v2",
"presence","sub_key",k,"channel",Z(e)]})},xdr:w,ready:ha,db:A,uuid:T,each:V,map:Y,grep:fa,supplant:ga,now:R,unique:da,updater:ea,poll_online:function(){Q()||h._reset_offline();W(h.poll_online,O)},poll_online2:function(){h.time(function(a){a||h._reset_offline();W(h.poll_online2,y)})}};B||(B=h.uuid());A.set(k+"uuid",B);W(h.poll_online,O);W(h.poll_online2,y);return h}
(function(){function a(b){function c(a){s||(s=1,clearTimeout(g),e&&(e.onerror=e.onload=r,e.abort&&e.abort(),e=r),a&&N())}function l(){if(!n){n=1;clearTimeout(g);try{response=JSON.parse(e.responseText)}catch(a){return c(1)}M(response)}}var e,s=0,n=0,g=W(function(){c(1)},J),N=b.b||u(),M=b.c||u();try{e="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;e.onerror=e.onabort=function(){c(1)};e.onload=e.onloadend=l;e.timeout=J;url=b.url.join(d);if(b.data){var C=[];url+="?";for(key in b.data)C.push(key+
"="+b.data[key]);url+=C.join(v)}e.open("GET",url,p);e.send()}catch(H){return c(0),a(b)}return c}function b(a,b,c){V(a.split(","),function(a){function d(a){a||(a=window.event);c(a)||(a.cancelBubble=p,a.returnValue=t,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,d,t):b.attachEvent?b.attachEvent("on"+a,d):b["on"+a]=d})}function c(d){d.db=y;d.xdr=a;var k=ia(d);k.init=c;if(d.notest)return k;b("beforeunload",window,function(){each_channel(function(a){k.LEAVE(a.name,
1)});return p});b("offline",window,k._reset_offline);b("offline",document,k._reset_offline);k.ready();return k}var d="/",v="&",J=31E4,y=function(){var a="undefined"!=typeof localStorage&&localStorage;return{get:function(b){try{return a?a.getItem(b):-1==document.cookie.indexOf(b)?r:((document.cookie||"").match(RegExp(b+"=([^;]+)"))||[])[1]||r}catch(c){}},set:function(b,c){try{if(a)return a.setItem(b,c)&&0;document.cookie=b+"="+c+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(d){}}}}();"undefined"!==
typeof module&&(module.l=c)||"undefined"!==typeof exports&&(exports.j=c)||(PUBNUB=c)})();E=1;F=t;I=[];K="-pnpres";L=10;aa=310;ba=60;O=1E3;ca=/{([\w\-]+)}/g;function da(){return"x"+ ++E+""+ +new Date}function R(){return+new Date}U=function(){var a=Math.floor(20*Math.random());return function(b,c){return 0<b.indexOf("pubsub.")&&b.replace("pubsub","ps"+(c?T().split("-")[0]:20>++a?a:a=1))||b}}();function ea(a,b){function c(){v+b>R()?(clearTimeout(d),d=setTimeout(c,b)):(v=R(),a())}var d,v=0;return c}
function fa(a,b){var c=[];V(a||[],function(a){b(a)&&c.push(a)});return c}function ga(a,b){return a.replace(ca,function(a,d){return b[d]||a})}function W(a,b){return setTimeout(a,b)}function T(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}
function V(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var c=0,d=a.length;c<d;)b.call(a[c],a[c],c++);else for(c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function Y(a,b){var c=[];V(a||[],function(a,v){c.push(b(a,v))});return c}function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];V(a,function(a,d){d.f&&b.push(a)});return b.sort()}
function ha(){W(function(){F||(F=1,V(I,function(a){a()}))},O)}
function ia(a){function b(){}function c(a){a&&(g.g=0);!g.g&&g.length&&(g.g=1,w(g.shift()))}function d(a){V($(q),function(b){(b=q[b])&&a(b)})}var v=+a.windowing||L,J=(+a.timeout||aa)*O,y=(+a.keepalive||ba)*O,m=a.publish_key||"",k=a.subscribe_key||"",l=a.ssl?"s":"",e="http"+l+"://"+(a.origin||"pubsub.pubnub.com"),s=U(e),n=U(e),g=[],N=0,M=0,C=0,H=0,S=0,D=0,q={},w=a.xdr,Q=a._is_online||z(1),x=a.jsonp_cb||z(0),A=a.db||{get:u(),set:u()},B=a.uuid||A&&A.get(k+"uuid")||"",h={_reset_offline:function(){C&&C(1)},
LEAVE:function(a,b){var c={uuid:B},d=U(e),g=x();0<a.indexOf(K)||("0"!=g&&(c.callback=g),w({k:b||l,timeout:2E3,a:g,data:c,url:[d,"v2","presence","sub_key",k,"channel",Z(a),"leave"]}))},history:function(a,b){b=a.callback||b;var c=a.count||a.limit||100,e=a.reverse||"false",d=a.error||u(),g=a.channel,h=a.start,l=a.end,n={},m=x();if(!g)return error("Missing Channel");if(!b)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");n.stringtoken="true";n.count=c;n.reverse=e;m&&(n.callback=
m);h&&(n.start=h);l&&(n.end=l);w({a:m,data:n,c:function(a){b(a)},b:d,url:[s,"v2","history","sub-key",k,"channel",Z(g)]})},replay:function(a){var b=b||a.callback||u(),c=a.source,e=a.destination,d=a.stop,g=a.start,h=a.end,l=a.reverse;a=a.limit;var n=x(),G={};if(!c)return error("Missing Source Channel");if(!e)return error("Missing Destination Channel");if(!m)return error("Missing Publish Key");if(!k)return error("Missing Subscribe Key");"0"!=n&&(G.callback=n);d&&(G.stop="all");l&&(G.reverse="true");
g&&(G.start=g);h&&(G.end=h);a&&(G.count=a);w({a:n,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[s,"v1","replay",m,k,c,e],data:G})},time:function(a){var b=x();w({a:b,timeout:5*O,url:[s,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){b=b||a.callback||u();var e=a.message,d=a.channel,h=x();if(!e)return error("Missing Message");if(!d)return error("Missing Channel");if(!m)return error("Missing Publish Key");if(!k)return error("Missing Subscribe Key");e=JSON.stringify(e);
d=[s,"publish",m,k,0,Z(d),h,Z(e)];g.push({a:h,timeout:5*O,url:d,data:{uuid:B},c:function(a){b(a);c(1)},b:function(){b([0,"Failed",e]);c(1)}});c()},unsubscribe:function(a){a=a.channel;D=0;H=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+K}).join(",");V(a.split(","),function(a){F&&h.LEAVE(a,0);q[a]=0});F&&b()},subscribe:function(a,c){function g(a){a?W(l,O):(s=U(e,1),n=U(e,1),W(function(){h.time(g)},O));d(function(b){if(a&&b.d)return b.d=0,b.i(b.name);!a&&!b.d&&(b.d=1,b.disconnect(b.name))})}
function l(){var a=x(),b=$(q).join(",");b&&(C=w({timeout:Q,a:a,b:function(){h.time(g)},data:{uuid:B},url:[n,"subscribe",k,Z(b),a,D],c:function(a){if(!a)return W(l,ja);d(function(a){a.e||(a.e=1,a.h(a.name))});D=!D&&H&&A.get(k)||a[1];X&&(Timetoken=1E4,X=0);A.set(k,a[1]);var b=function(){var b=(2<a.length?a[2]:"").split(",");return function(){var a=b.shift()||"";return[(q[a]||{}).a||N,(a||M).split(K)[0]]}}();V(a[0],function(f){var c=b();if(q[c[1]].f)c[0](f,a,c[1])});W(l,ja)}}))}var m=a.channel;c=(c=
c||a.callback)||a.message;var na=a.connect||u(),y=a.reconnect||u(),ka=a.disconnect||u(),P=a.presence||0,G=a.noheresync||0,X=a.backfill||0,Q=a.timeout||J,ja=a.windowing||v;a.restore&&(H=1);D=0;if(!m)return error("Missing Channel");if(!c)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");V((m.join?m.join(","):""+m).split(","),function(a){var b=q[a]||{};q[M=a]={name:a,e:b.e,d:b.d,f:1,a:N=c,h:na,disconnect:ka,i:y};P&&(h.subscribe({channel:a+K,callback:P}),!b.f&&!G&&h.here_now({channel:a,
callback:function(b){V("uuids"in b?b.uuids:[],function(f){P({action:"join",uuid:f,timestamp:R(),occupancy:b.occupancy||1},b,a)})}}))});b=function(){h._reset_offline();clearTimeout(S);S=W(l,100)};if(!F)return I.push(b);b()},here_now:function(a,b){b=a.callback||b;var c=a.error||u(),e=a.channel,d=x(),g=r;if(!e)return error("Missing Channel");if(!b)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");"0"!=d&&(g={},g.callback=d);w({a:d,data:g,c:function(a){b(a)},b:c,url:[s,"v2",
"presence","sub_key",k,"channel",Z(e)]})},xdr:w,ready:ha,db:A,uuid:T,each:V,map:Y,grep:fa,supplant:ga,now:R,unique:da,updater:ea,poll_online:function(){Q()||h._reset_offline();W(h.poll_online,O)},poll_online2:function(){h.time(function(a){a||h._reset_offline();W(h.poll_online2,y)})}};B||(B=h.uuid());A.set(k+"uuid",B);W(h.poll_online,O);W(h.poll_online2,y);return h}
(function(){function a(b){function c(a){s||(s=1,clearTimeout(g),e&&(e.onerror=e.onload=r,e.abort&&e.abort(),e=r),a&&N())}function l(){if(!n){n=1;clearTimeout(g);try{response=JSON.parse(e.responseText)}catch(a){return c(1)}M(response)}}var e,s=0,n=0,g=W(function(){c(1)},J),N=b.b||u(),M=b.c||u();try{e="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;e.onerror=e.onabort=function(){c(1)};e.onload=e.onloadend=l;e.timeout=J;url=b.url.join(d);if(b.data){var C=[];url+="?";for(key in b.data)C.push(key+
"="+b.data[key]);url+=C.join(v)}e.open("GET",url,p);e.send()}catch(H){return c(0),a(b)}return c}function b(a,b,c){V(a.split(","),function(a){function d(a){a||(a=window.event);c(a)||(a.cancelBubble=p,a.returnValue=t,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,d,t):b.attachEvent?b.attachEvent("on"+a,d):b["on"+a]=d})}function c(d){d.db=y;d.xdr=a;var k=ia(d);k.init=c;if(d.notest)return k;b("beforeunload",window,function(){each_channel(function(a){k.LEAVE(a.name,
1)});return p});b("offline",window,k._reset_offline);b("offline",document,k._reset_offline);k.ready();return k}var d="/",v="&",J=31E4,y=function(){var a="undefined"!=typeof localStorage&&localStorage;return{get:function(b){try{return a?a.getItem(b):-1==document.cookie.indexOf(b)?r:((document.cookie||"").match(RegExp(b+"=([^;]+)"))||[])[1]||r}catch(c){}},set:function(b,c){try{if(a)return a.setItem(b,c)&&0;document.cookie=b+"="+c+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(d){}}}}();"undefined"!==
typeof module&&(module.l=c)||"undefined"!==typeof exports&&(exports.j=c)||(PUBNUB=c)})();E=1;F=t;I=[];K="-pnpres";L=10;aa=310;ba=60;O=1E3;ca=/{([\w\-]+)}/g;function da(){return"x"+ ++E+""+ +new Date}function R(){return+new Date}U=function(){var a=Math.floor(20*Math.random());return function(b,c){return 0<b.indexOf("pubsub.")&&b.replace("pubsub","ps"+(c?T().split("-")[0]:20>++a?a:a=1))||b}}();function ea(a,b){function c(){v+b>R()?(clearTimeout(d),d=setTimeout(c,b)):(v=R(),a())}var d,v=0;return c}
function fa(a,b){var c=[];V(a||[],function(a){b(a)&&c.push(a)});return c}function ga(a,b){return a.replace(ca,function(a,d){return b[d]||a})}function W(a,b){return setTimeout(a,b)}function T(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}
function V(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var c=0,d=a.length;c<d;)b.call(a[c],a[c],c++);else for(c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function Y(a,b){var c=[];V(a||[],function(a,v){c.push(b(a,v))});return c}function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];V(a,function(a,d){d.f&&b.push(a)});return b.sort()}
function ha(){W(function(){F||(F=1,V(I,function(a){a()}))},O)}
function ia(a){function b(){}function c(a){a&&(g.g=0);!g.g&&g.length&&(g.g=1,w(g.shift()))}function d(a){V($(q),function(b){(b=q[b])&&a(b)})}var v=+a.windowing||L,J=(+a.timeout||aa)*O,y=(+a.keepalive||ba)*O,m=a.publish_key||"",k=a.subscribe_key||"",l=a.ssl?"s":"",e="http"+l+"://"+(a.origin||"pubsub.pubnub.com"),s=U(e),n=U(e),g=[],N=0,M=0,C=0,H=0,S=0,D=0,q={},w=a.xdr,Q=a._is_online||z(1),x=a.jsonp_cb||z(0),A=a.db||{get:u(),set:u()},B=a.uuid||A&&A.get(k+"uuid")||"",h={_reset_offline:function(){C&&C(1)},
LEAVE:function(a,b){var c={uuid:B},d=U(e),g=x();0<a.indexOf(K)||("0"!=g&&(c.callback=g),w({k:b||l,timeout:2E3,a:g,data:c,url:[d,"v2","presence","sub_key",k,"channel",Z(a),"leave"]}))},history:function(a,b){b=a.callback||b;var c=a.count||a.limit||100,d=a.reverse||"false",e=a.error||u(),g=a.channel,h=a.start,l=a.end,n={},m=x();if(!g)return error("Missing Channel");if(!b)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");n.stringtoken="true";n.count=c;n.reverse=d;m&&(n.callback=
m);h&&(n.start=h);l&&(n.end=l);w({a:m,data:n,c:function(a){b(a)},b:e,url:[s,"v2","history","sub-key",k,"channel",Z(g)]})},replay:function(a){var b=b||a.callback||u(),c=a.source,d=a.destination,e=a.stop,g=a.start,h=a.end,l=a.reverse;a=a.limit;var n=x(),G={};if(!c)return error("Missing Source Channel");if(!d)return error("Missing Destination Channel");if(!m)return error("Missing Publish Key");if(!k)return error("Missing Subscribe Key");"0"!=n&&(G.callback=n);e&&(G.stop="all");l&&(G.reverse="true");
g&&(G.start=g);h&&(G.end=h);a&&(G.count=a);w({a:n,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[s,"v1","replay",m,k,c,d],data:G})},time:function(a){var b=x();w({a:b,timeout:5*O,url:[s,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){b=b||a.callback||u();var d=a.message,e=a.channel,h=x();if(!d)return error("Missing Message");if(!e)return error("Missing Channel");if(!m)return error("Missing Publish Key");if(!k)return error("Missing Subscribe Key");d=JSON.stringify(d);
e=[s,"publish",m,k,0,Z(e),h,Z(d)];g.push({a:h,timeout:5*O,url:e,data:{uuid:B},c:function(a){b(a);c(1)},b:function(){b([0,"Failed",d]);c(1)}});c()},unsubscribe:function(a){a=a.channel;D=0;H=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+K}).join(",");V(a.split(","),function(a){F&&h.LEAVE(a,0);q[a]=0});F&&b()},subscribe:function(a,c){function g(a){a?W(l,O):(s=U(e,1),n=U(e,1),W(function(){h.time(g)},O));d(function(b){if(a&&b.d)return b.d=0,b.i(b.name);!a&&!b.d&&(b.d=1,b.disconnect(b.name))})}
function l(){var a=x(),b=$(q).join(",");b&&(C=w({timeout:Q,a:a,b:function(){h.time(g)},data:{uuid:B},url:[n,"subscribe",k,Z(b),a,D],c:function(a){if(!a)return W(l,ja);d(function(a){a.e||(a.e=1,a.h(a.name))});D=!D&&H&&A.get(k)||a[1];X&&(Timetoken=1E4,X=0);A.set(k,a[1]);var b=function(){var b=(2<a.length?a[2]:"").split(",");return function(){var a=b.shift()||"";return[(q[a]||{}).a||N,(a||M).split(K)[0]]}}();V(a[0],function(f){var c=b();if(q[c[1]].f)c[0](f,a,c[1])});W(l,ja)}}))}var m=a.channel;c=(c=
c||a.callback)||a.message;var na=a.connect||u(),y=a.reconnect||u(),ka=a.disconnect||u(),P=a.presence||0,G=a.noheresync||0,X=a.backfill||0,Q=a.timeout||J,ja=a.windowing||v;a.restore&&(H=1);D=0;if(!m)return error("Missing Channel");if(!c)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");V((m.join?m.join(","):""+m).split(","),function(a){var b=q[a]||{};q[M=a]={name:a,e:b.e,d:b.d,f:1,a:N=c,h:na,disconnect:ka,i:y};P&&(h.subscribe({channel:a+K,callback:P}),!b.f&&!G&&h.here_now({channel:a,
callback:function(b){V("uuids"in b?b.uuids:[],function(f){P({action:"join",uuid:f,timestamp:R(),occupancy:b.occupancy||1},b,a)})}}))});b=function(){h._reset_offline();clearTimeout(S);S=W(l,100)};if(!F)return I.push(b);b()},here_now:function(a,b){b=a.callback||b;var c=a.error||u(),d=a.channel,e=x(),g=r;if(!d)return error("Missing Channel");if(!b)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");"0"!=e&&(g={},g.callback=e);w({a:e,data:g,c:function(a){b(a)},b:c,url:[s,"v2",
"presence","sub_key",k,"channel",Z(d)]})},xdr:w,ready:ha,db:A,uuid:T,each:V,map:Y,grep:fa,supplant:ga,now:R,unique:da,updater:ea,poll_online:function(){Q()||h._reset_offline();W(h.poll_online,O)},poll_online2:function(){h.time(function(a){a||h._reset_offline();W(h.poll_online2,y)})}};B||(B=h.uuid());A.set(k+"uuid",B);W(h.poll_online,O);W(h.poll_online2,y);return h}
(function(){function a(b){function c(a){s||(s=1,clearTimeout(g),e&&(e.onerror=e.onload=r,e.abort&&e.abort(),e=r),a&&N())}function l(){if(!n){n=1;clearTimeout(g);try{response=JSON.parse(e.responseText)}catch(a){return c(1)}M(response)}}var e,s=0,n=0,g=W(function(){c(1)},J),N=b.b||u(),M=b.c||u();try{e="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;e.onerror=e.onabort=function(){c(1)};e.onload=e.onloadend=l;e.timeout=J;url=b.url.join(d);if(b.data){var C=[];url+="?";for(key in b.data)C.push(key+
"="+b.data[key]);url+=C.join(v)}e.open("GET",url,p);e.send()}catch(H){return c(0),a(b)}return c}function b(a,b,c){V(a.split(","),function(a){function d(a){a||(a=window.event);c(a)||(a.cancelBubble=p,a.returnValue=t,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,d,t):b.attachEvent?b.attachEvent("on"+a,d):b["on"+a]=d})}function c(d){d.db=y;d.xdr=a;var k=ia(d);k.init=c;if(d.notest)return k;b("beforeunload",window,function(){each_channel(function(a){k.LEAVE(a.name,
1)});return p});b("offline",window,k._reset_offline);b("offline",document,k._reset_offline);k.ready();return k}var d="/",v="&",J=31E4,y=function(){var a="undefined"!=typeof localStorage&&localStorage;return{get:function(b){try{return a?a.getItem(b):-1==document.cookie.indexOf(b)?r:((document.cookie||"").match(RegExp(b+"=([^;]+)"))||[])[1]||r}catch(c){}},set:function(b,c){try{if(a)return a.setItem(b,c)&&0;document.cookie=b+"="+c+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(d){}}}}();"undefined"!==
typeof module&&(module.l=c)||"undefined"!==typeof exports&&(exports.j=c)||(PUBNUB=c)})();E=1;F=t;I=[];K="-pnpres";L=10;aa=310;ba=60;O=1E3;ca=/{([\w\-]+)}/g;function da(){return"x"+ ++E+""+ +new Date}function R(){return+new Date}U=function(){var a=Math.floor(20*Math.random());return function(b,c){return 0<b.indexOf("pubsub.")&&b.replace("pubsub","ps"+(c?T().split("-")[0]:20>++a?a:a=1))||b}}();function ea(a,b){function c(){v+b>R()?(clearTimeout(d),d=setTimeout(c,b)):(v=R(),a())}var d,v=0;return c}
function fa(a,b){var c=[];V(a||[],function(a){b(a)&&c.push(a)});return c}function ga(a,b){return a.replace(ca,function(a,d){return b[d]||a})}function W(a,b){return setTimeout(a,b)}function T(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}
function V(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var c=0,d=a.length;c<d;)b.call(a[c],a[c],c++);else for(c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function Y(a,b){var c=[];V(a||[],function(a,v){c.push(b(a,v))});return c}function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];V(a,function(a,d){d.f&&b.push(a)});return b.sort()}
function ha(){W(function(){F||(F=1,V(I,function(a){a()}))},O)}
function ia(a){function b(){}function c(a){a&&(g.g=0);!g.g&&g.length&&(g.g=1,w(g.shift()))}function d(a){V($(q),function(b){(b=q[b])&&a(b)})}var v=+a.windowing||L,J=(+a.timeout||aa)*O,y=(+a.keepalive||ba)*O,m=a.publish_key||"",k=a.subscribe_key||"",l=a.ssl?"s":"",e="http"+l+"://"+(a.origin||"pubsub.pubnub.com"),s=U(e),n=U(e),g=[],N=0,M=0,C=0,H=0,S=0,D=0,q={},w=a.xdr,Q=a._is_online||z(1),x=a.jsonp_cb||z(0),A=a.db||{get:u(),set:u()},B=a.uuid||A&&A.get(k+"uuid")||"",h={_reset_offline:function(){C&&C(1)},
LEAVE:function(a,b){var c={uuid:B},d=U(e),g=x();0<a.indexOf(K)||("0"!=g&&(c.callback=g),w({k:b||l,timeout:2E3,a:g,data:c,url:[d,"v2","presence","sub_key",k,"channel",Z(a),"leave"]}))},history:function(a,b){b=a.callback||b;var c=a.count||a.limit||100,d=a.reverse||"false",e=a.error||u(),g=a.channel,h=a.start,l=a.end,n={},m=x();if(!g)return error("Missing Channel");if(!b)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");n.stringtoken="true";n.count=c;n.reverse=d;m&&(n.callback=
m);h&&(n.start=h);l&&(n.end=l);w({a:m,data:n,c:function(a){b(a)},b:e,url:[s,"v2","history","sub-key",k,"channel",Z(g)]})},replay:function(a){var b=b||a.callback||u(),c=a.source,d=a.destination,e=a.stop,g=a.start,h=a.end,l=a.reverse;a=a.limit;var n=x(),G={};if(!c)return error("Missing Source Channel");if(!d)return error("Missing Destination Channel");if(!m)return error("Missing Publish Key");if(!k)return error("Missing Subscribe Key");"0"!=n&&(G.callback=n);e&&(G.stop="all");l&&(G.reverse="true");
g&&(G.start=g);h&&(G.end=h);a&&(G.count=a);w({a:n,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[s,"v1","replay",m,k,c,d],data:G})},time:function(a){var b=x();w({a:b,timeout:5*O,url:[s,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){b=b||a.callback||u();var d=a.message,e=a.channel,h=x();if(!d)return error("Missing Message");if(!e)return error("Missing Channel");if(!m)return error("Missing Publish Key");if(!k)return error("Missing Subscribe Key");d=JSON.stringify(d);
e=[s,"publish",m,k,0,Z(e),h,Z(d)];g.push({a:h,timeout:5*O,url:e,data:{uuid:B},c:function(a){b(a);c(1)},b:function(){b([0,"Failed",d]);c(1)}});c()},unsubscribe:function(a){a=a.channel;D=0;H=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+K}).join(",");V(a.split(","),function(a){F&&h.LEAVE(a,0);q[a]=0});F&&b()},subscribe:function(a,c){function g(a){a?W(l,O):(s=U(e,1),n=U(e,1),W(function(){h.time(g)},O));d(function(b){if(a&&b.d)return b.d=0,b.i(b.name);!a&&!b.d&&(b.d=1,b.disconnect(b.name))})}
function l(){var a=x(),b=$(q).join(",");b&&(C=w({timeout:Q,a:a,b:function(){h.time(g)},data:{uuid:B},url:[n,"subscribe",k,Z(b),a,D],c:function(a){if(!a)return W(l,ja);d(function(a){a.e||(a.e=1,a.h(a.name))});D=!D&&H&&A.get(k)||a[1];X&&(Timetoken=1E4,X=0);A.set(k,a[1]);var b=function(){var b=(2<a.length?a[2]:"").split(",");return function(){var a=b.shift()||"";return[(q[a]||{}).a||N,(a||M).split(K)[0]]}}();V(a[0],function(f){var c=b();if(q[c[1]].f)c[0](f,a,c[1])});W(l,ja)}}))}var m=a.channel;c=(c=
c||a.callback)||a.message;var y=a.connect||u(),oa=a.reconnect||u(),ka=a.disconnect||u(),P=a.presence||0,G=a.noheresync||0,X=a.backfill||0,Q=a.timeout||J,ja=a.windowing||v;a.restore&&(H=1);D=0;if(!m)return error("Missing Channel");if(!c)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");V((m.join?m.join(","):""+m).split(","),function(a){var b=q[a]||{};q[M=a]={name:a,e:b.e,d:b.d,f:1,a:N=c,h:y,disconnect:ka,i:oa};P&&(h.subscribe({channel:a+K,callback:P}),!b.f&&!G&&h.here_now({channel:a,
callback:function(b){V("uuids"in b?b.uuids:[],function(f){P({action:"join",uuid:f,timestamp:R(),occupancy:b.occupancy||1},b,a)})}}))});b=function(){h._reset_offline();clearTimeout(S);S=W(l,100)};if(!F)return I.push(b);b()},here_now:function(a,b){b=a.callback||b;var c=a.error||u(),d=a.channel,e=x(),g=r;if(!d)return error("Missing Channel");if(!b)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");"0"!=e&&(g={},g.callback=e);w({a:e,data:g,c:function(a){b(a)},b:c,url:[s,"v2",
"presence","sub_key",k,"channel",Z(d)]})},xdr:w,ready:ha,db:A,uuid:T,each:V,map:Y,grep:fa,supplant:ga,now:R,unique:da,updater:ea,poll_online:function(){Q()||h._reset_offline();W(h.poll_online,O)},poll_online2:function(){h.time(function(a){a||h._reset_offline();W(h.poll_online2,y)})}};B||(B=h.uuid());A.set(k+"uuid",B);W(h.poll_online,O);W(h.poll_online2,y);return h}
(function(){function a(b){function c(a){s||(s=1,clearTimeout(g),e&&(e.onerror=e.onload=r,e.abort&&e.abort(),e=r),a&&N())}function l(){if(!n){n=1;clearTimeout(g);try{response=JSON.parse(e.responseText)}catch(a){return c(1)}M(response)}}var e,s=0,n=0,g=W(function(){c(1)},J),N=b.b||u(),M=b.c||u();try{e="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;e.onerror=e.onabort=function(){c(1)};e.onload=e.onloadend=l;e.timeout=J;url=b.url.join(d);if(b.data){var C=[];url+="?";for(key in b.data)C.push(key+
"="+b.data[key]);url+=C.join(v)}e.open("GET",url,p);e.send()}catch(H){return c(0),a(b)}return c}function b(a,b,c){V(a.split(","),function(a){function d(a){a||(a=window.event);c(a)||(a.cancelBubble=p,a.returnValue=t,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,d,t):b.attachEvent?b.attachEvent("on"+a,d):b["on"+a]=d})}function c(d){d.db=y;d.xdr=a;var k=ia(d);k.init=c;if(d.notest)return k;b("beforeunload",window,function(){each_channel(function(a){k.LEAVE(a.name,
1)});return p});b("offline",window,k._reset_offline);b("offline",document,k._reset_offline);k.ready();return k}var d="/",v="&",J=31E4,y=function(){var a="undefined"!=typeof localStorage&&localStorage;return{get:function(b){try{return a?a.getItem(b):-1==document.cookie.indexOf(b)?r:((document.cookie||"").match(RegExp(b+"=([^;]+)"))||[])[1]||r}catch(c){}},set:function(b,c){try{if(a)return a.setItem(b,c)&&0;document.cookie=b+"="+c+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(d){}}}}();"undefined"!==
typeof module&&(module.l=c)||"undefined"!==typeof exports&&(exports.j=c)||(PUBNUB=c)})();E=1;F=t;I=[];K="-pnpres";L=10;aa=310;ba=60;O=1E3;ca=/{([\w\-]+)}/g;function da(){return"x"+ ++E+""+ +new Date}function R(){return+new Date}U=function(){var a=Math.floor(20*Math.random());return function(b,c){return 0<b.indexOf("pubsub.")&&b.replace("pubsub","ps"+(c?T().split("-")[0]:20>++a?a:a=1))||b}}();function ea(a,b){function c(){v+b>R()?(clearTimeout(d),d=setTimeout(c,b)):(v=R(),a())}var d,v=0;return c}
function fa(a,b){var c=[];V(a||[],function(a){b(a)&&c.push(a)});return c}function ga(a,b){return a.replace(ca,function(a,d){return b[d]||a})}function W(a,b){return setTimeout(a,b)}function T(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}
function V(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var c=0,d=a.length;c<d;)b.call(a[c],a[c],c++);else for(c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function Y(a,b){var c=[];V(a||[],function(a,v){c.push(b(a,v))});return c}function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];V(a,function(a,d){d.f&&b.push(a)});return b.sort()}
function ha(){W(function(){F||(F=1,V(I,function(a){a()}))},O)}
function ia(a){function b(){}function c(a){a&&(g.g=0);!g.g&&g.length&&(g.g=1,w(g.shift()))}function d(a){V($(q),function(b){(b=q[b])&&a(b)})}var v=+a.windowing||L,J=(+a.timeout||aa)*O,y=(+a.keepalive||ba)*O,m=a.publish_key||"",k=a.subscribe_key||"",l=a.ssl?"s":"",e="http"+l+"://"+(a.origin||"pubsub.pubnub.com"),s=U(e),n=U(e),g=[],N=0,M=0,C=0,H=0,S=0,D=0,q={},w=a.xdr,Q=a._is_online||z(1),x=a.jsonp_cb||z(0),A=a.db||{get:u(),set:u()},B=a.uuid||A&&A.get(k+"uuid")||"",h={_reset_offline:function(){C&&C(1)},
LEAVE:function(a,b){var c={uuid:B},d=U(e),g=x();0<a.indexOf(K)||("0"!=g&&(c.callback=g),w({k:b||l,timeout:2E3,a:g,data:c,url:[d,"v2","presence","sub_key",k,"channel",Z(a),"leave"]}))},history:function(a,b){b=a.callback||b;var c=a.count||a.limit||100,d=a.reverse||"false",e=a.error||u(),g=a.channel,h=a.start,l=a.end,n={},m=x();if(!g)return error("Missing Channel");if(!b)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");n.stringtoken="true";n.count=c;n.reverse=d;m&&(n.callback=
m);h&&(n.start=h);l&&(n.end=l);w({a:m,data:n,c:function(a){b(a)},b:e,url:[s,"v2","history","sub-key",k,"channel",Z(g)]})},replay:function(a){var b=b||a.callback||u(),c=a.source,d=a.destination,e=a.stop,g=a.start,h=a.end,l=a.reverse;a=a.limit;var n=x(),q={};if(!c)return error("Missing Source Channel");if(!d)return error("Missing Destination Channel");if(!m)return error("Missing Publish Key");if(!k)return error("Missing Subscribe Key");"0"!=n&&(q.callback=n);e&&(q.stop="all");l&&(q.reverse="true");
g&&(q.start=g);h&&(q.end=h);a&&(q.count=a);w({a:n,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[s,"v1","replay",m,k,c,d],data:q})},time:function(a){var b=x();w({a:b,timeout:5*O,url:[s,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){b=b||a.callback||u();var d=a.message,e=a.channel,h=x();if(!d)return error("Missing Message");if(!e)return error("Missing Channel");if(!m)return error("Missing Publish Key");if(!k)return error("Missing Subscribe Key");d=JSON.stringify(d);
e=[s,"publish",m,k,0,Z(e),h,Z(d)];g.push({a:h,timeout:5*O,url:e,data:{uuid:B},c:function(a){b(a);c(1)},b:function(){b([0,"Failed",d]);c(1)}});c()},unsubscribe:function(a){a=a.channel;D=0;H=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+K}).join(",");V(a.split(","),function(a){F&&h.LEAVE(a,0);q[a]=0});F&&b()},subscribe:function(a,c){function g(a){a?W(l,O):(s=U(e,1),n=U(e,1),W(function(){h.time(g)},O));d(function(b){if(a&&b.d)return b.d=0,b.i(b.name);!a&&!b.d&&(b.d=1,b.disconnect(b.name))})}
function l(){var a=x(),b=$(q).join(",");b&&(C=w({timeout:pa,a:a,b:function(){h.time(g)},data:{uuid:B},url:[n,"subscribe",k,Z(b),a,D],c:function(a){if(!a)return W(l,ja);d(function(a){a.e||(a.e=1,a.h(a.name))});D=!D&&H&&A.get(k)||a[1];X&&(Timetoken=1E4,X=0);A.set(k,a[1]);var b=function(){var b=(2<a.length?a[2]:"").split(",");return function(){var a=b.shift()||"";return[(q[a]||{}).a||N,(a||M).split(K)[0]]}}();V(a[0],function(c){var f=b();if(q[f[1]].f)f[0](c,a,f[1])});W(l,ja)}}))}var m=a.channel;c=(c=
c||a.callback)||a.message;var y=a.connect||u(),oa=a.reconnect||u(),Q=a.disconnect||u(),P=a.presence||0,G=a.noheresync||0,X=a.backfill||0,pa=a.timeout||J,ja=a.windowing||v;a.restore&&(H=1);D=0;if(!m)return error("Missing Channel");if(!c)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");V((m.join?m.join(","):""+m).split(","),function(a){var b=q[a]||{};q[M=a]={name:a,e:b.e,d:b.d,f:1,a:N=c,h:y,disconnect:Q,i:oa};P&&(h.subscribe({channel:a+K,callback:P}),!b.f&&!G&&h.here_now({channel:a,
callback:function(b){V("uuids"in b?b.uuids:[],function(c){P({action:"join",uuid:c,timestamp:R(),occupancy:b.occupancy||1},b,a)})}}))});b=function(){h._reset_offline();clearTimeout(S);S=W(l,100)};if(!F)return I.push(b);b()},here_now:function(a,b){b=a.callback||b;var c=a.error||u(),d=a.channel,e=x(),g=r;if(!d)return error("Missing Channel");if(!b)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");"0"!=e&&(g={},g.callback=e);w({a:e,data:g,c:function(a){b(a)},b:c,url:[s,"v2",
"presence","sub_key",k,"channel",Z(d)]})},xdr:w,ready:ha,db:A,uuid:T,each:V,map:Y,grep:fa,supplant:ga,now:R,unique:da,updater:ea,poll_online:function(){Q()||h._reset_offline();W(h.poll_online,O)},poll_online2:function(){h.time(function(a){a||h._reset_offline();W(h.poll_online2,y)})}};B||(B=h.uuid());A.set(k+"uuid",B);W(h.poll_online,O);W(h.poll_online2,y);return h}
(function(){function a(b){function c(a){n||(n=1,clearTimeout(m),s&&(s.onerror=s.onload=r,s.abort&&s.abort(),s=r),a&&M())}function d(){if(!g){g=1;clearTimeout(m);try{response=JSON.parse(s.responseText)}catch(a){return c(1)}C(response)}}var s,n=0,g=0,m=W(function(){c(1)},y),M=b.b||u(),C=b.c||u();try{s="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;s.onerror=s.onabort=function(){c(1)};s.onload=s.onloadend=d;s.timeout=y;url=b.url.join(v);if(b.data){var H=[];url+="?";for(key in b.data)H.push(key+
"="+b.data[key]);url+=H.join(J)}s.open("GET",url,p);s.send()}catch(S){return c(0),a(b)}return c}function b(a,b,c){V(a.split(","),function(a){function d(a){a||(a=window.event);c(a)||(a.cancelBubble=p,a.returnValue=t,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,d,t):b.attachEvent?b.attachEvent("on"+a,d):b["on"+a]=d})}function c(a){return document.getElementById(a)}function d(k){k.db=m;k.xdr=a;var l=ia(k);l.init=d;l.$=c;if(k.notest)return l;
b("beforeunload",window,function(){each_channel(function(a){l.LEAVE(a.name,1)});return p});b("offline",window,l._reset_offline);b("offline",document,l._reset_offline);l.ready();return l}var v="/",J="&",y=31E4,m=function(){var a="undefined"!=typeof localStorage&&localStorage;return{get:function(b){try{return a?a.getItem(b):-1==document.cookie.indexOf(b)?r:((document.cookie||"").match(RegExp(b+"=([^;]+)"))||[])[1]||r}catch(c){}},set:function(b,c){try{if(a)return a.setItem(b,c)&&0;document.cookie=b+
"="+c+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(d){}}}}();"undefined"!==typeof module&&(module.l=d)||"undefined"!==typeof exports&&(exports.j=d)||(PUBNUB=d)})();E=1;F=t;I=[];K="-pnpres";L=10;aa=310;ba=60;O=1E3;ca=/{([\w\-]+)}/g;function da(){return"x"+ ++E+""+ +new Date}function R(){return+new Date}U=function(){var a=Math.floor(20*Math.random());return function(b,c){return 0<b.indexOf("pubsub.")&&b.replace("pubsub","ps"+(c?T().split("-")[0]:20>++a?a:a=1))||b}}();
function ea(a,b){function c(){v+b>R()?(clearTimeout(d),d=setTimeout(c,b)):(v=R(),a())}var d,v=0;return c}function fa(a,b){var c=[];V(a||[],function(a){b(a)&&c.push(a)});return c}function ga(a,b){return a.replace(ca,function(a,d){return b[d]||a})}function W(a,b){return setTimeout(a,b)}function T(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}
function V(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var c=0,d=a.length;c<d;)b.call(a[c],a[c],c++);else for(c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function Y(a,b){var c=[];V(a||[],function(a,v){c.push(b(a,v))});return c}function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];V(a,function(a,d){d.f&&b.push(a)});return b.sort()}
function ha(){W(function(){F||(F=1,V(I,function(a){a()}))},O)}
function ia(a){function b(){}function c(a){a&&(g.g=0);!g.g&&g.length&&(g.g=1,w(g.shift()))}function d(a){V($(q),function(b){(b=q[b])&&a(b)})}var v=+a.windowing||L,J=(+a.timeout||aa)*O,y=(+a.keepalive||ba)*O,m=a.publish_key||"",k=a.subscribe_key||"",l=a.ssl?"s":"",e="http"+l+"://"+(a.origin||"pubsub.pubnub.com"),s=U(e),n=U(e),g=[],N=0,M=0,C=0,H=0,S=0,D=0,q={},w=a.xdr,Q=a._is_online||z(1),x=a.jsonp_cb||z(0),A=a.db||{get:u(),set:u()},B=a.uuid||A&&A.get(k+"uuid")||"",h={_reset_offline:function(){C&&C(1)},
LEAVE:function(a,b){var c={uuid:B},d=U(e),g=x();0<a.indexOf(K)||("0"!=g&&(c.callback=g),w({k:b||l,timeout:2E3,a:g,data:c,url:[d,"v2","presence","sub_key",k,"channel",Z(a),"leave"]}))},history:function(a,b){b=a.callback||b;var c=a.count||a.limit||100,d=a.reverse||"false",e=a.error||u(),g=a.channel,h=a.start,n=a.end,l={},m=x();if(!g)return error("Missing Channel");if(!b)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");l.stringtoken="true";l.count=c;l.reverse=d;m&&(l.callback=
m);h&&(l.start=h);n&&(l.end=n);w({a:m,data:l,c:function(a){b(a)},b:e,url:[s,"v2","history","sub-key",k,"channel",Z(g)]})},replay:function(a){var b=b||a.callback||u(),c=a.source,d=a.destination,e=a.stop,g=a.start,h=a.end,n=a.reverse;a=a.limit;var l=x(),q={};if(!c)return error("Missing Source Channel");if(!d)return error("Missing Destination Channel");if(!m)return error("Missing Publish Key");if(!k)return error("Missing Subscribe Key");"0"!=l&&(q.callback=l);e&&(q.stop="all");n&&(q.reverse="true");
g&&(q.start=g);h&&(q.end=h);a&&(q.count=a);w({a:l,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[s,"v1","replay",m,k,c,d],data:q})},time:function(a){var b=x();w({a:b,timeout:5*O,url:[s,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){b=b||a.callback||u();var d=a.message,e=a.channel,h=x();if(!d)return error("Missing Message");if(!e)return error("Missing Channel");if(!m)return error("Missing Publish Key");if(!k)return error("Missing Subscribe Key");d=JSON.stringify(d);
e=[s,"publish",m,k,0,Z(e),h,Z(d)];g.push({a:h,timeout:5*O,url:e,data:{uuid:B},c:function(a){b(a);c(1)},b:function(){b([0,"Failed",d]);c(1)}});c()},unsubscribe:function(a){a=a.channel;D=0;H=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+K}).join(",");V(a.split(","),function(a){F&&h.LEAVE(a,0);q[a]=0});F&&b()},subscribe:function(a,c){function g(a){a?W(l,O):(s=U(e,1),n=U(e,1),W(function(){h.time(g)},O));d(function(b){if(a&&b.d)return b.d=0,b.i(b.name);!a&&!b.d&&(b.d=1,b.disconnect(b.name))})}
function l(){var a=x(),b=$(q).join(",");b&&(C=w({timeout:pa,a:a,b:function(){h.time(g)},data:{uuid:B},url:[n,"subscribe",k,Z(b),a,D],c:function(a){if(!a)return W(l,ja);d(function(a){a.e||(a.e=1,a.h(a.name))});D=!D&&H&&A.get(k)||a[1];X&&(Timetoken=1E4,X=0);A.set(k,a[1]);var b=function(){var b=(2<a.length?a[2]:"").split(",");return function(){var a=b.shift()||"";return[(q[a]||{}).a||N,(a||M).split(K)[0]]}}();V(a[0],function(c){var f=b();if(q[f[1]].f)f[0](c,a,f[1])});W(l,ja)}}))}var m=a.channel;c=(c=
c||a.callback)||a.message;var y=a.connect||u(),Q=a.reconnect||u(),ka=a.disconnect||u(),P=a.presence||0,G=a.noheresync||0,X=a.backfill||0,pa=a.timeout||J,ja=a.windowing||v;a.restore&&(H=1);D=0;if(!m)return error("Missing Channel");if(!c)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");V((m.join?m.join(","):""+m).split(","),function(a){var b=q[a]||{};q[M=a]={name:a,e:b.e,d:b.d,f:1,a:N=c,h:y,disconnect:ka,i:Q};P&&(h.subscribe({channel:a+K,callback:P}),!b.f&&!G&&h.here_now({channel:a,
callback:function(b){V("uuids"in b?b.uuids:[],function(c){P({action:"join",uuid:c,timestamp:R(),occupancy:b.occupancy||1},b,a)})}}))});b=function(){h._reset_offline();clearTimeout(S);S=W(l,100)};if(!F)return I.push(b);b()},here_now:function(a,b){b=a.callback||b;var c=a.error||u(),d=a.channel,e=x(),g=r;if(!d)return error("Missing Channel");if(!b)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");"0"!=e&&(g={},g.callback=e);w({a:e,data:g,c:function(a){b(a)},b:c,url:[s,"v2",
"presence","sub_key",k,"channel",Z(d)]})},xdr:w,ready:ha,db:A,uuid:T,each:V,map:Y,grep:fa,supplant:ga,now:R,unique:da,updater:ea,poll_online:function(){Q()||h._reset_offline();W(h.poll_online,O)},poll_online2:function(){h.time(function(a){a||h._reset_offline();W(h.poll_online2,y)})}};B||(B=h.uuid());A.set(k+"uuid",B);W(h.poll_online,O);W(h.poll_online2,y);return h}
(function(){function a(b){function c(a){n||(n=1,clearTimeout(m),s&&(s.onerror=s.onload=r,s.abort&&s.abort(),s=r),a&&M())}function d(){if(!g){g=1;clearTimeout(m);try{response=JSON.parse(s.responseText)}catch(a){return c(1)}C(response)}}var s,n=0,g=0,m=W(function(){c(1)},y),M=b.b||u(),C=b.c||u();try{s="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;s.onerror=s.onabort=function(){c(1)};s.onload=s.onloadend=d;s.timeout=y;url=b.url.join(v);if(b.data){var H=[];url+="?";for(key in b.data)H.push(key+
"="+b.data[key]);url+=H.join(J)}s.open("GET",url,p);s.send()}catch(S){return c(0),a(b)}return c}function b(a,b,c){V(a.split(","),function(a){function d(a){a||(a=window.event);c(a)||(a.cancelBubble=p,a.returnValue=t,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,d,t):b.attachEvent?b.attachEvent("on"+a,d):b["on"+a]=d})}function c(a){return document.getElementById(a)}function d(k){k.db=m;k.xdr=a;var l=ia(k);l.init=d;l.$=c;if(k.notest)return l;
b("beforeunload",window,function(){each_channel(function(a){l.LEAVE(a.name,1)});return p});b("offline",window,l._reset_offline);b("offline",document,l._reset_offline);l.ready();return l}var v="/",J="&",y=31E4,m=function(){var a="undefined"!=typeof localStorage&&localStorage;return{get:function(b){try{return a?a.getItem(b):-1==document.cookie.indexOf(b)?r:((document.cookie||"").match(RegExp(b+"=([^;]+)"))||[])[1]||r}catch(c){}},set:function(b,c){try{if(a)return a.setItem(b,c)&&0;document.cookie=b+
"="+c+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(d){}}}}();"undefined"!==typeof module&&(module.l=d)||"undefined"!==typeof exports&&(exports.j=d)||(PUBNUB=d)})();E=1;F=t;I=[];K="-pnpres";L=10;aa=310;ba=60;O=1E3;ca=/{([\w\-]+)}/g;function da(){return"x"+ ++E+""+ +new Date}function R(){return+new Date}U=function(){var a=Math.floor(20*Math.random());return function(b,c){return 0<b.indexOf("pubsub.")&&b.replace("pubsub","ps"+(c?T().split("-")[0]:20>++a?a:a=1))||b}}();
function ea(a,b){function c(){v+b>R()?(clearTimeout(d),d=setTimeout(c,b)):(v=R(),a())}var d,v=0;return c}function fa(a,b){var c=[];V(a||[],function(a){b(a)&&c.push(a)});return c}function ga(a,b){return a.replace(ca,function(a,d){return b[d]||a})}function W(a,b){return setTimeout(a,b)}function T(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}
function V(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var c=0,d=a.length;c<d;)b.call(a[c],a[c],c++);else for(c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function Y(a,b){var c=[];V(a||[],function(a,v){c.push(b(a,v))});return c}function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];V(a,function(a,d){d.f&&b.push(a)});return b.sort()}
function ha(){W(function(){F||(F=1,V(I,function(a){a()}))},O)}
function ia(a){function b(){}function c(a){a&&(g.g=0);!g.g&&g.length&&(g.g=1,w(g.shift()))}function d(a){V($(q),function(b){(b=q[b])&&a(b)})}var v=+a.windowing||L,J=(+a.timeout||aa)*O,y=(+a.keepalive||ba)*O,m=a.publish_key||"",k=a.subscribe_key||"",l=a.ssl?"s":"",e="http"+l+"://"+(a.origin||"pubsub.pubnub.com"),s=U(e),n=U(e),g=[],N=0,M=0,C=0,H=0,S=0,D=0,q={},w=a.xdr,Q=a._is_online||z(1),x=a.jsonp_cb||z(0),A=a.db||{get:u(),set:u()},B=a.uuid||A&&A.get(k+"uuid")||"",h={_reset_offline:function(){C&&C(1)},
LEAVE:function(a,b){var c={uuid:B},d=U(e),g=x();0<a.indexOf(K)||("0"!=g&&(c.callback=g),w({k:b||l,timeout:2E3,a:g,data:c,url:[d,"v2","presence","sub_key",k,"channel",Z(a),"leave"]}))},history:function(a,b){b=a.callback||b;var c=a.count||a.limit||100,d=a.reverse||"false",e=a.error||u(),g=a.channel,h=a.start,n=a.end,l={},m=x();if(!g)return error("Missing Channel");if(!b)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");l.stringtoken="true";l.count=c;l.reverse=d;m&&(l.callback=
m);h&&(l.start=h);n&&(l.end=n);w({a:m,data:l,c:function(a){b(a)},b:e,url:[s,"v2","history","sub-key",k,"channel",Z(g)]})},replay:function(a){var b=b||a.callback||u(),c=a.source,d=a.destination,e=a.stop,g=a.start,h=a.end,n=a.reverse;a=a.limit;var l=x(),q={};if(!c)return error("Missing Source Channel");if(!d)return error("Missing Destination Channel");if(!m)return error("Missing Publish Key");if(!k)return error("Missing Subscribe Key");"0"!=l&&(q.callback=l);e&&(q.stop="all");n&&(q.reverse="true");
g&&(q.start=g);h&&(q.end=h);a&&(q.count=a);w({a:l,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[s,"v1","replay",m,k,c,d],data:q})},time:function(a){var b=x();w({a:b,timeout:5*O,url:[s,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){b=b||a.callback||u();var d=a.message,e=a.channel,h=x();if(!d)return error("Missing Message");if(!e)return error("Missing Channel");if(!m)return error("Missing Publish Key");if(!k)return error("Missing Subscribe Key");d=JSON.stringify(d);
e=[s,"publish",m,k,0,Z(e),h,Z(d)];g.push({a:h,timeout:5*O,url:e,data:{uuid:B},c:function(a){b(a);c(1)},b:function(){b([0,"Failed",d]);c(1)}});c()},unsubscribe:function(a){a=a.channel;D=0;H=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+K}).join(",");V(a.split(","),function(a){F&&h.LEAVE(a,0);q[a]=0});F&&b()},subscribe:function(a,c){function g(a){a?W(l,O):(s=U(e,1),n=U(e,1),W(function(){h.time(g)},O));d(function(b){if(a&&b.d)return b.d=0,b.i(b.name);!a&&!b.d&&(b.d=1,b.disconnect(b.name))})}
function l(){var a=x(),b=$(q).join(",");b&&(C=w({timeout:pa,a:a,b:function(){h.time(g)},data:{uuid:B},url:[n,"subscribe",k,Z(b),a,D],c:function(a){if(!a)return W(l,ja);d(function(a){a.e||(a.e=1,a.h(a.name))});D=!D&&H&&A.get(k)||a[1];X&&(Timetoken=1E4,X=0);A.set(k,a[1]);var b=function(){var b=(2<a.length?a[2]:"").split(",");return function(){var a=b.shift()||"";return[(q[a]||{}).a||N,(a||M).split(K)[0]]}}();V(a[0],function(c){var f=b();if(q[f[1]].f)f[0](c,a,f[1])});W(l,ja)}}))}var m=a.channel;c=(c=
c||a.callback)||a.message;var y=a.connect||u(),Q=a.reconnect||u(),ka=a.disconnect||u(),P=a.presence||0,G=a.noheresync||0,X=a.backfill||0,pa=a.timeout||J,ja=a.windowing||v;a.restore&&(H=1);D=0;if(!m)return error("Missing Channel");if(!c)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");V((m.join?m.join(","):""+m).split(","),function(a){var b=q[a]||{};q[M=a]={name:a,e:b.e,d:b.d,f:1,a:N=c,h:y,disconnect:ka,i:Q};P&&(h.subscribe({channel:a+K,callback:P}),!b.f&&!G&&h.here_now({channel:a,
callback:function(b){V("uuids"in b?b.uuids:[],function(c){P({action:"join",uuid:c,timestamp:R(),occupancy:b.occupancy||1},b,a)})}}))});b=function(){h._reset_offline();clearTimeout(S);S=W(l,100)};if(!F)return I.push(b);b()},here_now:function(a,b){b=a.callback||b;var c=a.error||u(),d=a.channel,e=x(),g=r;if(!d)return error("Missing Channel");if(!b)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");"0"!=e&&(g={},g.callback=e);w({a:e,data:g,c:function(a){b(a)},b:c,url:[s,"v2",
"presence","sub_key",k,"channel",Z(d)]})},xdr:w,ready:ha,db:A,uuid:T,each:V,map:Y,grep:fa,supplant:ga,now:R,unique:da,updater:ea,poll_online:function(){Q()||h._reset_offline();W(h.poll_online,O)},poll_online2:function(){h.time(function(a){a||h._reset_offline();W(h.poll_online2,y)})}};B||(B=h.uuid());A.set(k+"uuid",B);W(h.poll_online,O);W(h.poll_online2,y);return h}
(function(){function a(b){function c(a){g||(g=1,clearTimeout(M),k&&(k.onerror=k.onload=r,k.abort&&k.abort(),k=r),a&&C())}function d(){if(!v){v=1;clearTimeout(M);try{response=JSON.parse(k.responseText)}catch(a){return c(1)}H(response)}}var k,g=0,v=0,M=W(function(){c(1)},m),C=b.b||u(),H=b.c||u();try{k="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;k.onerror=k.onabort=function(){c(1)};k.onload=k.onloadend=d;k.timeout=m;url=b.url.join(J);if(b.data){var S=[];url+="?";for(key in b.data)S.push(key+
"="+b.data[key]);url+=S.join(y)}k.open("GET",url,p);k.send()}catch(D){return c(0),a(b)}return c}function b(a,b,c){V(a.split(","),function(a){function d(a){a||(a=window.event);c(a)||(a.cancelBubble=p,a.returnValue=t,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,d,t):b.attachEvent?b.attachEvent("on"+a,d):b["on"+a]=d})}function c(a,b,c){if(c)a.setAttribute(b,c);else return a&&a.getAttribute&&a.getAttribute(b)}function d(a){return document.getElementById(a)}
function v(l){l.db=k;l.xdr=a;var e=ia(l);e.init=v;e.$=d;e.attr=c;if(l.notest)return e;b("beforeunload",window,function(){each_channel(function(a){e.LEAVE(a.name,1)});return p});b("offline",window,e._reset_offline);b("offline",document,e._reset_offline);e.ready();return e}var J="/",y="&",m=31E4,k=function(){var a="undefined"!=typeof localStorage&&localStorage;return{get:function(b){try{return a?a.getItem(b):-1==document.cookie.indexOf(b)?r:((document.cookie||"").match(RegExp(b+"=([^;]+)"))||[])[1]||
r}catch(c){}},set:function(b,c){try{if(a)return a.setItem(b,c)&&0;document.cookie=b+"="+c+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(d){}}}}();"undefined"!==typeof module&&(module.l=v)||"undefined"!==typeof exports&&(exports.j=v)||(PUBNUB=v)})();E=1;F=t;I=[];K="-pnpres";L=10;aa=310;ba=60;O=1E3;ca=/{([\w\-]+)}/g;function da(){return"x"+ ++E+""+ +new Date}function R(){return+new Date}
U=function(){var a=Math.floor(20*Math.random());return function(b,c){return 0<b.indexOf("pubsub.")&&b.replace("pubsub","ps"+(c?T().split("-")[0]:20>++a?a:a=1))||b}}();function ea(a,b){function c(){v+b>R()?(clearTimeout(d),d=setTimeout(c,b)):(v=R(),a())}var d,v=0;return c}function fa(a,b){var c=[];V(a||[],function(a){b(a)&&c.push(a)});return c}function ga(a,b){return a.replace(ca,function(a,d){return b[d]||a})}function W(a,b){return setTimeout(a,b)}
function T(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}function V(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var c=0,d=a.length;c<d;)b.call(a[c],a[c],c++);else for(c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function Y(a,b){var c=[];V(a||[],function(a,v){c.push(b(a,v))});return c}
function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];V(a,function(a,d){d.f&&b.push(a)});return b.sort()}function ha(){W(function(){F||(F=1,V(I,function(a){a()}))},O)}
function ia(a){function b(){}function c(a){a&&(g.g=0);!g.g&&g.length&&(g.g=1,w(g.shift()))}function d(a){V($(q),function(b){(b=q[b])&&a(b)})}var v=+a.windowing||L,J=(+a.timeout||aa)*O,y=(+a.keepalive||ba)*O,m=a.publish_key||"",k=a.subscribe_key||"",l=a.ssl?"s":"",e="http"+l+"://"+(a.origin||"pubsub.pubnub.com"),s=U(e),n=U(e),g=[],N=0,M=0,C=0,H=0,S=0,D=0,q={},w=a.xdr,Q=a._is_online||z(1),x=a.jsonp_cb||z(0),A=a.db||{get:u(),set:u()},B=a.uuid||A&&A.get(k+"uuid")||"",h={_reset_offline:function(){C&&C(1)},
LEAVE:function(a,b){var c={uuid:B},d=U(e),g=x();0<a.indexOf(K)||("0"!=g&&(c.callback=g),w({k:b||l,timeout:2E3,a:g,data:c,url:[d,"v2","presence","sub_key",k,"channel",Z(a),"leave"]}))},history:function(a,b){b=a.callback||b;var c=a.count||a.limit||100,d=a.reverse||"false",e=a.error||u(),g=a.channel,h=a.start,n=a.end,l={},m=x();if(!g)return error("Missing Channel");if(!b)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");l.stringtoken="true";l.count=c;l.reverse=d;m&&(l.callback=
m);h&&(l.start=h);n&&(l.end=n);w({a:m,data:l,c:function(a){b(a)},b:e,url:[s,"v2","history","sub-key",k,"channel",Z(g)]})},replay:function(a){var b=b||a.callback||u(),c=a.source,d=a.destination,e=a.stop,g=a.start,h=a.end,l=a.reverse;a=a.limit;var n=x(),q={};if(!c)return error("Missing Source Channel");if(!d)return error("Missing Destination Channel");if(!m)return error("Missing Publish Key");if(!k)return error("Missing Subscribe Key");"0"!=n&&(q.callback=n);e&&(q.stop="all");l&&(q.reverse="true");
g&&(q.start=g);h&&(q.end=h);a&&(q.count=a);w({a:n,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[s,"v1","replay",m,k,c,d],data:q})},time:function(a){var b=x();w({a:b,timeout:5*O,url:[s,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){b=b||a.callback||u();var d=a.message,e=a.channel,h=x();if(!d)return error("Missing Message");if(!e)return error("Missing Channel");if(!m)return error("Missing Publish Key");if(!k)return error("Missing Subscribe Key");d=JSON.stringify(d);
e=[s,"publish",m,k,0,Z(e),h,Z(d)];g.push({a:h,timeout:5*O,url:e,data:{uuid:B},c:function(a){b(a);c(1)},b:function(){b([0,"Failed",d]);c(1)}});c()},unsubscribe:function(a){a=a.channel;D=0;H=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+K}).join(",");V(a.split(","),function(a){F&&h.LEAVE(a,0);q[a]=0});F&&b()},subscribe:function(a,c){function g(a){a?W(l,O):(s=U(e,1),n=U(e,1),W(function(){h.time(g)},O));d(function(b){if(a&&b.d)return b.d=0,b.i(b.name);!a&&!b.d&&(b.d=1,b.disconnect(b.name))})}
function l(){var a=x(),b=$(q).join(",");b&&(C=w({timeout:pa,a:a,b:function(){h.time(g)},data:{uuid:B},url:[n,"subscribe",k,Z(b),a,D],c:function(a){if(!a)return W(l,ja);d(function(a){a.e||(a.e=1,a.h(a.name))});D=!D&&H&&A.get(k)||a[1];X&&(Timetoken=1E4,X=0);A.set(k,a[1]);var b=function(){var b=(2<a.length?a[2]:"").split(",");return function(){var a=b.shift()||"";return[(q[a]||{}).a||N,(a||M).split(K)[0]]}}();V(a[0],function(c){var d=b();if(q[d[1]].f)d[0](c,a,d[1])});W(l,ja)}}))}var m=a.channel;c=(c=
c||a.callback)||a.message;var y=a.connect||u(),Q=a.reconnect||u(),ka=a.disconnect||u(),P=a.presence||0,G=a.noheresync||0,X=a.backfill||0,pa=a.timeout||J,ja=a.windowing||v;a.restore&&(H=1);D=0;if(!m)return error("Missing Channel");if(!c)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");V((m.join?m.join(","):""+m).split(","),function(a){var b=q[a]||{};q[M=a]={name:a,e:b.e,d:b.d,f:1,a:N=c,h:y,disconnect:ka,i:Q};P&&(h.subscribe({channel:a+K,callback:P}),!b.f&&!G&&h.here_now({channel:a,
callback:function(b){V("uuids"in b?b.uuids:[],function(c){P({action:"join",uuid:c,timestamp:R(),occupancy:b.occupancy||1},b,a)})}}))});b=function(){h._reset_offline();clearTimeout(S);S=W(l,100)};if(!F)return I.push(b);b()},here_now:function(a,b){b=a.callback||b;var c=a.error||u(),d=a.channel,e=x(),g=r;if(!d)return error("Missing Channel");if(!b)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");"0"!=e&&(g={},g.callback=e);w({a:e,data:g,c:function(a){b(a)},b:c,url:[s,"v2",
"presence","sub_key",k,"channel",Z(d)]})},xdr:w,ready:ha,db:A,uuid:T,each:V,map:Y,grep:fa,supplant:ga,now:R,unique:da,updater:ea,poll_online:function(){Q()||h._reset_offline();W(h.poll_online,O)},poll_online2:function(){h.time(function(a){a||h._reset_offline();W(h.poll_online2,y)})}};B||(B=h.uuid());A.set(k+"uuid",B);W(h.poll_online,O);W(h.poll_online2,y);return h}
(function(){function a(b){function c(a){l||(l=1,clearTimeout(C),g&&(g.onerror=g.onload=r,g.abort&&g.abort(),g=r),a&&H())}function d(){if(!v){v=1;clearTimeout(C);try{response=JSON.parse(g.responseText)}catch(a){return c(1)}J(response)}}var g,l=0,v=0,C=W(function(){c(1)},k),H=b.b||u(),J=b.c||u();try{g="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;g.onerror=g.onabort=function(){c(1)};g.onload=g.onloadend=d;g.timeout=k;url=b.url.join(y);if(b.data){var D=[];url+="?";for(key in b.data)D.push(key+
"="+b.data[key]);url+=D.join(m)}g.open("GET",url,p);g.send()}catch(q){return c(0),a(b)}return c}function b(a,b,c){V(a.split(","),function(a){function d(a){a||(a=window.event);c(a)||(a.cancelBubble=p,a.returnValue=t,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,d,t):b.attachEvent?b.attachEvent("on"+a,d):b["on"+a]=d})}function c(a,b,c){if(c)a.setAttribute(b,c);else return a&&a.getAttribute&&a.getAttribute(b)}function d(a){return document.getElementById(a)}
function v(a,b){var c=[];V(a.split(/\s+/),function(a){V((b||document).getElementsByTagName(a),function(a){c.push(a)})});return c}function b(a,b,c){V(a.split(","),function(a){function d(a){a||(a=window.event);c(a)||(a.cancelBubble=p,a.returnValue=t,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,d,t):b.attachEvent?b.attachEvent("on"+a,d):b["on"+a]=d})}function J(e){e.db=l;e.xdr=a;var k=ia(e);k.init=J;k.$=d;k.attr=c;k.search=v;k.bind=
b;if(e.notest)return k;b("beforeunload",window,function(){each_channel(function(a){k.LEAVE(a.name,1)});return p});b("offline",window,k._reset_offline);b("offline",document,k._reset_offline);k.ready();return k}var y="/",m="&",k=31E4,l=function(){var a="undefined"!=typeof localStorage&&localStorage;return{get:function(b){try{return a?a.getItem(b):-1==document.cookie.indexOf(b)?r:((document.cookie||"").match(RegExp(b+"=([^;]+)"))||[])[1]||r}catch(c){}},set:function(b,c){try{if(a)return a.setItem(b,c)&&
0;document.cookie=b+"="+c+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(d){}}}}();"undefined"!==typeof module&&(module.l=J)||"undefined"!==typeof exports&&(exports.j=J)||(PUBNUB=J)})();E=1;F=t;I=[];K="-pnpres";L=10;aa=310;ba=60;O=1E3;ca=/{([\w\-]+)}/g;function da(){return"x"+ ++E+""+ +new Date}function R(){return+new Date}U=function(){var a=Math.floor(20*Math.random());return function(b,c){return 0<b.indexOf("pubsub.")&&b.replace("pubsub","ps"+(c?T().split("-")[0]:20>++a?a:a=1))||b}}();
function ea(a,b){function c(){v+b>R()?(clearTimeout(d),d=setTimeout(c,b)):(v=R(),a())}var d,v=0;return c}function fa(a,b){var c=[];V(a||[],function(a){b(a)&&c.push(a)});return c}function ga(a,b){return a.replace(ca,function(a,d){return b[d]||a})}function W(a,b){return setTimeout(a,b)}function T(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}
function V(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var c=0,d=a.length;c<d;)b.call(a[c],a[c],c++);else for(c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function Y(a,b){var c=[];V(a||[],function(a,v){c.push(b(a,v))});return c}function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];V(a,function(a,d){d.f&&b.push(a)});return b.sort()}
function ha(){W(function(){F||(F=1,V(I,function(a){a()}))},O)}
function ia(a){function b(){}function c(a){a&&(g.g=0);!g.g&&g.length&&(g.g=1,w(g.shift()))}function d(a){V($(q),function(b){(b=q[b])&&a(b)})}var v=+a.windowing||L,J=(+a.timeout||aa)*O,y=(+a.keepalive||ba)*O,m=a.publish_key||"",k=a.subscribe_key||"",l=a.ssl?"s":"",e="http"+l+"://"+(a.origin||"pubsub.pubnub.com"),s=U(e),n=U(e),g=[],N=0,M=0,C=0,H=0,S=0,D=0,q={},w=a.xdr,Q=a._is_online||z(1),x=a.jsonp_cb||z(0),A=a.db||{get:u(),set:u()},B=a.uuid||A&&A.get(k+"uuid")||"",h={_reset_offline:function(){C&&C(1)},
LEAVE:function(a,b){var c={uuid:B},d=U(e),g=x();0<a.indexOf(K)||("0"!=g&&(c.callback=g),w({k:b||l,timeout:2E3,a:g,data:c,url:[d,"v2","presence","sub_key",k,"channel",Z(a),"leave"]}))},history:function(a,b){b=a.callback||b;var c=a.count||a.limit||100,d=a.reverse||"false",e=a.error||u(),g=a.channel,h=a.start,l=a.end,n={},m=x();if(!g)return error("Missing Channel");if(!b)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");n.stringtoken="true";n.count=c;n.reverse=d;m&&(n.callback=
m);h&&(n.start=h);l&&(n.end=l);w({a:m,data:n,c:function(a){b(a)},b:e,url:[s,"v2","history","sub-key",k,"channel",Z(g)]})},replay:function(a){var b=b||a.callback||u(),c=a.source,d=a.destination,e=a.stop,g=a.start,h=a.end,l=a.reverse;a=a.limit;var n=x(),q={};if(!c)return error("Missing Source Channel");if(!d)return error("Missing Destination Channel");if(!m)return error("Missing Publish Key");if(!k)return error("Missing Subscribe Key");"0"!=n&&(q.callback=n);e&&(q.stop="all");l&&(q.reverse="true");
g&&(q.start=g);h&&(q.end=h);a&&(q.count=a);w({a:n,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[s,"v1","replay",m,k,c,d],data:q})},time:function(a){var b=x();w({a:b,timeout:5*O,url:[s,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){b=b||a.callback||u();var d=a.message,e=a.channel,h=x();if(!d)return error("Missing Message");if(!e)return error("Missing Channel");if(!m)return error("Missing Publish Key");if(!k)return error("Missing Subscribe Key");d=JSON.stringify(d);
e=[s,"publish",m,k,0,Z(e),h,Z(d)];g.push({a:h,timeout:5*O,url:e,data:{uuid:B},c:function(a){b(a);c(1)},b:function(){b([0,"Failed",d]);c(1)}});c()},unsubscribe:function(a){a=a.channel;D=0;H=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+K}).join(",");V(a.split(","),function(a){F&&h.LEAVE(a,0);q[a]=0});F&&b()},subscribe:function(a,c){function g(a){a?W(l,O):(s=U(e,1),n=U(e,1),W(function(){h.time(g)},O));d(function(b){if(a&&b.d)return b.d=0,b.i(b.name);!a&&!b.d&&(b.d=1,b.disconnect(b.name))})}
function l(){var a=x(),b=$(q).join(",");b&&(C=w({timeout:pa,a:a,b:function(){h.time(g)},data:{uuid:B},url:[n,"subscribe",k,Z(b),a,D],c:function(a){if(!a)return W(l,ja);d(function(a){a.e||(a.e=1,a.h(a.name))});D=!D&&H&&A.get(k)||a[1];X&&(Timetoken=1E4,X=0);A.set(k,a[1]);var b=function(){var b=(2<a.length?a[2]:"").split(",");return function(){var a=b.shift()||"";return[(q[a]||{}).a||N,(a||M).split(K)[0]]}}();V(a[0],function(c){var d=b();if(q[d[1]].f)d[0](c,a,d[1])});W(l,ja)}}))}var m=a.channel;c=(c=
c||a.callback)||a.message;var y=a.connect||u(),Q=a.reconnect||u(),ka=a.disconnect||u(),P=a.presence||0,G=a.noheresync||0,X=a.backfill||0,pa=a.timeout||J,ja=a.windowing||v;a.restore&&(H=1);D=0;if(!m)return error("Missing Channel");if(!c)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");V((m.join?m.join(","):""+m).split(","),function(a){var b=q[a]||{};q[M=a]={name:a,e:b.e,d:b.d,f:1,a:N=c,h:y,disconnect:ka,i:Q};P&&(h.subscribe({channel:a+K,callback:P}),!b.f&&!G&&h.here_now({channel:a,
callback:function(b){V("uuids"in b?b.uuids:[],function(c){P({action:"join",uuid:c,timestamp:R(),occupancy:b.occupancy||1},b,a)})}}))});b=function(){h._reset_offline();clearTimeout(S);S=W(l,100)};if(!F)return I.push(b);b()},here_now:function(a,b){b=a.callback||b;var c=a.error||u(),d=a.channel,e=x(),g=r;if(!d)return error("Missing Channel");if(!b)return error("Missing Callback");if(!k)return error("Missing Subscribe Key");"0"!=e&&(g={},g.callback=e);w({a:e,data:g,c:function(a){b(a)},b:c,url:[s,"v2",
"presence","sub_key",k,"channel",Z(d)]})},xdr:w,ready:ha,db:A,uuid:T,each:V,map:Y,grep:fa,supplant:ga,now:R,unique:da,updater:ea,poll_online:function(){Q()||h._reset_offline();W(h.poll_online,O)},poll_online2:function(){h.time(function(a){a||h._reset_offline();W(h.poll_online2,y)})}};B||(B=h.uuid());A.set(k+"uuid",B);W(h.poll_online,O);W(h.poll_online2,y);return h}
(function(){function a(b){function c(a){s||(s=1,clearTimeout(y),m&&(m.onerror=m.onload=r,m.abort&&m.abort(),m=r),a&&D())}function d(){if(!v){v=1;clearTimeout(y);try{response=JSON.parse(m.responseText)}catch(a){return c(1)}q(response)}}var m,s=0,v=0,y=W(function(){c(1)},e),D=b.b||u(),q=b.c||u();try{m="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;m.onerror=m.onabort=function(){c(1)};m.onload=m.onloadend=d;m.timeout=e;url=b.url.join(k);if(b.data){var w=[];url+="?";for(key in b.data)w.push(key+
"="+b.data[key]);url+=w.join(l)}m.open("GET",url,p);m.send()}catch(J){return c(0),a(b)}return c}function b(a,b,c){V(a.split(","),function(a){function d(a){a||(a=window.event);c(a)||(a.cancelBubble=p,a.returnValue=t,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,d,t):b.attachEvent?b.attachEvent("on"+a,d):b["on"+a]=d})}function c(a,b,c){if(c)a.setAttribute(b,c);else return a&&a.getAttribute&&a.getAttribute(b)}function d(a){return document.getElementById(a)}
function v(a,b){var c=[];V(a.split(/\s+/),function(a){V((b||document).getElementsByTagName(a),function(a){c.push(a)})});return c}function b(a,b,c){V(a.split(","),function(a){function d(a){a||(a=window.event);c(a)||(a.cancelBubble=p,a.returnValue=t,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,d,t):b.attachEvent?b.attachEvent("on"+a,d):b["on"+a]=d})}function J(a,b){for(var c in b)if(b.hasOwnProperty(c))try{a.style[c]=b[c]+(0<"|width|height|top|left|".indexOf(c)&&
"number"==typeof b[c]?"px":"")}catch(d){}}function y(a){return document.createElement(a)}function m(e){e.db=s;e.xdr=a;var g=ia(e);g.init=m;g.$=d;g.attr=c;g.search=v;g.bind=b;g.css=J;g.create=y;if(e.notest)return g;b("beforeunload",window,function(){each_channel(function(a){g.LEAVE(a.name,1)});return p});b("offline",window,g._reset_offline);b("offline",document,g._reset_offline);g.ready();return g}var k="/",l="&",e=31E4,s=function(){var a="undefined"!=typeof localStorage&&localStorage;return{get:function(b){try{return a?
a.getItem(b):-1==document.cookie.indexOf(b)?r:((document.cookie||"").match(RegExp(b+"=([^;]+)"))||[])[1]||r}catch(c){}},set:function(b,c){try{if(a)return a.setItem(b,c)&&0;document.cookie=b+"="+c+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(d){}}}}();"undefined"!==typeof module&&(module.l=m)||"undefined"!==typeof exports&&(exports.j=m)||(PUBNUB=m)})();
})();
