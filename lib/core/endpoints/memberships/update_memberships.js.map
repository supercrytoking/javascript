{"version":3,"sources":["core/endpoints/memberships/update_memberships.js"],"names":["prepareMessagePayload","modules","messagePayload","stringifiedPayload","JSON","stringify","getOperation","operationConstants","PNUpdateMembershipsOperation","validateParams","incomingParams","userId","spaces","getURL","config","subscribeKey","patchURL","usePatch","getRequestTimeout","getTransactionTimeout","isAuthSupported","prepareParams","include","limit","page","params","includes","totalCount","count","customFields","push","spaceFields","customSpaceFields","includesString","join","length","next","start","prev","end","patchPayload","addMemberships","updateMemberships","removeMemberships","payload","add","forEach","addMembership","currentAdd","id","custom","update","updateMembership","currentUpdate","remove","removeMembershipId","handleResponse","membershipsResponse"],"mappings":"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","sourcesContent":["/* @flow */\n\nimport {\n  AddMemberships,\n  UpdateMemberships,\n  MembershipsInput,\n  MembershipsListResponse,\n  ModulesInject,\n} from '../../flow_interfaces';\nimport operationConstants from '../../constants/operations';\n\nfunction prepareMessagePayload(modules, messagePayload) {\n  let stringifiedPayload = JSON.stringify(messagePayload);\n\n  return stringifiedPayload;\n}\n\nexport function getOperation(): string {\n  return operationConstants.PNUpdateMembershipsOperation;\n}\n\nexport function validateParams(\n  modules: ModulesInject,\n  incomingParams: MembershipsInput\n) {\n  let { userId, spaces } = incomingParams;\n\n  if (!userId) return 'Missing userId';\n  if (!spaces) return 'Missing spaces';\n}\n\nexport function getURL(\n  modules: ModulesInject,\n  incomingParams: MembershipsInput\n): string {\n  let { config } = modules;\n\n  return `/v1/objects/${config.subscribeKey}/users/${incomingParams.userId}/spaces`;\n}\n\nexport function patchURL(\n  modules: ModulesInject,\n  incomingParams: MembershipsInput\n): string {\n  let { config } = modules;\n\n  return `/v1/objects/${config.subscribeKey}/users/${incomingParams.userId}/spaces`;\n}\n\nexport function usePatch() {\n  return true;\n}\n\nexport function getRequestTimeout({ config }: ModulesInject) {\n  return config.getTransactionTimeout();\n}\n\nexport function isAuthSupported() {\n  return true;\n}\n\nexport function prepareParams(\n  modules: ModulesInject,\n  incomingParams: MembershipsInput\n): Object {\n  const { include, limit, page } = incomingParams;\n  const params = {};\n\n  if (limit) {\n    params.limit = limit;\n  }\n\n  if (include) {\n    let includes = [];\n\n    if (include.totalCount) {\n      params.count = true;\n    }\n\n    if (include.customFields) {\n      includes.push('custom');\n    }\n\n    if (include.spaceFields) {\n      includes.push('space');\n    }\n\n    if (include.customSpaceFields) {\n      includes.push('space.custom');\n    }\n\n    let includesString = includes.join(',');\n\n    if (includesString.length > 0) {\n      params.include = includesString;\n    }\n  }\n\n  if (page) {\n    if (page.next) {\n      params.start = page.next;\n    }\n    if (page.prev) {\n      params.end = page.prev;\n    }\n  }\n\n  return params;\n}\n\nexport function patchPayload(\n  modules: ModulesInject,\n  incomingParams: MembershipsInput\n): string {\n  const { addMemberships, updateMemberships, removeMemberships, spaces } = incomingParams;\n  let payload = {};\n\n  if (addMemberships && addMemberships.length > 0) {\n    payload.add = [];\n\n    addMemberships.forEach((addMembership) => {\n      let currentAdd: AddMemberships = { id: addMembership.id };\n\n      if (addMembership.custom) {\n        currentAdd.custom = addMembership.custom;\n      }\n\n      payload.add.push(currentAdd);\n    });\n  }\n\n  if (updateMemberships && updateMemberships.length > 0) {\n    payload.update = [];\n\n    updateMemberships.forEach((updateMembership) => {\n      let currentUpdate: UpdateMemberships = { id: updateMembership.id };\n\n      if (updateMembership.custom) {\n        currentUpdate.custom = updateMembership.custom;\n      }\n\n      payload.update.push(currentUpdate);\n    });\n  }\n\n  // if spaces is present then it is an update\n  if (spaces && spaces.length > 0) {\n    payload.update = payload.update || [];\n\n    spaces.forEach((updateMembership) => {\n      let currentUpdate: UpdateMemberships = { id: updateMembership.id };\n\n      if (updateMembership.custom) {\n        currentUpdate.custom = updateMembership.custom;\n      }\n\n      payload.update.push(currentUpdate);\n    });\n  }\n\n  if (removeMemberships && removeMemberships.length > 0) {\n    payload.remove = [];\n\n    removeMemberships.forEach((removeMembershipId) => {\n      payload.remove.push({ id: removeMembershipId });\n    });\n  }\n\n  return prepareMessagePayload(modules, payload);\n}\n\nexport function handleResponse(\n  modules: ModulesInject,\n  membershipsResponse: Object\n): MembershipsListResponse {\n  return membershipsResponse;\n}\n"],"file":"update_memberships.js"}