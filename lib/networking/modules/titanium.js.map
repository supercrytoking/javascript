{"version":3,"sources":["networking/modules/titanium.js"],"names":["get","post","log","req","_pickLogger","console","window","start","Date","getTime","timestamp","toISOString","logger","url","qs","on","res","now","elapsed","timestampDone","text","xdr","xhr","body","endpoint","callback","status","operation","enableKeepAlive","_config","keepAlive","onload","e","error","resp","statusCode","JSON","parse","responseText","onerror","errorData","category","_detectErrorCategory","timeout","send","params","Ti","Network","createHTTPClient","open","getStandardOrigin","call"],"mappings":"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","file":"titanium.js","sourcesContent":["/* @flow */\n/* Ti */\n\n\nfunction log(req: Object) {\n  let _pickLogger = () => {\n    if (console && console.log) return console; // eslint-disable-line no-console\n    if (window && window.console && window.console.log) return window.console;\n    return console;\n  };\n\n  let start = new Date().getTime();\n  let timestamp = new Date().toISOString();\n  let logger = _pickLogger();\n  logger.log('<<<<<');                                               // eslint-disable-line no-console\n  logger.log(`[${timestamp}]`, '\\n', req.url, '\\n', req.qs);    // eslint-disable-line no-console\n  logger.log('-----');                                               // eslint-disable-line no-console\n\n  req.on('response', (res) => {\n    let now = new Date().getTime();\n  let elapsed = now - start;\n  let timestampDone = new Date().toISOString();\n\n  logger.log('>>>>>>');                                                                                  // eslint-disable-line no-console\n  logger.log(`[${timestampDone} / ${elapsed}]`, '\\n', req.url, '\\n', req.qs, '\\n', res.text);  // eslint-disable-line no-console\n  logger.log('-----');                                                                                   // eslint-disable-line no-console\n});\n}\n\nfunction xdr(xhr, body: Object, endpoint: EndpointDefinition, callback: Function): Object {\n  let status: StatusAnnouncement = {};\n  status.operation = endpoint.operation;\n\n  xhr.enableKeepAlive = this._config.keepAlive || false;\n\n  xhr.onload = function (e) {\n    status.error = false;\n\n    if (resp && resp.status) {\n      status.statusCode = resp.status;\n    }\n\n    return callback(status, JSON.parse(this.responseText));\n  };\n\n  xhr.onerror = function (e) {\n    status.error = true;\n    status.errorData = e.error;\n    status.category = this._detectErrorCategory(e.error);\n    return callback(status, null);\n  };\n\n  xhr.timeout = 5000;\n\n  xhr.send(body);\n}\n\nexport function get(params: Object, endpoint: EndpointDefinition, callback: Function) {\n  var xhr = Ti.Network.createHTTPClient();\n\n  xhr.open(\"GET\", this.getStandardOrigin() + endpoint.url);\n\n  return xdr.call(this, xhr, {}, endpoint, callback);\n}\n\nexport function post(params: Object, body: string, endpoint: EndpointDefinition, callback: Function) {\n  var xhr = Ti.Network.createHTTPClient();\n\n  xhr.open(\"POST\", this.getStandardOrigin() + endpoint.url);\n\n  return xdr.call(this, xhr, JSON.parse(body), endpoint, callback);\n}\n\n// function buildURL(urlComponents, urlParams) {\n//   var url = urlComponents.join(defaultConfiguration.URLBIT);\n//   var params = [];\n//\n//   if (!urlParams) return url;\n//\n//   each(urlParams, function (key, value) {\n//     var valueStr = (typeof value === 'object') ? JSON['stringify'](value) : value;\n//     (typeof value !== 'undefined' &&\n//       value !== null && encode(valueStr).length > 0\n//     ) && params.push(key + '=' + encode(valueStr));\n//   });\n//\n//   url += '?' + params.join(defaultConfiguration.PARAMSBIT);\n//   return url;\n// }"]}