{"version":3,"sources":["core/components/endpoint.js"],"names":[],"mappings":";;;;;;kBAYe,UAAU,OAAV,EAAmB,QAAnB,EAAsC;AAAA,MAC7C,UAD6C,GACtB,OADsB,CAC7C,UAD6C;AAAA,MACjC,MADiC,GACtB,OADsB,CACjC,MADiC;;AAEnD,MAAI,WAAW,IAAf;AACA,MAAI,iBAAiB,EAArB;;AAEA,MAAI,SAAS,YAAT,OAA4B,iBAA5B,IAAiD,SAAS,YAAT,OAA4B,0BAAjF,EAA6G;AAC3G;AACD,GAFD,MAEO;AACL;AACA;AACD;;AAED,MAAI,mBAAmB,SAAS,cAAT,CAAwB,OAAxB,EAAiC,cAAjC,CAAvB;;AAEA,MAAI,gBAAJ,EAAsB;AACpB,aAAS,sBAAsB,gBAAtB,CAAT;AACA;AACD;;AAED,MAAI,iBAAiB,SAAS,aAAT,CAAuB,OAAvB,EAAgC,cAAhC,CAArB;;AAEA,iBAAe,IAAf,GAAsB,OAAO,IAA7B;;AAEA,SAAO,IAAP,CAAY,OAAO,UAAnB,EAA+B,OAA/B,CAAuC,UAAC,GAAD,EAAS;AAC9C,QAAI,QAAQ,OAAO,UAAP,CAAkB,GAAlB,CAAZ;AACA,QAAI,EAAE,OAAO,cAAT,CAAJ,EAA8B,eAAe,GAAf,IAAsB,KAAtB;AAC/B,GAHD;;AAKA,MAAI,OAAO,aAAX,EAA0B;AACxB,mBAAe,UAAf,GAA4B,OAAO,UAAnC;AACD;;AAED,MAAI,OAAO,YAAX,EAAyB;AACvB,mBAAe,SAAf,GAA2B,eAAc,EAAd,EAA3B;AACD;;AAED,MAAI,aAAa,SAAb,UAAa,CAAC,MAAD,EAA6B,OAA7B,EAAiD;AAChE,QAAI,OAAO,KAAX,EAAkB,OAAO,SAAS,MAAT,CAAP;;AAElB,aAAS,MAAT,EAAiB,SAAS,cAAT,CAAwB,OAAxB,EAAiC,OAAjC,EAA0C,cAA1C,CAAjB;AACD,GAJD;;AAMA,MAAI,qBAAJ;;AAEA,MAAI,SAAS,OAAT,IAAoB,SAAS,OAAT,CAAiB,OAAjB,EAA0B,cAA1B,CAAxB,EAAmE;AACjE,QAAI,MAAM,SAAS,OAAT,CAAiB,OAAjB,EAA0B,cAA1B,CAAV;AACA,QAAI,UAAU,SAAS,WAAT,CAAqB,OAArB,EAA8B,cAA9B,CAAd;AACA,mBAAe,WAAW,IAAX,CAAgB,cAAhB,EAAgC,OAAhC,EAAyC,EAAE,QAAF,EAAO,WAAW,SAAS,YAAT,EAAlB,EAAzC,EAAsF,UAAtF,CAAf;AACD,GAJD,MAIO;AACL,QAAI,OAAM,SAAS,MAAT,CAAgB,OAAhB,EAAyB,cAAzB,CAAV;AACA,mBAAe,WAAW,GAAX,CAAe,cAAf,EAA+B,EAAE,SAAF,EAAO,WAAW,SAAS,YAAT,EAAlB,EAA/B,EAA4E,UAA5E,CAAf;AACD;;AAED,MAAI,SAAS,YAAT,KAA0B,sBAA9B,EAAsD;AACpD,WAAO,YAAP;AACD;AACF,C;;AApED;;AACA;;;;;;AAEA,SAAS,WAAT,CAAqB,YAArB,EAA2C,IAA3C,EAAiE;AAC/D,eAAa,IAAb,GAAoB,IAApB;AACA,SAAO,YAAP;AACD;;AAED,SAAS,qBAAT,CAA+B,OAA/B,EAAwD;AACtD,SAAO,YAAY,EAAE,gBAAF,EAAZ,EAAyB,iBAAzB,CAAP;AACD","file":"core/components/endpoint.js","sourcesContent":["import { StatusAnnouncement } from '../flow_interfaces';\nimport uuidGenerator from 'uuid';\n\nfunction createError(errorPayload: Object, type: string): Object {\n  errorPayload.type = type;\n  return errorPayload;\n}\n\nfunction createValidationError(message: string): Object {\n  return createError({ message }, 'validationError');\n}\n\nexport default function (modules, endpoint, ...args) {\n  let { networking, config } = modules;\n  let callback = null;\n  let incomingParams = {};\n\n  if (endpoint.getOperation() === 'PNTimeOperation' || endpoint.getOperation() === 'PNChannelGroupsOperation') {\n    callback = args[0];\n  } else {\n    incomingParams = args[0];\n    callback = args[1];\n  }\n\n  let validationResult = endpoint.validateParams(modules, incomingParams);\n\n  if (validationResult) {\n    callback(createValidationError(validationResult));\n    return;\n  }\n\n  let outgoingParams = endpoint.prepareParams(modules, incomingParams);\n\n  outgoingParams.uuid = config.UUID;\n\n  Object.keys(config.baseParams).forEach((key) => {\n    let value = config.baseParams[key];\n    if (!(key in outgoingParams)) outgoingParams[key] = value;\n  });\n\n  if (config.useInstanceId) {\n    outgoingParams.instanceid = config.instanceId;\n  }\n\n  if (config.useRequestId) {\n    outgoingParams.requestid = uuidGenerator.v4();\n  }\n\n  let onResponse = (status: StatusAnnouncement, payload: Object) => {\n    if (status.error) return callback(status);\n\n    callback(status, endpoint.handleResponse(modules, payload, incomingParams));\n  };\n\n  let callInstance;\n\n  if (endpoint.usePost && endpoint.usePost(modules, incomingParams)) {\n    let url = endpoint.postURL(modules, incomingParams);\n    let payload = endpoint.postPayload(modules, incomingParams);\n    callInstance = networking.POST(outgoingParams, payload, { url, operation: endpoint.getOperation() }, onResponse);\n  } else {\n    let url = endpoint.getURL(modules, incomingParams);\n    callInstance = networking.GET(outgoingParams, { url, operation: endpoint.getOperation() }, onResponse);\n  }\n\n  if (endpoint.getOperation === 'PNSubscribeOperation') {\n    return callInstance;\n  }\n}\n"],"sourceRoot":"/source/"}